{"version":3,"file":"color-input.min.js","sources":["../node_modules/@preact/signals-core/dist/signals-core.module.js","../node_modules/colorjs.io/src/multiply-matrices.js","../node_modules/colorjs.io/src/util.js","../node_modules/colorjs.io/src/Type.js","../node_modules/colorjs.io/src/Format.js","../node_modules/colorjs.io/src/hooks.js","../node_modules/colorjs.io/src/adapt.js","../node_modules/colorjs.io/src/defaults.js","../node_modules/colorjs.io/src/parse.js","../node_modules/colorjs.io/src/getColor.js","../node_modules/colorjs.io/src/ColorSpace.js","../node_modules/colorjs.io/src/spaces/xyz-d65.js","../node_modules/colorjs.io/src/RGBColorSpace.js","../node_modules/colorjs.io/src/getAll.js","../node_modules/colorjs.io/src/get.js","../node_modules/colorjs.io/src/setAll.js","../node_modules/colorjs.io/src/set.js","../node_modules/colorjs.io/src/spaces/xyz-d50.js","../node_modules/colorjs.io/src/spaces/lab.js","../node_modules/colorjs.io/src/angles.js","../node_modules/colorjs.io/src/spaces/lch.js","../node_modules/colorjs.io/src/deltaE/deltaE2000.js","../node_modules/colorjs.io/src/spaces/oklab.js","../node_modules/colorjs.io/src/deltaE/deltaEOK.js","../node_modules/colorjs.io/src/inGamut.js","../node_modules/colorjs.io/src/clone.js","../node_modules/colorjs.io/src/deltaE/deltaECMC.js","../node_modules/colorjs.io/src/spaces/xyz-abs-d65.js","../node_modules/colorjs.io/src/spaces/jzazbz.js","../node_modules/colorjs.io/src/spaces/jzczhz.js","../node_modules/colorjs.io/src/spaces/ictcp.js","../node_modules/colorjs.io/src/spaces/cam16.js","../node_modules/colorjs.io/src/spaces/hct.js","../node_modules/colorjs.io/src/deltaE/deltaEHCT.js","../node_modules/colorjs.io/src/deltaE/index.js","../node_modules/colorjs.io/src/deltaE/deltaE76.js","../node_modules/colorjs.io/src/distance.js","../node_modules/colorjs.io/src/deltaE/deltaEJz.js","../node_modules/colorjs.io/src/deltaE/deltaEITP.js","../node_modules/colorjs.io/src/deltaE/deltaEOK2.js","../node_modules/colorjs.io/src/toGamut.js","../node_modules/colorjs.io/src/to.js","../node_modules/colorjs.io/src/spaces/rec2020-linear.js","../node_modules/colorjs.io/src/spaces/rec2020.js","../node_modules/colorjs.io/src/spaces/p3-linear.js","../node_modules/colorjs.io/src/spaces/srgb-linear.js","../node_modules/colorjs.io/src/keywords.js","../node_modules/colorjs.io/src/spaces/srgb.js","../node_modules/colorjs.io/src/spaces/p3.js","../node_modules/colorjs.io/src/luminance.js","../node_modules/colorjs.io/src/contrast/APCA.js","../node_modules/colorjs.io/src/contrast/Lstar.js","../node_modules/colorjs.io/src/spaces/lab-d65.js","../node_modules/colorjs.io/src/contrast/deltaPhi.js","../node_modules/colorjs.io/src/contrast/Michelson.js","../node_modules/colorjs.io/src/contrast/WCAG21.js","../node_modules/colorjs.io/src/contrast/Weber.js","../node_modules/colorjs.io/src/contrast.js","../node_modules/colorjs.io/src/spaces/hsl.js","../node_modules/colorjs.io/src/spaces/hsv.js","../node_modules/colorjs.io/src/spaces/hwb.js","../node_modules/colorjs.io/src/spaces/a98rgb-linear.js","../node_modules/colorjs.io/src/spaces/a98rgb.js","../node_modules/colorjs.io/src/spaces/prophoto-linear.js","../node_modules/colorjs.io/src/spaces/prophoto.js","../node_modules/colorjs.io/src/spaces/oklch.js","../src/color.ts","../src/utils/channel-formatting.ts","../src/utils/color-conversion.ts","../src/utils/positioning.ts","../src/color-input.ts","../src/utils/template.ts","../node_modules/colorjs.io/src/serialize.js"],"sourcesContent":["var i=Symbol.for(\"preact-signals\");function t(){if(!(s>1)){var i,t=!1;while(void 0!==h){var r=h;h=void 0;f++;while(void 0!==r){var o=r.o;r.o=void 0;r.f&=-3;if(!(8&r.f)&&c(r))try{r.c()}catch(r){if(!t){i=r;t=!0}}r=o}}f=0;s--;if(t)throw i}else s--}function r(i){if(s>0)return i();s++;try{return i()}finally{t()}}var o=void 0;function n(i){var t=o;o=void 0;try{return i()}finally{o=t}}var h=void 0,s=0,f=0,v=0;function e(i){if(void 0!==o){var t=i.n;if(void 0===t||t.t!==o){t={i:0,S:i,p:o.s,n:void 0,t:o,e:void 0,x:void 0,r:t};if(void 0!==o.s)o.s.n=t;o.s=t;i.n=t;if(32&o.f)i.S(t);return t}else if(-1===t.i){t.i=0;if(void 0!==t.n){t.n.p=t.p;if(void 0!==t.p)t.p.n=t.n;t.p=o.s;t.n=void 0;o.s.n=t;o.s=t}return t}}}function u(i,t){this.v=i;this.i=0;this.n=void 0;this.t=void 0;this.W=null==t?void 0:t.watched;this.Z=null==t?void 0:t.unwatched;this.name=null==t?void 0:t.name}u.prototype.brand=i;u.prototype.h=function(){return!0};u.prototype.S=function(i){var t=this,r=this.t;if(r!==i&&void 0===i.e){i.x=r;this.t=i;if(void 0!==r)r.e=i;else n(function(){var i;null==(i=t.W)||i.call(t)})}};u.prototype.U=function(i){var t=this;if(void 0!==this.t){var r=i.e,o=i.x;if(void 0!==r){r.x=o;i.e=void 0}if(void 0!==o){o.e=r;i.x=void 0}if(i===this.t){this.t=o;if(void 0===o)n(function(){var i;null==(i=t.Z)||i.call(t)})}}};u.prototype.subscribe=function(i){var t=this;return E(function(){var r=t.value,n=o;o=void 0;try{i(r)}finally{o=n}},{name:\"sub\"})};u.prototype.valueOf=function(){return this.value};u.prototype.toString=function(){return this.value+\"\"};u.prototype.toJSON=function(){return this.value};u.prototype.peek=function(){var i=o;o=void 0;try{return this.value}finally{o=i}};Object.defineProperty(u.prototype,\"value\",{get:function(){var i=e(this);if(void 0!==i)i.i=this.i;return this.v},set:function(i){if(i!==this.v){if(f>100)throw new Error(\"Cycle detected\");this.v=i;this.i++;v++;s++;try{for(var r=this.t;void 0!==r;r=r.x)r.t.N()}finally{t()}}}});function d(i,t){return new u(i,t)}function c(i){for(var t=i.s;void 0!==t;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function a(i){for(var t=i.s;void 0!==t;t=t.n){var r=t.S.n;if(void 0!==r)t.r=r;t.S.n=t;t.i=-1;if(void 0===t.n){i.s=t;break}}}function l(i){var t=i.s,r=void 0;while(void 0!==t){var o=t.p;if(-1===t.i){t.S.U(t);if(void 0!==o)o.n=t.n;if(void 0!==t.n)t.n.p=o}else r=t;t.S.n=t.r;if(void 0!==t.r)t.r=void 0;t=o}i.s=r}function y(i,t){u.call(this,void 0);this.x=i;this.s=void 0;this.g=v-1;this.f=4;this.W=null==t?void 0:t.watched;this.Z=null==t?void 0:t.unwatched;this.name=null==t?void 0:t.name}y.prototype=new u;y.prototype.h=function(){this.f&=-3;if(1&this.f)return!1;if(32==(36&this.f))return!0;this.f&=-5;if(this.g===v)return!0;this.g=v;this.f|=1;if(this.i>0&&!c(this)){this.f&=-2;return!0}var i=o;try{a(this);o=this;var t=this.x();if(16&this.f||this.v!==t||0===this.i){this.v=t;this.f&=-17;this.i++}}catch(i){this.v=i;this.f|=16;this.i++}o=i;l(this);this.f&=-2;return!0};y.prototype.S=function(i){if(void 0===this.t){this.f|=36;for(var t=this.s;void 0!==t;t=t.n)t.S.S(t)}u.prototype.S.call(this,i)};y.prototype.U=function(i){if(void 0!==this.t){u.prototype.U.call(this,i);if(void 0===this.t){this.f&=-33;for(var t=this.s;void 0!==t;t=t.n)t.S.U(t)}}};y.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var i=this.t;void 0!==i;i=i.x)i.t.N()}};Object.defineProperty(y.prototype,\"value\",{get:function(){if(1&this.f)throw new Error(\"Cycle detected\");var i=e(this);this.h();if(void 0!==i)i.i=this.i;if(16&this.f)throw this.v;return this.v}});function w(i,t){return new y(i,t)}function _(i){var r=i.u;i.u=void 0;if(\"function\"==typeof r){s++;var n=o;o=void 0;try{r()}catch(t){i.f&=-2;i.f|=8;b(i);throw t}finally{o=n;t()}}}function b(i){for(var t=i.s;void 0!==t;t=t.n)t.S.U(t);i.x=void 0;i.s=void 0;_(i)}function g(i){if(o!==this)throw new Error(\"Out-of-order effect\");l(this);o=i;this.f&=-2;if(8&this.f)b(this);t()}function p(i,t){this.x=i;this.u=void 0;this.s=void 0;this.o=void 0;this.f=32;this.name=null==t?void 0:t.name}p.prototype.c=function(){var i=this.S();try{if(8&this.f)return;if(void 0===this.x)return;var t=this.x();if(\"function\"==typeof t)this.u=t}finally{i()}};p.prototype.S=function(){if(1&this.f)throw new Error(\"Cycle detected\");this.f|=1;this.f&=-9;_(this);a(this);s++;var i=o;o=this;return g.bind(this,i)};p.prototype.N=function(){if(!(2&this.f)){this.f|=2;this.o=h;h=this}};p.prototype.d=function(){this.f|=8;if(!(1&this.f))b(this)};p.prototype.dispose=function(){this.d()};function E(i,t){var r=new p(i,t);try{r.c()}catch(i){r.d();throw i}var o=r.d.bind(r);o[Symbol.dispose]=o;return o}export{y as Computed,p as Effect,u as Signal,r as batch,w as computed,E as effect,d as signal,n as untracked};//# sourceMappingURL=signals-core.module.js.map\n","/** @import { Matrix3x3, Vector3 } from \"./types.js\" */\n\n/**\n * A is m x n. B is n x p. product is m x p.\n *\n * Array arguments are treated like vectors:\n * - A becomes 1 x n\n * - B becomes n x 1\n *\n * Returns Matrix m x p or equivalent array or number\n *\n * @overload\n * @param {number[]} A Vector 1 x n\n * @param {number[]} B Vector n x 1\n * @returns {number} Scalar number\n *\n * @overload\n * @param {number[][]} A Matrix m x n\n * @param {number[]} B Vector n x 1\n * @returns {number[]} Array with length m\n *\n * @overload\n * @param {number[]} A Vector 1 x n\n * @param {number[][]} B Matrix n x p\n * @returns {number[]} Array with length p\n *\n * @overload\n * @param {number[][]} A Matrix m x n\n * @param {number[][]} B Matrix n x p\n * @returns {number[][]} Matrix m x p\n *\n * @param {number[] | number[][]} A Matrix m x n or a vector\n * @param {number[] | number[][]} B Matrix n x p or a vector\n * @returns {number | number[] | number[][]} Matrix m x p or equivalent array or number\n */\nexport default function multiplyMatrices (A, B) {\n\tlet m = A.length;\n\t/** @type {number[][]} */\n\tlet AM;\n\t/** @type {number[][]} */\n\tlet BM;\n\tlet aVec = false;\n\tlet bVec = false;\n\n\tif (!Array.isArray(A[0])) {\n\t\t// A is vector, convert to [[a, b, c, ...]]\n\t\tAM = [/** @type {number[]} */ (A)];\n\t\tm = AM.length;\n\t\taVec = true;\n\t}\n\telse {\n\t\tAM = /** @type {number[][]} */ (A);\n\t}\n\n\tif (!Array.isArray(B[0])) {\n\t\t// B is vector, convert to [[a], [b], [c], ...]]\n\t\tBM = B.length > 0 ? B.map(x => [x]) : [[]]; // Avoid mapping empty array\n\t\tbVec = true;\n\t}\n\telse {\n\t\tBM = /** @type {number[][]} */ (B);\n\t}\n\n\tlet p = BM[0].length;\n\tlet BM_cols = BM[0].map((_, i) => BM.map(x => x[i])); // transpose B\n\t/** @type {number[] | number[][]} */\n\tlet product = AM.map(row =>\n\t\tBM_cols.map(col => {\n\t\t\tlet ret = 0;\n\n\t\t\tif (!Array.isArray(row)) {\n\t\t\t\tfor (let c of col) {\n\t\t\t\t\tret += row * c;\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < row.length; i++) {\n\t\t\t\tret += row[i] * (col[i] || 0);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}));\n\n\tif (m === 1 && aVec) {\n\t\tproduct = product[0]; // Avoid [[a, b, c, ...]]\n\t}\n\tif (p === 1 && bVec) {\n\t\tif (m === 1 && aVec) {\n\t\t\treturn product[0]; // Avoid [[a]], return a number\n\t\t}\n\t\telse {\n\t\t\treturn product.map(x => x[0]); // Avoid [[a], [b], [c], ...]]\n\t\t}\n\t}\n\n\treturn product;\n}\n\n// dot3 and transform functions adapted from https://github.com/texel-org/color/blob/9793c7d4d02b51f068e0f3fd37131129a4270396/src/core.js\n//\n// The MIT License (MIT)\n// Copyright (c) 2024 Matt DesLauriers\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n// IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE\n// OR OTHER DEALINGS IN THE SOFTWARE.\n\n/**\n * Returns the dot product of two vectors each with a length of 3.\n *\n * @param {Vector3} a\n * @param {Vector3} b\n * @returns {number}\n */\nfunction dot3 (a, b) {\n\treturn a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n\n/**\n * Transforms a vector of length 3 by a 3x3 matrix. Specify the same input and output\n * vector to transform in place.\n *\n * @param {Vector3} input\n * @param {Matrix3x3} matrix\n * @param {Vector3} [out]\n * @returns {Vector3}\n */\nexport function multiply_v3_m3x3 (input, matrix, out = [0, 0, 0]) {\n\tconst x = dot3(input, matrix[0]);\n\tconst y = dot3(input, matrix[1]);\n\tconst z = dot3(input, matrix[2]);\n\tout[0] = x;\n\tout[1] = y;\n\tout[2] = z;\n\treturn out;\n}\n","/**\n * Various utility functions\n */\n\nexport { default as multiplyMatrices, multiply_v3_m3x3 } from \"./multiply-matrices.js\";\n\n/**\n * Check if a value is a string (including a String object)\n * @param {any} str - Value to check\n * @returns {str is string}\n */\nexport function isString (str) {\n\treturn type(str) === \"string\";\n}\n\n/**\n * Determine the internal JavaScript [[Class]] of an object.\n * @param {any} o - Value to check\n * @returns {string}\n */\nexport function type (o) {\n\tlet str = Object.prototype.toString.call(o);\n\n\treturn (str.match(/^\\[object\\s+(.*?)\\]$/)[1] || \"\").toLowerCase();\n}\n\n/**\n * @param {number} n\n * @param {{ precision?: number | undefined, unit?: string | undefined }} options\n * @returns {string}\n */\nexport function serializeNumber (n, { precision = 16, unit }) {\n\tif (isNone(n)) {\n\t\treturn \"none\";\n\t}\n\n\tn = +toPrecision(n, precision);\n\n\treturn n + (unit ?? \"\");\n}\n\n/**\n * Check if a value corresponds to a none argument\n * @param {any} n - Value to check\n * @returns {n is null}\n */\nexport function isNone (n) {\n\treturn n === null;\n}\n\n/**\n * Replace none values with 0\n * @param {number | null} n\n * @returns {number}\n */\nexport function skipNone (n) {\n\treturn isNone(n) ? 0 : n;\n}\n\n/**\n * Round a number to a certain number of significant digits\n * @param {number} n - The number to round\n * @param {number} precision - Number of significant digits\n */\nexport function toPrecision (n, precision) {\n\tif (n === 0) {\n\t\treturn 0;\n\t}\n\tlet integer = ~~n;\n\tlet digits = 0;\n\tif (integer && precision) {\n\t\tdigits = ~~Math.log10(Math.abs(integer)) + 1;\n\t}\n\tconst multiplier = 10.0 ** (precision - digits);\n\treturn Math.floor(n * multiplier + 0.5) / multiplier;\n}\n\n/**\n * @param {number} start\n * @param {number} end\n * @param {number} p\n */\nexport function interpolate (start, end, p) {\n\tif (isNaN(start)) {\n\t\treturn end;\n\t}\n\n\tif (isNaN(end)) {\n\t\treturn start;\n\t}\n\n\treturn start + (end - start) * p;\n}\n\n/**\n * @param {number} start\n * @param {number} end\n * @param {number} value\n */\nexport function interpolateInv (start, end, value) {\n\treturn (value - start) / (end - start);\n}\n\n/**\n * @param {[number, number]} from\n * @param {[number, number]} to\n * @param {number} value\n */\nexport function mapRange (from, to, value) {\n\tif (\n\t\t!from ||\n\t\t!to ||\n\t\tfrom === to ||\n\t\t(from[0] === to[0] && from[1] === to[1]) ||\n\t\tisNaN(value) ||\n\t\tvalue === null\n\t) {\n\t\t// Ranges missing or the same\n\t\treturn value;\n\t}\n\n\treturn interpolate(to[0], to[1], interpolateInv(from[0], from[1], value));\n}\n\n/**\n * Clamp value between the minimum and maximum\n * @param {number} min minimum value to return\n * @param {number} val the value to return if it is between min and max\n * @param {number} max maximum value to return\n */\nexport function clamp (min, val, max) {\n\treturn Math.max(Math.min(max, val), min);\n}\n\n/**\n * Copy sign of one value to another.\n * @param {number} to - Number to copy sign to\n * @param {number} from - Number to copy sign from\n */\nexport function copySign (to, from) {\n\treturn Math.sign(to) === Math.sign(from) ? to : -to;\n}\n\n/**\n * Perform pow on a signed number and copy sign to result\n * @param {number} base The base number\n * @param {number} exp The exponent\n */\nexport function spow (base, exp) {\n\treturn copySign(Math.abs(base) ** exp, base);\n}\n\n/**\n * Perform a divide, but return zero if the denominator is zero\n * @param {number} n The numerator\n * @param {number} d The denominator\n */\nexport function zdiv (n, d) {\n\treturn d === 0 ? 0 : n / d;\n}\n\n/**\n * Perform a bisect on a sorted list and locate the insertion point for\n * a value in arr to maintain sorted order.\n * @param {number[]} arr - array of sorted numbers\n * @param {number} value - value to find insertion point for\n * @param {number} lo - used to specify a the low end of a subset of the list\n * @param {number} hi - used to specify a the high end of a subset of the list\n */\nexport function bisectLeft (arr, value, lo = 0, hi = arr.length) {\n\twhile (lo < hi) {\n\t\tconst mid = (lo + hi) >> 1;\n\t\tif (arr[mid] < value) {\n\t\t\tlo = mid + 1;\n\t\t}\n\t\telse {\n\t\t\thi = mid;\n\t\t}\n\t}\n\treturn lo;\n}\n\n/**\n * Determines whether an argument is an instance of a constructor, including subclasses.\n * This is done by first just checking `instanceof`,\n * and then comparing the string names of the constructors if that fails.\n * @param {any} arg\n * @param {C} constructor\n * @template {new (...args: any) => any} C\n * @returns {arg is InstanceType<C>}\n */\nexport function isInstance (arg, constructor) {\n\tif (arg instanceof constructor) {\n\t\treturn true;\n\t}\n\n\tconst targetName = constructor.name;\n\n\twhile (arg) {\n\t\tconst proto = Object.getPrototypeOf(arg);\n\t\tconst constructorName = proto?.constructor?.name;\n\t\tif (constructorName === targetName) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!constructorName || constructorName === \"Object\") {\n\t\t\treturn false;\n\t\t}\n\t\targ = proto;\n\t}\n\n\treturn false;\n}\n","import { serializeNumber, mapRange, isInstance } from \"./util.js\";\n\nexport default class Type {\n\t// Class properties - declared here so that type inference works\n\ttype;\n\tcoordMeta;\n\tcoordRange;\n\t/** @type {[number, number]} */\n\trange;\n\n\t/**\n\t * @param {any} type\n\t * @param {import(\"./types.js\").CoordMeta} coordMeta\n\t */\n\tconstructor (type, coordMeta) {\n\t\tif (typeof type === \"object\") {\n\t\t\tthis.coordMeta = type;\n\t\t}\n\n\t\tif (coordMeta) {\n\t\t\tthis.coordMeta = coordMeta;\n\t\t\tthis.coordRange = coordMeta.range ?? coordMeta.refRange;\n\t\t}\n\n\t\tif (typeof type === \"string\") {\n\t\t\tlet params = type\n\t\t\t\t.trim()\n\t\t\t\t.match(/^(?<type><[a-z]+>)(\\[(?<min>-?[.\\d]+),\\s*(?<max>-?[.\\d]+)\\])?$/);\n\n\t\t\tif (!params) {\n\t\t\t\tthrow new TypeError(`Cannot parse ${type} as a type definition.`);\n\t\t\t}\n\n\t\t\tthis.type = params.groups.type;\n\t\t\tlet { min, max } = params.groups;\n\n\t\t\tif (min || max) {\n\t\t\t\tthis.range = [+min, +max];\n\t\t\t}\n\t\t}\n\t}\n\n\t/** @returns {[number, number]} */\n\tget computedRange () {\n\t\tif (this.range) {\n\t\t\treturn this.range;\n\t\t}\n\t\tif (this.type === \"<percentage>\") {\n\t\t\treturn this.percentageRange();\n\t\t}\n\t\telse if (this.type === \"<angle>\") {\n\t\t\treturn [0, 360];\n\t\t}\n\t\treturn null;\n\t}\n\n\tget unit () {\n\t\tif (this.type === \"<percentage>\") {\n\t\t\treturn \"%\";\n\t\t}\n\t\telse if (this.type === \"<angle>\") {\n\t\t\treturn \"deg\";\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Map a number to the internal representation\n\t * @param {number} number\n\t */\n\tresolve (number) {\n\t\tif (this.type === \"<angle>\") {\n\t\t\treturn number;\n\t\t}\n\n\t\tlet fromRange = this.computedRange;\n\t\tlet toRange = this.coordRange;\n\n\t\tif (this.type === \"<percentage>\") {\n\t\t\ttoRange ??= this.percentageRange();\n\t\t}\n\n\t\treturn mapRange(fromRange, toRange, number);\n\t}\n\n\t/**\n\t * Serialize a number from the internal representation to a string\n\t * @param {number} number\n\t * @param {number} [precision]\n\t */\n\tserialize (number, precision) {\n\t\tlet toRange = this.type === \"<percentage>\" ? this.percentageRange(100) : this.computedRange;\n\n\t\tlet unit = this.unit;\n\n\t\tnumber = mapRange(this.coordRange, toRange, number);\n\t\treturn serializeNumber(number, { unit, precision });\n\t}\n\n\ttoString () {\n\t\tlet ret = this.type;\n\n\t\tif (this.range) {\n\t\t\tlet [min = \"\", max = \"\"] = this.range;\n\t\t\tret += `[${min},${max}]`;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Returns a percentage range for values of this type\n\t * @param {number} scale\n\t * @returns {[number, number]}\n\t */\n\tpercentageRange (scale = 1) {\n\t\tlet range;\n\t\tif (\n\t\t\t(this.coordMeta && this.coordMeta.range) ||\n\t\t\t(this.coordRange && this.coordRange[0] >= 0)\n\t\t) {\n\t\t\trange = [0, 1];\n\t\t}\n\t\telse {\n\t\t\trange = [-1, 1];\n\t\t}\n\t\treturn [range[0] * scale, range[1] * scale];\n\t}\n\n\tstatic get (type, coordMeta) {\n\t\tif (isInstance(type, this)) {\n\t\t\treturn type;\n\t\t}\n\n\t\treturn new this(type, coordMeta);\n\t}\n}\n","import { isInstance, isNone } from \"./util.js\";\nimport Type from \"./Type.js\";\n\n/** @import { ColorSpace, Coords } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").Format} FormatInterface */\n\n/**\n * @internal\n * Used to index {@link FormatInterface Format} objects and store an instance.\n * Not meant for external use\n */\nexport const instance = Symbol(\"instance\");\n\n/**\n * Remove the first element of an array type\n * @template {any[]} T\n * @typedef {T extends [any, ...infer R] ? R : T[number][]} RemoveFirstElement\n */\n\n/**\n * @class Format\n * @implements {Omit<FormatInterface, \"coords\" | \"serializeCoords\">}\n * Class to hold a color serialization format\n */\nexport default class Format {\n\t// Class properties - declared here so that type inference works\n\ttype;\n\tname;\n\tspaceCoords;\n\t/** @type {Type[][]} */\n\tcoords;\n\t/** @type {string | undefined} */\n\tid;\n\t/** @type {boolean | undefined} */\n\talpha;\n\n\t/**\n\t * @param {FormatInterface} format\n\t * @param {ColorSpace} space\n\t */\n\tconstructor (format, space = format.space) {\n\t\tformat[instance] = this;\n\t\tthis.type = \"function\";\n\t\tthis.name = \"color\";\n\n\t\tObject.assign(this, format);\n\n\t\tthis.space = space;\n\n\t\tif (this.type === \"custom\") {\n\t\t\t// Nothing else to do here\n\t\t\treturn;\n\t\t}\n\n\t\tthis.spaceCoords = Object.values(space.coords);\n\n\t\tif (!this.coords) {\n\t\t\t// @ts-expect-error Strings are converted to the correct type later\n\t\t\tthis.coords = this.spaceCoords.map(coordMeta => {\n\t\t\t\tlet ret = [\"<number>\", \"<percentage>\"];\n\n\t\t\t\tif (coordMeta.type === \"angle\") {\n\t\t\t\t\tret.push(\"<angle>\");\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t});\n\t\t}\n\n\t\tthis.coords = this.coords.map(\n\t\t\t/** @param {string | string[] | Type[]} types */ (types, i) => {\n\t\t\t\tlet coordMeta = this.spaceCoords[i];\n\n\t\t\t\tif (typeof types === \"string\") {\n\t\t\t\t\ttypes = types.trim().split(/\\s*\\|\\s*/);\n\t\t\t\t}\n\n\t\t\t\treturn types.map(type => Type.get(type, coordMeta));\n\t\t\t},\n\t\t);\n\t}\n\n\t/**\n\t * @param {Coords} coords\n\t * @param {number} precision\n\t * @param {Type[]} types\n\t */\n\tserializeCoords (coords, precision, types) {\n\t\ttypes = coords.map((_, i) =>\n\t\t\tType.get(types?.[i] ?? this.coords[i][0], this.spaceCoords[i]));\n\t\treturn coords.map((c, i) => types[i].serialize(c, precision));\n\t}\n\n\t/**\n\t * Validates the coordinates of a color against a format's coord grammar and\n\t * maps the coordinates to the range or refRange of the coordinates.\n\t * @param {Coords} coords\n\t * @param {[string, string, string]} types\n\t */\n\tcoerceCoords (coords, types) {\n\t\treturn Object.entries(this.space.coords).map(([id, coordMeta], i) => {\n\t\t\tlet arg = coords[i];\n\n\t\t\tif (isNone(arg) || isNaN(arg)) {\n\t\t\t\t// Nothing to do here\n\t\t\t\treturn arg;\n\t\t\t}\n\n\t\t\t// Find grammar alternative that matches the provided type\n\t\t\t// Non-strict equals is intentional because we are comparing w/ string objects\n\t\t\tlet providedType = types[i];\n\t\t\tlet type = this.coords[i].find(c => c.type == providedType);\n\n\t\t\t// Check that each coord conforms to its grammar\n\t\t\tif (!type) {\n\t\t\t\t// Type does not exist in the grammar, throw\n\t\t\t\tlet coordName = coordMeta.name || id;\n\t\t\t\tthrow new TypeError(\n\t\t\t\t\t`${providedType ?? /** @type {any} */ (arg)?.raw ?? arg} not allowed for ${coordName} in ${this.name}()`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\targ = type.resolve(arg);\n\n\t\t\tif (type.range) {\n\t\t\t\t// Adjust type to include range\n\t\t\t\ttypes[i] = type.toString();\n\t\t\t}\n\n\t\t\treturn arg;\n\t\t});\n\t}\n\n\t/**\n\t * @returns {boolean | Required<FormatInterface>[\"serialize\"]}\n\t */\n\tcanSerialize () {\n\t\treturn this.type === \"function\" || /** @type {any} */ (this).serialize;\n\t}\n\n\t/**\n\t * @param {string} str\n\t * @returns {(import(\"./types.js\").ColorConstructor) | undefined | null}\n\t */\n\tparse (str) {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @param {Format | FormatInterface} format\n\t * @param {RemoveFirstElement<ConstructorParameters<typeof Format>>} args\n\t * @returns {Format}\n\t */\n\tstatic get (format, ...args) {\n\t\tif (!format || isInstance(format, this)) {\n\t\t\treturn /** @type {Format} */ (format);\n\t\t}\n\n\t\tif (format[instance]) {\n\t\t\treturn format[instance];\n\t\t}\n\n\t\treturn new Format(format, ...args);\n\t}\n}\n","/**\n * A class for adding deep extensibility to any piece of JS code\n */\nexport class Hooks {\n\tadd (name, callback, first) {\n\t\tif (typeof arguments[0] != \"string\") {\n\t\t\t// Multiple hooks\n\t\t\tfor (var name in arguments[0]) {\n\t\t\t\tthis.add(name, arguments[0][name], arguments[1]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t(Array.isArray(name) ? name : [name]).forEach(function (name) {\n\t\t\tthis[name] = this[name] || [];\n\n\t\t\tif (callback) {\n\t\t\t\tthis[name][first ? \"unshift\" : \"push\"](callback);\n\t\t\t}\n\t\t}, this);\n\t}\n\n\trun (name, env) {\n\t\tthis[name] = this[name] || [];\n\t\tthis[name].forEach(function (callback) {\n\t\t\tcallback.call(env && env.context ? env.context : env, env);\n\t\t});\n\t}\n}\n\n/**\n * The instance of {@link Hooks} used throughout Color.js\n */\nconst hooks = new Hooks();\n\nexport default hooks;\n","import hooks from \"./hooks.js\";\nimport { multiply_v3_m3x3 } from \"./util.js\";\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").White} White */\n\n/** @type {Record<string, White>} */\n// prettier-ignore\nexport const WHITES = {\n\t// for compatibility, the four-digit chromaticity-derived ones everyone else uses\n\tD50: [0.3457 / 0.3585, 1.00000, (1.0 - 0.3457 - 0.3585) / 0.3585],\n\tD65: [0.3127 / 0.3290, 1.00000, (1.0 - 0.3127 - 0.3290) / 0.3290],\n};\n\n/**\n *\n * @param {string | White} name\n * @returns {White}\n */\nexport function getWhite (name) {\n\tif (Array.isArray(name)) {\n\t\treturn name;\n\t}\n\n\treturn WHITES[name];\n}\n\n/**\n * Adapt XYZ from white point W1 to W2\n * @param {White | string} W1\n * @param {White | string} W2\n * @param {[number, number, number]} XYZ\n * @param {{ method?: string | undefined }} options\n * @returns {[number, number, number]}\n */\nexport default function adapt (W1, W2, XYZ, options = {}) {\n\tW1 = getWhite(W1);\n\tW2 = getWhite(W2);\n\n\tif (!W1 || !W2) {\n\t\tthrow new TypeError(\n\t\t\t`Missing white point to convert ${!W1 ? \"from\" : \"\"}${!W1 && !W2 ? \"/\" : \"\"}${!W2 ? \"to\" : \"\"}`,\n\t\t);\n\t}\n\n\tif (W1 === W2) {\n\t\t// Same whitepoints, no conversion needed\n\t\treturn XYZ;\n\t}\n\n\tlet env = { W1, W2, XYZ, options };\n\n\thooks.run(\"chromatic-adaptation-start\", env);\n\n\tif (!env.M) {\n\t\tif (env.W1 === WHITES.D65 && env.W2 === WHITES.D50) {\n\t\t\t// prettier-ignore\n\t\t\tenv.M = [\n\t\t\t\t[  1.0479297925449969,   0.022946870601609652, -0.05019226628920524  ],\n\t\t\t\t[  0.02962780877005599,  0.9904344267538799,   -0.017073799063418826 ],\n\t\t\t\t[ -0.009243040646204504, 0.015055191490298152,  0.7518742814281371   ],\n\t\t\t];\n\t\t}\n\t\telse if (env.W1 === WHITES.D50 && env.W2 === WHITES.D65) {\n\t\t\t// prettier-ignore\n\t\t\tenv.M = [\n\t\t\t\t[  0.955473421488075,    -0.02309845494876471,  0.06325924320057072  ],\n\t\t\t\t[ -0.0283697093338637,    1.0099953980813041,   0.021041441191917323 ],\n\t\t\t\t[  0.012314014864481998, -0.020507649298898964, 1.330365926242124    ],\n\t\t\t];\n\t\t}\n\t}\n\n\thooks.run(\"chromatic-adaptation-end\", env);\n\n\tif (env.M) {\n\t\treturn multiply_v3_m3x3(env.XYZ, env.M);\n\t}\n\telse {\n\t\tthrow new TypeError(\"Only Bradford CAT with white points D50 and D65 supported for now.\");\n\t}\n}\n","// Global defaults one may want to configure\nexport default {\n\tgamut_mapping: \"css\",\n\tprecision: 5,\n\tdeltaE: \"76\", // Default deltaE method\n\tverbose: globalThis?.process?.env?.NODE_ENV?.toLowerCase() !== \"test\",\n\twarn: function warn (msg) {\n\t\tif (this.verbose) {\n\t\t\tglobalThis?.console?.warn?.(msg);\n\t\t}\n\t},\n};\n","import { isNone, clamp } from \"./util.js\";\nimport hooks from \"./hooks.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport defaults from \"./defaults.js\";\n\n/** @import { ColorConstructor } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").ArgumentMeta} ArgumentMeta */\n/** @typedef {import(\"./types.js\").ParseFunctionReturn} ParseFunctionReturn */\n/** @typedef {import(\"./types.js\").ParseOptions} ParseOptions */\n\n/**\n * Convert a CSS Color string to a color object\n * @param {string} str\n * @param {ParseOptions} [options]\n * @returns {ColorConstructor}\n */\nexport default function parse (str, options) {\n\tlet env = {\n\t\tstr: String(str)?.trim(),\n\t\toptions,\n\t};\n\n\thooks.run(\"parse-start\", env);\n\n\tif (env.color) {\n\t\treturn env.color;\n\t}\n\n\tenv.parsed = parseFunction(env.str);\n\tlet ret;\n\tlet meta = env.options ? (env.options.parseMeta ?? env.options.meta) : null;\n\n\tif (env.parsed) {\n\t\t// Is a functional syntax\n\t\tlet name = env.parsed.name;\n\t\tlet format;\n\t\tlet space;\n\t\tlet coords = env.parsed.args;\n\t\tlet types = coords.map((c, i) => env.parsed.argMeta[i]?.type);\n\n\t\tif (name === \"color\") {\n\t\t\t// color() function\n\t\t\tlet id = coords.shift();\n\t\t\ttypes.shift();\n\t\t\t// Check against both <dashed-ident> and <ident> versions\n\t\t\tlet alternateId = id.startsWith(\"--\") ? id.substring(2) : `--${id}`;\n\t\t\tlet ids = [id, alternateId];\n\t\t\tformat = ColorSpace.findFormat({ name, id: ids, type: \"function\" });\n\n\t\t\tif (!format) {\n\t\t\t\t// Not found\n\t\t\t\tlet didYouMean;\n\n\t\t\t\tlet registryId = id in ColorSpace.registry ? id : alternateId;\n\t\t\t\tif (registryId in ColorSpace.registry) {\n\t\t\t\t\t// Used color space id instead of color() id, these are often different\n\t\t\t\t\tlet cssId = ColorSpace.registry[registryId].formats?.color?.id;\n\n\t\t\t\t\tif (cssId) {\n\t\t\t\t\t\tlet altColor = str.replace(\"color(\" + id, \"color(\" + cssId);\n\t\t\t\t\t\tdidYouMean = `Did you mean ${altColor}?`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthrow new TypeError(\n\t\t\t\t\t`Cannot parse ${env.str}. ` + (didYouMean ?? \"Missing a plugin?\"),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tspace = format.space;\n\n\t\t\tif (format.id.startsWith(\"--\") && !id.startsWith(\"--\")) {\n\t\t\t\tdefaults.warn(\n\t\t\t\t\t`${space.name} is a non-standard space and not currently supported in the CSS spec. ` +\n\t\t\t\t\t\t`Use prefixed color(${format.id}) instead of color(${id}).`,\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (id.startsWith(\"--\") && !format.id.startsWith(\"--\")) {\n\t\t\t\tdefaults.warn(\n\t\t\t\t\t`${space.name} is a standard space and supported in the CSS spec. ` +\n\t\t\t\t\t\t`Use color(${format.id}) instead of prefixed color(${id}).`,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tformat = ColorSpace.findFormat({ name, type: \"function\" });\n\t\t\tspace = format.space;\n\t\t}\n\n\t\tif (meta) {\n\t\t\tObject.assign(meta, {\n\t\t\t\tformat,\n\t\t\t\tformatId: format.name,\n\t\t\t\ttypes,\n\t\t\t\tcommas: env.parsed.commas,\n\t\t\t});\n\t\t}\n\n\t\tlet alpha = 1;\n\n\t\tif (env.parsed.lastAlpha) {\n\t\t\talpha = env.parsed.args.pop();\n\n\t\t\tif (meta) {\n\t\t\t\tmeta.alphaType = types.pop();\n\t\t\t}\n\t\t}\n\n\t\tlet coordCount = format.coords.length;\n\n\t\tif (coords.length !== coordCount) {\n\t\t\tthrow new TypeError(\n\t\t\t\t`Expected ${coordCount} coordinates for ${space.id} in ${env.str}), got ${coords.length}`,\n\t\t\t);\n\t\t}\n\n\t\tcoords = format.coerceCoords(coords, types);\n\n\t\tret = { spaceId: space.id, coords, alpha };\n\t}\n\telse {\n\t\t// Custom, colorspace-specific format\n\t\tspaceloop: for (let space of ColorSpace.all) {\n\t\t\tfor (let formatId in space.formats) {\n\t\t\t\tlet format = space.formats[formatId];\n\n\t\t\t\tif (format.type !== \"custom\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (format.test && !format.test(env.str)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Convert to Format object\n\t\t\t\tlet formatObject = space.getFormat(format);\n\n\t\t\t\tlet color = formatObject.parse(env.str);\n\n\t\t\t\tif (color) {\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tObject.assign(meta, { format: formatObject, formatId });\n\t\t\t\t\t}\n\n\t\t\t\t\tret = color;\n\t\t\t\t\tbreak spaceloop;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!ret) {\n\t\t// If we're here, we couldn't parse\n\t\tthrow new TypeError(`Could not parse ${str} as a color. Missing a plugin?`);\n\t}\n\n\t// Clamp alpha to [0, 1]\n\tret.alpha = isNone(ret.alpha)\n\t\t? ret.alpha\n\t\t: ret.alpha === undefined\n\t\t\t? 1\n\t\t\t: clamp(0, ret.alpha, 1);\n\n\treturn ret;\n}\n\n/**\n * Units and multiplication factors for the internally stored numbers\n */\nexport const units = {\n\t\"%\": 0.01,\n\tdeg: 1,\n\tgrad: 0.9,\n\trad: 180 / Math.PI,\n\tturn: 360,\n};\n\nexport const regex = {\n\t// Need to list calc(NaN) explicitly as otherwise its ending paren would terminate the function call\n\tfunction: /^([a-z]+)\\(((?:calc\\(NaN\\)|.)+?)\\)$/i,\n\tnumber: /^([-+]?(?:[0-9]*\\.)?[0-9]+(e[-+]?[0-9]+)?)$/i,\n\tunitValue: RegExp(`(${Object.keys(units).join(\"|\")})$`),\n\n\t// NOTE The -+ are not just for prefix, but also for idents, and e+N notation!\n\tsingleArgument: /\\/?\\s*(none|NaN|calc\\(NaN\\)|[-+\\w.]+(?:%|deg|g?rad|turn)?)/g,\n};\n\n/**\n * Parse a single function argument\n * @param {string} rawArg\n * @returns {{value: number, meta: ArgumentMeta}}\n */\nexport function parseArgument (rawArg) {\n\t/** @type {Partial<ArgumentMeta>} */\n\tlet meta = {};\n\tlet unit = rawArg.match(regex.unitValue)?.[0];\n\t/** @type {string | number} */\n\tlet value = (meta.raw = rawArg);\n\n\tif (unit) {\n\t\t// It’s a dimension token\n\t\tmeta.type = unit === \"%\" ? \"<percentage>\" : \"<angle>\";\n\t\tmeta.unit = unit;\n\t\tmeta.unitless = Number(value.slice(0, -unit.length)); // unitless number\n\n\t\tvalue = meta.unitless * units[unit];\n\t}\n\telse if (regex.number.test(value)) {\n\t\t// It's a number\n\t\t// Convert numerical args to numbers\n\t\tvalue = Number(value);\n\t\tmeta.type = \"<number>\";\n\t}\n\telse if (value === \"none\") {\n\t\tvalue = null;\n\t}\n\telse if (value === \"NaN\" || value === \"calc(NaN)\") {\n\t\tvalue = NaN;\n\t\tmeta.type = \"<number>\";\n\t}\n\telse {\n\t\tmeta.type = \"<ident>\";\n\t}\n\n\treturn { value: /** @type {number} */ (value), meta: /** @type {ArgumentMeta} */ (meta) };\n}\n\n/**\n * Parse a CSS function, regardless of its name and arguments\n * @param {string} str String to parse\n * @return {ParseFunctionReturn | void}\n */\nexport function parseFunction (str) {\n\tif (!str) {\n\t\treturn;\n\t}\n\n\tstr = str.trim();\n\n\tlet parts = str.match(regex.function);\n\n\tif (parts) {\n\t\t// It is a function, parse args\n\t\tlet args = [];\n\t\tlet argMeta = [];\n\t\tlet lastAlpha = false;\n\t\tlet name = parts[1].toLowerCase();\n\n\t\tlet separators = parts[2].replace(regex.singleArgument, ($0, rawArg) => {\n\t\t\tlet { value, meta } = parseArgument(rawArg);\n\n\t\t\tif (\n\t\t\t\t// If there's a slash here, it's modern syntax\n\t\t\t\t$0.startsWith(\"/\") ||\n\t\t\t\t// If there's still elements to process after there's already 3 in `args` (and the we're not dealing with \"color()\"), it's likely to be a legacy color like \"hsl(0, 0%, 0%, 0.5)\"\n\t\t\t\t(name !== \"color\" && args.length === 3)\n\t\t\t) {\n\t\t\t\t// It's alpha\n\t\t\t\tlastAlpha = true;\n\t\t\t}\n\n\t\t\targs.push(value);\n\t\t\targMeta.push(meta);\n\t\t\treturn \"\";\n\t\t});\n\n\t\treturn {\n\t\t\tname,\n\t\t\targs,\n\t\t\targMeta,\n\t\t\tlastAlpha,\n\t\t\tcommas: separators.includes(\",\"),\n\t\t\trawName: parts[1],\n\t\t\trawArgs: parts[2],\n\t\t};\n\t}\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport { isString, isInstance } from \"./util.js\";\nimport parse from \"./parse.js\";\n\n/** @import { ColorTypes, ParseOptions as GetColorOptions, PlainColorObject } from \"./types.js\" */\n\n/**\n * Resolves a color reference (object or string) to a plain color object\n * @overload\n * @param {ColorTypes} color\n * @param {GetColorOptions} [options]\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes[]} color\n * @param {GetColorOptions} [options]\n * @returns {PlainColorObject[]}\n */\nexport default function getColor (color, options) {\n\tif (Array.isArray(color)) {\n\t\treturn color.map(c => getColor(c, options));\n\t}\n\n\tif (!color) {\n\t\tthrow new TypeError(\"Empty color reference\");\n\t}\n\n\tif (isString(color)) {\n\t\tcolor = parse(color, options);\n\t}\n\n\t// Object fixup\n\tlet space = color.space || color.spaceId;\n\n\tif (typeof space === \"string\") {\n\t\t// Convert string id to color space object\n\t\tcolor.space = ColorSpace.get(space);\n\t}\n\n\tif (color.alpha === undefined) {\n\t\tcolor.alpha = 1;\n\t}\n\n\treturn color;\n}\n","/**\n * @packageDocumentation\n * Defines the class and other types related to creating color spaces.\n * For the builtin color spaces, see the `spaces` module.\n */\nimport { type, isNone, isInstance } from \"./util.js\";\nimport Format from \"./Format.js\";\nimport { getWhite } from \"./adapt.js\";\nimport hooks from \"./hooks.js\";\nimport getColor from \"./getColor.js\";\n\nconst ε = 0.000075;\n\n/**\n * Class to represent a color space\n */\nexport default class ColorSpace {\n\tconstructor (options) {\n\t\tthis.id = options.id;\n\t\tthis.name = options.name;\n\t\tthis.base = options.base ? ColorSpace.get(options.base) : null;\n\t\tthis.aliases = options.aliases;\n\n\t\tif (this.base) {\n\t\t\tthis.fromBase = options.fromBase;\n\t\t\tthis.toBase = options.toBase;\n\t\t}\n\n\t\t// Coordinate metadata\n\n\t\tlet coords = options.coords ?? this.base.coords;\n\n\t\tfor (let name in coords) {\n\t\t\tif (!(\"name\" in coords[name])) {\n\t\t\t\tcoords[name].name = name;\n\t\t\t}\n\t\t}\n\t\tthis.coords = coords;\n\n\t\t// White point\n\n\t\tlet white = options.white ?? this.base.white ?? \"D65\";\n\t\tthis.white = getWhite(white);\n\n\t\t// Sort out formats\n\n\t\tthis.formats = options.formats ?? {};\n\n\t\tfor (let name in this.formats) {\n\t\t\tlet format = this.formats[name];\n\t\t\tformat.type ||= \"function\";\n\t\t\tformat.name ||= name;\n\t\t}\n\n\t\tif (!this.formats.color?.id) {\n\t\t\tthis.formats.color = {\n\t\t\t\t...(this.formats.color ?? {}),\n\t\t\t\tid: options.cssId || this.id,\n\t\t\t};\n\t\t}\n\n\t\t// Gamut space\n\n\t\tif (options.gamutSpace) {\n\t\t\t// Gamut space explicitly specified\n\t\t\tthis.gamutSpace =\n\t\t\t\toptions.gamutSpace === \"self\" ? this : ColorSpace.get(options.gamutSpace);\n\t\t}\n\t\telse {\n\t\t\t// No gamut space specified, calculate a sensible default\n\t\t\tif (this.isPolar) {\n\t\t\t\t// Do not check gamut through polar coordinates\n\t\t\t\tthis.gamutSpace = this.base;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.gamutSpace = this;\n\t\t\t}\n\t\t}\n\n\t\t// Optimize inGamut for unbounded spaces\n\t\tif (this.gamutSpace.isUnbounded) {\n\t\t\tthis.inGamut = (coords, options) => {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\t// Other stuff\n\t\tthis.referred = options.referred;\n\n\t\t// Compute ancestors and store them, since they will never change\n\t\tObject.defineProperty(this, \"path\", {\n\t\t\tvalue: getPath(this).reverse(),\n\t\t\twritable: false,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t});\n\n\t\thooks.run(\"colorspace-init-end\", this);\n\t}\n\n\tinGamut (coords, { epsilon = ε } = {}) {\n\t\tif (!this.equals(this.gamutSpace)) {\n\t\t\tcoords = this.to(this.gamutSpace, coords);\n\t\t\treturn this.gamutSpace.inGamut(coords, { epsilon });\n\t\t}\n\n\t\tlet coordMeta = Object.values(this.coords);\n\n\t\treturn coords.every((c, i) => {\n\t\t\tlet meta = coordMeta[i];\n\n\t\t\tif (meta.type !== \"angle\" && meta.range) {\n\t\t\t\tif (isNone(c)) {\n\t\t\t\t\t// NaN is always in gamut\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tlet [min, max] = meta.range;\n\t\t\t\treturn (\n\t\t\t\t\t(min === undefined || c >= min - epsilon) &&\n\t\t\t\t\t(max === undefined || c <= max + epsilon)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tget isUnbounded () {\n\t\treturn Object.values(this.coords).every(coord => !(\"range\" in coord));\n\t}\n\n\tget cssId () {\n\t\treturn this.formats?.color?.id || this.id;\n\t}\n\n\tget isPolar () {\n\t\tfor (let id in this.coords) {\n\t\t\tif (this.coords[id].type === \"angle\") {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Lookup a format in this color space\n\t * @param {string | object | Format} format - Format id if string. If object, it's converted to a `Format` object and returned.\n\t * @returns {Format}\n\t */\n\tgetFormat (format) {\n\t\tif (!format) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (format === \"default\") {\n\t\t\tformat = Object.values(this.formats)[0];\n\t\t}\n\t\telse if (typeof format === \"string\") {\n\t\t\tformat = this.formats[format];\n\t\t}\n\n\t\tlet ret = Format.get(format, this);\n\n\t\tif (ret !== format && format.name in this.formats) {\n\t\t\t// Update the format we have on file so we can find it more quickly next time\n\t\t\tthis.formats[format.name] = ret;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Check if this color space is the same as another color space reference.\n\t * Allows proxying color space objects and comparing color spaces with ids.\n\t * @param {string | ColorSpace} space ColorSpace object or id to compare to\n\t * @returns {boolean}\n\t */\n\tequals (space) {\n\t\tif (!space) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this === space || this.id === space || this.id === space.id;\n\t}\n\n\tto (space, coords) {\n\t\tif (arguments.length === 1) {\n\t\t\tconst color = getColor(space);\n\t\t\t[space, coords] = [color.space, color.coords];\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tif (this.equals(space)) {\n\t\t\t// Same space, no change needed\n\t\t\treturn coords;\n\t\t}\n\n\t\t// Convert NaN to 0, which seems to be valid in every coordinate of every color space\n\t\tcoords = coords.map(c => (isNone(c) ? 0 : c));\n\n\t\t// Find connection space = lowest common ancestor in the base tree\n\t\tlet myPath = this.path;\n\t\tlet otherPath = space.path;\n\n\t\tlet connectionSpace, connectionSpaceIndex;\n\n\t\tfor (let i = 0; i < myPath.length; i++) {\n\t\t\tif (myPath[i].equals(otherPath[i])) {\n\t\t\t\tconnectionSpace = myPath[i];\n\t\t\t\tconnectionSpaceIndex = i;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!connectionSpace) {\n\t\t\t// This should never happen\n\t\t\tthrow new Error(\n\t\t\t\t`Cannot convert between color spaces ${this} and ${space}: no connection space was found`,\n\t\t\t);\n\t\t}\n\n\t\t// Go up from current space to connection space\n\t\tfor (let i = myPath.length - 1; i > connectionSpaceIndex; i--) {\n\t\t\tcoords = myPath[i].toBase(coords);\n\t\t}\n\n\t\t// Go down from connection space to target space\n\t\tfor (let i = connectionSpaceIndex + 1; i < otherPath.length; i++) {\n\t\t\tcoords = otherPath[i].fromBase(coords);\n\t\t}\n\n\t\treturn coords;\n\t}\n\n\tfrom (space, coords) {\n\t\tif (arguments.length === 1) {\n\t\t\tconst color = getColor(space);\n\t\t\t[space, coords] = [color.space, color.coords];\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\treturn space.to(this, coords);\n\t}\n\n\ttoString () {\n\t\treturn `${this.name} (${this.id})`;\n\t}\n\n\tgetMinCoords () {\n\t\tlet ret = [];\n\n\t\tfor (let id in this.coords) {\n\t\t\tlet meta = this.coords[id];\n\t\t\tlet range = meta.range || meta.refRange;\n\t\t\tret.push(range?.min ?? 0);\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tstatic registry = {};\n\n\t// Returns array of unique color spaces\n\tstatic get all () {\n\t\treturn [...new Set(Object.values(ColorSpace.registry))];\n\t}\n\n\tstatic register (id, space) {\n\t\tif (arguments.length === 1) {\n\t\t\tspace = arguments[0];\n\t\t\tid = space.id;\n\t\t}\n\n\t\tspace = this.get(space);\n\n\t\tif (this.registry[id] && this.registry[id] !== space) {\n\t\t\tthrow new Error(`Duplicate color space registration: '${id}'`);\n\t\t}\n\t\tthis.registry[id] = space;\n\n\t\t// Register aliases when called without an explicit ID.\n\t\tif (arguments.length === 1 && space.aliases) {\n\t\t\tfor (let alias of space.aliases) {\n\t\t\t\tthis.register(alias, space);\n\t\t\t}\n\t\t}\n\n\t\treturn space;\n\t}\n\n\t/**\n\t * Lookup ColorSpace object by name\n\t * @param {ColorSpace | string} name\n\t */\n\tstatic get (space, ...alternatives) {\n\t\tif (!space || isInstance(space, this)) {\n\t\t\treturn space;\n\t\t}\n\n\t\tlet argType = type(space);\n\n\t\tif (argType === \"string\") {\n\t\t\t// It's a color space id\n\t\t\tlet ret = ColorSpace.registry[space.toLowerCase()];\n\n\t\t\tif (!ret) {\n\t\t\t\tthrow new TypeError(`No color space found with id = \"${space}\"`);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (alternatives.length) {\n\t\t\treturn ColorSpace.get(...alternatives);\n\t\t}\n\n\t\tthrow new TypeError(`${space} is not a valid color space`);\n\t}\n\n\t/**\n\t * Look up all color spaces for a format that matches certain criteria\n\t * @param {object | string} filters\n\t * @param {Array<ColorSpace>} [spaces=ColorSpace.all]\n\t * @returns {Format | null}\n\t */\n\tstatic findFormat (filters, spaces = ColorSpace.all) {\n\t\tif (!filters) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (typeof filters === \"string\") {\n\t\t\tfilters = { name: filters };\n\t\t}\n\n\t\tfor (let space of spaces) {\n\t\t\tfor (let [name, format] of Object.entries(space.formats)) {\n\t\t\t\tformat.name ??= name;\n\t\t\t\tformat.type ??= \"function\";\n\n\t\t\t\tlet matches =\n\t\t\t\t\t(!filters.name || format.name === filters.name) &&\n\t\t\t\t\t(!filters.type || format.type === filters.type);\n\n\t\t\t\tif (filters.id) {\n\t\t\t\t\tlet ids = format.ids || [format.id];\n\t\t\t\t\tlet filterIds = Array.isArray(filters.id) ? filters.id : [filters.id];\n\t\t\t\t\tmatches &&= filterIds.some(id => ids.includes(id));\n\t\t\t\t}\n\n\t\t\t\tif (matches) {\n\t\t\t\t\tlet ret = Format.get(format, space);\n\n\t\t\t\t\tif (ret !== format) {\n\t\t\t\t\t\tspace.formats[format.name] = ret;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Get metadata about a coordinate of a color space\n\t *\n\t * @static\n\t * @param {Array | string} ref\n\t * @param {ColorSpace | string} [workingSpace]\n\t * @return {Object}\n\t */\n\tstatic resolveCoord (ref, workingSpace) {\n\t\tlet coordType = type(ref);\n\t\tlet space, coord;\n\n\t\tif (coordType === \"string\") {\n\t\t\tif (ref.includes(\".\")) {\n\t\t\t\t// Absolute coordinate\n\t\t\t\t[space, coord] = ref.split(\".\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Relative coordinate\n\t\t\t\t[space, coord] = [, ref];\n\t\t\t}\n\t\t}\n\t\telse if (Array.isArray(ref)) {\n\t\t\t[space, coord] = ref;\n\t\t}\n\t\telse {\n\t\t\t// Object\n\t\t\tspace = ref.space;\n\t\t\tcoord = ref.coordId;\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tif (!space) {\n\t\t\tspace = workingSpace;\n\t\t}\n\n\t\tif (!space) {\n\t\t\tthrow new TypeError(\n\t\t\t\t`Cannot resolve coordinate reference ${ref}: No color space specified and relative references are not allowed here`,\n\t\t\t);\n\t\t}\n\n\t\tcoordType = type(coord);\n\n\t\tif (coordType === \"number\" || (coordType === \"string\" && coord >= 0)) {\n\t\t\t// Resolve numerical coord\n\t\t\tlet meta = Object.entries(space.coords)[coord];\n\n\t\t\tif (meta) {\n\t\t\t\treturn { space, id: meta[0], index: coord, ...meta[1] };\n\t\t\t}\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tlet normalizedCoord = coord.toLowerCase();\n\n\t\tlet i = 0;\n\t\tfor (let id in space.coords) {\n\t\t\tlet meta = space.coords[id];\n\n\t\t\tif (\n\t\t\t\tid.toLowerCase() === normalizedCoord ||\n\t\t\t\tmeta.name?.toLowerCase() === normalizedCoord\n\t\t\t) {\n\t\t\t\treturn { space, id, index: i, ...meta };\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\tthrow new TypeError(\n\t\t\t`No \"${coord}\" coordinate found in ${space.name}. Its coordinates are: ${Object.keys(space.coords).join(\", \")}`,\n\t\t);\n\t}\n\n\tstatic DEFAULT_FORMAT = {\n\t\ttype: \"functions\",\n\t\tname: \"color\",\n\t};\n}\n\nfunction getPath (space) {\n\tlet ret = [space];\n\n\tfor (let s = space; (s = s.base); ) {\n\t\tret.push(s);\n\t}\n\n\treturn ret;\n}\n","import ColorSpace from \"../ColorSpace.js\";\n\nexport default new ColorSpace({\n\tid: \"xyz-d65\",\n\tname: \"XYZ D65\",\n\tcoords: {\n\t\tx: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"X\",\n\t\t},\n\t\ty: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Y\",\n\t\t},\n\t\tz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Z\",\n\t\t},\n\t},\n\twhite: \"D65\",\n\tformats: {\n\t\tcolor: {\n\t\t\tids: [\"xyz-d65\", \"xyz\"],\n\t\t},\n\t},\n\taliases: [\"xyz\"],\n});\n","import ColorSpace from \"./ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"./util.js\";\nimport adapt from \"./adapt.js\";\nimport XYZ_D65 from \"./spaces/xyz-d65.js\";\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").RGBOptions} RGBOptions */\n\n/** Convenience class for RGB color spaces */\nexport default class RGBColorSpace extends ColorSpace {\n\t/**\n\t * Creates a new RGB ColorSpace.\n\t * If coords are not specified, they will use the default RGB coords.\n\t * Instead of `fromBase()` and `toBase()` functions,\n\t * you can specify to/from XYZ matrices and have `toBase()` and `fromBase()` automatically generated.\n\t * @param {RGBOptions} options\n\t */\n\tconstructor (options) {\n\t\tif (!options.coords) {\n\t\t\toptions.coords = {\n\t\t\t\tr: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Red\",\n\t\t\t\t},\n\t\t\t\tg: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Green\",\n\t\t\t\t},\n\t\t\t\tb: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Blue\",\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tif (!options.base) {\n\t\t\toptions.base = XYZ_D65;\n\t\t}\n\n\t\tif (options.toXYZ_M && options.fromXYZ_M) {\n\t\t\toptions.toBase ??= rgb => {\n\t\t\t\tlet xyz = multiply_v3_m3x3(rgb, options.toXYZ_M);\n\n\t\t\t\tif (this.white !== this.base.white) {\n\t\t\t\t\t// Perform chromatic adaptation\n\t\t\t\t\txyz = adapt(this.white, this.base.white, xyz);\n\t\t\t\t}\n\n\t\t\t\treturn xyz;\n\t\t\t};\n\n\t\t\toptions.fromBase ??= xyz => {\n\t\t\t\txyz = adapt(this.base.white, this.white, xyz);\n\t\t\t\treturn multiply_v3_m3x3(xyz, options.fromXYZ_M);\n\t\t\t};\n\t\t}\n\n\t\toptions.referred ??= \"display\";\n\n\t\tsuper(options);\n\t}\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\nimport { toPrecision } from \"./util.js\";\n\n/** @import { ColorTypes, Coords } from \"./types.js\" */\n\n/**\n * Options for {@link getAll}\n * @typedef GetAllOptions\n * @property {string | ColorSpace | undefined} [space]\n * The color space to convert to. Defaults to the color's current space\n * @property {number | undefined} [precision]\n * The number of significant digits to round the coordinates to\n */\n\n/**\n * Get the coordinates of a color in any color space\n * @overload\n * @param {ColorTypes} color\n * @param {string | ColorSpace} [options=color.space] The color space to convert to. Defaults to the color's current space\n * @returns {Coords} The color coordinates in the given color space\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {GetAllOptions} [options]\n * @returns {Coords} The color coordinates in the given color space\n */\nexport default function getAll (color, options) {\n\tcolor = getColor(color);\n\n\tlet space = ColorSpace.get(options, options?.space);\n\tlet precision = options?.precision;\n\n\tlet coords;\n\tif (!space || color.space.equals(space)) {\n\t\t// No conversion needed\n\t\tcoords = color.coords.slice();\n\t}\n\telse {\n\t\tcoords = space.from(color);\n\t}\n\n\treturn precision === undefined ? coords : coords.map(coord => toPrecision(coord, precision));\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getAll from \"./getAll.js\";\nimport getColor from \"./getColor.js\";\n\n/** @import { ColorTypes, Ref } from \"./types.js\" */\n\n/**\n * @param {ColorTypes} color\n * @param {Ref} prop\n * @returns {number}\n */\nexport default function get (color, prop) {\n\tcolor = getColor(color);\n\n\tif (prop === \"alpha\") {\n\t\treturn color.alpha ?? 1;\n\t}\n\n\tlet { space, index } = ColorSpace.resolveCoord(prop, color.space);\n\tlet coords = getAll(color, space);\n\treturn coords[index];\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\n\n/** @import { ColorTypes, Coords, PlainColorObject } from \"./types.js\" */\n\n/**\n * Set all coordinates of a color at once, in its own color space or another.\n * Modifies the color in place.\n * @overload\n * @param {ColorTypes} color\n * @param {Coords} coords Array of coordinates\n * @param {number} [alpha]\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {string | ColorSpace} space The color space of the provided coordinates.\n * @param {Coords} coords Array of coordinates\n * @param {number} [alpha]\n * @returns {PlainColorObject}\n */\nexport default function setAll (color, space, coords, alpha) {\n\tcolor = getColor(color);\n\n\tif (Array.isArray(space)) {\n\t\t// Space is omitted\n\t\t[space, coords, alpha] = [color.space, space, coords];\n\t}\n\n\tspace = ColorSpace.get(space); // Make sure we have a ColorSpace object\n\tcolor.coords = space === color.space ? coords.slice() : space.to(color.space, coords);\n\n\tif (alpha !== undefined) {\n\t\tcolor.alpha = alpha;\n\t}\n\n\treturn color;\n}\n\n/** @type {\"color\"} */\nsetAll.returns = \"color\";\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\nimport get from \"./get.js\";\nimport getAll from \"./getAll.js\";\nimport setAll from \"./setAll.js\";\nimport { type } from \"./util.js\";\n\n/** @import { ColorTypes, PlainColorObject, Ref } from \"./types.js\" */\n\n/**\n * Set properties and return current instance\n * @overload\n * @param {ColorTypes} color\n * @param {Ref} prop\n * @param {number | ((coord: number) => number)} value\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {Record<string, number | ((coord: number) => number)>} props\n * @returns {PlainColorObject}\n */\nexport default function set (color, prop, value) {\n\tcolor = getColor(color);\n\n\tif (arguments.length === 2 && type(arguments[1]) === \"object\") {\n\t\t// Argument is an object literal\n\t\tlet object = arguments[1];\n\t\tfor (let p in object) {\n\t\t\tset(color, p, object[p]);\n\t\t}\n\t}\n\telse {\n\t\tif (typeof value === \"function\") {\n\t\t\tvalue = value(get(color, prop));\n\t\t}\n\n\t\tif (prop === \"alpha\") {\n\t\t\tcolor.alpha = value;\n\t\t}\n\t\telse {\n\t\t\tlet { space, index } = ColorSpace.resolveCoord(prop, color.space);\n\t\t\tlet coords = getAll(color, space);\n\t\t\tcoords[index] = value;\n\t\t\tsetAll(color, space, coords);\n\t\t}\n\t}\n\n\treturn color;\n}\n\n/** @type {\"color\"} */\nset.returns = \"color\";\n","import ColorSpace from \"../ColorSpace.js\";\nimport adapt from \"../adapt.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\nexport default new ColorSpace({\n\tid: \"xyz-d50\",\n\tname: \"XYZ D50\",\n\twhite: \"D50\",\n\tbase: XYZ_D65,\n\tfromBase: coords => adapt(XYZ_D65.white, \"D50\", coords),\n\ttoBase: coords => adapt(\"D50\", XYZ_D65.white, coords),\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { WHITES } from \"../adapt.js\";\nimport xyz_d50 from \"./xyz-d50.js\";\n\n// κ * ε  = 2^3 = 8\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst ε3 = 24 / 116;\nconst κ = 24389 / 27; // 29^3/3^3\n\nlet white = WHITES.D50;\n\nexport default new ColorSpace({\n\tid: \"lab\",\n\tname: \"Lab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t},\n\n\t// Assuming XYZ is relative to D50, convert to CIE Lab\n\t// from CIE standard, which now defines these as a rational fraction\n\twhite,\n\n\tbase: xyz_d50,\n\t// Convert D50-adapted XYX to Lab\n\t// CIE 15.3:2004 section 8.2.1.1\n\tfromBase (XYZ) {\n\t\t// XYZ scaled relative to reference white\n\t\tlet xyz = XYZ.map((value, i) => value / white[i]);\n\t\tlet f = xyz.map(value => (value > ε ? Math.cbrt(value) : (κ * value + 16) / 116));\n\n\t\tlet L = 116 * f[1] - 16;\n\t\tlet a = 500 * (f[0] - f[1]);\n\t\tlet b = 200 * (f[1] - f[2]);\n\n\t\treturn [L, a, b];\n\t},\n\t// Convert Lab to D50-adapted XYZ\n\t// Same result as CIE 15.3:2004 Appendix D although the derivation is different\n\t// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n\ttoBase (Lab) {\n\t\t// compute f, starting with the luminance-related term\n\t\tlet [L, a, b] = Lab;\n\t\tlet f = [];\n\t\tf[1] = (L + 16) / 116;\n\t\tf[0] = a / 500 + f[1];\n\t\tf[2] = f[1] - b / 200;\n\n\t\t// compute xyz\n\t\t// prettier-ignore\n\t\tlet xyz = [\n\t\t\tf[0]   > ε3 ? Math.pow(f[0], 3)                : (116 * f[0] - 16) / κ,\n\t\t\tLab[0] > 8  ? Math.pow((Lab[0] + 16) / 116, 3) : Lab[0] / κ,\n\t\t\tf[2]   > ε3 ? Math.pow(f[2], 3)                : (116 * f[2] - 16) / κ,\n\t\t];\n\n\t\t// Compute XYZ by scaling xyz by reference white\n\t\treturn xyz.map((value, i) => value * white[i]);\n\t},\n\n\tformats: {\n\t\tlab: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import * as util from \"./util.js\";\n\n/**\n * Constrain an angle to 360 degrees\n * @param {number} angle\n * @returns {number}\n */\nexport function constrain (angle) {\n\tif (typeof angle !== \"number\") {\n\t\treturn angle;\n\t}\n\n\treturn ((angle % 360) + 360) % 360;\n}\n\n/**\n * @param {\"raw\" | \"increasing\" | \"decreasing\" | \"longer\" | \"shorter\"} arc\n * @param {[number, number]} angles\n * @returns {[number, number]}\n */\nexport function adjust (arc, angles) {\n\tlet [a1, a2] = angles;\n\n\tlet none1 = util.isNone(a1);\n\tlet none2 = util.isNone(a2);\n\n\tif (none1 && none2) {\n\t\treturn [a1, a2];\n\t}\n\telse if (none1) {\n\t\ta1 = a2;\n\t}\n\telse if (none2) {\n\t\ta2 = a1;\n\t}\n\n\tif (arc === \"raw\") {\n\t\treturn angles;\n\t}\n\n\ta1 = constrain(a1);\n\ta2 = constrain(a2);\n\n\tlet angleDiff = a2 - a1;\n\n\tif (arc === \"increasing\") {\n\t\tif (angleDiff < 0) {\n\t\t\ta2 += 360;\n\t\t}\n\t}\n\telse if (arc === \"decreasing\") {\n\t\tif (angleDiff > 0) {\n\t\t\ta1 += 360;\n\t\t}\n\t}\n\telse if (arc === \"longer\") {\n\t\tif (-180 < angleDiff && angleDiff < 180) {\n\t\t\tif (angleDiff > 0) {\n\t\t\t\ta1 += 360;\n\t\t\t}\n\t\t\telse {\n\t\t\t\ta2 += 360;\n\t\t\t}\n\t\t}\n\t}\n\telse if (arc === \"shorter\") {\n\t\tif (angleDiff > 180) {\n\t\t\ta1 += 360;\n\t\t}\n\t\telse if (angleDiff < -180) {\n\t\t\ta2 += 360;\n\t\t}\n\t}\n\n\treturn [a1, a2];\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport Lab from \"./lab.js\";\nimport { constrain as constrainAngle } from \"../angles.js\";\nimport { isNone } from \"../util.js\";\n\nexport default new ColorSpace({\n\tid: \"lch\",\n\tname: \"LCH\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 150],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Lab,\n\tfromBase (Lab) {\n\t\t// These methods are used for other polar forms as well, so we can't hardcode the ε\n\t\tif (this.ε === undefined) {\n\t\t\t// @ts-expect-error Property 'coords' does not exist on type 'string | ColorSpace'\n\t\t\tlet range = Object.values(this.base.coords)[1].refRange;\n\t\t\tlet extent = range[1] - range[0];\n\t\t\tthis.ε = extent / 100000;\n\t\t}\n\n\t\t// Convert to polar form\n\t\tlet [L, a, b] = Lab;\n\t\tlet isAchromatic = Math.abs(a) < this.ε && Math.abs(b) < this.ε;\n\t\tlet h = isAchromatic ? null : constrainAngle((Math.atan2(b, a) * 180) / Math.PI);\n\t\tlet C = isAchromatic ? 0 : Math.sqrt(a ** 2 + b ** 2);\n\n\t\treturn [L, C, h];\n\t},\n\ttoBase (lch) {\n\t\t// Convert from polar form\n\t\tlet [L, C, h] = lch;\n\t\tlet a = null,\n\t\t\tb = null;\n\n\t\tif (!isNone(h)) {\n\t\t\tC = C < 0 ? 0 : C; // Clamp negative Chroma\n\t\t\ta = C * Math.cos((h * Math.PI) / 180);\n\t\t\tb = C * Math.sin((h * Math.PI) / 180);\n\t\t}\n\n\t\treturn [L, a, b];\n\t},\n\n\tformats: {\n\t\tlch: {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import defaults from \"../defaults.js\";\nimport lab from \"../spaces/lab.js\";\nimport lch from \"../spaces/lch.js\";\nimport getColor from \"../getColor.js\";\n\n// deltaE2000 is a statistically significant improvement\n// and is recommended by the CIE and Idealliance\n// especially for color differences less than 10 deltaE76\n// but is wicked complicated\n// and many implementations have small errors!\n// DeltaE2000 is also discontinuous; in case this\n// matters to you, use deltaECMC instead.\n\nconst Gfactor = 25 ** 7;\nconst π = Math.PI;\nconst r2d = 180 / π;\nconst d2r = π / 180;\n\nfunction pow7 (x) {\n\t// Faster than x ** 7 or Math.pow(x, 7)\n\n\tconst x2 = x * x;\n\tconst x7 = x2 * x2 * x2 * x;\n\n\treturn x7;\n}\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @param {{ kL?: number | undefined; kC?: number | undefined; kH?: number | undefined }} options\n * @returns {number}\n */\nexport default function (color, sample, { kL = 1, kC = 1, kH = 1 } = {}) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and the function parameter as the sample,\n\t// calculate deltaE 2000.\n\n\t// This implementation assumes the parametric\n\t// weighting factors kL, kC and kH\n\t// for the influence of viewing conditions\n\t// are all 1, as sadly seems typical.\n\t// kL should be increased for lightness texture or noise\n\t// and kC increased for chroma noise\n\n\tlet [L1, a1, b1] = lab.from(color);\n\tlet C1 = lch.from(lab, [L1, a1, b1])[1];\n\tlet [L2, a2, b2] = lab.from(sample);\n\tlet C2 = lch.from(lab, [L2, a2, b2])[1];\n\n\t// Check for negative Chroma,\n\t// which might happen through\n\t// direct user input of LCH values\n\n\tif (C1 < 0) {\n\t\tC1 = 0;\n\t}\n\tif (C2 < 0) {\n\t\tC2 = 0;\n\t}\n\n\tlet Cbar = (C1 + C2) / 2; // mean Chroma\n\n\t// calculate a-axis asymmetry factor from mean Chroma\n\t// this turns JND ellipses for near-neutral colors back into circles\n\tlet C7 = pow7(Cbar);\n\n\tlet G = 0.5 * (1 - Math.sqrt(C7 / (C7 + Gfactor)));\n\n\t// scale a axes by asymmetry factor\n\t// this by the way is why there is no Lab2000 colorspace\n\tlet adash1 = (1 + G) * a1;\n\tlet adash2 = (1 + G) * a2;\n\n\t// calculate new Chroma from scaled a and original b axes\n\tlet Cdash1 = Math.sqrt(adash1 ** 2 + b1 ** 2);\n\tlet Cdash2 = Math.sqrt(adash2 ** 2 + b2 ** 2);\n\n\t// calculate new hues, with zero hue for true neutrals\n\t// and in degrees, not radians\n\n\tlet h1 = adash1 === 0 && b1 === 0 ? 0 : Math.atan2(b1, adash1);\n\tlet h2 = adash2 === 0 && b2 === 0 ? 0 : Math.atan2(b2, adash2);\n\n\tif (h1 < 0) {\n\t\th1 += 2 * π;\n\t}\n\tif (h2 < 0) {\n\t\th2 += 2 * π;\n\t}\n\n\th1 *= r2d;\n\th2 *= r2d;\n\n\t// Lightness and Chroma differences; sign matters\n\tlet ΔL = L2 - L1;\n\tlet ΔC = Cdash2 - Cdash1;\n\n\t// Hue difference, getting the sign correct\n\tlet hdiff = h2 - h1;\n\tlet hsum = h1 + h2;\n\tlet habs = Math.abs(hdiff);\n\tlet Δh;\n\n\tif (Cdash1 * Cdash2 === 0) {\n\t\tΔh = 0;\n\t}\n\telse if (habs <= 180) {\n\t\tΔh = hdiff;\n\t}\n\telse if (hdiff > 180) {\n\t\tΔh = hdiff - 360;\n\t}\n\telse if (hdiff < -180) {\n\t\tΔh = hdiff + 360;\n\t}\n\telse {\n\t\tdefaults.warn(\"the unthinkable has happened\");\n\t}\n\n\t// weighted Hue difference, more for larger Chroma\n\tlet ΔH = 2 * Math.sqrt(Cdash2 * Cdash1) * Math.sin((Δh * d2r) / 2);\n\n\t// calculate mean Lightness and Chroma\n\tlet Ldash = (L1 + L2) / 2;\n\tlet Cdash = (Cdash1 + Cdash2) / 2;\n\tlet Cdash7 = pow7(Cdash);\n\n\t// Compensate for non-linearity in the blue region of Lab.\n\t// Four possibilities for hue weighting factor,\n\t// depending on the angles, to get the correct sign\n\tlet hdash;\n\tif (Cdash1 * Cdash2 === 0) {\n\t\thdash = hsum; // which should be zero\n\t}\n\telse if (habs <= 180) {\n\t\thdash = hsum / 2;\n\t}\n\telse if (hsum < 360) {\n\t\thdash = (hsum + 360) / 2;\n\t}\n\telse {\n\t\thdash = (hsum - 360) / 2;\n\t}\n\n\t// positional corrections to the lack of uniformity of CIELAB\n\t// These are all trying to make JND ellipsoids more like spheres\n\n\t// SL Lightness crispening factor\n\t// a background with L=50 is assumed\n\tlet lsq = (Ldash - 50) ** 2;\n\tlet SL = 1 + (0.015 * lsq) / Math.sqrt(20 + lsq);\n\n\t// SC Chroma factor, similar to those in CMC and deltaE 94 formulae\n\tlet SC = 1 + 0.045 * Cdash;\n\n\t// Cross term T for blue non-linearity\n\tlet T = 1;\n\tT -= 0.17 * Math.cos((hdash - 30) * d2r);\n\tT += 0.24 * Math.cos(2 * hdash * d2r);\n\tT += 0.32 * Math.cos((3 * hdash + 6) * d2r);\n\tT -= 0.2 * Math.cos((4 * hdash - 63) * d2r);\n\n\t// SH Hue factor depends on Chroma,\n\t// as well as adjusted hue angle like deltaE94.\n\tlet SH = 1 + 0.015 * Cdash * T;\n\n\t// RT Hue rotation term compensates for rotation of JND ellipses\n\t// and Munsell constant hue lines\n\t// in the medium-high Chroma blue region\n\t// (Hue 225 to 315)\n\tlet Δθ = 30 * Math.exp(-1 * ((hdash - 275) / 25) ** 2);\n\tlet RC = 2 * Math.sqrt(Cdash7 / (Cdash7 + Gfactor));\n\tlet RT = -1 * Math.sin(2 * Δθ * d2r) * RC;\n\n\t// Finally calculate the deltaE, term by term as root sume of squares\n\tlet dE = (ΔL / (kL * SL)) ** 2;\n\tdE += (ΔC / (kC * SC)) ** 2;\n\tdE += (ΔH / (kH * SH)) ** 2;\n\tdE += RT * (ΔC / (kC * SC)) * (ΔH / (kH * SH));\n\treturn Math.sqrt(dE);\n\t// Yay!!!\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"../util.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// Recalculated for consistent reference white\n// see https://github.com/w3c/csswg-drafts/issues/6642#issuecomment-943521484\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst XYZtoLMS_M = [\n\t[ 0.8190224379967030, 0.3619062600528904, -0.1288737815209879 ],\n\t[ 0.0329836539323885, 0.9292868615863434,  0.0361446663506424 ],\n\t[ 0.0481771893596242, 0.2642395317527308,  0.6335478284694309 ],\n];\n// inverse of XYZtoLMS_M\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst LMStoXYZ_M = [\n\t[  1.2268798758459243, -0.5578149944602171,  0.2813910456659647 ],\n\t[ -0.0405757452148008,  1.1122868032803170, -0.0717110580655164 ],\n\t[ -0.0763729366746601, -0.4214933324022432,  1.5869240198367816 ],\n];\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const LMStoLab_M = [\n\t[ 0.2104542683093140,  0.7936177747023054, -0.0040720430116193 ],\n\t[ 1.9779985324311684, -2.4285922420485799,  0.4505937096174110 ],\n\t[ 0.0259040424655478,  0.7827717124575296, -0.8086757549230774 ],\n];\n// LMStoIab_M inverted\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const LabtoLMS_M = [\n\t[ 1.0000000000000000,  0.3963377773761749,  0.2158037573099136 ],\n\t[ 1.0000000000000000, -0.1055613458156586, -0.0638541728258133 ],\n\t[ 1.0000000000000000, -0.0894841775298119, -1.2914855480194092 ],\n];\n\nexport default new ColorSpace({\n\tid: \"oklab\",\n\tname: \"Oklab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t},\n\n\t// Note that XYZ is relative to D65\n\twhite: \"D65\",\n\tbase: XYZ_D65,\n\tfromBase (XYZ) {\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiply_v3_m3x3(XYZ, XYZtoLMS_M);\n\n\t\t// non-linearity\n\t\tLMS[0] = Math.cbrt(LMS[0]);\n\t\tLMS[1] = Math.cbrt(LMS[1]);\n\t\tLMS[2] = Math.cbrt(LMS[2]);\n\n\t\treturn multiply_v3_m3x3(LMS, LMStoLab_M, LMS);\n\t},\n\ttoBase (OKLab) {\n\t\t// move to LMS cone domain\n\t\tlet LMSg = multiply_v3_m3x3(OKLab, LabtoLMS_M);\n\n\t\t// restore linearity\n\t\tLMSg[0] = LMSg[0] ** 3;\n\t\tLMSg[1] = LMSg[1] ** 3;\n\t\tLMSg[2] = LMSg[2] ** 3;\n\n\t\treturn multiply_v3_m3x3(LMSg, LMStoXYZ_M, LMSg);\n\t},\n\n\tformats: {\n\t\toklab: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import oklab from \"../spaces/oklab.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * More accurate color-difference formulae\n * than the simple 1976 Euclidean distance in CIE Lab\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaEOK, term by term as root sum of squares\n\tlet [L1, a1, b1] = oklab.from(color);\n\tlet [L2, a2, b2] = oklab.from(sample);\n\tlet ΔL = L1 - L2;\n\tlet Δa = a1 - a2;\n\tlet Δb = b1 - b2;\n\treturn Math.sqrt(ΔL ** 2 + Δa ** 2 + Δb ** 2);\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\nconst ε = 0.000075;\n\n/**\n * Check if a color is in gamut of either its own or another color space\n * @param {ColorTypes} color\n * @param {string | ColorSpace} [space]\n * @param {{ epsilon?: number | undefined }} [param2]\n * @returns {boolean}\n */\nexport default function inGamut (color, space, { epsilon = ε } = {}) {\n\tcolor = getColor(color);\n\n\tif (!space) {\n\t\tspace = color.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\tlet coords = color.coords;\n\n\tif (space !== color.space) {\n\t\tcoords = space.from(color);\n\t}\n\n\treturn space.inGamut(coords, { epsilon });\n}\n","/** @import { Coords, PlainColorObject } from \"./types.js\" */\n\n/**\n * @param {PlainColorObject} color\n * @returns {PlainColorObject}\n */\nexport default function clone (color) {\n\treturn {\n\t\tspace: color.space,\n\t\tcoords: /** @type {Coords} */ (color.coords.slice()),\n\t\talpha: color.alpha,\n\t};\n}\n","import lab from \"../spaces/lab.js\";\nimport lch from \"../spaces/lch.js\";\nimport getColor from \"../getColor.js\";\nimport { isNone } from \"../util.js\";\n\n// More accurate color-difference formulae\n// than the simple 1976 Euclidean distance in Lab\n\n// CMC by the Color Measurement Committee of the\n// Bradford Society of Dyeists and Colorsts, 1994.\n// Uses LCH rather than Lab,\n// with different weights for L, C and H differences\n// A nice increase in accuracy for modest increase in complexity\nconst π = Math.PI;\nconst d2r = π / 180;\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @param {{ l?: number | undefined; c?: number | undefined }} options\n * @returns {number}\n */\nexport default function (color, sample, { l = 2, c = 1 } = {}) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE CMC.\n\n\t// This implementation assumes the parametric\n\t// weighting factors l:c are 2:1\n\t// which is typical for non-textile uses.\n\n\tlet [L1, a1, b1] = lab.from(color);\n\tlet [, C1, H1] = lch.from(lab, [L1, a1, b1]);\n\tlet [L2, a2, b2] = lab.from(sample);\n\tlet C2 = lch.from(lab, [L2, a2, b2])[1];\n\n\t// let [L1, a1, b1] = color.getAll(lab);\n\t// let C1 = color.get(\"lch.c\");\n\t// let H1 = color.get(\"lch.h\");\n\t// let [L2, a2, b2] = sample.getAll(lab);\n\t// let C2 = sample.get(\"lch.c\");\n\n\t// Check for negative Chroma,\n\t// which might happen through\n\t// direct user input of LCH values\n\n\tif (C1 < 0) {\n\t\tC1 = 0;\n\t}\n\tif (C2 < 0) {\n\t\tC2 = 0;\n\t}\n\n\t// we don't need H2 as ΔH is calculated from Δa, Δb and ΔC\n\n\t// Lightness and Chroma differences\n\t// These are (color - sample), unlike deltaE2000\n\tlet ΔL = L1 - L2;\n\tlet ΔC = C1 - C2;\n\n\tlet Δa = a1 - a2;\n\tlet Δb = b1 - b2;\n\n\t// weighted Hue difference, less for larger Chroma difference\n\n\tlet H2 = Δa ** 2 + Δb ** 2 - ΔC ** 2;\n\t// due to roundoff error it is possible that, for zero a and b,\n\t// ΔC > Δa + Δb is 0, resulting in attempting\n\t// to take the square root of a negative number\n\n\t// trying instead the equation from Industrial Color Physics\n\t// By Georg A. Klein\n\n\t// let ΔH = ((a1 * b2) - (a2 * b1)) / Math.sqrt(0.5 * ((C2 * C1) + (a2 * a1) + (b2 * b1)));\n\t// console.log({ΔH});\n\t// This gives the same result to 12 decimal places\n\t// except it sometimes NaNs when trying to root a negative number\n\n\t// let ΔH = Math.sqrt(H2); we never actually use the root, it gets squared again!!\n\n\t// positional corrections to the lack of uniformity of CIELAB\n\t// These are all trying to make JND ellipsoids more like spheres\n\n\t// SL Lightness crispening factor, depends entirely on L1 not L2\n\tlet SL = 0.511; // linear portion of the Y to L transfer function\n\tif (L1 >= 16) {\n\t\t// cubic portion\n\t\tSL = (0.040975 * L1) / (1 + 0.01765 * L1);\n\t}\n\n\t// SC Chroma factor\n\tlet SC = (0.0638 * C1) / (1 + 0.0131 * C1) + 0.638;\n\n\t// Cross term T for blue non-linearity\n\tlet T;\n\tif (isNone(H1)) {\n\t\tH1 = 0;\n\t}\n\n\tif (H1 >= 164 && H1 <= 345) {\n\t\tT = 0.56 + Math.abs(0.2 * Math.cos((H1 + 168) * d2r));\n\t}\n\telse {\n\t\tT = 0.36 + Math.abs(0.4 * Math.cos((H1 + 35) * d2r));\n\t}\n\t// console.log({T});\n\n\t// SH Hue factor also depends on C1,\n\tlet C4 = Math.pow(C1, 4);\n\tlet F = Math.sqrt(C4 / (C4 + 1900));\n\tlet SH = SC * (F * T + 1 - F);\n\n\t// Finally calculate the deltaE, term by term as root sume of squares\n\tlet dE = (ΔL / (l * SL)) ** 2;\n\tdE += (ΔC / (c * SC)) ** 2;\n\tdE += H2 / SH ** 2;\n\t// dE += (ΔH / SH)  ** 2;\n\treturn Math.sqrt(dE);\n\t// Yay!!!\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\nconst Yw = 203; // absolute luminance of media white\n\nexport default new ColorSpace({\n\t// Absolute CIE XYZ, with a D65 whitepoint,\n\t// as used in most HDR colorspaces as a starting point.\n\t// SDR spaces are converted per BT.2048\n\t// so that diffuse, media white is 203 cd/m²\n\tid: \"xyz-abs-d65\",\n\tcssId: \"--xyz-abs-d65\",\n\tname: \"Absolute XYZ D65\",\n\tcoords: {\n\t\tx: {\n\t\t\trefRange: [0, 9504.7],\n\t\t\tname: \"Xa\",\n\t\t},\n\t\ty: {\n\t\t\trefRange: [0, 10000],\n\t\t\tname: \"Ya\",\n\t\t},\n\t\tz: {\n\t\t\trefRange: [0, 10888.3],\n\t\t\tname: \"Za\",\n\t\t},\n\t},\n\n\tbase: XYZ_D65,\n\tfromBase (XYZ) {\n\t\t// Make XYZ absolute, not relative to media white\n\t\t// Maximum luminance in PQ is 10,000 cd/m²\n\t\t// Relative XYZ has Y=1 for media white\n\t\treturn XYZ.map(v => v * Yw);\n\t},\n\ttoBase (AbsXYZ) {\n\t\t// Convert to media-white relative XYZ\n\t\treturn AbsXYZ.map(v => v / Yw);\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"../util.js\";\nimport XYZ_Abs_D65 from \"./xyz-abs-d65.js\";\nimport { spow } from \"../util.js\";\n\n/** @import { Matrix3x3, Vector3 } from \"../types.js\" */\n\nconst b = 1.15;\nconst g = 0.66;\nconst n = 2610 / 2 ** 14;\nconst ninv = 2 ** 14 / 2610;\nconst c1 = 3424 / 2 ** 12;\nconst c2 = 2413 / 2 ** 7;\nconst c3 = 2392 / 2 ** 7;\nconst p = (1.7 * 2523) / 2 ** 5;\nconst pinv = 2 ** 5 / (1.7 * 2523);\nconst d = -0.56;\nconst d0 = 1.6295499532821566e-11;\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst XYZtoCone_M = [\n\t[  0.41478972, 0.579999,  0.0146480 ],\n\t[ -0.2015100,  1.120649,  0.0531008 ],\n\t[ -0.0166008,  0.264800,  0.6684799 ],\n];\n// XYZtoCone_M inverted\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst ConetoXYZ_M = [\n\t[  1.9242264357876067,  -1.0047923125953657,  0.037651404030618   ],\n\t[  0.35031676209499907,  0.7264811939316552, -0.06538442294808501 ],\n\t[ -0.09098281098284752, -0.3127282905230739,  1.5227665613052603  ],\n];\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst ConetoIab_M = [\n\t[  0.5,       0.5,       0        ],\n\t[  3.524000, -4.066708,  0.542708 ],\n\t[  0.199076,  1.096799, -1.295875 ],\n];\n// ConetoIab_M inverted\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst IabtoCone_M = [\n\t[ 1,                   0.13860504327153927,   0.05804731615611883 ],\n\t[ 1,                  -0.1386050432715393,   -0.058047316156118904 ],\n\t[ 1,                  -0.09601924202631895,  -0.81189189605603900  ],\n];\n\nexport default new ColorSpace({\n\tid: \"jzazbz\",\n\tname: \"Jzazbz\",\n\tcoords: {\n\t\tjz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Jz\",\n\t\t},\n\t\taz: {\n\t\t\trefRange: [-0.21, 0.21],\n\t\t},\n\t\tbz: {\n\t\t\trefRange: [-0.21, 0.21],\n\t\t},\n\t},\n\n\tbase: XYZ_Abs_D65,\n\tfromBase (XYZ) {\n\t\t// First make XYZ absolute, not relative to media white\n\t\t// Maximum luminance in PQ is 10,000 cd/m²\n\t\t// Relative XYZ has Y=1 for media white\n\t\t// BT.2048 says media white Y=203 at PQ 58\n\n\t\tlet [Xa, Ya, Za] = XYZ;\n\n\t\t// modify X and Y to minimize blue curvature\n\t\tlet Xm = b * Xa - (b - 1) * Za;\n\t\tlet Ym = g * Ya - (g - 1) * Xa;\n\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiply_v3_m3x3([Xm, Ym, Za], XYZtoCone_M);\n\n\t\t// PQ-encode LMS\n\t\tlet PQLMS = /** @type {Vector3} } */ (\n\t\t\tLMS.map(function (val) {\n\t\t\t\tlet num = c1 + c2 * spow(val / 10000, n);\n\t\t\t\tlet denom = 1 + c3 * spow(val / 10000, n);\n\n\t\t\t\treturn spow(num / denom, p);\n\t\t\t})\n\t\t);\n\n\t\t// almost there, calculate Iz az bz\n\t\tlet [Iz, az, bz] = multiply_v3_m3x3(PQLMS, ConetoIab_M);\n\t\t// console.log({Iz, az, bz});\n\n\t\tlet Jz = ((1 + d) * Iz) / (1 + d * Iz) - d0;\n\t\treturn [Jz, az, bz];\n\t},\n\ttoBase (Jzazbz) {\n\t\tlet [Jz, az, bz] = Jzazbz;\n\t\tlet Iz = (Jz + d0) / (1 + d - d * (Jz + d0));\n\n\t\t// bring into LMS cone domain\n\t\tlet PQLMS = multiply_v3_m3x3([Iz, az, bz], IabtoCone_M);\n\n\t\t// convert from PQ-coded to linear-light\n\t\tlet LMS = /** @type {Vector3} } */ (\n\t\t\tPQLMS.map(function (val) {\n\t\t\t\tlet num = c1 - spow(val, pinv);\n\t\t\t\tlet denom = c3 * spow(val, pinv) - c2;\n\t\t\t\tlet x = 10000 * spow(num / denom, ninv);\n\n\t\t\t\treturn x; // luminance relative to diffuse white, [0, 70 or so].\n\t\t\t})\n\t\t);\n\n\t\t// modified abs XYZ\n\t\tlet [Xm, Ym, Za] = multiply_v3_m3x3(LMS, ConetoXYZ_M);\n\n\t\t// un-modify X and Y to get D65 XYZ, relative to media white\n\t\tlet Xa = (Xm + (b - 1) * Za) / b;\n\t\tlet Ya = (Ym + (g - 1) * Xa) / g;\n\t\treturn [Xa, Ya, Za];\n\t},\n\n\tformats: {\n\t\t// https://drafts.csswg.org/css-color-hdr/#Jzazbz\n\t\tjzazbz: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport Jzazbz from \"./jzazbz.js\";\nimport lch from \"./lch.js\";\n\nexport default new ColorSpace({\n\tid: \"jzczhz\",\n\tname: \"JzCzHz\",\n\tcoords: {\n\t\tjz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Jz\",\n\t\t},\n\t\tcz: {\n\t\t\trefRange: [0, 0.26],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\thz: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Jzazbz,\n\tfromBase: lch.fromBase,\n\ttoBase: lch.toBase,\n\n\tformats: {\n\t\t// https://drafts.csswg.org/css-color-hdr/#JzCzhz\n\t\tjzczhz: {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"../util.js\";\nimport XYZ_Abs_D65 from \"./xyz-abs-d65.js\";\n\n/** @import { Matrix3x3, Vector3 } from \"../types.js\" */\n\nconst c1 = 3424 / 4096;\nconst c2 = 2413 / 128;\nconst c3 = 2392 / 128;\nconst m1 = 2610 / 16384;\nconst m2 = 2523 / 32;\nconst im1 = 16384 / 2610;\nconst im2 = 32 / 2523;\n\n// The matrix below includes the 4% crosstalk components\n// and is from the Dolby \"What is ICtCp\" paper\"\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst XYZtoLMS_M = [\n\t[  0.3592832590121217,  0.6976051147779502, -0.0358915932320290 ],\n\t[ -0.1920808463704993,  1.1004767970374321,  0.0753748658519118 ],\n\t[  0.0070797844607479,  0.0748396662186362,  0.8433265453898765 ],\n];\n// linear-light Rec.2020 to LMS, again with crosstalk\n// rational terms from Jan Fröhlich,\n// Encoding High Dynamic Range andWide Color Gamut Imagery, p.97\n// and ITU-R BT.2124-0 p.2\n/*\nconst Rec2020toLMS_M = [\n\t[ 1688 / 4096,  2146 / 4096,   262 / 4096 ],\n\t[  683 / 4096,  2951 / 4096,   462 / 4096 ],\n\t[   99 / 4096,   309 / 4096,  3688 / 4096 ]\n];\n*/\n// this includes the Ebner LMS coefficients,\n// the rotation, and the scaling to [-0.5,0.5] range\n// rational terms from Fröhlich p.97\n// and ITU-R BT.2124-0 pp.2-3\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst LMStoIPT_M = [\n\t[  2048 / 4096,   2048 / 4096,       0      ],\n\t[  6610 / 4096, -13613 / 4096,  7003 / 4096 ],\n\t[ 17933 / 4096, -17390 / 4096,  -543 / 4096 ],\n];\n\n// inverted matrices, calculated from the above\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst IPTtoLMS_M = [\n\t[ 0.9999999999999998,  0.0086090370379328,  0.1110296250030260 ],\n\t[ 0.9999999999999998, -0.0086090370379328, -0.1110296250030259 ],\n\t[ 0.9999999999999998,  0.5600313357106791, -0.3206271749873188 ],\n];\n/*\n// prettier-ignore\nconst LMStoRec2020_M = [\n\t[ 3.4375568932814012112,   -2.5072112125095058195,   0.069654319228104608382],\n\t[-0.79142868665644156125,   1.9838372198740089874,  -0.19240853321756742626 ],\n\t[-0.025646662911506476363, -0.099240248643945566751, 1.1248869115554520431  ]\n];\n*/\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst LMStoXYZ_M = [\n\t[  2.0701522183894223, -1.3263473389671563,  0.2066510476294053 ],\n\t[  0.3647385209748072,  0.6805660249472273, -0.0453045459220347 ],\n\t[ -0.0497472075358123, -0.0492609666966131,  1.1880659249923042 ],\n];\n\n// Only the PQ form of ICtCp is implemented here. There is also an HLG form.\n// from Dolby, \"WHAT IS ICTCP?\"\n// https://professional.dolby.com/siteassets/pdfs/ictcp_dolbywhitepaper_v071.pdf\n// and\n// Dolby, \"Perceptual Color Volume\n// Measuring the Distinguishable Colors of HDR and WCG Displays\"\n// https://professional.dolby.com/siteassets/pdfs/dolby-vision-measuring-perceptual-color-volume-v7.1.pdf\nexport default new ColorSpace({\n\tid: \"ictcp\",\n\tname: \"ICTCP\",\n\t// From BT.2100-2 page 7:\n\t// During production, signal values are expected to exceed the\n\t// range E′ = [0.0 : 1.0]. This provides processing headroom and avoids\n\t// signal degradation during cascaded processing. Such values of E′,\n\t// below 0.0 or exceeding 1.0, should not be clipped during production\n\t// and exchange.\n\t// Values below 0.0 should not be clipped in reference displays (even\n\t// though they represent “negative” light) to allow the black level of\n\t// the signal (LB) to be properly set using test signals known as “PLUGE”\n\tcoords: {\n\t\ti: {\n\t\t\trefRange: [0, 1], // Constant luminance,\n\t\t\tname: \"I\",\n\t\t},\n\t\tct: {\n\t\t\trefRange: [-0.5, 0.5], // Full BT.2020 gamut in range [-0.5, 0.5]\n\t\t\tname: \"CT\",\n\t\t},\n\t\tcp: {\n\t\t\trefRange: [-0.5, 0.5],\n\t\t\tname: \"CP\",\n\t\t},\n\t},\n\n\tbase: XYZ_Abs_D65,\n\tfromBase (XYZ) {\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiply_v3_m3x3(XYZ, XYZtoLMS_M);\n\n\t\treturn LMStoICtCp(LMS);\n\t},\n\ttoBase (ICtCp) {\n\t\tlet LMS = ICtCptoLMS(ICtCp);\n\n\t\treturn multiply_v3_m3x3(LMS, LMStoXYZ_M);\n\t},\n\n\tformats: {\n\t\tictcp: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n\n/**\n *\n * @param {Vector3} LMS\n * @returns {Vector3}\n */\nfunction LMStoICtCp (LMS) {\n\t// apply the PQ EOTF\n\t// we can't ever be dividing by zero because of the \"1 +\" in the denominator\n\tlet PQLMS = /** @type {Vector3} */ (\n\t\tLMS.map(function (val) {\n\t\t\tlet num = c1 + c2 * (val / 10000) ** m1;\n\t\t\tlet denom = 1 + c3 * (val / 10000) ** m1;\n\n\t\t\treturn (num / denom) ** m2;\n\t\t})\n\t);\n\n\t// LMS to IPT, with rotation for Y'C'bC'r compatibility\n\treturn multiply_v3_m3x3(PQLMS, LMStoIPT_M);\n}\n\n/**\n *\n * @param {Vector3} ICtCp\n * @returns {Vector3}\n */\nfunction ICtCptoLMS (ICtCp) {\n\tlet PQLMS = multiply_v3_m3x3(ICtCp, IPTtoLMS_M);\n\n\t// From BT.2124-0 Annex 2 Conversion 3\n\tlet LMS = /** @type {Vector3} */ (\n\t\tPQLMS.map(function (val) {\n\t\t\tlet num = Math.max(val ** im2 - c1, 0);\n\t\t\tlet denom = c2 - c3 * val ** im2;\n\t\t\treturn 10000 * (num / denom) ** im1;\n\t\t})\n\t);\n\n\treturn LMS;\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3, interpolate, copySign, spow, zdiv, bisectLeft } from \"../util.js\";\nimport { constrain } from \"../angles.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport { WHITES } from \"../adapt.js\";\n\n/** @import { Coords, Matrix3x3, Vector3 } from \"../types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"../types.js\").Cam16Object} Cam16Object */\n/** @typedef {import(\"../types.js\").Cam16Input} Cam16Input */\n/** @typedef {import(\"../types.js\").Cam16Environment} Cam16Environment */\n\nconst white = WHITES.D65;\nconst adaptedCoef = 0.42;\nconst adaptedCoefInv = 1 / adaptedCoef;\nconst tau = 2 * Math.PI;\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst cat16 = [\n\t[  0.401288,  0.650173, -0.051461 ],\n\t[ -0.250268,  1.204414,  0.045854 ],\n\t[ -0.002079,  0.048952,  0.953127 ],\n];\n\n/** @type {Matrix3x3} */\nconst cat16Inv = [\n\t[1.8620678550872327, -1.0112546305316843, 0.14918677544445175],\n\t[0.38752654323613717, 0.6214474419314753, -0.008973985167612518],\n\t[-0.015841498849333856, -0.03412293802851557, 1.0499644368778496],\n];\n\n/** @type {Matrix3x3} */\nconst m1 = [\n\t[460.0, 451.0, 288.0],\n\t[460.0, -891.0, -261.0],\n\t[460.0, -220.0, -6300.0],\n];\n\nconst surroundMap = {\n\tdark: [0.8, 0.525, 0.8],\n\tdim: [0.9, 0.59, 0.9],\n\taverage: [1, 0.69, 1],\n};\n\nconst hueQuadMap = {\n\t// Red, Yellow, Green, Blue, Red\n\th: [20.14, 90.0, 164.25, 237.53, 380.14],\n\te: [0.8, 0.7, 1.0, 1.2, 0.8],\n\tH: [0.0, 100.0, 200.0, 300.0, 400.0],\n};\n\nconst rad2deg = 180 / Math.PI;\nconst deg2rad = Math.PI / 180;\n\n/**\n * @param {Coords} coords\n * @param {number} fl\n * @returns {[number, number, number]}\n */\nexport function adapt (coords, fl) {\n\tconst temp = /** @type {[number, number, number]} */ (\n\t\tcoords.map(c => {\n\t\t\tconst x = spow(fl * Math.abs(c) * 0.01, adaptedCoef);\n\t\t\treturn (400 * copySign(x, c)) / (x + 27.13);\n\t\t})\n\t);\n\treturn temp;\n}\n\n/**\n * @param {Coords} adapted\n * @param {number} fl\n * @returns {[number, number, number]}\n */\nexport function unadapt (adapted, fl) {\n\tconst constant = (100 / fl) * 27.13 ** adaptedCoefInv;\n\treturn /** @type {[number, number, number]} */ (\n\t\tadapted.map(c => {\n\t\t\tconst cabs = Math.abs(c);\n\t\t\treturn copySign(constant * spow(cabs / (400 - cabs), adaptedCoefInv), c);\n\t\t})\n\t);\n}\n\n/**\n * @param {number} h\n */\nexport function hueQuadrature (h) {\n\tlet hp = constrain(h);\n\tif (hp <= hueQuadMap.h[0]) {\n\t\thp += 360;\n\t}\n\n\tconst i = bisectLeft(hueQuadMap.h, hp) - 1;\n\tconst [hi, hii] = hueQuadMap.h.slice(i, i + 2);\n\tconst [ei, eii] = hueQuadMap.e.slice(i, i + 2);\n\tconst Hi = hueQuadMap.H[i];\n\n\tconst t = (hp - hi) / ei;\n\treturn Hi + (100 * t) / (t + (hii - hp) / eii);\n}\n\n/**\n * @param {number} H\n */\nexport function invHueQuadrature (H) {\n\tlet Hp = ((H % 400) + 400) % 400;\n\tconst i = Math.floor(0.01 * Hp);\n\tHp = Hp % 100;\n\tconst [hi, hii] = hueQuadMap.h.slice(i, i + 2);\n\tconst [ei, eii] = hueQuadMap.e.slice(i, i + 2);\n\n\treturn constrain((Hp * (eii * hi - ei * hii) - 100 * hi * eii) / (Hp * (eii - ei) - 100 * eii));\n}\n\n/**\n * @param {[number, number, number]} refWhite\n * @param {number} adaptingLuminance\n * @param {number} backgroundLuminance\n * @param {keyof typeof surroundMap} surround\n * @param {boolean} discounting\n * @returns {Cam16Environment}\n */\nexport function environment (\n\trefWhite,\n\tadaptingLuminance,\n\tbackgroundLuminance,\n\tsurround,\n\tdiscounting,\n) {\n\tconst env = {};\n\n\tenv.discounting = discounting;\n\tenv.refWhite = refWhite;\n\tenv.surround = surround;\n\tconst xyzW = /** @type {Vector3} */ (\n\t\trefWhite.map(c => {\n\t\t\treturn c * 100;\n\t\t})\n\t);\n\n\t// The average luminance of the environment in `cd/m^2cd/m` (a.k.a. nits)\n\tenv.la = adaptingLuminance;\n\t// The relative luminance of the nearby background\n\tenv.yb = backgroundLuminance;\n\t// Absolute luminance of the reference white.\n\tconst yw = xyzW[1];\n\n\t// Cone response for reference white\n\tconst rgbW = multiply_v3_m3x3(xyzW, cat16);\n\n\t// Surround: dark, dim, and average\n\tlet values = surroundMap[env.surround];\n\tconst f = values[0];\n\tenv.c = values[1];\n\tenv.nc = values[2];\n\n\tconst k = 1 / (5 * env.la + 1);\n\tconst k4 = k ** 4;\n\n\t// Factor of luminance level adaptation\n\tenv.fl = k4 * env.la + 0.1 * (1 - k4) * (1 - k4) * Math.cbrt(5 * env.la);\n\tenv.flRoot = env.fl ** 0.25;\n\n\tenv.n = env.yb / yw;\n\tenv.z = 1.48 + Math.sqrt(env.n);\n\tenv.nbb = 0.725 * env.n ** -0.2;\n\tenv.ncb = env.nbb;\n\n\t// Degree of adaptation calculating if not discounting\n\t// illuminant (assumed eye is fully adapted)\n\tconst d = discounting\n\t\t? 1\n\t\t: Math.max(Math.min(f * (1 - (1 / 3.6) * Math.exp((-env.la - 42) / 92)), 1), 0);\n\tenv.dRgb = /** @type {[number, number, number]} */ (\n\t\trgbW.map(c => {\n\t\t\treturn interpolate(1, yw / c, d);\n\t\t})\n\t);\n\tenv.dRgbInv = /** @type {[number, number, number]} */ (\n\t\tenv.dRgb.map(c => {\n\t\t\treturn 1 / c;\n\t\t})\n\t);\n\n\t// Achromatic response\n\tconst rgbCW = /** @type {[number, number, number]} */ (\n\t\trgbW.map((c, i) => {\n\t\t\treturn c * env.dRgb[i];\n\t\t})\n\t);\n\tconst rgbAW = adapt(rgbCW, env.fl);\n\tenv.aW = env.nbb * (2 * rgbAW[0] + rgbAW[1] + 0.05 * rgbAW[2]);\n\n\t// console.log(env);\n\n\treturn env;\n}\n\n// Pre-calculate everything we can with the viewing conditions\nconst viewingConditions = environment(white, (64 / Math.PI) * 0.2, 20, \"average\", false);\n\n/**\n * @param {Cam16Input} cam16\n * @param {Cam16Environment} env\n * @returns {[number, number, number]}\n */\nexport function fromCam16 (cam16, env) {\n\t// These check ensure one, and only one attribute for a\n\t// given category is provided.\n\t// @ts-expect-error The '^` operator is not allowed for boolean types\n\tif (!((cam16.J !== undefined) ^ (cam16.Q !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'J' or 'Q'\");\n\t}\n\n\t// @ts-expect-error - The '^` operator is not allowed for boolean types\n\tif (!((cam16.C !== undefined) ^ (cam16.M !== undefined) ^ (cam16.s !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'C', 'M' or 's'\");\n\t}\n\n\t// Hue is absolutely required\n\t// @ts-expect-error - The '^` operator is not allowed for boolean types\n\tif (!((cam16.h !== undefined) ^ (cam16.H !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'h' or 'H'\");\n\t}\n\n\t// Black\n\tif (cam16.J === 0.0 || cam16.Q === 0.0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\n\t// Break hue into Cartesian components\n\tlet hRad = 0.0;\n\tif (cam16.h !== undefined) {\n\t\thRad = constrain(cam16.h) * deg2rad;\n\t}\n\telse {\n\t\thRad = invHueQuadrature(cam16.H) * deg2rad;\n\t}\n\n\tconst cosh = Math.cos(hRad);\n\tconst sinh = Math.sin(hRad);\n\n\t// Calculate `Jroot` from one of the lightness derived coordinates.\n\tlet Jroot = 0.0;\n\tif (cam16.J !== undefined) {\n\t\tJroot = spow(cam16.J, 1 / 2) * 0.1;\n\t}\n\telse if (cam16.Q !== undefined) {\n\t\tJroot = (0.25 * env.c * cam16.Q) / ((env.aW + 4) * env.flRoot);\n\t}\n\n\t// Calculate the `t` value from one of the chroma derived coordinates\n\tlet alpha = 0.0;\n\tif (cam16.C !== undefined) {\n\t\talpha = cam16.C / Jroot;\n\t}\n\telse if (cam16.M !== undefined) {\n\t\talpha = cam16.M / env.flRoot / Jroot;\n\t}\n\telse if (cam16.s !== undefined) {\n\t\talpha = (0.0004 * cam16.s ** 2 * (env.aW + 4)) / env.c;\n\t}\n\tconst t = spow(alpha * Math.pow(1.64 - Math.pow(0.29, env.n), -0.73), 10 / 9);\n\n\t// Eccentricity\n\tconst et = 0.25 * (Math.cos(hRad + 2) + 3.8);\n\n\t// Achromatic response\n\tconst A = env.aW * spow(Jroot, 2 / env.c / env.z);\n\n\t// Calculate red-green and yellow-blue components\n\tconst p1 = (5e4 / 13) * env.nc * env.ncb * et;\n\tconst p2 = A / env.nbb;\n\tconst r = 23 * (p2 + 0.305) * zdiv(t, 23 * p1 + t * (11 * cosh + 108 * sinh));\n\tconst a = r * cosh;\n\tconst b = r * sinh;\n\n\t// Calculate back from cone response to XYZ\n\tconst rgb_c = unadapt(\n\t\t/** @type {Vector3} */\n\t\t(\n\t\t\tmultiply_v3_m3x3([p2, a, b], m1).map(c => {\n\t\t\t\treturn (c * 1) / 1403;\n\t\t\t})\n\t\t),\n\t\tenv.fl,\n\t);\n\treturn /** @type {Vector3} */ (\n\t\tmultiply_v3_m3x3(\n\t\t\t/** @type {Vector3} */ (\n\t\t\t\trgb_c.map((c, i) => {\n\t\t\t\t\treturn c * env.dRgbInv[i];\n\t\t\t\t})\n\t\t\t),\n\t\t\tcat16Inv,\n\t\t).map(c => {\n\t\t\treturn c / 100;\n\t\t})\n\t);\n}\n\n/**\n * @param {[number, number, number]} xyzd65\n * @param {Cam16Environment} env\n * @returns {Cam16Object}\n */\nexport function toCam16 (xyzd65, env) {\n\t// Cone response\n\tconst xyz100 = /** @type {Vector3} */ (\n\t\txyzd65.map(c => {\n\t\t\treturn c * 100;\n\t\t})\n\t);\n\tconst rgbA = adapt(\n\t\t/** @type {[number, number, number]} */\n\t\t(\n\t\t\tmultiply_v3_m3x3(xyz100, cat16).map((c, i) => {\n\t\t\t\treturn c * env.dRgb[i];\n\t\t\t})\n\t\t),\n\t\tenv.fl,\n\t);\n\n\t// Calculate hue from red-green and yellow-blue components\n\tconst a = rgbA[0] + (-12 * rgbA[1] + rgbA[2]) / 11;\n\tconst b = (rgbA[0] + rgbA[1] - 2 * rgbA[2]) / 9;\n\tconst hRad = ((Math.atan2(b, a) % tau) + tau) % tau;\n\n\t// Eccentricity\n\tconst et = 0.25 * (Math.cos(hRad + 2) + 3.8);\n\n\tconst t =\n\t\t(5e4 / 13) *\n\t\tenv.nc *\n\t\tenv.ncb *\n\t\tzdiv(et * Math.sqrt(a ** 2 + b ** 2), rgbA[0] + rgbA[1] + 1.05 * rgbA[2] + 0.305);\n\tconst alpha = spow(t, 0.9) * Math.pow(1.64 - Math.pow(0.29, env.n), 0.73);\n\n\t// Achromatic response\n\tconst A = env.nbb * (2 * rgbA[0] + rgbA[1] + 0.05 * rgbA[2]);\n\n\tconst Jroot = spow(A / env.aW, 0.5 * env.c * env.z);\n\n\t// Lightness\n\tconst J = 100 * spow(Jroot, 2);\n\n\t// Brightness\n\tconst Q = (4 / env.c) * Jroot * (env.aW + 4) * env.flRoot;\n\n\t// Chroma\n\tconst C = alpha * Jroot;\n\n\t// Colorfulness\n\tconst M = C * env.flRoot;\n\n\t// Hue\n\tconst h = constrain(hRad * rad2deg);\n\n\t// Hue quadrature\n\tconst H = hueQuadrature(h);\n\n\t// Saturation\n\tconst s = 50 * spow((env.c * alpha) / (env.aW + 4), 1 / 2);\n\n\t// console.log({J: J, C: C, h: h, s: s, Q: Q, M: M, H: H});\n\n\treturn { J: J, C: C, h: h, s: s, Q: Q, M: M, H: H };\n}\n\n// Provided as a way to directly evaluate the CAM16 model\n// https://observablehq.com/@jrus/cam16: reference implementation\n// https://arxiv.org/pdf/1802.06067.pdf: Nico Schlömer\n// https://onlinelibrary.wiley.com/doi/pdf/10.1002/col.22324: hue quadrature\n// https://www.researchgate.net/publication/318152296_Comprehensive_color_solutions_CAM16_CAT16_and_CAM16-UCS\n// Results compared against: https://github.com/colour-science/colour\nexport default new ColorSpace({\n\tid: \"cam16-jmh\",\n\tcssId: \"--cam16-jmh\",\n\tname: \"CAM16-JMh\",\n\tcoords: {\n\t\tj: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"J\",\n\t\t},\n\t\tm: {\n\t\t\trefRange: [0, 105.0],\n\t\t\tname: \"Colorfulness\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: xyz_d65,\n\n\tfromBase (xyz) {\n\t\t// If another derivation is created, ε could vary, so we can't hardcode\n\t\tif (this.ε === undefined) {\n\t\t\tthis.ε = Object.values(this.coords)[1].refRange[1] / 100000;\n\t\t}\n\t\tconst cam16 = toCam16(xyz, viewingConditions);\n\t\tconst isAchromatic = Math.abs(cam16.M) < this.ε;\n\t\treturn [cam16.J, isAchromatic ? 0 : cam16.M, isAchromatic ? null : cam16.h];\n\t},\n\ttoBase (cam16) {\n\t\treturn fromCam16({ J: cam16[0], M: cam16[1], h: cam16[2] }, viewingConditions);\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { constrain } from \"../angles.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport { fromCam16, toCam16, environment } from \"./cam16.js\";\nimport { WHITES } from \"../adapt.js\";\n\nconst white = WHITES.D65;\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27; // 29^3/3^3\n\nfunction toLstar (y) {\n\t// Convert XYZ Y to L*\n\n\tconst fy = y > ε ? Math.cbrt(y) : (κ * y + 16) / 116;\n\treturn 116.0 * fy - 16.0;\n}\n\nfunction fromLstar (lstar) {\n\t// Convert L* back to XYZ Y\n\n\treturn lstar > 8 ? Math.pow((lstar + 16) / 116, 3) : lstar / κ;\n}\n\nfunction fromHct (coords, env) {\n\t// Use Newton's method to try and converge as quick as possible or\n\t// converge as close as we can. While the requested precision is achieved\n\t// most of the time, it may not always be achievable. Especially past the\n\t// visible spectrum, the algorithm will likely struggle to get the same\n\t// precision. If, for whatever reason, we cannot achieve the accuracy we\n\t// seek in the allotted iterations, just return the closest we were able to\n\t// get.\n\n\tlet [h, c, t] = coords;\n\tlet xyz = [];\n\tlet j = 0;\n\n\t// Shortcut out for black\n\tif (t === 0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\n\t// Calculate the Y we need to target\n\tlet y = fromLstar(t);\n\n\t// A better initial guess yields better results. Polynomials come from\n\t// curve fitting the T vs J response.\n\tif (t > 0) {\n\t\tj = 0.00379058511492914 * t ** 2 + 0.608983189401032 * t + 0.9155088574762233;\n\t}\n\telse {\n\t\tj = 9.514440756550361e-6 * t ** 2 + 0.08693057439788597 * t - 21.928975842194614;\n\t}\n\n\t// Threshold of how close is close enough, and max number of attempts.\n\t// More precision and more attempts means more time spent iterating. Higher\n\t// required precision gives more accuracy but also increases the chance of\n\t// not hitting the goal. 2e-12 allows us to convert round trip with\n\t// reasonable accuracy of six decimal places or more.\n\tconst threshold = 2e-12;\n\tconst max_attempts = 15;\n\n\tlet attempt = 0;\n\tlet last = Infinity;\n\tlet best = j;\n\n\t// Try to find a J such that the returned y matches the returned y of the L*\n\twhile (attempt <= max_attempts) {\n\t\txyz = fromCam16({ J: j, C: c, h: h }, env);\n\n\t\t// If we are within range, return XYZ\n\t\t// If we are closer than last time, save the values\n\t\tconst delta = Math.abs(xyz[1] - y);\n\t\tif (delta < last) {\n\t\t\tif (delta <= threshold) {\n\t\t\t\treturn xyz;\n\t\t\t}\n\t\t\tbest = j;\n\t\t\tlast = delta;\n\t\t}\n\n\t\t// f(j_root) = (j ** (1 / 2)) * 0.1\n\t\t// f(j) = ((f(j_root) * 100) ** 2) / j - 1 = 0\n\t\t// f(j_root) = Y = y / 100\n\t\t// f(j) = (y ** 2) / j - 1\n\t\t// f'(j) = (2 * y) / j\n\t\tj = j - ((xyz[1] - y) * j) / (2 * xyz[1]);\n\n\t\tattempt += 1;\n\t}\n\n\t// We could not acquire the precision we desired,\n\t// return our closest attempt.\n\treturn fromCam16({ J: j, C: c, h: h }, env);\n}\n\nfunction toHct (xyz, env) {\n\t// Calculate HCT by taking the L* of CIE LCh D65 and CAM16 chroma and hue.\n\n\tconst t = toLstar(xyz[1]);\n\tif (t === 0.0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\tconst cam16 = toCam16(xyz, viewingConditions);\n\treturn [constrain(cam16.h), cam16.C, t];\n}\n\n// Pre-calculate everything we can with the viewing conditions\nexport const viewingConditions = environment(\n\twhite,\n\t(200 / Math.PI) * fromLstar(50.0),\n\tfromLstar(50.0) * 100,\n\t\"average\",\n\tfalse,\n);\n\n// https://material.io/blog/science-of-color-design\n// This is not a port of the material-color-utilities,\n// but instead implements the full color space as described,\n// combining CAM16 JCh and Lab D65. This does not clamp conversion\n// to HCT to specific chroma bands and provides support for wider\n// gamuts than Google currently supports and does so at a greater\n// precision (> 8 bits back to sRGB).\n// This implementation comes from https://github.com/facelessuser/coloraide\n// which is licensed under MIT.\nexport default new ColorSpace({\n\tid: \"hct\",\n\tname: \"HCT\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 145],\n\t\t\tname: \"Colorfulness\",\n\t\t},\n\t\tt: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Tone\",\n\t\t},\n\t},\n\n\tbase: xyz_d65,\n\n\tfromBase (xyz) {\n\t\tif (this.ε === undefined) {\n\t\t\tthis.ε = Object.values(this.coords)[1].refRange[1] / 100000;\n\t\t}\n\t\tlet hct = toHct(xyz, viewingConditions);\n\t\tif (hct[1] < this.ε) {\n\t\t\thct[1] = 0.0;\n\t\t\thct[0] = null;\n\t\t}\n\t\treturn hct;\n\t},\n\ttoBase (hct) {\n\t\treturn fromHct(hct, viewingConditions);\n\t},\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hct\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import hct from \"../spaces/hct.js\";\nimport { viewingConditions } from \"../spaces/hct.js\";\nimport getColor from \"../getColor.js\";\n\n/** @import { Coords } from \"../types.js\" */\n\nconst rad2deg = 180 / Math.PI;\nconst deg2rad = Math.PI / 180;\nconst ucsCoeff = [1.0, 0.007, 0.0228];\n\n/**\n * Convert HCT chroma and hue (CAM16 JMh colorfulness and hue) using UCS logic for a and b.\n * @param {Coords} coords - HCT coordinates.\n * @return {number[]}\n */\nfunction convertUcsAb (coords) {\n\t// We want the distance between the actual color.\n\t// If chroma is negative, it will throw off our calculations.\n\t// Normally, converting back to the base and forward will correct it.\n\t// If we have a negative chroma after this, then we have a color that\n\t// cannot resolve to positive chroma.\n\tif (coords[1] < 0) {\n\t\tcoords = hct.fromBase(hct.toBase(coords));\n\t}\n\n\t// Only in extreme cases (usually outside the visible spectrum)\n\t// can the input value for log become negative.\n\t// Avoid domain error by forcing a zero result via \"max\" if necessary.\n\tconst M =\n\t\tMath.log(Math.max(1 + ucsCoeff[2] * coords[1] * viewingConditions.flRoot, 1.0)) /\n\t\tucsCoeff[2];\n\tconst hrad = coords[0] * deg2rad;\n\tconst a = M * Math.cos(hrad);\n\tconst b = M * Math.sin(hrad);\n\n\treturn [coords[2], a, b];\n}\n\n/**\n * Color distance using HCT.\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\tlet [t1, a1, b1] = convertUcsAb(hct.from(color));\n\tlet [t2, a2, b2] = convertUcsAb(hct.from(sample));\n\n\t// Use simple euclidean distance with a and b using UCS conversion\n\t// and LCh lightness (HCT tone).\n\treturn Math.sqrt((t1 - t2) ** 2 + (a1 - a2) ** 2 + (b1 - b2) ** 2);\n}\n","/**\n * @packageDocumentation\n * This module defines all the builtin deltaE methods.\n */\nimport deltaE76 from \"./deltaE76.js\";\nimport deltaECMC from \"./deltaECMC.js\";\nimport deltaE2000 from \"./deltaE2000.js\";\nimport deltaEJz from \"./deltaEJz.js\";\nimport deltaEITP from \"./deltaEITP.js\";\nimport deltaEOK from \"./deltaEOK.js\";\nimport deltaEOK2 from \"./deltaEOK2.js\";\nimport deltaEHCT from \"./deltaEHCT.js\";\n\nexport { deltaE76, deltaECMC, deltaE2000, deltaEJz, deltaEITP, deltaEOK, deltaEOK2, deltaEHCT };\n\nexport default {\n\tdeltaE76,\n\tdeltaECMC,\n\tdeltaE2000,\n\tdeltaEJz,\n\tdeltaEITP,\n\tdeltaEOK,\n\tdeltaEOK2,\n\tdeltaEHCT,\n};\n\n/** @typedef {keyof typeof import(\"./index.js\").default extends `deltaE${infer Method}` ? Method : string} Methods */\n","import distance from \"../distance.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function deltaE76 (color, sample) {\n\t// Assume getColor() is called in the distance function\n\treturn distance(color, sample, \"lab\");\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport { isNone } from \"./util.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n/**\n * Euclidean distance of colors in an arbitrary color space\n * @param {ColorTypes} color1\n * @param {ColorTypes} color2\n * @param {string | ColorSpace} space\n * @returns {number}\n */\nexport default function distance (color1, color2, space = \"lab\") {\n\tspace = ColorSpace.get(space);\n\n\t// Assume getColor() is called on color in space.from()\n\tlet coords1 = space.from(color1);\n\tlet coords2 = space.from(color2);\n\n\treturn Math.sqrt(\n\t\tcoords1.reduce((acc, c1, i) => {\n\t\t\tlet c2 = coords2[i];\n\t\t\tif (isNone(c1) || isNone(c2)) {\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\treturn acc + (c2 - c1) ** 2;\n\t\t}, 0),\n\t);\n}\n","import jzczhz from \"../spaces/jzczhz.js\";\nimport getColor from \"../getColor.js\";\nimport { isNone } from \"../util.js\";\n\n/**\n * More accurate color-difference formulae\n * than the simple 1976 Euclidean distance in Lab\n *\n * Uses JzCzHz, which has improved perceptual uniformity\n * and thus a simple Euclidean root-sum of ΔL² ΔC² ΔH²\n * gives good results.\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE in JzCzHz.\n\tlet [Jz1, Cz1, Hz1] = jzczhz.from(color);\n\tlet [Jz2, Cz2, Hz2] = jzczhz.from(sample);\n\n\t// Lightness and Chroma differences\n\t// sign does not matter as they are squared.\n\tlet ΔJ = Jz1 - Jz2;\n\tlet ΔC = Cz1 - Cz2;\n\n\t// length of chord for ΔH\n\tif (isNone(Hz1) && isNone(Hz2)) {\n\t\t// both undefined hues\n\t\tHz1 = 0;\n\t\tHz2 = 0;\n\t}\n\telse if (isNone(Hz1)) {\n\t\t// one undefined, set to the defined hue\n\t\tHz1 = Hz2;\n\t}\n\telse if (isNone(Hz2)) {\n\t\tHz2 = Hz1;\n\t}\n\n\tlet Δh = Hz1 - Hz2;\n\tlet ΔH = 2 * Math.sqrt(Cz1 * Cz2) * Math.sin((Δh / 2) * (Math.PI / 180));\n\n\treturn Math.sqrt(ΔJ ** 2 + ΔC ** 2 + ΔH ** 2);\n}\n","import ictcp from \"../spaces/ictcp.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * Delta E in ICtCp space,\n * which the ITU calls Delta E ITP, which is shorter.\n * Formulae from ITU Rec. ITU-R BT.2124-0\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE in ICtCp\n\t// which is simply the Euclidean distance\n\n\tlet [I1, T1, P1] = ictcp.from(color);\n\tlet [I2, T2, P2] = ictcp.from(sample);\n\n\t// the 0.25 factor is to undo the encoding scaling in Ct\n\t// the 720 is so that 1 deltaE = 1 JND\n\t// per  ITU-R BT.2124-0 p.3\n\n\treturn 720 * Math.sqrt((I1 - I2) ** 2 + 0.25 * (T1 - T2) ** 2 + (P1 - P2) ** 2);\n}\n","import oklab from \"../spaces/oklab.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * More accurate color-difference formulae\n * than the simple 1976 Euclidean distance in CIE Lab\n * The Oklab a and b axes are scaled relative to the L axis, for better uniformity\n * Björn Ottosson said:\n * \"I've recently done some tests with color distance datasets as implemented\n * in Colorio and on both the Combvd dataset and the OSA-UCS dataset a\n * scale factor of slightly more than 2 for a and b would give the best results\n * (2.016 works best for Combvd and 2.045 for the OSA-UCS dataset).\"\n * @see {@link <https://github.com/w3c/csswg-drafts/issues/6642#issuecomment-945714988>}\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaEOK2, term by term as root sum of squares\n\tlet abscale = 2;\n\tlet [L1, a1, b1] = oklab.from(color);\n\tlet [L2, a2, b2] = oklab.from(sample);\n\tlet ΔL = L1 - L2;\n\tlet Δa = abscale * (a1 - a2);\n\tlet Δb = abscale * (b1 - b2);\n\treturn Math.sqrt(ΔL ** 2 + Δa ** 2 + Δb ** 2);\n}\n","import * as util from \"./util.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport defaults from \"./defaults.js\";\nimport deltaE2000 from \"./deltaE/deltaE2000.js\";\nimport deltaEOK from \"./deltaE/deltaEOK.js\";\nimport inGamut from \"./inGamut.js\";\nimport to from \"./to.js\";\nimport get from \"./get.js\";\nimport oklab from \"./spaces/oklab.js\";\nimport set from \"./set.js\";\nimport clone from \"./clone.js\";\nimport getColor from \"./getColor.js\";\nimport deltaEMethods from \"./deltaE/index.js\";\nimport { WHITES } from \"./adapt.js\";\n\n/** @import { ColorTypes, PlainColorObject } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").ToGamutOptions} ToGamutOptions */\n\n/**\n * Calculate the epsilon to 2 degrees smaller than the specified JND.\n * @param {number} jnd The target \"just noticeable difference\".\n * @returns {number}\n */\nfunction calcEpsilon (jnd) {\n\t// Calculate the epsilon to 2 degrees smaller than the specified JND.\n\n\tconst order = !jnd ? 0 : Math.floor(Math.log10(Math.abs(jnd)));\n\t// Limit to an arbitrary value to ensure value is never too small and causes infinite loops.\n\treturn Math.max(parseFloat(`1e${order - 2}`), 1e-6);\n}\n\nconst GMAPPRESET = {\n\thct: {\n\t\tmethod: \"hct.c\",\n\t\tjnd: 2,\n\t\tdeltaEMethod: \"hct\",\n\t\tblackWhiteClamp: {},\n\t},\n\t\"hct-tonal\": {\n\t\tmethod: \"hct.c\",\n\t\tjnd: 0,\n\t\tdeltaEMethod: \"hct\",\n\t\tblackWhiteClamp: { channel: \"hct.t\", min: 0, max: 100 },\n\t},\n};\n\n/**\n * Force coordinates to be in gamut of a certain color space.\n * Mutates the color it is passed.\n * @overload\n * @param {ColorTypes} color\n * @param {ToGamutOptions} [options]\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {string} [space]\n * @returns {PlainColorObject}\n */\n/**\n * @param {ColorTypes} color\n * @param {string & Partial<ToGamutOptions> | ToGamutOptions} [space]\n * @returns {PlainColorObject}\n */\nexport default function toGamut (\n\tcolor,\n\t{\n\t\tmethod = defaults.gamut_mapping,\n\t\tspace = undefined,\n\t\tdeltaEMethod = \"\",\n\t\tjnd = 2,\n\t\tblackWhiteClamp = undefined,\n\t} = {},\n) {\n\tcolor = getColor(color);\n\n\tif (util.isString(arguments[1])) {\n\t\tspace = arguments[1];\n\t}\n\telse if (!space) {\n\t\tspace = color.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\n\t// 3 spaces:\n\t// color.space: current color space\n\t// space: space whose gamut we are mapping to\n\t// mapSpace: space with the coord we're reducing\n\n\tif (inGamut(color, space, { epsilon: 0 })) {\n\t\treturn /** @type {PlainColorObject} */ (color);\n\t}\n\n\tlet spaceColor;\n\tif (method === \"css\") {\n\t\tspaceColor = toGamutCSS(color, { space });\n\t}\n\telse {\n\t\tif (method !== \"clip\" && !inGamut(color, space)) {\n\t\t\tif (Object.prototype.hasOwnProperty.call(GMAPPRESET, method)) {\n\t\t\t\t({ method, jnd, deltaEMethod, blackWhiteClamp } = GMAPPRESET[method]);\n\t\t\t}\n\n\t\t\t// Get the correct delta E method\n\t\t\tlet de = deltaE2000;\n\t\t\tif (deltaEMethod !== \"\") {\n\t\t\t\tfor (let m in deltaEMethods) {\n\t\t\t\t\tif (\"deltae\" + deltaEMethod.toLowerCase() === m.toLowerCase()) {\n\t\t\t\t\t\tde = deltaEMethods[m];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (jnd === 0) {\n\t\t\t\tjnd = 1e-16;\n\t\t\t}\n\n\t\t\tlet clipped = toGamut(to(color, space), { method: \"clip\", space });\n\t\t\tif (de(color, clipped) > jnd) {\n\t\t\t\t// Clamp to SDR white and black if required\n\t\t\t\tif (blackWhiteClamp && Object.keys(blackWhiteClamp).length === 3) {\n\t\t\t\t\tlet channelMeta = ColorSpace.resolveCoord(blackWhiteClamp.channel);\n\t\t\t\t\tlet channel = get(to(color, channelMeta.space), channelMeta.id);\n\t\t\t\t\tif (util.isNone(channel)) {\n\t\t\t\t\t\tchannel = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (channel >= blackWhiteClamp.max) {\n\t\t\t\t\t\treturn to({ space: \"xyz-d65\", coords: WHITES[\"D65\"] }, color.space);\n\t\t\t\t\t}\n\t\t\t\t\telse if (channel <= blackWhiteClamp.min) {\n\t\t\t\t\t\treturn to({ space: \"xyz-d65\", coords: [0, 0, 0] }, color.space);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Reduce a coordinate of a certain color space until the color is in gamut\n\t\t\t\tlet coordMeta = ColorSpace.resolveCoord(method);\n\t\t\t\tlet mapSpace = coordMeta.space;\n\t\t\t\tlet coordId = coordMeta.id;\n\n\t\t\t\tlet mappedColor = to(color, mapSpace);\n\t\t\t\t// If we were already in the mapped color space, we need to resolve undefined channels\n\t\t\t\tmappedColor.coords.forEach((c, i) => {\n\t\t\t\t\tif (util.isNone(c)) {\n\t\t\t\t\t\tmappedColor.coords[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet bounds = coordMeta.range || coordMeta.refRange;\n\t\t\t\tlet min = bounds[0];\n\t\t\t\tlet ε = calcEpsilon(jnd);\n\t\t\t\tlet low = min;\n\t\t\t\tlet high = get(mappedColor, coordId);\n\n\t\t\t\twhile (high - low > ε) {\n\t\t\t\t\tlet clipped = clone(mappedColor);\n\t\t\t\t\tclipped = toGamut(clipped, { space, method: \"clip\" });\n\t\t\t\t\tlet deltaE = de(mappedColor, clipped);\n\n\t\t\t\t\tif (deltaE - jnd < ε) {\n\t\t\t\t\t\tlow = get(mappedColor, coordId);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\thigh = get(mappedColor, coordId);\n\t\t\t\t\t}\n\n\t\t\t\t\tset(mappedColor, coordId, (low + high) / 2);\n\t\t\t\t}\n\n\t\t\t\tspaceColor = to(mappedColor, space);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tspaceColor = clipped;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tspaceColor = to(color, space);\n\t\t}\n\n\t\tif (\n\t\t\tmethod === \"clip\" || // Dumb coord clipping\n\t\t\t// finish off smarter gamut mapping with clip to get rid of ε, see #17\n\t\t\t!inGamut(spaceColor, space, { epsilon: 0 })\n\t\t) {\n\t\t\tlet bounds = Object.values(space.coords).map(c => c.range || []);\n\n\t\t\tspaceColor.coords = /** @type {[number, number, number]} */ (\n\t\t\t\tspaceColor.coords.map((c, i) => {\n\t\t\t\t\tlet [min, max] = bounds[i];\n\n\t\t\t\t\tif (min !== undefined) {\n\t\t\t\t\t\tc = Math.max(min, c);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (max !== undefined) {\n\t\t\t\t\t\tc = Math.min(c, max);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn c;\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t}\n\n\tif (space !== color.space) {\n\t\tspaceColor = to(spaceColor, color.space);\n\t}\n\n\tcolor.coords = spaceColor.coords;\n\treturn /** @type {PlainColorObject} */ (color);\n}\n\n/** @type {\"color\"} */\ntoGamut.returns = \"color\";\n\n/**\n * The reference colors to be used if lightness is out of the range 0-1 in the\n * `Oklch` space. These are created in the `Oklab` space, as it is used by the\n * DeltaEOK calculation, so it is guaranteed to be imported.\n * @satisfies {Record<string, ColorTypes>}\n */\nconst COLORS = {\n\tWHITE: { space: oklab, coords: [1, 0, 0], alpha: 1 },\n\tBLACK: { space: oklab, coords: [0, 0, 0], alpha: 1 },\n};\n\n/**\n * Given a color `origin`, returns a new color that is in gamut using\n * the CSS Gamut Mapping Algorithm. If `space` is specified, it will be in gamut\n * in `space`, and returned in `space`. Otherwise, it will be in gamut and\n * returned in the color space of `origin`.\n * @param {ColorTypes} origin\n * @param {{ space?: string | ColorSpace | undefined }} param1\n * @returns {PlainColorObject}\n */\nexport function toGamutCSS (origin, { space } = {}) {\n\tconst JND = 0.02;\n\tconst ε = 0.0001;\n\n\torigin = getColor(origin);\n\n\tif (!space) {\n\t\tspace = origin.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\tconst oklchSpace = ColorSpace.get(\"oklch\");\n\n\tif (space.isUnbounded) {\n\t\treturn to(origin, space);\n\t}\n\n\tconst origin_OKLCH = to(origin, oklchSpace);\n\tlet L = origin_OKLCH.coords[0];\n\n\t// return media white or black, if lightness is out of range\n\tif (L >= 1) {\n\t\tconst white = to(COLORS.WHITE, space);\n\t\twhite.alpha = origin.alpha;\n\t\treturn to(white, space);\n\t}\n\tif (L <= 0) {\n\t\tconst black = to(COLORS.BLACK, space);\n\t\tblack.alpha = origin.alpha;\n\t\treturn to(black, space);\n\t}\n\n\tif (inGamut(origin_OKLCH, space, { epsilon: 0 })) {\n\t\treturn to(origin_OKLCH, space);\n\t}\n\n\tfunction clip (_color) {\n\t\tconst destColor = to(_color, space);\n\t\tconst spaceCoords = Object.values(/** @type {ColorSpace} */ (space).coords);\n\t\tdestColor.coords = /** @type {[number, number, number]} */ (\n\t\t\tdestColor.coords.map((coord, index) => {\n\t\t\t\tif (\"range\" in spaceCoords[index]) {\n\t\t\t\t\tconst [min, max] = spaceCoords[index].range;\n\t\t\t\t\treturn util.clamp(min, coord, max);\n\t\t\t\t}\n\t\t\t\treturn coord;\n\t\t\t})\n\t\t);\n\t\treturn destColor;\n\t}\n\tlet min = 0;\n\tlet max = origin_OKLCH.coords[1];\n\tlet min_inGamut = true;\n\tlet current = clone(origin_OKLCH);\n\tlet clipped = clip(current);\n\n\tlet E = deltaEOK(clipped, current);\n\tif (E < JND) {\n\t\treturn clipped;\n\t}\n\n\twhile (max - min > ε) {\n\t\tconst chroma = (min + max) / 2;\n\t\tcurrent.coords[1] = chroma;\n\t\tif (min_inGamut && inGamut(current, space, { epsilon: 0 })) {\n\t\t\tmin = chroma;\n\t\t}\n\t\telse {\n\t\t\tclipped = clip(current);\n\t\t\tE = deltaEOK(clipped, current);\n\t\t\tif (E < JND) {\n\t\t\t\tif (JND - E < ε) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmin_inGamut = false;\n\t\t\t\t\tmin = chroma;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmax = chroma;\n\t\t\t}\n\t\t}\n\t}\n\treturn clipped;\n}\n","import getColor from \"./getColor.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport toGamut from \"./toGamut.js\";\n\n/** @import { ColorTypes, PlainColorObject, ToGamutOptions } from \"./types.js\" */\n\n/**\n * Convert to color space and return a new color\n * @param {ColorTypes} color\n * @param {string | ColorSpace} space\n * @param {{ inGamut?: boolean | ToGamutOptions | undefined }} options\n * @returns {PlainColorObject}\n */\nexport default function to (color, space, { inGamut } = {}) {\n\tcolor = getColor(color);\n\tspace = ColorSpace.get(space);\n\n\tlet coords = space.from(color);\n\tlet ret = { space, coords, alpha: color.alpha };\n\n\tif (inGamut) {\n\t\tret = toGamut(ret, inGamut === true ? undefined : inGamut);\n\t}\n\n\treturn ret;\n}\n\n/** @type {\"color\"} */\nto.returns = \"color\";\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// convert an array of linear-light rec2020 values to CIE XYZ\n// using  D65 (no chromatic adaptation)\n// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n// 0 is actually calculated as  4.994106574466076e-17\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.6369580483012914, 0.14461690358620832,  0.1688809751641721  ],\n\t[ 0.2627002120112671, 0.6779980715188708,   0.05930171646986196 ],\n\t[ 0.000000000000000,  0.028072693049087428, 1.060985057710791   ],\n];\n\n// from ITU-R BT.2124-0 Annex 2 p.3\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[  1.716651187971268,  -0.355670783776392, -0.253366281373660  ],\n\t[ -0.666684351832489,   1.616481236634939,  0.0157685458139111 ],\n\t[  0.017639857445311,  -0.042770613257809,  0.942103121235474  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"rec2020-linear\",\n\tcssId: \"--rec2020-linear\",\n\tname: \"Linear REC.2020\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport REC2020Linear from \"./rec2020-linear.js\";\n// import sRGB from \"./srgb.js\";\n\nexport default new RGBColorSpace({\n\tid: \"rec2020\",\n\tname: \"REC.2020\",\n\tbase: REC2020Linear,\n\t//  Reference electro-optical transfer function from Rec. ITU-R BT.1886 Annex 1\n\t//  with b (black lift) = 0 and a (user gain) = 1\n\t//  defined over the extended range, not clamped\n\ttoBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\t\t\treturn sign * Math.pow(abs, 2.4);\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\t\t\treturn sign * Math.pow(abs, 1 / 2.4);\n\t\t});\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[0.4865709486482162, 0.26566769316909306, 0.1982172852343625],\n\t[0.2289745640697488, 0.6917385218365064,  0.079286914093745],\n\t[0.0000000000000000, 0.04511338185890264, 1.043944368900976],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[ 2.493496911941425,   -0.9313836179191239, -0.40271078445071684],\n\t[-0.8294889695615747,   1.7626640603183463,  0.023624685841943577],\n\t[ 0.03584583024378447, -0.07617238926804182, 0.9568845240076872],\n];\n\nexport default new RGBColorSpace({\n\tid: \"p3-linear\",\n\tcssId: \"display-p3-linear\",\n\tname: \"Linear P3\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// This is the linear-light version of sRGB\n// as used for example in SVG filters\n// or in Canvas\n\n// This matrix was calculated directly from the RGB and white chromaticities\n// when rounded to 8 decimal places, it agrees completely with the official matrix\n// see https://github.com/w3c/csswg-drafts/issues/5922\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.41239079926595934, 0.357584339383878,   0.1804807884018343  ],\n\t[ 0.21263900587151027, 0.715168678767756,   0.07219231536073371 ],\n\t[ 0.01933081871559182, 0.11919477979462598, 0.9505321522496607  ],\n];\n\n// This matrix is the inverse of the above;\n// again it agrees with the official definition when rounded to 8 decimal places\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const fromXYZ_M = [\n\t[  3.2409699419045226,  -1.537383177570094,   -0.4986107602930034  ],\n\t[ -0.9692436362808796,   1.8759675015077202,   0.04155505740717559 ],\n\t[  0.05563007969699366, -0.20397695888897652,  1.0569715142428786  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"srgb-linear\",\n\tname: \"Linear sRGB\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","// To produce: Visit https://www.w3.org/TR/css-color-4/#named-colors\n// and run in the console:\n// copy($$(\"tr\", $(\".named-color-table tbody\")).map(tr => `\"${tr.cells[2].textContent.trim()}\": [${tr.cells[4].textContent.trim().split(/\\s+/).map(c => c === \"0\"? \"0\" : c === \"255\"? \"1\" : c + \" / 255\").join(\", \")}]`).join(\",\\n\"))\n\n/** List of CSS color keywords\n *  Note that this does not include currentColor, transparent,\n *  or system colors\n *\n *  @type {Record<string, [number, number, number]>}\n */\nexport default {\n\taliceblue: [240 / 255, 248 / 255, 1],\n\tantiquewhite: [250 / 255, 235 / 255, 215 / 255],\n\taqua: [0, 1, 1],\n\taquamarine: [127 / 255, 1, 212 / 255],\n\tazure: [240 / 255, 1, 1],\n\tbeige: [245 / 255, 245 / 255, 220 / 255],\n\tbisque: [1, 228 / 255, 196 / 255],\n\tblack: [0, 0, 0],\n\tblanchedalmond: [1, 235 / 255, 205 / 255],\n\tblue: [0, 0, 1],\n\tblueviolet: [138 / 255, 43 / 255, 226 / 255],\n\tbrown: [165 / 255, 42 / 255, 42 / 255],\n\tburlywood: [222 / 255, 184 / 255, 135 / 255],\n\tcadetblue: [95 / 255, 158 / 255, 160 / 255],\n\tchartreuse: [127 / 255, 1, 0],\n\tchocolate: [210 / 255, 105 / 255, 30 / 255],\n\tcoral: [1, 127 / 255, 80 / 255],\n\tcornflowerblue: [100 / 255, 149 / 255, 237 / 255],\n\tcornsilk: [1, 248 / 255, 220 / 255],\n\tcrimson: [220 / 255, 20 / 255, 60 / 255],\n\tcyan: [0, 1, 1],\n\tdarkblue: [0, 0, 139 / 255],\n\tdarkcyan: [0, 139 / 255, 139 / 255],\n\tdarkgoldenrod: [184 / 255, 134 / 255, 11 / 255],\n\tdarkgray: [169 / 255, 169 / 255, 169 / 255],\n\tdarkgreen: [0, 100 / 255, 0],\n\tdarkgrey: [169 / 255, 169 / 255, 169 / 255],\n\tdarkkhaki: [189 / 255, 183 / 255, 107 / 255],\n\tdarkmagenta: [139 / 255, 0, 139 / 255],\n\tdarkolivegreen: [85 / 255, 107 / 255, 47 / 255],\n\tdarkorange: [1, 140 / 255, 0],\n\tdarkorchid: [153 / 255, 50 / 255, 204 / 255],\n\tdarkred: [139 / 255, 0, 0],\n\tdarksalmon: [233 / 255, 150 / 255, 122 / 255],\n\tdarkseagreen: [143 / 255, 188 / 255, 143 / 255],\n\tdarkslateblue: [72 / 255, 61 / 255, 139 / 255],\n\tdarkslategray: [47 / 255, 79 / 255, 79 / 255],\n\tdarkslategrey: [47 / 255, 79 / 255, 79 / 255],\n\tdarkturquoise: [0, 206 / 255, 209 / 255],\n\tdarkviolet: [148 / 255, 0, 211 / 255],\n\tdeeppink: [1, 20 / 255, 147 / 255],\n\tdeepskyblue: [0, 191 / 255, 1],\n\tdimgray: [105 / 255, 105 / 255, 105 / 255],\n\tdimgrey: [105 / 255, 105 / 255, 105 / 255],\n\tdodgerblue: [30 / 255, 144 / 255, 1],\n\tfirebrick: [178 / 255, 34 / 255, 34 / 255],\n\tfloralwhite: [1, 250 / 255, 240 / 255],\n\tforestgreen: [34 / 255, 139 / 255, 34 / 255],\n\tfuchsia: [1, 0, 1],\n\tgainsboro: [220 / 255, 220 / 255, 220 / 255],\n\tghostwhite: [248 / 255, 248 / 255, 1],\n\tgold: [1, 215 / 255, 0],\n\tgoldenrod: [218 / 255, 165 / 255, 32 / 255],\n\tgray: [128 / 255, 128 / 255, 128 / 255],\n\tgreen: [0, 128 / 255, 0],\n\tgreenyellow: [173 / 255, 1, 47 / 255],\n\tgrey: [128 / 255, 128 / 255, 128 / 255],\n\thoneydew: [240 / 255, 1, 240 / 255],\n\thotpink: [1, 105 / 255, 180 / 255],\n\tindianred: [205 / 255, 92 / 255, 92 / 255],\n\tindigo: [75 / 255, 0, 130 / 255],\n\tivory: [1, 1, 240 / 255],\n\tkhaki: [240 / 255, 230 / 255, 140 / 255],\n\tlavender: [230 / 255, 230 / 255, 250 / 255],\n\tlavenderblush: [1, 240 / 255, 245 / 255],\n\tlawngreen: [124 / 255, 252 / 255, 0],\n\tlemonchiffon: [1, 250 / 255, 205 / 255],\n\tlightblue: [173 / 255, 216 / 255, 230 / 255],\n\tlightcoral: [240 / 255, 128 / 255, 128 / 255],\n\tlightcyan: [224 / 255, 1, 1],\n\tlightgoldenrodyellow: [250 / 255, 250 / 255, 210 / 255],\n\tlightgray: [211 / 255, 211 / 255, 211 / 255],\n\tlightgreen: [144 / 255, 238 / 255, 144 / 255],\n\tlightgrey: [211 / 255, 211 / 255, 211 / 255],\n\tlightpink: [1, 182 / 255, 193 / 255],\n\tlightsalmon: [1, 160 / 255, 122 / 255],\n\tlightseagreen: [32 / 255, 178 / 255, 170 / 255],\n\tlightskyblue: [135 / 255, 206 / 255, 250 / 255],\n\tlightslategray: [119 / 255, 136 / 255, 153 / 255],\n\tlightslategrey: [119 / 255, 136 / 255, 153 / 255],\n\tlightsteelblue: [176 / 255, 196 / 255, 222 / 255],\n\tlightyellow: [1, 1, 224 / 255],\n\tlime: [0, 1, 0],\n\tlimegreen: [50 / 255, 205 / 255, 50 / 255],\n\tlinen: [250 / 255, 240 / 255, 230 / 255],\n\tmagenta: [1, 0, 1],\n\tmaroon: [128 / 255, 0, 0],\n\tmediumaquamarine: [102 / 255, 205 / 255, 170 / 255],\n\tmediumblue: [0, 0, 205 / 255],\n\tmediumorchid: [186 / 255, 85 / 255, 211 / 255],\n\tmediumpurple: [147 / 255, 112 / 255, 219 / 255],\n\tmediumseagreen: [60 / 255, 179 / 255, 113 / 255],\n\tmediumslateblue: [123 / 255, 104 / 255, 238 / 255],\n\tmediumspringgreen: [0, 250 / 255, 154 / 255],\n\tmediumturquoise: [72 / 255, 209 / 255, 204 / 255],\n\tmediumvioletred: [199 / 255, 21 / 255, 133 / 255],\n\tmidnightblue: [25 / 255, 25 / 255, 112 / 255],\n\tmintcream: [245 / 255, 1, 250 / 255],\n\tmistyrose: [1, 228 / 255, 225 / 255],\n\tmoccasin: [1, 228 / 255, 181 / 255],\n\tnavajowhite: [1, 222 / 255, 173 / 255],\n\tnavy: [0, 0, 128 / 255],\n\toldlace: [253 / 255, 245 / 255, 230 / 255],\n\tolive: [128 / 255, 128 / 255, 0],\n\tolivedrab: [107 / 255, 142 / 255, 35 / 255],\n\torange: [1, 165 / 255, 0],\n\torangered: [1, 69 / 255, 0],\n\torchid: [218 / 255, 112 / 255, 214 / 255],\n\tpalegoldenrod: [238 / 255, 232 / 255, 170 / 255],\n\tpalegreen: [152 / 255, 251 / 255, 152 / 255],\n\tpaleturquoise: [175 / 255, 238 / 255, 238 / 255],\n\tpalevioletred: [219 / 255, 112 / 255, 147 / 255],\n\tpapayawhip: [1, 239 / 255, 213 / 255],\n\tpeachpuff: [1, 218 / 255, 185 / 255],\n\tperu: [205 / 255, 133 / 255, 63 / 255],\n\tpink: [1, 192 / 255, 203 / 255],\n\tplum: [221 / 255, 160 / 255, 221 / 255],\n\tpowderblue: [176 / 255, 224 / 255, 230 / 255],\n\tpurple: [128 / 255, 0, 128 / 255],\n\trebeccapurple: [102 / 255, 51 / 255, 153 / 255],\n\tred: [1, 0, 0],\n\trosybrown: [188 / 255, 143 / 255, 143 / 255],\n\troyalblue: [65 / 255, 105 / 255, 225 / 255],\n\tsaddlebrown: [139 / 255, 69 / 255, 19 / 255],\n\tsalmon: [250 / 255, 128 / 255, 114 / 255],\n\tsandybrown: [244 / 255, 164 / 255, 96 / 255],\n\tseagreen: [46 / 255, 139 / 255, 87 / 255],\n\tseashell: [1, 245 / 255, 238 / 255],\n\tsienna: [160 / 255, 82 / 255, 45 / 255],\n\tsilver: [192 / 255, 192 / 255, 192 / 255],\n\tskyblue: [135 / 255, 206 / 255, 235 / 255],\n\tslateblue: [106 / 255, 90 / 255, 205 / 255],\n\tslategray: [112 / 255, 128 / 255, 144 / 255],\n\tslategrey: [112 / 255, 128 / 255, 144 / 255],\n\tsnow: [1, 250 / 255, 250 / 255],\n\tspringgreen: [0, 1, 127 / 255],\n\tsteelblue: [70 / 255, 130 / 255, 180 / 255],\n\ttan: [210 / 255, 180 / 255, 140 / 255],\n\tteal: [0, 128 / 255, 128 / 255],\n\tthistle: [216 / 255, 191 / 255, 216 / 255],\n\ttomato: [1, 99 / 255, 71 / 255],\n\tturquoise: [64 / 255, 224 / 255, 208 / 255],\n\tviolet: [238 / 255, 130 / 255, 238 / 255],\n\twheat: [245 / 255, 222 / 255, 179 / 255],\n\twhite: [1, 1, 1],\n\twhitesmoke: [245 / 255, 245 / 255, 245 / 255],\n\tyellow: [1, 1, 0],\n\tyellowgreen: [154 / 255, 205 / 255, 50 / 255],\n};\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport sRGBLinear from \"./srgb-linear.js\";\nimport KEYWORDS from \"../keywords.js\";\n\n/** @import { Coords } from \"../types.js\" */\n\nlet coordGrammar = Array(3).fill(\"<percentage> | <number>[0, 255]\");\nlet coordGrammarNumber = Array(3).fill(\"<number>[0, 255]\");\n\nexport default new RGBColorSpace({\n\tid: \"srgb\",\n\tname: \"sRGB\",\n\tbase: sRGBLinear,\n\tfromBase: rgb => {\n\t\t// convert an array of linear-light sRGB values in the range 0.0-1.0\n\t\t// to gamma corrected form\n\t\t// https://en.wikipedia.org/wiki/SRGB\n\t\treturn rgb.map(val => {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs > 0.0031308) {\n\t\t\t\treturn sign * (1.055 * abs ** (1 / 2.4) - 0.055);\n\t\t\t}\n\n\t\t\treturn 12.92 * val;\n\t\t});\n\t},\n\ttoBase: rgb => {\n\t\t// convert an array of sRGB values in the range 0.0 - 1.0\n\t\t// to linear light (un-companded) form.\n\t\t// https://en.wikipedia.org/wiki/SRGB\n\t\treturn rgb.map(val => {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs <= 0.04045) {\n\t\t\t\treturn val / 12.92;\n\t\t\t}\n\n\t\t\treturn sign * ((abs + 0.055) / 1.055) ** 2.4;\n\t\t});\n\t},\n\tformats: {\n\t\trgb: {\n\t\t\tcoords: coordGrammar,\n\t\t},\n\t\trgb_number: {\n\t\t\tname: \"rgb\",\n\t\t\tcommas: true,\n\t\t\tcoords: coordGrammarNumber,\n\t\t\talpha: false,\n\t\t},\n\t\tcolor: {\n\t\t\t/* use defaults */\n\t\t},\n\t\trgba: {\n\t\t\tcoords: coordGrammar,\n\t\t\tcommas: true,\n\t\t\talpha: true,\n\t\t},\n\t\trgba_number: {\n\t\t\tname: \"rgba\",\n\t\t\tcommas: true,\n\t\t\tcoords: coordGrammarNumber,\n\t\t},\n\t\thex: {\n\t\t\ttype: \"custom\",\n\t\t\ttoGamut: true,\n\t\t\ttest: str => /^#(([a-f0-9]{2}){3,4}|[a-f0-9]{3,4})$/i.test(str),\n\t\t\tparse (str) {\n\t\t\t\tif (str.length <= 5) {\n\t\t\t\t\t// #rgb or #rgba, duplicate digits\n\t\t\t\t\tstr = str.replace(/[a-f0-9]/gi, \"$&$&\");\n\t\t\t\t}\n\n\t\t\t\t/** @type {number[]} */\n\t\t\t\tlet rgba = [];\n\t\t\t\t// @ts-expect-error Type 'void' is not assignable to type 'string'\n\t\t\t\tstr.replace(/[a-f0-9]{2}/gi, component => {\n\t\t\t\t\trgba.push(parseInt(component, 16) / 255);\n\t\t\t\t});\n\n\t\t\t\treturn {\n\t\t\t\t\tspaceId: \"srgb\",\n\t\t\t\t\tcoords: /** @type {Coords} */ (rgba.slice(0, 3)),\n\t\t\t\t\talpha: /** @type {number} */ (rgba.slice(3)[0]),\n\t\t\t\t};\n\t\t\t},\n\t\t\tserialize: (\n\t\t\t\tcoords,\n\t\t\t\talpha,\n\t\t\t\t{\n\t\t\t\t\tcollapse = true, // collapse to 3-4 digit hex when possible?\n\t\t\t\t\talpha: alphaFormat,\n\t\t\t\t} = {},\n\t\t\t) => {\n\t\t\t\tif ((alphaFormat !== false && alpha < 1) || alphaFormat === true) {\n\t\t\t\t\tcoords.push(alpha);\n\t\t\t\t}\n\n\t\t\t\tcoords = /** @type {[number, number, number]} */ (\n\t\t\t\t\tcoords.map(c => Math.round(c * 255))\n\t\t\t\t);\n\n\t\t\t\tlet collapsible = collapse && coords.every(c => c % 17 === 0);\n\n\t\t\t\tlet hex = coords\n\t\t\t\t\t.map(c => {\n\t\t\t\t\t\tif (collapsible) {\n\t\t\t\t\t\t\treturn (c / 17).toString(16);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn c.toString(16).padStart(2, \"0\");\n\t\t\t\t\t})\n\t\t\t\t\t.join(\"\");\n\n\t\t\t\treturn \"#\" + hex;\n\t\t\t},\n\t\t},\n\t\tkeyword: {\n\t\t\ttype: \"custom\",\n\t\t\ttest: str => /^[a-z]+$/i.test(str),\n\t\t\tparse (str) {\n\t\t\t\tstr = str.toLowerCase();\n\t\t\t\tlet ret = { spaceId: \"srgb\", coords: null, alpha: 1 };\n\n\t\t\t\tif (str === \"transparent\") {\n\t\t\t\t\tret.coords = KEYWORDS.black;\n\t\t\t\t\tret.alpha = 0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tret.coords = KEYWORDS[str];\n\t\t\t\t}\n\n\t\t\t\tif (ret.coords) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport P3Linear from \"./p3-linear.js\";\nimport sRGB from \"./srgb.js\";\n\nexport default new RGBColorSpace({\n\tid: \"p3\",\n\tcssId: \"display-p3\",\n\tname: \"P3\",\n\tbase: P3Linear,\n\t// Gamma encoding/decoding is the same as sRGB\n\tfromBase: sRGB.fromBase,\n\ttoBase: sRGB.toBase,\n});\n","/**\n * Relative luminance\n */\nimport get from \"./get.js\";\nimport set from \"./set.js\";\nimport xyz_d65 from \"./spaces/xyz-d65.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n/**\n *\n * @param {ColorTypes} color\n * @returns {number}\n */\nexport function getLuminance (color) {\n\t// Assume getColor() is called on color in get()\n\treturn get(color, [xyz_d65, \"y\"]);\n}\n\n/**\n * @param {ColorTypes} color\n * @param {number | ((coord: number) => number)} value\n */\nexport function setLuminance (color, value) {\n\t// Assume getColor() is called on color in set()\n\tset(color, [xyz_d65, \"y\"], value);\n}\n\n/**\n * @param {typeof import(\"./color.js\").default} Color\n */\nexport function register (Color) {\n\tObject.defineProperty(Color.prototype, \"luminance\", {\n\t\tget () {\n\t\t\treturn getLuminance(this);\n\t\t},\n\t\tset (value) {\n\t\t\tsetLuminance(this, value);\n\t\t},\n\t});\n}\n","// APCA 0.0.98G\n// https://github.com/Myndex/apca-w3\n// see also https://github.com/w3c/silver/issues/643\n\nimport getColor from \"../getColor.js\";\nimport to from \"../to.js\";\nimport { isNone } from \"../util.js\";\n\n// exponents\nconst normBG = 0.56;\nconst normTXT = 0.57;\nconst revTXT = 0.62;\nconst revBG = 0.65;\n\n// clamps\nconst blkThrs = 0.022;\nconst blkClmp = 1.414;\nconst loClip = 0.1;\nconst deltaYmin = 0.0005;\n\n// scalers\n// see https://github.com/w3c/silver/issues/645\nconst scaleBoW = 1.14;\nconst loBoWoffset = 0.027;\nconst scaleWoB = 1.14;\nconst loWoBoffset = 0.027;\n\nfunction fclamp (Y) {\n\tif (Y >= blkThrs) {\n\t\treturn Y;\n\t}\n\treturn Y + (blkThrs - Y) ** blkClmp;\n}\n\nfunction linearize (val) {\n\tlet sign = val < 0 ? -1 : 1;\n\tlet abs = Math.abs(val);\n\treturn sign * Math.pow(abs, 2.4);\n}\n\n/**\n * Not symmetric, requires a foreground (text) color, and a background color\n * @param {import(\"../types.js\").ColorTypes} background\n * @param {import(\"../types.js\").ColorTypes} foreground\n * @returns {number}\n */\nexport default function contrastAPCA (background, foreground) {\n\tforeground = getColor(foreground);\n\tbackground = getColor(background);\n\n\tlet S;\n\tlet C;\n\tlet Sapc;\n\n\t// Myndex as-published, assumes sRGB inputs\n\tlet R, G, B;\n\n\tforeground = to(foreground, \"srgb\");\n\t// Should these be clamped to in-gamut values?\n\n\t// Calculates \"screen luminance\" with non-standard simple gamma EOTF\n\t// weights should be from CSS Color 4, not the ones here which are via Myndex and copied from Lindbloom\n\t[R, G, B] = foreground.coords.map(c => {\n\t\treturn isNone(c) ? 0 : c;\n\t});\n\tlet lumTxt = linearize(R) * 0.2126729 + linearize(G) * 0.7151522 + linearize(B) * 0.072175;\n\n\tbackground = to(background, \"srgb\");\n\t[R, G, B] = background.coords.map(c => {\n\t\treturn isNone(c) ? 0 : c;\n\t});\n\tlet lumBg = linearize(R) * 0.2126729 + linearize(G) * 0.7151522 + linearize(B) * 0.072175;\n\n\t// toe clamping of very dark values to account for flare\n\tlet Ytxt = fclamp(lumTxt);\n\tlet Ybg = fclamp(lumBg);\n\n\t// are we \"Black on White\" (dark on light), or light on dark?\n\tlet BoW = Ybg > Ytxt;\n\n\t// why is this a delta, when Y is not perceptually uniform?\n\t// Answer: it is a noise gate, see\n\t// https://github.com/LeaVerou/color.js/issues/208\n\tif (Math.abs(Ybg - Ytxt) < deltaYmin) {\n\t\tC = 0;\n\t}\n\telse {\n\t\tif (BoW) {\n\t\t\t// dark text on light background\n\t\t\tS = Ybg ** normBG - Ytxt ** normTXT;\n\t\t\tC = S * scaleBoW;\n\t\t}\n\t\telse {\n\t\t\t// light text on dark background\n\t\t\tS = Ybg ** revBG - Ytxt ** revTXT;\n\t\t\tC = S * scaleWoB;\n\t\t}\n\t}\n\tif (Math.abs(C) < loClip) {\n\t\tSapc = 0;\n\t}\n\telse if (C > 0) {\n\t\t// not clear whether Woffset is loBoWoffset or loWoBoffset\n\t\t// but they have the same value\n\t\tSapc = C - loBoWoffset;\n\t}\n\telse {\n\t\tSapc = C + loBoWoffset;\n\t}\n\n\treturn Sapc * 100;\n}\n","// CIE Lightness difference, as used by Google Material Design\n// Google HCT Tone is the same as CIE Lightness\n// https://material.io/blog/science-of-color-design\n\nimport getColor from \"../getColor.js\";\nimport get from \"../get.js\";\nimport lab from \"../spaces/lab.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastLstar (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet L1 = get(color1, [lab, \"l\"]);\n\tlet L2 = get(color2, [lab, \"l\"]);\n\n\treturn Math.abs(L1 - L2);\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { WHITES } from \"../adapt.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\n\n// κ * ε  = 2^3 = 8\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst ε3 = 24 / 116;\nconst κ = 24389 / 27; // 29^3/3^3\n\nlet white = WHITES.D65;\n\nexport default new ColorSpace({\n\tid: \"lab-d65\",\n\tname: \"Lab D65\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t},\n\n\t// Assuming XYZ is relative to D65, convert to CIE Lab\n\t// from CIE standard, which now defines these as a rational fraction\n\twhite,\n\n\tbase: xyz_d65,\n\t// Convert D65-adapted XYZ to Lab\n\t//  CIE 15.3:2004 section 8.2.1.1\n\tfromBase (XYZ) {\n\t\t// compute xyz, which is XYZ scaled relative to reference white\n\t\tlet xyz = XYZ.map((value, i) => value / white[i]);\n\n\t\t// now compute f\n\t\tlet f = xyz.map(value => (value > ε ? Math.cbrt(value) : (κ * value + 16) / 116));\n\n\t\treturn [\n\t\t\t116 * f[1] - 16, // L\n\t\t\t500 * (f[0] - f[1]), // a\n\t\t\t200 * (f[1] - f[2]), // b\n\t\t];\n\t},\n\t// Convert Lab to D65-adapted XYZ\n\t// Same result as CIE 15.3:2004 Appendix D although the derivation is different\n\t// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n\ttoBase (Lab) {\n\t\t// compute f, starting with the luminance-related term\n\t\tlet f = [];\n\t\tf[1] = (Lab[0] + 16) / 116;\n\t\tf[0] = Lab[1] / 500 + f[1];\n\t\tf[2] = f[1] - Lab[2] / 200;\n\n\t\t// compute xyz\n\t\tlet xyz = [\n\t\t\tf[0] > ε3 ? Math.pow(f[0], 3) : (116 * f[0] - 16) / κ,\n\t\t\tLab[0] > 8 ? Math.pow((Lab[0] + 16) / 116, 3) : Lab[0] / κ,\n\t\t\tf[2] > ε3 ? Math.pow(f[2], 3) : (116 * f[2] - 16) / κ,\n\t\t];\n\n\t\t// Compute XYZ by scaling xyz by reference white\n\t\treturn xyz.map((value, i) => value * white[i]);\n\t},\n\n\tformats: {\n\t\t\"lab-d65\": {\n\t\t\tcoords: [\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","// Delta Phi Star perceptual lightness contrast\n// See https://github.com/Myndex/deltaphistar\n// The (difference between two Lstars each raised to phi) raised to (1/phi)\n// Symmetric, does not matter which is foreground and which is background\n\nimport getColor from \"../getColor.js\";\nimport get from \"../get.js\";\nimport lab_d65 from \"../spaces/lab-d65.js\";\n\nconst phi = Math.pow(5, 0.5) * 0.5 + 0.5; // Math.phi can be used if Math.js\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastDeltaPhi (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Lstr1 = get(color1, [lab_d65, \"l\"]);\n\tlet Lstr2 = get(color2, [lab_d65, \"l\"]);\n\n\tlet deltaPhiStar = Math.abs(Math.pow(Lstr1, phi) - Math.pow(Lstr2, phi));\n\n\tlet contrast = Math.pow(deltaPhiStar, 1 / phi) * Math.SQRT2 - 40;\n\n\treturn contrast < 7.5 ? 0.0 : contrast;\n}\n","// Michelson  luminance contrast\n// the relation between the spread and the sum of the two luminances\n// Symmetric, does not matter which is foreground and which is background\n// No black level compensation for flare.\n\nimport getColor from \"../getColor.js\";\nimport { getLuminance } from \"../luminance.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastMichelson (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\tlet denom = Y1 + Y2;\n\treturn denom === 0 ? 0 : (Y1 - Y2) / denom;\n}\n","// WCAG 2.0 contrast https://www.w3.org/TR/WCAG20-TECHS/G18.html\n// Simple contrast, with fixed 5% viewing flare contribution\n// Symmetric, does not matter which is foreground and which is background\n\nimport getColor from \"../getColor.js\";\nimport { getLuminance } from \"../luminance.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastWCAG21 (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\treturn (Y1 + 0.05) / (Y2 + 0.05);\n}\n","// Weber luminance contrast\n// The difference between the two luminances divided by the lower luminance\n// Symmetric, does not matter which is foreground and which is background\n// No black level compensation for flare.\n\nimport getColor from \"../getColor.js\";\nimport { getLuminance } from \"../luminance.js\";\n\n// the darkest sRGB color above black is #000001 and this produces\n// a plain Weber contrast of ~45647.\n// So, setting the divide-by-zero result at 50000 is a reasonable\n// max clamp for the plain Weber\nconst max = 50000;\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastWeber (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\treturn Y2 === 0 ? max : (Y1 - Y2) / Y2;\n}\n","import getColor from \"./getColor.js\";\n// import defaults from \"./defaults.js\";\nimport { isString } from \"./util.js\";\nimport * as contrastAlgorithms from \"./contrast/index.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").Algorithms} Algorithms */\n\n/**\n *\n * @param {ColorTypes} background\n * @param {ColorTypes} foreground\n * @param {Algorithms | ({ algorithm: Algorithms } & Record<string, any>)} o\n * Algorithm to use as well as any other options to pass to the contrast function\n * @returns {number}\n * @throws {TypeError} Unknown or unspecified algorithm\n */\nexport default function contrast (background, foreground, o) {\n\tif (isString(o)) {\n\t\to = { algorithm: o };\n\t}\n\n\tlet { algorithm, ...rest } = o || {};\n\n\tif (!algorithm) {\n\t\tlet algorithms = Object.keys(contrastAlgorithms)\n\t\t\t.map(a => a.replace(/^contrast/, \"\"))\n\t\t\t.join(\", \");\n\t\tthrow new TypeError(\n\t\t\t`contrast() function needs a contrast algorithm. Please specify one of: ${algorithms}`,\n\t\t);\n\t}\n\n\tbackground = getColor(background);\n\tforeground = getColor(foreground);\n\n\tfor (let a in contrastAlgorithms) {\n\t\tif (\"contrast\" + algorithm.toLowerCase() === a.toLowerCase()) {\n\t\t\treturn contrastAlgorithms[a](background, foreground, rest);\n\t\t}\n\t}\n\n\tthrow new TypeError(`Unknown contrast algorithm: ${algorithm}`);\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport sRGB from \"./srgb.js\";\n\nexport default new ColorSpace({\n\tid: \"hsl\",\n\tname: \"HSL\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: sRGB,\n\n\t// Adapted from https://drafts.csswg.org/css-color-4/better-rgbToHsl.js\n\tfromBase: rgb => {\n\t\tlet max = Math.max(...rgb);\n\t\tlet min = Math.min(...rgb);\n\t\tlet [r, g, b] = rgb;\n\t\tlet [h, s, l] = [null, 0, (min + max) / 2];\n\t\tlet d = max - min;\n\n\t\tif (d !== 0) {\n\t\t\ts = l === 0 || l === 1 ? 0 : (max - l) / Math.min(l, 1 - l);\n\n\t\t\tswitch (max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t}\n\n\t\t\th = h * 60;\n\t\t}\n\n\t\t// Very out of gamut colors can produce negative saturation\n\t\t// If so, just rotate the hue by 180 and use a positive saturation\n\t\t// see https://github.com/w3c/csswg-drafts/issues/9222\n\t\tif (s < 0) {\n\t\t\th += 180;\n\t\t\ts = Math.abs(s);\n\t\t}\n\n\t\tif (h >= 360) {\n\t\t\th -= 360;\n\t\t}\n\n\t\treturn [h, s * 100, l * 100];\n\t},\n\n\t// Adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSL_to_RGB_alternative\n\ttoBase: hsl => {\n\t\tlet [h, s, l] = hsl;\n\t\th = h % 360;\n\n\t\tif (h < 0) {\n\t\t\th += 360;\n\t\t}\n\n\t\ts /= 100;\n\t\tl /= 100;\n\n\t\tfunction f (n) {\n\t\t\tlet k = (n + h / 30) % 12;\n\t\t\tlet a = s * Math.min(l, 1 - l);\n\t\t\treturn l - a * Math.max(-1, Math.min(k - 3, 9 - k, 1));\n\t\t}\n\n\t\treturn [f(0), f(8), f(4)];\n\t},\n\n\tformats: {\n\t\thsl: {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t\thsla: {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t\tcommas: true,\n\t\t\talpha: true,\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport sRGB from \"./srgb.js\";\n\n// Note that, like HSL, calculations are done directly on\n// gamma-corrected sRGB values rather than linearising them first.\n\nexport default new ColorSpace({\n\tid: \"hsv\",\n\tname: \"HSV\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tv: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Value\",\n\t\t},\n\t},\n\n\tbase: sRGB,\n\t// https://en.wikipedia.org/wiki/HSL_and_HSV#Formal_derivation\n\tfromBase (rgb) {\n\t\tlet max = Math.max(...rgb);\n\t\tlet min = Math.min(...rgb);\n\t\tlet [r, g, b] = rgb;\n\t\tlet [h, s, v] = [null, 0, max];\n\t\tlet d = max - min;\n\n\t\tif (d !== 0) {\n\t\t\tswitch (max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t}\n\n\t\t\th = h * 60;\n\t\t}\n\n\t\tif (v) {\n\t\t\ts = d / v;\n\t\t}\n\n\t\tif (h >= 360) {\n\t\t\th -= 360;\n\t\t}\n\n\t\treturn [h, s * 100, v * 100];\n\t},\n\t// Adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSV_to_RGB_alternative\n\ttoBase (hsv) {\n\t\tlet [h, s, v] = hsv;\n\t\th = h % 360;\n\n\t\tif (h < 0) {\n\t\t\th += 360;\n\t\t}\n\n\t\ts /= 100;\n\t\tv /= 100;\n\n\t\tfunction f (n) {\n\t\t\tlet k = (n + h / 60) % 6;\n\t\t\treturn v - v * s * Math.max(0, Math.min(k, 4 - k, 1));\n\t\t}\n\n\t\treturn [f(5), f(3), f(1)];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hsv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport HSV from \"./hsv.js\";\n\n// The Hue, Whiteness Blackness (HWB) colorspace\n// See https://drafts.csswg.org/css-color-4/#the-hwb-notation\n// Note that, like HSL, calculations are done directly on\n// gamma-corrected sRGB values rather than linearising them first.\n\nexport default new ColorSpace({\n\tid: \"hwb\",\n\tname: \"HWB\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\tw: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Whiteness\",\n\t\t},\n\t\tb: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Blackness\",\n\t\t},\n\t},\n\n\tbase: HSV,\n\tfromBase (hsv) {\n\t\tlet [h, s, v] = hsv;\n\n\t\treturn [h, (v * (100 - s)) / 100, 100 - v];\n\t},\n\ttoBase (hwb) {\n\t\tlet [h, w, b] = hwb;\n\n\t\t// Now convert percentages to [0..1]\n\t\tw /= 100;\n\t\tb /= 100;\n\n\t\t// Achromatic check (white plus black >= 1)\n\t\tlet sum = w + b;\n\t\tif (sum >= 1) {\n\t\t\tlet gray = w / sum;\n\t\t\treturn [h, 0, gray * 100];\n\t\t}\n\n\t\tlet v = 1 - b;\n\t\tlet s = v === 0 ? 0 : 1 - w / v;\n\t\treturn [h, s * 100, v * 100];\n\t},\n\n\tformats: {\n\t\thwb: {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// convert an array of linear-light a98-rgb values to CIE XYZ\n// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n// has greater numerical precision than section 4.3.5.3 of\n// https://www.adobe.com/digitalimag/pdfs/AdobeRGB1998.pdf\n// but the values below were calculated from first principles\n// from the chromaticity coordinates of R G B W\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.5766690429101305,   0.1855582379065463,   0.1882286462349947  ],\n\t[ 0.29734497525053605,  0.6273635662554661,   0.07529145849399788 ],\n\t[ 0.02703136138641234,  0.07068885253582723,  0.9913375368376388  ],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[  2.0415879038107465,    -0.5650069742788596,   -0.34473135077832956 ],\n\t[ -0.9692436362808795,     1.8759675015077202,    0.04155505740717557 ],\n\t[  0.013444280632031142,  -0.11836239223101838,   1.0151749943912054  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"a98rgb-linear\",\n\tcssId: \"--a98-rgb-linear\",\n\tname: \"Linear Adobe® 98 RGB compatible\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport A98Linear from \"./a98rgb-linear.js\";\n\nexport default new RGBColorSpace({\n\tid: \"a98rgb\",\n\tcssId: \"a98-rgb\",\n\tname: \"Adobe® 98 RGB compatible\",\n\tbase: A98Linear,\n\ttoBase: RGB => RGB.map(val => Math.pow(Math.abs(val), 563 / 256) * Math.sign(val)),\n\tfromBase: RGB => RGB.map(val => Math.pow(Math.abs(val), 256 / 563) * Math.sign(val)),\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport XYZ_D50 from \"./xyz-d50.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// convert an array of  prophoto-rgb values to CIE XYZ\n// using  D50 (so no chromatic adaptation needed afterwards)\n// matrix cannot be expressed in rational form, but is calculated to 64 bit accuracy\n// see https://github.com/w3c/csswg-drafts/issues/7675\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.79776664490064230,  0.13518129740053308,  0.03134773412839220 ],\n\t[ 0.28807482881940130,  0.71183523424187300,  0.00008993693872564 ],\n\t[ 0.00000000000000000,  0.00000000000000000,  0.82510460251046020 ],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[  1.34578688164715830, -0.25557208737979464, -0.05110186497554526 ],\n\t[ -0.54463070512490190,  1.50824774284514680,  0.02052744743642139 ],\n\t[  0.00000000000000000,  0.00000000000000000,  1.21196754563894520 ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"prophoto-linear\",\n\tcssId: \"--prophoto-rgb-linear\",\n\tname: \"Linear ProPhoto\",\n\twhite: \"D50\",\n\tbase: XYZ_D50,\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport ProPhotoLinear from \"./prophoto-linear.js\";\n\nconst Et = 1 / 512;\nconst Et2 = 16 / 512;\n\nexport default new RGBColorSpace({\n\tid: \"prophoto\",\n\tcssId: \"prophoto-rgb\",\n\tname: \"ProPhoto\",\n\tbase: ProPhotoLinear,\n\ttoBase (RGB) {\n\t\t// Transfer curve is gamma 1.8 with a small linear portion\n\t\treturn RGB.map(v => {\n\t\t\tlet sign = v < 0 ? -1 : 1;\n\t\t\tlet abs = v * sign;\n\n\t\t\tif (abs < Et2) {\n\t\t\t\treturn v / 16;\n\t\t\t}\n\n\t\t\treturn sign * abs ** 1.8;\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(v => {\n\t\t\tlet sign = v < 0 ? -1 : 1;\n\t\t\tlet abs = v * sign;\n\n\t\t\tif (abs >= Et) {\n\t\t\t\treturn sign * abs ** (1 / 1.8);\n\t\t\t}\n\n\t\t\treturn 16 * v;\n\t\t});\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport OKLab from \"./oklab.js\";\nimport lch from \"./lch.js\";\n\nexport default new ColorSpace({\n\tid: \"oklch\",\n\tname: \"OkLCh\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 0.4],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\twhite: \"D65\",\n\n\tbase: OKLab,\n\tfromBase: lch.fromBase,\n\ttoBase: lch.toBase,\n\n\tformats: {\n\t\toklch: {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import * as colorjs from \"colorjs.io/fn\";\nimport { type ColorConstructor, parse, contrast, contrastLstar, to, inGamut } from 'colorjs.io/fn'\n\nexport type Theme = 'auto' | 'light' | 'dark'\nexport type StandardSpace = 'srgb' | 'hex' | 'hsl' | 'hwb' | 'lab' | 'lch' | 'oklab' | 'oklch'\nexport type WideRGB = 'srgb-linear' | 'display-p3' | 'rec2020' | 'a98-rgb' | 'prophoto' | 'xyz' | 'xyz-d50' | 'xyz-d65'\nexport type ColorSpace = StandardSpace | WideRGB\n\n\ncolorjs.ColorSpace.register(colorjs.sRGB);\ncolorjs.ColorSpace.register(colorjs.sRGB_Linear);\ncolorjs.ColorSpace.register(colorjs.HSL);\ncolorjs.ColorSpace.register(colorjs.HWB);\ncolorjs.ColorSpace.register(colorjs.Lab);\ncolorjs.ColorSpace.register(colorjs.LCH);\ncolorjs.ColorSpace.register(colorjs.OKLab);\ncolorjs.ColorSpace.register(colorjs.OKLCH);\ncolorjs.ColorSpace.register(colorjs.P3);\ncolorjs.ColorSpace.register(colorjs.A98RGB);\ncolorjs.ColorSpace.register(colorjs.ProPhoto);\ncolorjs.ColorSpace.register(colorjs.REC_2020);\ncolorjs.ColorSpace.register(colorjs.XYZ_D65);\ncolorjs.ColorSpace.register(colorjs.XYZ_D50);\n\n\nexport function parseCoords(x: number, min = 0, max = 100) {\n  return Math.max(min, Math.min(max, x))\n}\n\nexport function contrastColor(c: string): 'white' | 'black' {\n  try {\n    const color = parse(c)\n    let wh: number\n    let bl: number\n    try {\n      wh = contrast(color, 'white', 'WCAG21') ?? contrastLstar(color, 'white')\n      bl = contrast(color, 'black', 'WCAG21') ?? contrastLstar(color, 'black')\n    } catch {\n      wh = contrastLstar(color, 'white')\n      bl = contrastLstar(color, 'black')\n    }\n    return wh > bl ? 'white' : 'black'\n  } catch {\n    return 'black'\n  }\n}\n\nexport type Gamut = 'srgb' | 'p3' | 'rec2020' | 'xyz'\nexport function detectGamut(colorStr: string): Gamut {\n  let gamut: Gamut = 'srgb'\n  if (!colorStr || colorStr.startsWith('#')) return gamut\n  try {\n    const c = parse(colorStr)\n    const srgb: ColorConstructor = { spaceId: 'srgb', coords: to(c, 'srgb').coords, alpha: null }\n    const p3: ColorConstructor = { spaceId: 'p3', coords: to(c, 'p3').coords, alpha: null }\n    const rec2020: ColorConstructor = { spaceId: 'rec2020', coords: to(c, 'rec2020').coords, alpha: null }\n    const xyz: ColorConstructor = { spaceId: 'xyz', coords: to(c, 'xyz').coords, alpha: null }\n    if (inGamut(xyz)) gamut = 'xyz'\n    if (inGamut(rec2020)) gamut = 'rec2020'\n    if (inGamut(p3)) gamut = 'p3'\n    if (inGamut(srgb)) gamut = 'srgb'\n  } catch { }\n  return gamut\n}\n\nexport function getColorJSSpaceID(space: ColorSpace | string) {\n  if (space === 'display-p3') return 'p3'\n  if (space === 'a98-rgb') return 'a98rgb'\n  return space\n}\n\nexport function reverseColorJSSpaceID(space: string): ColorSpace | string {\n  if (space === 'p3') return 'display-p3'\n  if (space === 'a98rgb') return 'a98-rgb'\n  return space\n}\n\nexport function alphaToString(alpha: string | number) {\n  return alpha === '100' || alpha === 100 ? '' : ` / ${alpha}%`\n}\n\nexport function isRGBLike(space: string) {\n  return [\n    'srgb-linear',\n    'display-p3',\n    'rec2020',\n    'a98-rgb',\n    'prophoto',\n    'xyz',\n    'xyz-d50',\n    'xyz-d65'\n  ].includes(space)\n}\n\nexport function rgbColor(space: string, r: string | number, g: string | number, b: string | number, a: string | number) {\n  const s = space === 'prophoto' ? 'prophoto-rgb' : space\n  return `color(${s} ${r}% ${g}% ${b}%${alphaToString(a)})`\n}\n","import type { ColorSpace } from '../color'\n\n/**\n * Round number to fixed decimals and remove trailing zeros from the string representation.\n * @example toFixed(1.5, 2) → \"1.5\"\n * @example toFixed(2.00, 2) → \"2\"\n */\nexport function toFixed(n: null | number, digits = 0): string {\n  if (n == null) {\n    return '0'\n  }\n  return Number(n.toFixed(digits)).toString()\n}\n\n/**\n * Strip trailing zeros from decimal strings.\n * @example trimZeros(\"1.500\") → \"1.5\"\n * @example trimZeros(\"2.00\") → \"2\"\n */\nexport function trimZeros(s: string): string {\n  return s.replace(/\\.0+($|\\D)/, '$1').replace(/(\\.\\d*?)0+($|\\D)/, '$1$2')\n}\n\n/**\n * Format a channel value to appropriate precision for the given color space and channel name.\n * Handles different precision requirements across color spaces:\n * - OKLab: L (0 decimals), A/B (2 decimals)\n * - OKLCH: L/C/H (0 decimals)\n * - Lab: L/A/B (0 decimals)\n * - LCH: L/C/H (0 decimals)\n * - HSL/HWB: All channels (0 decimals)\n * - RGB-like: R/G/B (0 decimals)\n * - Alpha: (0 decimals)\n * - Default: 2 decimals\n */\nexport function formatChannel(space: ColorSpace, key: string, val: number): string {\n  const round = (n: number, d = 0) => Number(n.toFixed(d))\n\n  if (space === 'oklab') {\n    if (key === 'L') return String(round(val, 0))\n    if (key === 'A' || key === 'B') return String(round(val, 2))\n  } else if (space === 'oklch') {\n    if (key === 'L') return String(round(val, 0))\n    if (key === 'C') return String(round(val, 0)) // 0-100 percentage\n    if (key === 'H') return String(round(val, 0))\n  } else if (space === 'lab') {\n    if (key === 'L') return String(round(val, 0))\n    if (key === 'A' || key === 'B') return String(round(val, 0))\n  } else if (space === 'lch') {\n    if (key === 'L' || key === 'C' || key === 'H') return String(round(val, 0)) // C is 0-100 scale\n  } else if (space === 'hsl' || space === 'hwb') {\n    if (key === 'H') return String(round(val, 0))\n    if (key === 'S' || key === 'L' || key === 'W' || key === 'B') return String(round(val, 0))\n  } else if (space === 'srgb' || space === 'hex') {\n    if (key === 'R' || key === 'G' || key === 'B') return String(round(val, 0))\n  } else {\n    // Handle RGB-like spaces (display-p3, rec2020, etc.)\n    const rgbLike = [\n      'srgb-linear',\n      'display-p3',\n      'rec2020',\n      'a98-rgb',\n      'prophoto',\n      'xyz',\n      'xyz-d50',\n      'xyz-d65'\n    ]\n    if (rgbLike.includes(space) && (key === 'R' || key === 'G' || key === 'B')) {\n      return String(round(val, 0))\n    }\n  }\n\n  if (key === 'ALP') return String(round(val, 0))\n  return String(round(val, 2))\n}\n","import { getColor, parse, to, toGamut } from 'colorjs.io/fn'\nimport type { ColorSpace } from '../color'\nimport {\n  alphaToString,\n  getColorJSSpaceID,\n  isRGBLike,\n  rgbColor,\n  reverseColorJSSpaceID\n} from '../color'\nimport { toFixed } from './channel-formatting'\n\nexport type ChannelRecord = Record<string, string | number>\n\n/**\n * Generate a CSS color string from channel values and color space identifier.\n * Handles percentage/angle notation and alpha transparency per CSS Color spec.\n *\n * @param space - The color space (e.g., 'oklch', 'hsl', 'srgb')\n * @param ch - Channel values as a record (e.g., { L: '50', C: '75', H: '180', ALP: '100' })\n * @returns CSS color string (e.g., 'oklch(50% 75% 180)')\n *\n * @example\n * gencolor('oklch', { L: '50', C: '75', H: '180', ALP: '100' })\n * // → 'oklch(50% 75% 180)'\n *\n * @example\n * gencolor('hsl', { H: '120', S: '100', L: '50', ALP: '50' })\n * // → 'hsl(120 100% 50% / 50%)'\n */\nexport function gencolor(space: ColorSpace, ch: ChannelRecord): string {\n  const L = (ch.L ?? 50) as any\n  const A = (ch.A ?? 0) as any\n  const B = (ch.B ?? 0) as any\n  const C = (ch.C ?? 0) as any\n  const H = (ch.H ?? 0) as any\n  const S = (ch.S ?? 0) as any\n  const W = (ch.W ?? 0) as any\n  const R = (ch.R ?? 0) as any\n  const G = (ch.G ?? 0) as any\n  const ALP = (ch.ALP ?? 100) as any\n\n  switch (space) {\n    case 'oklab': return `oklab(${L}% ${A} ${B}${alphaToString(ALP)})`\n    case 'oklch': return `oklch(${L}% ${C}% ${H}${alphaToString(ALP)})` // Chroma as percentage\n    case 'lab': return `lab(${L}% ${A} ${B}${alphaToString(ALP)})`\n    case 'lch': return `lch(${L}% ${C}% ${H}${alphaToString(ALP)})` // Chroma as percentage\n    case 'hsl': return `hsl(${H} ${S}% ${L}%${alphaToString(ALP)})`\n    case 'hwb': return `hwb(${H} ${W}% ${B}%${alphaToString(ALP)})`\n    case 'srgb': return `rgb(${R}% ${G}% ${B}%${alphaToString(ALP)})`\n    case 'hex': {\n      // Convert percentage to 0-255 range\n      const r = Math.round(Number(R) * 2.55)\n      const g = Math.round(Number(G) * 2.55)\n      const b = Math.round(Number(B) * 2.55)\n      const a = Number(ALP)\n      // Format as hex\n      const rh = r.toString(16).padStart(2, '0')\n      const gh = g.toString(16).padStart(2, '0')\n      const bh = b.toString(16).padStart(2, '0')\n\n      // Check if we can use shortened hex format (3 or 4 digits)\n      const canShorten = rh[0] === rh[1] && gh[0] === gh[1] && bh[0] === bh[1]\n\n      if (a < 100) {\n        const alpha = Math.round((a / 100) * 255)\n        const ah = alpha.toString(16).padStart(2, '0')\n\n        if (canShorten && ah[0] === ah[1]) {\n          // Use 4-digit hex format (#rgba)\n          return `#${rh[0]}${gh[0]}${bh[0]}${ah[0]}`\n        }\n        return `#${rh}${gh}${bh}${ah}`\n      }\n\n      if (canShorten) {\n        // Use 3-digit hex format (#rgb)\n        return `#${rh[0]}${gh[0]}${bh[0]}`\n      }\n      return `#${rh}${gh}${bh}`\n    }\n    default:\n      if (isRGBLike(space)) return rgbColor(space, R, G, B, ALP)\n      return 'oklch(75% 75% 180)' // fallback\n  }\n}\n\n/**\n * Parse a CSS color string into its component channels for a target color space.\n * Converts between spaces if necessary, normalizes channel ranges, and handles missing hue.\n *\n * @param space - Target color space to parse into\n * @param colorStr - CSS color string to parse\n * @returns Object containing the parsed space and channel values\n *\n * @example\n * parseIntoChannels('oklch', 'red')\n * // → { space: 'oklch', ch: { L: '62', C: '57', H: '29', ALP: '100' } }\n *\n * @example\n * parseIntoChannels('hsl', '#ff0000')\n * // → { space: 'hsl', ch: { H: '0', S: '100', L: '50', ALP: '100' } }\n */\nexport function parseIntoChannels(space: ColorSpace, colorStr: string): { space: ColorSpace; ch: ChannelRecord } {\n  // getColor() converts input to compatible type with to() result\n  let c = getColor(parse(colorStr))\n  // Hex is internally sRGB\n  const actualSpace = space === 'hex' ? 'srgb' : space\n  // Convert to target space if different\n  const targetId = getColorJSSpaceID(actualSpace)\n  if (c.space.id !== targetId) {\n    c = to(c, targetId)\n  }\n  const id = reverseColorJSSpaceID(c.space.id)\n  const s = (id === 'rgb' ? 'srgb' : id) as ColorSpace\n\n  const ch: ChannelRecord = {}\n\n  // fallback to non-transparent\n  const alpha = c.alpha ?? 1\n  if (s === 'oklab') {\n    const [l, a, b] = c.coords\n    ch.L = toFixed((l ?? 0) * 100)\n    ch.A = toFixed(a, 2)\n    ch.B = toFixed(b, 2)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'oklch') {\n    const [l, cc, h] = c.coords\n    ch.L = toFixed((l ?? 0) * 100)\n    ch.C = toFixed(Math.min(100, (cc ?? 0) * 100), 0) // Convert to 0-100%, clamp at 100%\n    ch.H = toFixed(h)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'lab') {\n    const [l, a, b] = c.coords\n    ch.L = toFixed(l)\n    ch.A = toFixed(a)\n    ch.B = toFixed(b)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'lch') {\n    const [l, cc, h] = c.coords\n    ch.L = toFixed(l)\n    ch.C = toFixed(Math.min(100, (cc ?? 0) / 1.5), 0) // Normalize 0-150 to 0-100%, clamp at 100%\n    ch.H = toFixed(h)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'hsl') {\n    const h = c.coords[0]\n    const s2 = c.coords[1] ?? 0\n    const l = c.coords[2] ?? 0\n    ch.H = toFixed(h)\n    // colorjs.io returns 0-1 when parsing HSL strings, but 0-100 when converting from other spaces\n    ch.S = toFixed(s2 > 1 ? s2 : s2 * 100)\n    ch.L = toFixed(l > 1 ? l : l * 100)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'hwb') {\n    const h = c.coords[0]\n    const w = c.coords[1] ?? 0\n    const b = c.coords[2] ?? 0\n    ch.H = toFixed(h)\n    // colorjs.io returns 0-1 when parsing HWB strings, but 0-100 when converting from other spaces\n    ch.W = toFixed(w > 1 ? w : w * 100)\n    ch.B = toFixed(b > 1 ? b : b * 100)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'srgb' || s === 'hex') {\n    const [r, g, b] = toGamut(c, { space: 'srgb', method: 'clip' }).coords\n    ch.R = toFixed((r ?? 0) * 100)\n    ch.G = toFixed((g ?? 0) * 100)\n    ch.B = toFixed((b ?? 0) * 100)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (isRGBLike(s)) {\n    const [r, g, b] = c.coords\n    ch.R = toFixed((r ?? 0) * 100)\n    ch.G = toFixed((g ?? 0) * 100)\n    ch.B = toFixed((b ?? 0) * 100)\n    ch.ALP = toFixed(alpha * 100)\n  }\n\n  return { space: s, ch }\n}\n","/**\n * Positioning system: Intelligent popover placement\n *\n * Computes optimal popover position relative to an anchor, respecting viewport\n * bounds, safe areas, and scroll containers. Tries multiple placements and picks\n * the one that maximizes visible area while maintaining placement stability.\n */\n\nexport const VIEWPORT_MARGIN = 8\nexport const GUTTER = 8\n\nexport type Placement =\n  | 'bottom-center' | 'top-center'\n  | 'right-start' | 'left-start'\n  | 'bottom-left' | 'bottom-right'\n  | 'top-left' | 'top-right'\n\nexport interface Rect {\n  left: number\n  top: number\n  right: number\n  bottom: number\n  width: number\n  height: number\n}\n\nexport interface Size {\n  width: number\n  height: number\n}\n\nexport interface Candidate {\n  placement: Placement\n  left: number\n  top: number\n  right: number\n  bottom: number\n}\n\nlet cachedInsets: { top: number; right: number; bottom: number; left: number } | null = null\n\n/**\n * Detect CSS safe area insets (for notched/rounded displays) via a probe element.\n * Caches result after first call.\n */\nexport function getSafeAreaInsets(): { top: number; right: number; bottom: number; left: number } {\n  if (cachedInsets) return cachedInsets\n\n  const probe = document.createElement('div')\n  probe.style.position = 'fixed'\n  probe.style.left = '-9999px'\n  probe.style.top = '0'\n  probe.style.paddingTop = 'env(safe-area-inset-top)'\n  probe.style.paddingRight = 'env(safe-area-inset-right)'\n  probe.style.paddingBottom = 'env(safe-area-inset-bottom)'\n  probe.style.paddingLeft = 'env(safe-area-inset-left)'\n  document.documentElement.appendChild(probe)\n\n  const computed = getComputedStyle(probe)\n  const top = parseFloat(computed.paddingTop) || 0\n  const right = parseFloat(computed.paddingRight) || 0\n  const bottom = parseFloat(computed.paddingBottom) || 0\n  const left = parseFloat(computed.paddingLeft) || 0\n\n  document.documentElement.removeChild(probe)\n  cachedInsets = { top, right, bottom, left }\n  return cachedInsets\n}\n\n/**\n * Calculate the usable viewport rectangle after accounting for safe areas and margin.\n */\nexport function getViewportClampRect(insets: { top: number; right: number; bottom: number; left: number }): Rect {\n  const vw = window.visualViewport?.width ?? window.innerWidth\n  const vh = window.visualViewport?.height ?? window.innerHeight\n  const scrollX = window.pageXOffset || document.documentElement.scrollLeft\n  const scrollY = window.pageYOffset || document.documentElement.scrollTop\n\n  const left = insets.left + VIEWPORT_MARGIN + scrollX\n  const top = insets.top + VIEWPORT_MARGIN + scrollY\n  const right = vw - insets.right - VIEWPORT_MARGIN + scrollX\n  const bottom = vh - insets.bottom - VIEWPORT_MARGIN + scrollY\n\n  return {\n    left,\n    top,\n    right,\n    bottom,\n    width: right - left,\n    height: bottom - top,\n  }\n}\n\n/**\n * Generate all possible placement candidates (bottom-center, top-center, etc.) for a popover of given size.\n */\nexport function computeCandidates(anchor: Rect, size: Size): Candidate[] {\n  const { width: w, height: h } = size\n  const placements: Candidate[] = [\n    {\n      placement: 'bottom-center',\n      left: anchor.left + anchor.width / 2 - w / 2,\n      top: anchor.bottom + GUTTER,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'top-center',\n      left: anchor.left + anchor.width / 2 - w / 2,\n      top: anchor.top - GUTTER - h,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'right-start',\n      left: anchor.right + GUTTER,\n      top: anchor.top,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'left-start',\n      left: anchor.left - GUTTER - w,\n      top: anchor.top,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'bottom-left',\n      left: anchor.left,\n      top: anchor.bottom + GUTTER,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'bottom-right',\n      left: anchor.right - w,\n      top: anchor.bottom + GUTTER,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'top-left',\n      left: anchor.left,\n      top: anchor.top - GUTTER - h,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'top-right',\n      left: anchor.right - w,\n      top: anchor.top - GUTTER - h,\n      right: 0, bottom: 0\n    },\n  ]\n\n  // Compute right and bottom for each\n  placements.forEach((p) => {\n    p.right = p.left + w\n    p.bottom = p.top + h\n  })\n\n  return placements\n}\n\n/**\n * Select the best placement candidate: prefer the last placement if still valid (stability),\n * otherwise pick the first that fully fits, or the one with maximum visible area.\n */\nexport function findFirstFitOrMaxArea(\n  candidates: Candidate[],\n  viewport: Rect,\n  lastPlacement: Placement | null\n): Candidate {\n  // Check if last placement still fits (for stability)\n  if (lastPlacement) {\n    const last = candidates.find((c) => c.placement === lastPlacement)\n    if (last && fitsInside(last, viewport)) {\n      return last\n    }\n  }\n\n  // First pass: find first that fully fits\n  for (const c of candidates) {\n    if (fitsInside(c, viewport)) {\n      return c\n    }\n  }\n\n  // Second pass: choose candidate with maximum visible area\n  let best = candidates[0]\n  let maxArea = visibleArea(best, viewport)\n\n  for (let i = 1; i < candidates.length; i++) {\n    const area = visibleArea(candidates[i], viewport)\n    if (area > maxArea) {\n      maxArea = area\n      best = candidates[i]\n    }\n  }\n\n  return best\n}\n\n/**\n * Check if a candidate placement fully fits within the viewport bounds.\n */\nexport function fitsInside(candidate: Candidate, viewport: Rect): boolean {\n  return (\n    candidate.left >= viewport.left &&\n    candidate.top >= viewport.top &&\n    candidate.right <= viewport.right &&\n    candidate.bottom <= viewport.bottom\n  )\n}\n\n/**\n * Calculate the visible area (in px²) of a candidate that intersects with the viewport.\n */\nexport function visibleArea(candidate: Candidate, viewport: Rect): number {\n  const left = Math.max(candidate.left, viewport.left)\n  const top = Math.max(candidate.top, viewport.top)\n  const right = Math.min(candidate.right, viewport.right)\n  const bottom = Math.min(candidate.bottom, viewport.bottom)\n\n  if (right <= left || bottom <= top) return 0\n  return (right - left) * (bottom - top)\n}\n\n/**\n * Walk up the DOM tree to find all scrollable ancestor containers of an element.\n */\nexport function getScrollParents(el: HTMLElement): Element[] {\n  const parents: Element[] = []\n  let current: Element | null = el.parentElement\n\n  while (current && current !== document.documentElement) {\n    const style = getComputedStyle(current)\n    const overflowY = style.overflowY\n    const overflowX = style.overflowX\n\n    if (\n      (overflowY === 'auto' || overflowY === 'scroll' || overflowX === 'auto' || overflowX === 'scroll') &&\n      (current.scrollHeight > current.clientHeight || current.scrollWidth > current.clientWidth)\n    ) {\n      parents.push(current)\n    }\n\n    current = current.parentElement\n  }\n\n  // Always include document scrolling element\n  if (document.scrollingElement) {\n    parents.push(document.scrollingElement)\n  }\n\n  return parents\n}\n","import { signal, computed, effect, Signal } from '@preact/signals-core'\nimport { parse, serialize, to, toGamut } from 'colorjs.io/fn'\nimport {\n  contrastColor,\n  detectGamut,\n  getColorJSSpaceID,\n  isRGBLike,\n  reverseColorJSSpaceID,\n  type Theme,\n  type ColorSpace\n} from './color'\nimport { formatChannel } from './utils/channel-formatting'\nimport { gencolor, parseIntoChannels } from './utils/color-conversion'\nimport {\n  computeCandidates,\n  findFirstFitOrMaxArea,\n  getSafeAreaInsets,\n  getScrollParents,\n  getViewportClampRect,\n  type Placement,\n  type Rect,\n  type Size\n} from './utils/positioning'\nimport { createTemplate } from './utils/template'\n// @ts-ignore\nimport styles from './styles/index.css?inline'\n\nexport type { Theme, ColorSpace }\nexport interface ChangeDetail { value: string; colorspace: ColorSpace; gamut: string }\n\nconst DEFAULT_VALUE = 'oklch(75% 75% 180)'\nconst DEFAULT_SPACE: ColorSpace = 'oklch'\n\n// Create shared stylesheet for all component instances\nconst sheet = new CSSStyleSheet()\n// Only call replaceSync if it exists (not available in jsdom)\nif (typeof sheet.replaceSync === 'function') {\n  sheet.replaceSync(styles)\n}\n\nexport class ColorInput extends HTMLElement {\n  static get observedAttributes() { return ['value', 'colorspace', 'theme', 'no-alpha'] }\n\n  // ──────────────────────────────────────────────────────────────────────────────\n  // State: Reactive signals (Preact Signals Core)\n  // ──────────────────────────────────────────────────────────────────────────────\n  #value = signal<string>(DEFAULT_VALUE)\n  #space = signal<ColorSpace>(DEFAULT_SPACE)\n  #theme = signal<Theme>('auto')\n  #open = signal(false)\n  #anchor: Signal<HTMLElement | null> = signal(null)\n  #error = signal<string | null>(null)\n  #noAlpha = signal(false)\n\n  #contrast = computed(() => contrastColor(this.#value.value))\n  #gamut = computed(() => detectGamut(this.#value.value))\n\n  #previewEffectCleanup: ReturnType<typeof effect> | null = null\n  #colorSchemeEffectCleanup: ReturnType<typeof effect> | null = null\n  #errorEffectCleanup: ReturnType<typeof effect> | null = null\n  #controlsEffectCleanup: ReturnType<typeof effect> | null = null\n  #programmaticUpdate = false\n\n  get value() { return this.#value.value }\n  set value(v: string) {\n    if (typeof v !== 'string' || !v) return\n    try {\n      const parsed = parse(v)\n      const sid = reverseColorJSSpaceID(parsed.spaceId)\n      const isHex = typeof v === 'string' && v.trim().startsWith('#')\n      this.#space.value = isHex ? 'hex' : (sid === 'rgb' ? 'srgb' : (sid as ColorSpace))\n      this.#value.value = v\n      this.#programmaticUpdate = true\n      this.setAttribute('value', v)\n      this.setAttribute('colorspace', this.#space.value)\n      this.#programmaticUpdate = false\n      this.#emitChange()\n    } catch { }\n  }\n\n  get colorspace() { return this.#space.value }\n  set colorspace(s: ColorSpace | string) {\n    const next = (s as ColorSpace) || DEFAULT_SPACE\n    this.#space.value = next\n    this.#programmaticUpdate = true\n    this.setAttribute('colorspace', next)\n    try {\n      const current = parse(this.#value.value)\n      const targetSpace = next === 'hex' ? 'srgb' : next\n      const converted = toGamut(to(current, getColorJSSpaceID(targetSpace)))\n      const tempStr = serialize(converted, { precision: 12 })\n      const parsed = parseIntoChannels(next, tempStr)\n      const newValue = gencolor(next, parsed.ch)\n      this.#value.value = newValue\n      this.setAttribute('value', newValue)\n      this.#emitChange()\n    } catch { }\n    this.#programmaticUpdate = false\n    // Re-render controls for new colorspace\n    if (this.#controls) this.#renderControls()\n  }\n\n  get theme() { return this.#theme.value }\n  set theme(t: Theme | string) {\n    const next: Theme = (t === 'light' || t === 'dark') ? t : 'auto'\n    this.#theme.value = next\n    if (next === 'auto') this.removeAttribute('theme')\n    else this.setAttribute('theme', next)\n  }\n\n  get noAlpha() { return this.#noAlpha.value }\n  set noAlpha(v: boolean) {\n    this.#noAlpha.value = !!v\n    if (v) this.setAttribute('no-alpha', '')\n    else this.removeAttribute('no-alpha')\n  }\n\n  get gamut() { return this.#gamut.value }\n  get contrastColor() { return this.#contrast.value }\n\n  show(anchor?: HTMLElement | null) {\n    if (anchor) this.#anchor.value = anchor\n    this.#panel?.showPopover?.();\n    this.#startReposition()\n  }\n  close() { this.#panel?.hidePopover?.(); this.#stopReposition() }\n  showPicker() { this.show() }\n\n  setAnchor(el: HTMLElement | null) { this.#anchor.value = el }\n  set setColor(v: string) { this.value = v }\n  set setAnchorElement(el: HTMLElement | null) { this.setAnchor(el) }\n\n  // ──────────────────────────────────────────────────────────────────────────────\n  // DOM references\n  // ──────────────────────────────────────────────────────────────────────────────\n  #root: ShadowRoot\n  #panel?: HTMLElement & { showPopover?: () => void; hidePopover?: () => void }\n  #controls?: HTMLElement\n  #spaceSelect?: HTMLSelectElement\n  #output?: HTMLOutputElement\n  #chip?: HTMLElement\n  #internalTrigger?: HTMLButtonElement\n  #textInput?: HTMLInputElement\n  #errorMessage?: HTMLElement\n  #lastInvoker: HTMLElement | null = null\n\n  constructor() {\n    super()\n    this.#root = this.attachShadow({ mode: 'open', delegatesFocus: true })\n\n    // Adopt shared stylesheet if supported, otherwise inject inline styles\n    if ('adoptedStyleSheets' in this.#root && typeof sheet.replaceSync === 'function') {\n      this.#root.adoptedStyleSheets = [sheet]\n    } else {\n      // Fallback for environments without adoptedStyleSheets support (e.g., jsdom)\n      const styleEl = document.createElement('style')\n      styleEl.textContent = styles\n      this.#root.appendChild(styleEl)\n    }\n\n    // Add template content\n    const template = createTemplate()\n    this.#root.appendChild(template.content.cloneNode(true))\n  }\n\n  connectedCallback() {\n    const btn = this.#root.querySelector<HTMLButtonElement>('button.trigger')\n    this.#internalTrigger = btn ?? undefined\n    this.#panel = this.#root.querySelector('.panel') as any\n    this.#controls = this.#root.querySelector('.controls') as HTMLElement\n    this.#spaceSelect = this.#root.querySelector('.space') as HTMLSelectElement\n    this.#output = this.#root.querySelector('output.info') as HTMLOutputElement\n    this.#chip = this.#root.querySelector('.chip') as HTMLElement\n    this.#textInput = this.#root.querySelector('.text-input') as HTMLInputElement\n    this.#errorMessage = this.#root.querySelector('.error-message') as HTMLElement\n\n    // Copy to clipboard\n    const copyBtn = this.#root.querySelector<HTMLButtonElement>('button.copy-btn')\n    const copyMessage = this.#root.querySelector<HTMLElement>('.copy-message')\n    const copyMessageLiveRegion = this.#root.querySelector<HTMLElement>('.copy-message-live-region')\n    if (copyBtn && copyMessage && copyMessageLiveRegion) {\n      let copyTimeout: number | null = null\n      copyBtn.addEventListener('click', async () => {\n        try {\n          await navigator.clipboard.writeText(this.#value.value)\n          copyMessage.classList.add('show')\n          copyMessageLiveRegion.innerText = copyMessage.innerText\n          if (copyTimeout !== null) clearTimeout(copyTimeout)\n          copyTimeout = window.setTimeout(() => {\n            copyMessage.classList.remove('show')\n            copyMessageLiveRegion.innerText = \"\"\n            copyTimeout = null\n          }, 3000)\n        } catch { }\n      })\n    }\n\n    // Init space options\n    this.#spaceSelect.innerHTML = `\n      <optgroup label=\"Standard\">\n        <option value=\"hex\">hex</option>\n        <option value=\"srgb\">rgb</option>\n        <option value=\"srgb-linear\">srgb-linear</option>\n        <option value=\"hsl\">hsl</option>\n        <option value=\"hwb\">hwb</option>\n      </optgroup>\n      <optgroup label=\"HDR\">\n        <option value=\"display-p3\">display-p3</option>\n        <option value=\"a98-rgb\">a98-rgb</option>\n      </optgroup>\n      <optgroup label=\"Ultra HDR\">\n        <option value=\"lab\">lab</option>\n        <option value=\"lch\">lch</option>\n        <option value=\"oklch\">oklch</option>\n        <option value=\"oklab\">oklab</option>\n        <option value=\"rec2020\">rec2020</option>\n        <option value=\"prophoto\">prophoto</option>\n        <option value=\"xyz\">xyz</option>\n        <option value=\"xyz-d50\">xyz-d50</option>\n        <option value=\"xyz-d65\">xyz-d65</option>\n      </optgroup>\n    `\n\n    if (btn) btn.addEventListener('click', () => this.show(btn))\n\n    // Text input validation\n    if (this.#textInput) {\n      this.#textInput.value = this.#value.value\n\n      this.#textInput.addEventListener('input', (e) => {\n        const inputValue = (e.target as HTMLInputElement).value\n        this.#validateAndSetColor(inputValue)\n      })\n\n      this.#textInput.addEventListener('paste', (e) => {\n        // Allow default paste, then validate via input event\n      })\n    }\n\n    // Command API handler\n    this.addEventListener('command', (ev: Event) => {\n      const command = (ev as any).command as string | undefined\n      if (!command) return\n      const possibleInvoker = (ev as any).source || (ev as any).invoker || (document.activeElement instanceof HTMLElement ? document.activeElement : null)\n      if (possibleInvoker) { this.#lastInvoker = possibleInvoker; this.setAnchor(possibleInvoker) }\n      if (command === 'show-popover' || command === 'show') this.show(this.#lastInvoker)\n      else if (command === 'hide-popover' || command === 'close') this.close()\n      else if (command === 'toggle-popover' || command === 'toggle') {\n        if (this.#open.value) this.close(); else this.show(this.#lastInvoker)\n      }\n    })\n\n    this.#panel?.addEventListener('toggle', () => {\n      const el = this.#panel as HTMLElement\n      let isOpen = !el.hasAttribute('hidden')\n      try {\n        isOpen = el.matches(':popover-open') ?? false\n      } catch { }\n      this.#open.value = isOpen\n      if (isOpen) {\n        this.#startReposition()\n      } else {\n        this.#stopReposition()\n      }\n      this.dispatchEvent(new CustomEvent(isOpen ? 'open' : 'close', { bubbles: true }))\n    })\n\n    this.#spaceSelect.addEventListener('change', () => {\n      this.colorspace = this.#spaceSelect!.value as ColorSpace\n      this.#renderControls()\n    })\n\n    // Reactive effects\n    this.#previewEffectCleanup = effect(() => {\n      const v = this.#value.value\n      const gamut = this.#gamut.value\n      const contrast = this.#contrast.value\n      if (this.#output) this.#output.value = v\n      if (this.#chip) this.#chip.style.setProperty('--value', v)\n      if (this.#textInput && this.#textInput.value !== v) {\n        this.#textInput.value = v\n      }\n      this.style.setProperty('--contrast', contrast)\n      this.style.setProperty('--counter', contrast === 'white' ? 'black' : 'white')\n      const gamutEl = this.#root.querySelector('.gamut') as HTMLElement\n      if (gamutEl) gamutEl.textContent = gamut\n      const preview = this.#root.querySelector('.preview') as HTMLElement\n      if (preview) preview.style.setProperty('--value', v)\n    })\n\n    this.#errorEffectCleanup = effect(() => {\n      const error = this.#error.value\n      if (error) {\n        this.setAttribute('data-error', '')\n        if (this.#errorMessage) this.#errorMessage.textContent = error\n        if (this.#textInput) this.#textInput.setAttribute('aria-invalid', 'true')\n      } else {\n        this.removeAttribute('data-error')\n        if (this.#errorMessage) this.#errorMessage.textContent = ''\n        if (this.#textInput) this.#textInput.setAttribute('aria-invalid', 'false')\n      }\n    })\n\n    this.#colorSchemeEffectCleanup = effect(() => {\n      const theme = this.#theme.value\n      const colorScheme = theme === 'auto' ? 'light dark' : theme\n      this.style.setProperty('color-scheme', colorScheme)\n    })\n\n    // Defaults\n    if (!this.hasAttribute('value')) this.setAttribute('value', DEFAULT_VALUE)\n    if (!this.hasAttribute('colorspace')) {\n      // If we have a value attribute, the colorspace was already detected in attributeChangedCallback\n      // So we should sync the attribute with the detected internal space value\n      this.setAttribute('colorspace', this.#space.value)\n    }\n\n    this.#spaceSelect.value = this.#space.value\n    this.#renderControls()\n  }\n\n  disconnectedCallback() {\n    if (this.#colorSchemeEffectCleanup) this.#colorSchemeEffectCleanup()\n    if (this.#previewEffectCleanup) this.#previewEffectCleanup()\n    if (this.#errorEffectCleanup) this.#errorEffectCleanup()\n  }\n\n  attributeChangedCallback(name: string, _old: string | null, value: string | null) {\n    if (value === _old) return\n    // Skip processing if this is from a programmatic update (avoid circular event emissions)\n    if (this.#programmaticUpdate) return\n\n    if (name === 'value' && typeof value === 'string') {\n      try {\n        const parsed = parse(value)\n        const sid = reverseColorJSSpaceID(parsed.spaceId)\n        const isHex = typeof value === 'string' && value.trim().startsWith('#')\n        this.#value.value = value\n        this.#space.value = isHex ? 'hex' : (sid === 'rgb' ? 'srgb' : (sid as ColorSpace))\n        if (this.#spaceSelect) this.#spaceSelect.value = this.#space.value\n      } catch { }\n    }\n    if (name === 'colorspace' && value) {\n      this.#space.value = value as ColorSpace\n      if (this.#spaceSelect) this.#spaceSelect.value = value\n    }\n    if (name === 'theme') {\n      this.#theme.value = (value as Theme) || 'auto'\n    }\n    if (name === 'no-alpha') {\n      this.#noAlpha.value = value !== null\n      if (this.#controls) this.#renderControls()\n    }\n  }\n\n  #emitChange() {\n    const detail: ChangeDetail = { value: this.#value.value, colorspace: this.#space.value, gamut: this.#gamut.value }\n    this.dispatchEvent(new CustomEvent<ChangeDetail>('change', { detail, bubbles: true }))\n  }\n\n  #validateAndSetColor(inputValue: string) {\n    if (!inputValue || !inputValue.trim()) {\n      this.#error.value = 'Invalid color format'\n      return\n    }\n\n    try {\n      const parsed = parse(inputValue)\n      const sid = reverseColorJSSpaceID(parsed.spaceId)\n      const isHex = typeof inputValue === 'string' && inputValue.trim().startsWith('#')\n\n      // Clear error on success\n      this.#error.value = null\n\n      // Update value and colorspace\n      this.#space.value = isHex ? 'hex' : (sid === 'rgb' ? 'srgb' : (sid as ColorSpace))\n      this.#value.value = inputValue\n      this.setAttribute('value', inputValue)\n      this.setAttribute('colorspace', this.#space.value)\n      if (this.#spaceSelect) this.#spaceSelect.value = this.#space.value\n      this.#emitChange()\n    } catch (error) {\n      this.#error.value = 'Invalid color format'\n    }\n  }\n\n  // ──────────────────────────────────────────────────────────────────────────────\n  // Positioning system\n  // ──────────────────────────────────────────────────────────────────────────────\n  #lastPlacement: Placement | null = null\n  #lastPanelSize: Size | null = null\n  #cleanup: Array<() => void> = []\n  #rafId: number | null = null\n\n  #startReposition() {\n    if (this.#cleanup.length) return\n    this.#scheduleReposition()\n\n    const anchor = this.#anchor.value ?? this.#lastInvoker ?? this.#internalTrigger\n    if (!anchor || !this.#panel) return\n\n    if (typeof ResizeObserver !== 'undefined') {\n      const ro = new ResizeObserver(() => this.#scheduleReposition())\n      ro.observe(anchor)\n      ro.observe(this.#panel)\n      ro.observe(document.documentElement)\n      this.#cleanup.push(() => ro.disconnect())\n    } else {\n      const onResize = () => this.#scheduleReposition()\n      window.addEventListener('resize', onResize)\n      this.#cleanup.push(() => window.removeEventListener('resize', onResize))\n    }\n\n    if (window.visualViewport) {\n      const onVV = () => this.#scheduleReposition()\n      window.visualViewport.addEventListener('resize', onVV)\n      window.visualViewport.addEventListener('scroll', onVV)\n      this.#cleanup.push(() => {\n        window.visualViewport?.removeEventListener('resize', onVV)\n        window.visualViewport?.removeEventListener('scroll', onVV)\n      })\n    }\n\n    const scrollParents = getScrollParents(anchor)\n    scrollParents.forEach((sp) => {\n      const onScroll = () => this.#scheduleReposition()\n      sp.addEventListener('scroll', onScroll, { passive: true })\n      this.#cleanup.push(() => sp.removeEventListener('scroll', onScroll))\n    })\n\n    if (typeof IntersectionObserver !== 'undefined') {\n      const io = new IntersectionObserver(() => this.#scheduleReposition(), { threshold: 0 })\n      io.observe(anchor)\n      this.#cleanup.push(() => io.disconnect())\n    }\n  }\n\n  #stopReposition() {\n    this.#cleanup.forEach((fn) => fn())\n    this.#cleanup = []\n    if (this.#rafId !== null) {\n      cancelAnimationFrame(this.#rafId)\n      this.#rafId = null\n    }\n  }\n\n  #scheduleReposition() {\n    if (this.#rafId !== null) return\n    this.#rafId = requestAnimationFrame(() => {\n      this.#rafId = null\n      this.#positionNow()\n    })\n  }\n\n  #positionNow() {\n    if (!this.#panel) return\n    const panel = this.#panel as HTMLElement\n\n    const anchorRect = this.#getAnchorRect()\n    const insets = getSafeAreaInsets()\n    const viewport = getViewportClampRect(insets)\n    const size = this.#measurePanel(panel)\n\n    const candidates = computeCandidates(anchorRect, size)\n    const pick = findFirstFitOrMaxArea(candidates, viewport, this.#lastPlacement)\n    this.#lastPlacement = pick.placement\n\n    const left = Math.round(Math.min(Math.max(pick.left, viewport.left), viewport.right - size.width))\n    const top = Math.round(Math.min(Math.max(pick.top, viewport.top), viewport.bottom - size.height))\n\n    const maxPanelHeight = viewport.bottom - viewport.top\n    if (size.height > maxPanelHeight) {\n      panel.style.maxHeight = `${maxPanelHeight}px`\n      panel.style.overflow = 'auto'\n    } else if (panel.style.maxHeight) {\n      panel.style.maxHeight = ''\n      panel.style.overflow = ''\n    }\n\n    panel.style.position = 'absolute'\n    panel.style.left = `${left}px`\n    panel.style.top = `${top}px`\n    panel.style.setProperty('--ci-panel-placement', pick.placement)\n    panel.dataset.placement = pick.placement\n  }\n\n  #getAnchorRect(): Rect {\n    const anchor = this.#anchor.value ?? this.#lastInvoker ?? this.#internalTrigger ?? this\n    const scrollX = window.pageXOffset || document.documentElement.scrollLeft\n    const scrollY = window.pageYOffset || document.documentElement.scrollTop\n\n    if (!anchor.isConnected) {\n      const vw = window.visualViewport?.width ?? window.innerWidth\n      const vh = window.visualViewport?.height ?? window.innerHeight\n      const cx = vw / 2 + scrollX\n      const cy = vh / 2 + scrollY\n      return { left: cx, top: cy, right: cx, bottom: cy, width: 0, height: 0 }\n    }\n    const rect = anchor.getBoundingClientRect()\n    return {\n      left: rect.left + scrollX,\n      top: rect.top + scrollY,\n      right: rect.right + scrollX,\n      bottom: rect.bottom + scrollY,\n      width: rect.width,\n      height: rect.height,\n    }\n  }\n\n  #measurePanel(panel: HTMLElement): Size {\n    const rect = panel.getBoundingClientRect()\n    if (rect.width > 0 && rect.height > 0) {\n      this.#lastPanelSize = { width: rect.width, height: rect.height }\n      return this.#lastPanelSize\n    }\n\n    const saved = {\n      display: panel.style.display,\n      position: panel.style.position,\n      left: panel.style.left,\n      top: panel.style.top,\n      visibility: panel.style.visibility,\n      maxHeight: panel.style.maxHeight,\n    }\n    panel.style.display = 'block'\n    panel.style.position = 'absolute'\n    panel.style.left = '-99999px'\n    panel.style.top = '0'\n    panel.style.visibility = 'hidden'\n    panel.style.maxHeight = 'none'\n\n    const rect2 = panel.getBoundingClientRect()\n    panel.style.display = saved.display\n    panel.style.position = saved.position\n    panel.style.left = saved.left\n    panel.style.top = saved.top\n    panel.style.visibility = saved.visibility\n    panel.style.maxHeight = saved.maxHeight\n\n    if (rect2.width > 0 && rect2.height > 0) {\n      this.#lastPanelSize = { width: rect2.width, height: rect2.height }\n      return this.#lastPanelSize\n    }\n\n    return this.#lastPanelSize ?? { width: 560, height: 400 }\n  }\n\n  // ──────────────────────────────────────────────────────────────────────────────\n  // Control rendering\n  // ──────────────────────────────────────────────────────────────────────────────\n  #renderControls() {\n    if (this.#controlsEffectCleanup) this.#controlsEffectCleanup()\n    const space = this.#space.value\n    if (!this.#controls) return\n    const current = parseIntoChannels(space, this.#value.value)\n    const ch = current.ch\n\n    const channelSignals: Record<string, ReturnType<typeof signal<string>>> = {}\n    Object.keys(ch).forEach(key => {\n      channelSignals[key] = signal(String(ch[key]))\n    })\n\n    const make = (label: string, key: string, min: number, max: number, step = 1, bg?: string, bgColor?: string) => {\n      const wrapHue = key === 'H'\n      const isPercentage = ['L', 'S', 'C', 'W', 'B', 'R', 'G', 'ALP'].includes(key)\n      const isAngle = key === 'H'\n\n      const group = document.createElement('div')\n      group.className = 'control'\n      const lab = document.createElement('label')\n      lab.textContent = label\n      const titleMap: Record<string, string> = {\n        'L': 'Lightness',\n        'C': 'Chroma',\n        'H': 'Hue',\n        'S': 'Saturation',\n        'A': 'A (green-red axis)',\n        'W': 'Whiteness',\n        'R': 'Red',\n        'G': 'Green',\n        'ALP': 'Alpha'\n      }\n      if (key === 'B') {\n        if (space === 'oklab' || space === 'lab') {\n          lab.title = 'B (blue-yellow axis)'\n        } else if (space === 'hwb') {\n          lab.title = 'Blackness'\n        } else {\n          lab.title = 'Blue'\n        }\n      } else if (titleMap[key]) {\n        lab.title = titleMap[key]\n      }\n      const range = document.createElement('input')\n      range.type = 'range'\n      range.min = String(min)\n      range.max = String(max)\n      range.step = String(step)\n      range.classList.add(`ch-${key.toLowerCase()}`)\n      if (bg) range.style.backgroundImage = bg\n      if (bgColor) range.style.backgroundColor = bgColor\n      range.value = String(ch[key] ?? 0)\n      if (key === 'ALP') {\n        range.classList.add('alpha')\n        try {\n          const c0 = gencolor(space, { ...ch, ALP: '0' })\n          const c1 = gencolor(space, { ...ch, ALP: '100' })\n          const interpSpace = space === 'hsl' ? 'hsl' : (space === 'lch' ? 'lch' : (space === 'oklch' ? 'oklch' : 'oklab'))\n          range.style.background = `linear-gradient(to right in ${interpSpace}, ${c0}, ${c1}), var(--checker)`\n        } catch { }\n      }\n      const num = document.createElement('input')\n      num.type = 'number'\n      num.min = String(min)\n      num.max = String(max)\n      num.step = String(step)\n      num.classList.add(`ch-${key.toLowerCase()}`)\n      num.value = String(ch[key] ?? 0)\n\n      const numWrapper = document.createElement('div')\n      numWrapper.className = 'num-wrapper'\n      numWrapper.appendChild(num)\n      if (isPercentage || isAngle) {\n        const unit = document.createElement('sup')\n        unit.textContent = isAngle ? '°' : '%'\n        numWrapper.appendChild(unit)\n      }\n\n      const apply = () => {\n        const next = gencolor(space, ch)\n        this.#value.value = next\n        this.setAttribute('value', next)\n        this.#emitChange()\n      }\n\n      const onInput = (ev: Event) => {\n        const target = ev.target as HTMLInputElement\n        let val = Number(target.value)\n        if (!Number.isFinite(val)) return\n        if (wrapHue) {\n          val = ((val % 360) + 360) % 360\n        } else {\n          val = Math.max(min, Math.min(max, val))\n        }\n        const formatted = formatChannel(space, key, val)\n        ch[key] = formatted\n        channelSignals[key].value = formatted\n        // keep controls in sync\n        range.value = String(ch[key])\n        num.value = String(ch[key])\n        apply()\n      }\n\n      range.addEventListener('input', onInput)\n      num.addEventListener('input', onInput)\n      group.append(lab, range, numWrapper)\n      return group\n    }\n\n    this.#controls.innerHTML = ''\n\n    if (space === 'oklab') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('L', 'L', 0, 100, 1, 'linear-gradient(in oklab to right, black, white)'),\n        make('A', 'A', -0.5, 0.5, 0.01, 'linear-gradient(to right in oklab, oklab(65% -.5 .5), oklab(65% .5 .5))'),\n        make('B', 'B', -0.5, 0.5, 0.01, 'linear-gradient(to right in oklab, oklab(47% -.03 -.32), oklab(96% 0 .25))'),\n        alphaControl\n      )\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const L = channelSignals.L.value || '50'\n        const A = channelSignals.A.value || '0'\n        const B = channelSignals.B.value || '0'\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in oklab, oklab(${L}% ${A} ${B} / 0%), oklab(${L}% ${A} ${B} / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'oklch') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('L', 'L', 0, 100, 1, 'linear-gradient(in oklab to right, black, white)'),\n        make('C', 'C', 0, 100, 1, `linear-gradient(in oklch to right, oklch(${ch.L ?? 0}% 1% ${ch.H ?? 0}), oklch(${ch.L ?? 0}% 100% ${ch.H ?? 0}))`),\n        make('H', 'H', 0, 359, 1, 'linear-gradient(to right in oklch longer hue, oklch(90% 75% 0), oklch(90% 75% 0))'),\n        alphaControl\n      )\n      const cRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-c')\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const L = channelSignals.L.value || '0'\n        const C = channelSignals.C.value || '0'\n        const H = channelSignals.H.value || '0'\n        if (cRange) {\n          cRange.style.backgroundImage = `linear-gradient(in oklch to right, oklch(${L}% 1% ${H}deg), oklch(${L}% 100% ${H}deg))`\n        }\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in oklch, oklch(${L}% ${C}% ${H} / 0%), oklch(${L}% ${C}% ${H} / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'lab') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('L', 'L', 0, 100, 1, 'linear-gradient(in lab to right, black, white)'),\n        make('A', 'A', -160, 160, 1, 'linear-gradient(to right in oklab, lab(85% -100 100), lab(55% 100 100))'),\n        make('B', 'B', -160, 160, 1, 'linear-gradient(to right in oklab, lab(31% 70 -120), lab(96% 0 120))'),\n        alphaControl\n      )\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const L = channelSignals.L.value || '50'\n        const A = channelSignals.A.value || '0'\n        const B = channelSignals.B.value || '0'\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in lab, lab(${L}% ${A} ${B} / 0%), lab(${L}% ${A} ${B} / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'lch') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('L', 'L', 0, 100, 1, 'linear-gradient(in lab to right, black, white)'),\n        make('C', 'C', 0, 100, 1, `linear-gradient(in lch to right, lch(${ch.L ?? 0}% 1% ${ch.H ?? 0}), lch(${ch.L ?? 0}% 100% ${ch.H ?? 0}))`),\n        make('H', 'H', 0, 359, 1, 'linear-gradient(to right in lch longer hue, lch(90% 75% 0), lch(90% 75% 0))'),\n        alphaControl\n      )\n      const cRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-c')\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const L = channelSignals.L.value || '50'\n        const C = channelSignals.C.value || '0'\n        const H = channelSignals.H.value || '0'\n        if (cRange) {\n          cRange.style.backgroundImage = `linear-gradient(in lch to right, lch(${L}% 1% ${H}), lch(${L}% 100% ${H}))`\n        }\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in lch, lch(${L}% ${C}% ${H} / 0%), lch(${L}% ${C}% ${H} / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'hsl') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('H', 'H', 0, 359, 1, 'linear-gradient(to right in hsl longer hue, hsl(0 100% 50%), hsl(360 100% 50%))'),\n        make('S', 'S', 0, 100, 1, `linear-gradient(in hsl to right, hsl(${ch.H ?? 0} 0% ${ch.L ?? 50}% / 100%), hsl(${ch.H ?? 0} 100% ${ch.L ?? 50}% / 100%))`),\n        make('L', 'L', 0, 100, 1, `linear-gradient(in oklab to right, hsl(${ch.H ?? 0} ${ch.S ?? 100}% 0%), hsl(${ch.H ?? 0} ${ch.S ?? 100}% 100%))`),\n        alphaControl\n      )\n      const sRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-s')\n      const lRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-l')\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const H = channelSignals.H.value || '0'\n        const S = channelSignals.S.value || '100'\n        const L = channelSignals.L.value || '50'\n        if (sRange) {\n          sRange.style.backgroundImage = `linear-gradient(in hsl to right, hsl(${H} 0% ${L}% / 100%), hsl(${H} 100% ${L}% / 100%))`\n        }\n        if (lRange) {\n          lRange.style.backgroundImage = `linear-gradient(in oklab to right, hsl(${H} ${S}% 0%), hsl(${H} ${S}% 100%))`\n        }\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in hsl, hsl(${H} ${S}% ${L}% / 0%), hsl(${H} ${S}% ${L}% / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'hwb') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('H', 'H', 0, 359, 1, 'linear-gradient(to right in hsl longer hue, hsl(0 100% 50%), hsl(360 100% 50%))'),\n        make('W', 'W', 0, 100, 1, 'linear-gradient(to right in oklab, #fff0, #fff)', 'black'),\n        make('B', 'B', 0, 100, 1, 'linear-gradient(to right in oklab, #0000, #000)', 'white'),\n        alphaControl\n      )\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const H = channelSignals.H.value || '0'\n        const W = channelSignals.W.value || '0'\n        const B = channelSignals.B.value || '0'\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in hwb, hwb(${H} ${W}% ${B}% / 0%), hwb(${H} ${W}% ${B}% / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'srgb' || space === 'hex') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('R', 'R', 0, 100, 1, 'linear-gradient(to right in oklab, #f000, #f00)', 'black'),\n        make('G', 'G', 0, 100, 1, 'linear-gradient(to right in oklab, #0f00, #0f0)', 'black'),\n        make('B', 'B', 0, 100, 1, 'linear-gradient(to right in oklab, #00f0, #00f)', 'black'),\n        alphaControl\n      )\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const R = channelSignals.R.value || '0'\n        const G = channelSignals.G.value || '0'\n        const B = channelSignals.B.value || '0'\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in srgb, rgb(${R}% ${G}% ${B}% / 0%), rgb(${R}% ${G}% ${B}% / 100%)), var(--checker)`\n        }\n      })\n    } else if (isRGBLike(space)) {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('R', 'R', 0, 100, 1, 'linear-gradient(to right in oklab, #f000, #f00)', 'black'),\n        make('G', 'G', 0, 100, 1, 'linear-gradient(to right in oklab, #0f00, #0f0)', 'black'),\n        make('B', 'B', 0, 100, 1, 'linear-gradient(to right in oklab, #00f0, #00f)', 'black'),\n        alphaControl\n      )\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const R = channelSignals.R.value || '0'\n        const G = channelSignals.G.value || '0'\n        const B = channelSignals.B.value || '0'\n        if (alphaRange) {\n          const c0 = gencolor(space, { ...ch, R, G, B, ALP: '0' })\n          const c1 = gencolor(space, { ...ch, R, G, B, ALP: '100' })\n          alphaRange.style.background = `linear-gradient(to right, ${c0}, ${c1}), var(--checker)`\n        }\n      })\n    }\n  }\n}\n\ncustomElements.define('color-input', ColorInput)\n\ndeclare global {\n  interface HTMLElementTagNameMap { 'color-input': ColorInput }\n}\n","/**\n * Shadow DOM Template\n *\n * Defines the component's internal structure.\n * Layout: trigger button + popover panel (preview area + controls).\n *\n * Note: Styles are applied via adoptedStyleSheets in the component.\n */\n\nexport function createTemplate(): HTMLTemplateElement {\n  const template = document.createElement('template')\n  template.innerHTML = `\n  <button class=\"trigger\" part=\"trigger\" aria-haspopup=\"dialog\" aria-label=\"Open color picker\" title=\"Open color picker\">\n    <span class=\"chip\" part=\"chip\"></span>\n  </button>\n  <div class=\"input-wrapper\">\n    <span class=\"error-message\" part=\"error\" role=\"alert\" aria-live=\"polite\"></span>\n    <input type=\"text\" class=\"text-input\" part=\"input\" aria-label=\"Color value\" title=\"Color value\" aria-invalid=\"false\" spellcheck=\"false\" />\n  </div>\n  <div class=\"panel\" popover=\"auto\" part=\"panel\">\n    <div class=\"preview\">\n      <div class=\"copy-wrap\">\n        <button class=\"copy-btn\">\n          <span class=\"visually-hidden\">Copy color</span>\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" aria-hidden=\"true\"><title>Copy color</title><path fill=\"currentColor\" d=\"M5 22q-.825 0-1.413-.588T3 20V6h2v14h11v2H5Zm4-4q-.825 0-1.413-.588T7 16V4q0-.825.588-1.413T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.588 1.413T18 18H9Z\"/></svg>\n        </button>\n        <span class=\"copy-message\" aria-hidden=\"true\">Copied!</span>\n        <span class=\"copy-message-live-region visually-hidden\" role=\"status\"></span>\n      </div>\n      <select class=\"space\" title=\"Colorspace\"></select>\n      <output class=\"info\" part=\"output\"></output>\n      <span class=\"gamut\" title=\"Color's gamut\" part=\"gamut\"></span>\n    </div>\n    <div class=\"controls\" part=\"controls\"></div>\n  </div>\n  `\n\n  return template\n}\n","// @ts-nocheck\n\nimport * as util from \"./util.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport defaults from \"./defaults.js\";\nimport getColor from \"./getColor.js\";\nimport to from \"./to.js\";\nimport checkInGamut from \"./inGamut.js\";\nimport toGamut from \"./toGamut.js\";\nimport clone from \"./clone.js\";\n\n/** @import { ColorTypes, ParseOptions, PlainColorObject } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").SerializeOptions} SerializeOptions */\n\n/**\n * Generic toString() method, outputs a color(spaceId ...coords) function, a functional syntax, or custom formats defined by the color space\n * @param {ColorTypes} color\n * @param {SerializeOptions & Record<string, any>} options\n * @returns {string}\n */\nexport default function serialize (color, options = {}) {\n\tlet {\n\t\tprecision = defaults.precision,\n\t\tformat,\n\t\tinGamut = true,\n\t\tcoords: coordFormat,\n\t\talpha: alphaFormat,\n\t\tcommas,\n\t} = options;\n\tlet ret;\n\n\tlet colorWithMeta = /** @type {PlainColorObject & ParseOptions} */ (getColor(color));\n\n\tlet formatId = format;\n\tlet parseMeta = colorWithMeta.parseMeta;\n\n\tif (parseMeta && !format) {\n\t\tif (parseMeta.format.canSerialize()) {\n\t\t\tformat = parseMeta.format;\n\t\t\tformatId = parseMeta.formatId;\n\t\t}\n\n\t\tcoordFormat ??= parseMeta.types;\n\t\talphaFormat ??= parseMeta.alphaType;\n\t\tcommas ??= parseMeta.commas;\n\t}\n\n\tif (formatId) {\n\t\t// A format is explicitly specified\n\t\tformat = colorWithMeta.space.getFormat(format) ?? ColorSpace.findFormat(formatId);\n\t}\n\n\tif (!format) {\n\t\t// No format specified, or format not found\n\t\tformat = colorWithMeta.space.getFormat(\"default\") ?? ColorSpace.DEFAULT_FORMAT;\n\t\tformatId = format.name;\n\t}\n\n\tif (format && format.space && format.space !== colorWithMeta.space) {\n\t\t// Format specified belongs to a different color space,\n\t\t// need to convert to it first\n\t\tcolorWithMeta = to(colorWithMeta, format.space);\n\t}\n\n\t// The assignment to coords and inGamut needs to stay in the order they are now\n\t// The order of the assignment was changed as a workaround for a bug in Next.js\n\t// See this issue for details: https://github.com/color-js/color.js/issues/260\n\n\tlet coords = colorWithMeta.coords.slice(); // clone so we can manipulate it\n\n\tinGamut ||= format.toGamut;\n\n\tif (inGamut && !checkInGamut(colorWithMeta)) {\n\t\t// FIXME what happens if the color contains none values?\n\t\tcoords = toGamut(clone(colorWithMeta), inGamut === true ? undefined : inGamut).coords;\n\t}\n\n\tif (format.type === \"custom\") {\n\t\tif (format.serialize) {\n\t\t\tret = format.serialize(coords, colorWithMeta.alpha, options);\n\t\t}\n\t\telse {\n\t\t\tthrow new TypeError(\n\t\t\t\t`format ${formatId} can only be used to parse colors, not for serialization`,\n\t\t\t);\n\t\t}\n\t}\n\telse {\n\t\t// Functional syntax\n\t\tlet name = format.name || \"color\";\n\n\t\tlet args = format.serializeCoords(coords, precision, coordFormat);\n\n\t\tif (name === \"color\") {\n\t\t\t// If output is a color() function, add colorspace id as first argument\n\t\t\tlet cssId =\n\t\t\t\tformat.id || format.ids?.[0] || colorWithMeta.space.cssId || colorWithMeta.space.id;\n\t\t\targs.unshift(cssId);\n\t\t}\n\n\t\t// Serialize alpha?\n\t\t/** @type {string | number} */\n\t\tlet alpha = colorWithMeta.alpha;\n\n\t\tif (alphaFormat !== undefined && !(typeof alphaFormat === \"object\")) {\n\t\t\talphaFormat =\n\t\t\t\ttypeof alphaFormat === \"string\" ? { type: alphaFormat } : { include: alphaFormat };\n\t\t}\n\n\t\tlet alphaType = alphaFormat?.type ?? \"<number>\";\n\t\tlet serializeAlpha =\n\t\t\talphaFormat?.include === true ||\n\t\t\tformat.alpha === true ||\n\t\t\t(alphaFormat?.include !== false && format.alpha !== false && alpha < 1);\n\t\tlet strAlpha = \"\";\n\n\t\tcommas ??= format.commas;\n\n\t\tif (serializeAlpha) {\n\t\t\tif (precision !== null) {\n\t\t\t\tlet unit;\n\n\t\t\t\tif (alphaType === \"<percentage>\") {\n\t\t\t\t\tunit = \"%\";\n\t\t\t\t\talpha *= 100;\n\t\t\t\t}\n\n\t\t\t\talpha = util.serializeNumber(alpha, { precision, unit });\n\t\t\t}\n\n\t\t\tstrAlpha = `${commas ? \",\" : \" /\"} ${alpha}`;\n\t\t}\n\n\t\tret = `${name}(${args.join(commas ? \", \" : \" \")}${strAlpha})`;\n\t}\n\n\treturn ret;\n}\n"],"names":["i","Symbol","for","t","s","h","r","f","o","c","n","v","e","S","p","x","u","this","W","watched","Z","unwatched","name","d","a","l","U","y","call","g","w","_","b","Error","E","bind","dispose","dot3","multiply_v3_m3x3","input","matrix","out","z","isString","str","type","Object","prototype","toString","match","toLowerCase","serializeNumber","precision","unit","isNone","toPrecision","integer","digits","Math","log10","abs","multiplier","floor","interpolate","start","end","isNaN","mapRange","from","to","value","interpolateInv","clamp","min","val","max","copySign","sign","spow","base","exp","zdiv","isInstance","arg","constructor","targetName","proto","getPrototypeOf","constructorName","_a","brand","subscribe","valueOf","toJSON","peek","defineProperty","get","set","N","Type","coordMeta","__publicField","coordRange","range","refRange","params","trim","TypeError","groups","computedRange","percentageRange","resolve","number","fromRange","toRange","serialize","ret","scale","instance","Format","format","space","assign","spaceCoords","values","coords","map","push","types","split","serializeCoords","coerceCoords","entries","id","providedType","find","coordName","raw","canSerialize","parse","args","hooks","add","callback","first","arguments","Array","isArray","forEach","run","env","context","WHITES","D50","D65","getWhite","adapt","W1","W2","XYZ","options","M","defaults","gamut_mapping","deltaE","verbose","_c","process","_b","NODE_ENV","warn","msg","globalThis","console","String","color","parsed","parts","regex","function","argMeta","lastAlpha","separators","replace","singleArgument","$0","rawArg","meta","unitValue","unitless","Number","slice","length","units","test","NaN","parseArgument","startsWith","commas","includes","rawName","rawArgs","parseFunction","parseMeta","shift","alternateId","substring","ids","ColorSpace","findFormat","didYouMean","registryId","registry","cssId","_d","formats","formatId","alpha","pop","alphaType","coordCount","spaceId","spaceloop","all","formatObject","getFormat","deg","grad","rad","PI","turn","RegExp","keys","join","getColor","_ColorSpace","aliases","fromBase","toBase","white","_e","_f","gamutSpace","isPolar","isUnbounded","inGamut","referred","getPath","reverse","writable","enumerable","configurable","epsilon","equals","every","coord","connectionSpace","connectionSpaceIndex","myPath","path","otherPath","getMinCoords","Set","register","alias","alternatives","filters","spaces","matches","filterIds","some","resolveCoord","ref","workingSpace","coordType","coordId","index","normalizedCoord","xyz_d65","RGBColorSpace","XYZ_D65","toXYZ_M","fromXYZ_M","rgb","xyz","super","getAll","prop","setAll","object","returns","XYZ_D50","ε","ε3","κ","lab","xyz_d50","cbrt","Lab","L","pow","constrain","angle","lch","extent","isAchromatic","constrainAngle","atan2","sqrt","C","cos","sin","Gfactor","π","r2d","d2r","pow7","x2","deltaE2000","sample","kL","kC","kH","L1","a1","b1","C1","L2","a2","b2","C2","C7","G","adash1","adash2","Cdash1","Cdash2","h1","h2","hdiff","hsum","habs","hdash","Ldash","Cdash","Cdash7","lsq","SL","SC","T","SH","RC","dE","XYZtoLMS_M","LMStoXYZ_M","LMStoLab_M","LabtoLMS_M","Oklab","LMS","OKLab","LMSg","oklab","deltaEOK","clone","XYZ_Abs_D65","AbsXYZ","ninv","c1","c2","c3","pinv","d0","XYZtoCone_M","ConetoXYZ_M","ConetoIab_M","IabtoCone_M","Jzazbz","jz","az","bz","Xa","Ya","Za","PQLMS","num","denom","Iz","Jz","Xm","Ym","jzazbz","jzczhz","cz","hz","m1","im1","im2","LMStoIPT_M","IPTtoLMS_M","ictcp","ct","cp","ICtCp","ICtCptoLMS","adaptedCoefInv","tau","cat16","cat16Inv","surroundMap","dark","dim","average","hueQuadMap","H","rad2deg","deg2rad","fl","environment","refWhite","adaptingLuminance","backgroundLuminance","surround","discounting","xyzW","la","yb","yw","rgbW","nc","k4","flRoot","nbb","ncb","dRgb","dRgbInv","rgbAW","aW","viewingConditions","fromCam16","cam16","J","Q","hRad","Hp","hi","hii","ei","eii","invHueQuadrature","cosh","sinh","Jroot","et","A","p1","p2","rgb_c","adapted","constant","cabs","unadapt","toCam16","xyzd65","rgbA","hp","arr","lo","mid","bisectLeft","hueQuadrature","j","m","fromLstar","lstar","hct","toHct","attempt","last","Infinity","delta","fromHct","ucsCoeff","convertUcsAb","log","hrad","deltaEMethods","deltaE76","color1","color2","coords1","coords2","reduce","acc","distance","deltaECMC","H1","H2","C4","F","deltaEJz","Jz1","Cz1","Hz1","Jz2","Cz2","Hz2","deltaEITP","I1","T1","P1","I2","T2","P2","deltaEOK2","deltaEHCT","t1","t2","GMAPPRESET","method","jnd","deltaEMethod","blackWhiteClamp","channel","toGamut","util.isString","spaceColor","origin","JND","oklchSpace","origin_OKLCH","COLORS","WHITE","black","BLACK","clip","_color","destColor","util.clamp","min_inGamut","current","clipped","chroma","toGamutCSS","hasOwnProperty","de","channelMeta","util.isNone","mapSpace","mappedColor","order","parseFloat","calcEpsilon","low","high","bounds","REC_2020_Linear","REC2020","REC2020Linear","RGB","P3Linear","sRGBLinear","KEYWORDS","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","whitesmoke","yellow","yellowgreen","coordGrammar","fill","coordGrammarNumber","sRGB","rgb_number","rgba","rgba_number","hex","component","parseInt","collapse","alphaFormat","round","collapsible","padStart","keyword","P3","getLuminance","fclamp","Y","linearize","contrastLstar","lab_d65","phi","background","foreground","Sapc","R","B","lumTxt","lumBg","Ytxt","Ybg","BoW","Lstr1","Lstr2","deltaPhiStar","contrast","SQRT2","Y1","Y2","algorithm","rest","algorithms","contrastAlgorithms","hsl","k","hsla","HSV","hsv","hwb","sum","A98Linear","a98rgb","ProPhotoLinear","Et","prophoto","oklch","getColorJSSpaceID","reverseColorJSSpaceID","alphaToString","isRGBLike","toFixed","gencolor","ch","_g","_h","_i","ALP","_j","rh","gh","bh","canShorten","ah","rgbColor","parseIntoChannels","colorStr","targetId","cc","s2","colorjs.ColorSpace","colorjs.sRGB","colorjs.sRGB_Linear","colorjs.HSL","colorjs.HWB","colorjs.Lab","colorjs.LCH","colorjs.OKLab","colorjs.OKLCH","colorjs.P3","colorjs.A98RGB","colorjs.ProPhoto","colorjs.REC_2020","colorjs.XYZ_D65","colorjs.XYZ_D50","cachedInsets","fitsInside","candidate","viewport","left","top","right","bottom","visibleArea","DEFAULT_VALUE","DEFAULT_SPACE","sheet","CSSStyleSheet","replaceSync","styles","ColorInput","HTMLElement","__privateAdd","_ColorInput_instances","_value","signal","_space","_theme","_open","_anchor","_error","_noAlpha","_contrast","computed","wh","bl","contrastColor","__privateGet","_gamut","gamut","srgb","p3","rec2020","detectGamut","_previewEffectCleanup","_colorSchemeEffectCleanup","_errorEffectCleanup","_controlsEffectCleanup","_programmaticUpdate","_root","_panel","_controls","_spaceSelect","_output","_chip","_internalTrigger","_textInput","_errorMessage","_lastInvoker","_lastPlacement","_lastPanelSize","_cleanup","_rafId","__privateSet","attachShadow","mode","delegatesFocus","adoptedStyleSheets","styleEl","document","createElement","textContent","appendChild","template","innerHTML","createTemplate","content","cloneNode","observedAttributes","sid","isHex","setAttribute","__privateMethod","emitChange_fn","colorspace","next","newValue","coordFormat","colorWithMeta","DEFAULT_FORMAT","checkInGamut","unshift","include","serializeAlpha","strAlpha","util.serializeNumber","renderControls_fn","theme","removeAttribute","noAlpha","show","anchor","showPopover","startReposition_fn","close","hidePopover","stopReposition_fn","showPicker","setAnchor","el","setColor","setAnchorElement","connectedCallback","btn","querySelector","copyBtn","copyMessage","copyMessageLiveRegion","copyTimeout","addEventListener","async","navigator","clipboard","writeText","classList","innerText","clearTimeout","window","setTimeout","remove","inputValue","target","ev","command","possibleInvoker","source","invoker","activeElement","isOpen","hasAttribute","dispatchEvent","CustomEvent","bubbles","effect","style","setProperty","gamutEl","preview","error","colorScheme","disconnectedCallback","attributeChangedCallback","_old","WeakMap","WeakSet","detail","validateAndSetColor_fn","scheduleReposition_fn","ResizeObserver","ro","observe","documentElement","disconnect","onResize","removeEventListener","visualViewport","onVV","parents","parentElement","getComputedStyle","overflowY","overflowX","scrollHeight","clientHeight","scrollWidth","clientWidth","scrollingElement","getScrollParents","sp","onScroll","passive","IntersectionObserver","io","threshold","fn","cancelAnimationFrame","requestAnimationFrame","positionNow_fn","panel","anchorRect","getAnchorRect_fn","insets","probe","position","paddingTop","paddingRight","paddingBottom","paddingLeft","removeChild","getSafeAreaInsets","vw","width","innerWidth","vh","height","innerHeight","scrollX","pageXOffset","scrollLeft","scrollY","pageYOffset","scrollTop","getViewportClampRect","size","measurePanel_fn","candidates","placements","placement","computeCandidates","pick","lastPlacement","best","maxArea","area","findFirstFitOrMaxArea","maxPanelHeight","maxHeight","overflow","dataset","isConnected","cx","cy","rect","getBoundingClientRect","saved","display","visibility","rect2","channelSignals","key","make","label","step","bg","bgColor","wrapHue","isPercentage","isAngle","group","className","titleMap","title","backgroundImage","backgroundColor","c0","interpSpace","numWrapper","apply","onInput","isFinite","formatted","formatChannel","append","alphaControl","alphaRange","cRange","_k","_l","_m","_n","_o","_p","sRange","lRange","customElements","define"],"mappings":";ioBAAIA,EAAEC,OAAOC,IAAI,kBAAkB,SAASC,IAAI,GAAKC,GAAE,EAA0LA,SAAvL,CAAY,IAAX,IAAIJ,EAAEG,GAAE,OAAS,IAASE,IAAE,CAAC,IAAIC,EAAED,GAAe,IAAbA,QAAE,EAAOE,UAAU,IAASD,GAAE,CAAC,IAAIE,EAAEF,EAAEE,EAAqB,GAAnBF,EAAEE,OAAE,EAAOF,EAAEC,IAAG,IAAQ,EAAED,EAAEC,IAAIE,GAAEH,GAAG,IAAIA,EAAEG,GAAG,OAAOH,GAAOH,IAAGH,EAAEM,EAAEH,GAAE,EAAG,CAACG,EAAEE,CAAC,CAAC,CAAS,GAARD,GAAE,EAAEH,KAAOD,EAAE,MAAMH,CAAC,CAAS,CAAiE,IAAIQ,OAAE,EAAO,SAASE,EAAEV,GAAG,IAAIG,EAAEK,EAAEA,OAAE,EAAO,IAAI,OAAOR,GAAG,CAAA,QAASQ,EAAEL,CAAC,CAAC,CAAC,IAAIE,QAAE,EAAOD,GAAE,EAAEG,GAAE,EAAEI,GAAE,EAAE,SAASC,GAAEZ,GAAG,QAAG,IAASQ,EAAE,CAAC,IAAIL,EAAEH,EAAEU,EAAE,QAAG,IAASP,GAAGA,EAAEA,IAAIK,EAA6G,OAA1GL,EAAE,CAACH,EAAE,EAAEa,EAAEb,EAAEc,EAAEN,EAAEJ,EAAEM,OAAE,EAAOP,EAAEK,EAAEI,OAAE,EAAOG,OAAE,EAAOT,EAAEH,QAAM,IAASK,EAAEJ,IAAEI,EAAEJ,EAAEM,EAAEP,GAAEK,EAAEJ,EAAED,EAAEH,EAAEU,EAAEP,EAAK,GAAGK,EAAED,GAAEP,EAAEa,EAAEV,GAAUA,EAAC,IAAS,IAAKA,EAAEH,EAA+F,OAA5FG,EAAEH,EAAE,OAAK,IAASG,EAAEO,IAAGP,EAAEO,EAAEI,EAAEX,EAAEW,OAAK,IAASX,EAAEW,IAAEX,EAAEW,EAAEJ,EAAEP,EAAEO,GAAEP,EAAEW,EAAEN,EAAEJ,EAAED,EAAEO,OAAE,EAAOF,EAAEJ,EAAEM,EAAEP,EAAEK,EAAEJ,EAAED,GAASA,CAAE,CAAC,CAAC,SAASa,GAAEhB,EAAEG,GAAGc,KAAKN,EAAEX,EAAEiB,KAAKjB,EAAE,EAAEiB,KAAKP,OAAE,EAAOO,KAAKd,OAAE,EAAOc,KAAKC,EAAE,MAAMf,OAAE,EAAOA,EAAEgB,QAAQF,KAAKG,EAAE,MAAMjB,OAAE,EAAOA,EAAEkB,UAAUJ,KAAKK,KAAK,MAAMnB,OAAE,EAAOA,EAAEmB,IAAI,CAAqjC,SAASC,GAAEvB,EAAEG,GAAG,OAAO,IAAIa,GAAEhB,EAAEG,EAAE,CAAC,SAASM,GAAET,GAAG,IAAA,IAAQG,EAAEH,EAAEI,OAAE,IAASD,EAAEA,EAAEA,EAAEO,EAAE,GAAGP,EAAEU,EAAEb,IAAIG,EAAEH,IAAIG,EAAEU,EAAER,KAAKF,EAAEU,EAAEb,IAAIG,EAAEH,EAAE,OAAM,EAAG,OAAM,CAAE,CAAC,SAASwB,GAAExB,GAAG,IAAA,IAAQG,EAAEH,EAAEI,OAAE,IAASD,EAAEA,EAAEA,EAAEO,EAAE,CAAC,IAAIJ,EAAEH,EAAEU,EAAEH,EAAqC,QAAhC,IAASJ,IAAEH,EAAEG,EAAEA,GAAEH,EAAEU,EAAEH,EAAEP,EAAEA,EAAEH,GAAE,OAAM,IAASG,EAAEO,EAAE,CAACV,EAAEI,EAAED,EAAE,KAAK,CAAC,CAAC,CAAC,SAASsB,GAAEzB,GAAsB,IAAnB,IAAIG,EAAEH,EAAEI,EAAEE,OAAE,OAAa,IAASH,GAAE,CAAC,IAAIK,EAAEL,EAAEW,GAAK,IAAKX,EAAEH,GAAGG,EAAEU,EAAEa,EAAEvB,QAAM,IAASK,IAAEA,EAAEE,EAAEP,EAAEO,QAAK,IAASP,EAAEO,IAAEP,EAAEO,EAAEI,EAAEN,IAAOF,EAAEH,EAAEA,EAAEU,EAAEH,EAAEP,EAAEG,OAAK,IAASH,EAAEG,IAAEH,EAAEG,OAAE,GAAOH,EAAEK,CAAC,CAACR,EAAEI,EAAEE,CAAC,CAAC,SAASqB,GAAE3B,EAAEG,GAAGa,GAAEY,KAAKX,UAAK,GAAQA,KAAKF,EAAEf,EAAEiB,KAAKb,OAAE,EAAOa,KAAKY,EAAElB,GAAE,EAAEM,KAAKV,EAAE,EAAEU,KAAKC,EAAE,MAAMf,OAAE,EAAOA,EAAEgB,QAAQF,KAAKG,EAAE,MAAMjB,OAAE,EAAOA,EAAEkB,UAAUJ,KAAKK,KAAK,MAAMnB,OAAE,EAAOA,EAAEmB,IAAI,CAAu7B,SAASQ,GAAE9B,EAAEG,GAAG,OAAO,IAAIwB,GAAE3B,EAAEG,EAAE,CAAC,SAAS4B,GAAE/B,GAAG,IAAIM,EAAEN,EAAEgB,EAAa,GAAXhB,EAAEgB,OAAE,EAAU,mBAAmBV,EAAE,CAACF,KAAI,IAAIM,EAAEF,EAAEA,OAAE,EAAO,IAAIF,GAAG,OAAOH,GAAuB,MAApBH,EAAEO,IAAG,EAAGP,EAAEO,GAAG,EAAEyB,GAAEhC,GAASG,CAAC,CAAA,QAASK,EAAEE,EAAEP,GAAG,CAAC,CAAC,CAAC,SAAS6B,GAAEhC,GAAG,IAAA,IAAQG,EAAEH,EAAEI,OAAE,IAASD,EAAEA,EAAEA,EAAEO,EAAEP,EAAEU,EAAEa,EAAEvB,GAAGH,EAAEe,OAAE,EAAOf,EAAEI,OAAE,EAAO2B,GAAE/B,EAAE,CAAC,SAAS6B,GAAE7B,GAAG,GAAGQ,IAAIS,KAAK,MAAM,IAAIgB,MAAM,uBAAuBR,GAAER,MAAMT,EAAER,EAAEiB,KAAKV,IAAG,EAAM,EAAEU,KAAKV,GAAEyB,GAAEf,MAAMd,GAAG,CAAC,SAASW,GAAEd,EAAEG,GAAGc,KAAKF,EAAEf,EAAEiB,KAAKD,OAAE,EAAOC,KAAKb,OAAE,EAAOa,KAAKT,OAAE,EAAOS,KAAKV,EAAE,GAAGU,KAAKK,KAAK,MAAMnB,OAAE,EAAOA,EAAEmB,IAAI,CAAud,SAASY,GAAElC,EAAEG,GAAG,IAAIG,EAAE,IAAIQ,GAAEd,EAAEG,GAAG,IAAIG,EAAEG,GAAG,OAAOT,GAAS,MAANM,EAAEiB,IAAUvB,CAAC,CAAC,IAAIQ,EAAEF,EAAEiB,EAAEY,KAAK7B,GAAuB,OAApBE,EAAEP,OAAOmC,SAAS5B,EAASA,CAAC,CCkI99I,SAAS6B,GAAMb,EAAGQ,GACjB,OAAOR,EAAE,GAAKQ,EAAE,GAAKR,EAAE,GAAKQ,EAAE,GAAKR,EAAE,GAAKQ,EAAE,EAC7C,CAWO,SAASM,GAAkBC,EAAOC,EAAQC,EAAM,CAAC,EAAG,EAAG,IAC7D,MAAM1B,EAAIsB,GAAKE,EAAOC,EAAO,IACvBb,EAAIU,GAAKE,EAAOC,EAAO,IACvBE,EAAIL,GAAKE,EAAOC,EAAO,IAI7B,OAHAC,EAAI,GAAK1B,EACT0B,EAAI,GAAKd,EACTc,EAAI,GAAKC,EACFD,CACR,CC5IO,SAASE,GAAUC,GACzB,MAAqB,WAAdC,GAAKD,EACb,CAOO,SAASC,GAAMrC,GAGrB,OAFUsC,OAAOC,UAAUC,SAASpB,KAAKpB,GAE7ByC,MAAM,wBAAwB,IAAM,IAAIC,aACrD,CAOO,SAASC,GAAiBzC,GAAG0C,UAAEA,EAAY,GAAAC,KAAIA,IACrD,OAAIC,GAAO5C,GACH,QAGRA,GAAK6C,GAAY7C,EAAG0C,KAER,MAAAC,EAAAA,EAAQ,GACrB,CAOO,SAASC,GAAQ5C,GACvB,OAAa,OAANA,CACR,CAgBO,SAAS6C,GAAa7C,EAAG0C,GAC/B,GAAU,IAAN1C,EACH,OAAO,EAER,IAAI8C,IAAY9C,EACZ+C,EAAS,EACTD,GAAWJ,IACdK,EAA2C,IAAhCC,KAAKC,MAAMD,KAAKE,IAAIJ,KAEhC,MAAMK,EAAa,KAAST,EAAYK,GACxC,OAAOC,KAAKI,MAAMpD,EAAImD,EAAa,IAAOA,CAC3C,CAOO,SAASE,GAAaC,EAAOC,EAAKnD,GACxC,OAAIoD,MAAMF,GACFC,EAGJC,MAAMD,GACFD,EAGDA,GAASC,EAAMD,GAASlD,CAChC,CAgBO,SAASqD,GAAUC,EAAMC,EAAIC,GACnC,OACEF,IACAC,GACDD,IAASC,GACRD,EAAK,KAAOC,EAAG,IAAMD,EAAK,KAAOC,EAAG,IACrCH,MAAMI,IACI,OAAVA,EAGOA,EAGDP,GAAYM,EAAG,GAAIA,EAAG,GAtBvB,SAAyBL,EAAOC,EAAKK,GAC3C,OAAQA,EAAQN,IAAUC,EAAMD,EACjC,CAoBkCO,CAAeH,EAAK,GAAIA,EAAK,GAAIE,GACnE,CAQO,SAASE,GAAOC,EAAKC,EAAKC,GAChC,OAAOjB,KAAKiB,IAAIjB,KAAKe,IAAIE,EAAKD,GAAMD,EACrC,CAOO,SAASG,GAAUP,EAAID,GAC7B,OAAOV,KAAKmB,KAAKR,KAAQX,KAAKmB,KAAKT,GAAQC,GAAMA,CAClD,CAOO,SAASS,GAAMC,EAAMC,GAC3B,OAAOJ,GAASlB,KAAKE,IAAImB,IAASC,EAAKD,EACxC,CAOO,SAASE,GAAMvE,EAAGa,GACxB,OAAa,IAANA,EAAU,EAAIb,EAAIa,CAC1B,CAgCO,SAAS2D,GAAYC,EAAKC,SAChC,GAAID,aAAeC,EAClB,OAAO,EAGR,MAAMC,EAAaD,EAAY9D,KAE/B,KAAO6D,GAAK,CACX,MAAMG,EAAQxC,OAAOyC,eAAeJ,GAC9BK,EAAkB,OAAAC,EAAA,MAAAH,OAAA,EAAAA,EAAOF,oBAAPK,EAAoBnE,KAC5C,GAAIkE,IAAoBH,EACvB,OAAO,EAER,IAAKG,GAAuC,WAApBA,EACvB,OAAO,EAERL,EAAMG,CACP,CAEA,OAAO,CACR,CFnNi2BtE,GAAE+B,UAAU2C,MAAM1F,EAAEgB,GAAE+B,UAAU1C,EAAE,WAAW,OAAM,CAAE,EAAEW,GAAE+B,UAAUlC,EAAE,SAASb,GAAG,IAAIG,EAAEc,KAAKX,EAAEW,KAAKd,EAAKG,IAAIN,QAAG,IAASA,EAAEY,IAAGZ,EAAEe,EAAET,EAAEW,KAAKd,EAAEH,OAAK,IAASM,EAAEA,EAAEM,EAAEZ,IAAS,WAAW,IAAIA,EAAE,OAAOA,EAAEG,EAAEe,IAAIlB,EAAE4B,KAAKzB,EAAE,GAAG,EAAEa,GAAE+B,UAAUrB,EAAE,SAAS1B,GAAG,IAAIG,EAAEc,KAAK,QAAG,IAASA,KAAKd,EAAE,CAAC,IAAIG,EAAEN,EAAEY,EAAEJ,EAAER,EAAEe,OAAK,IAAST,IAAGA,EAAES,EAAEP,EAAER,EAAEY,OAAE,QAAU,IAASJ,IAAGA,EAAEI,EAAEN,EAAEN,EAAEe,OAAE,GAAUf,IAAIiB,KAAKd,IAAGc,KAAKd,EAAEK,OAAK,IAASA,GAAEE,EAAE,WAAW,IAAIV,EAAE,OAAOA,EAAEG,EAAEiB,IAAIpB,EAAE4B,KAAKzB,EAAE,GAAG,CAAC,EAAEa,GAAE+B,UAAU4C,UAAU,SAAS3F,GAAG,IAAIG,EAAEc,KAAK,OAAOiB,GAAE,WAAW,IAAI5B,EAAEH,EAAEmE,MAAM5D,EAAEF,EAAEA,OAAE,EAAO,IAAIR,EAAEM,EAAE,CAAA,QAASE,EAAEE,CAAC,CAAC,EAAE,CAACY,KAAK,OAAO,EAAEN,GAAE+B,UAAU6C,QAAQ,WAAW,OAAO3E,KAAKqD,KAAK,EAAEtD,GAAE+B,UAAUC,SAAS,WAAW,OAAO/B,KAAKqD,MAAM,EAAE,EAAEtD,GAAE+B,UAAU8C,OAAO,WAAW,OAAO5E,KAAKqD,KAAK,EAAEtD,GAAE+B,UAAU+C,KAAK,WAAW,IAAI9F,EAAEQ,EAAEA,OAAE,EAAO,IAAI,OAAOS,KAAKqD,KAAK,CAAA,QAAS9D,EAAER,CAAC,CAAC,EAAE8C,OAAOiD,eAAe/E,GAAE+B,UAAU,QAAQ,CAACiD,IAAI,WAAW,IAAIhG,EAAEY,GAAEK,MAA+B,YAAtB,IAASjB,IAAEA,EAAEA,EAAEiB,KAAKjB,GAASiB,KAAKN,CAAC,EAAEsF,IAAI,SAASjG,GAAG,GAAGA,IAAIiB,KAAKN,EAAE,CAAC,GAAGJ,GAAE,IAAI,MAAM,IAAI0B,MAAM,kBAAkBhB,KAAKN,EAAEX,EAAEiB,KAAKjB,IAAIW,KAAIP,KAAI,IAAI,IAAA,IAAQE,EAAEW,KAAKd,OAAE,IAASG,EAAEA,EAAEA,EAAES,EAAET,EAAEH,EAAE+F,GAAG,CAAA,QAAS/F,GAAG,CAAC,CAAC,IAAinBwB,GAAEoB,UAAU,IAAI/B,GAAEW,GAAEoB,UAAU1C,EAAE,WAAsB,GAAXY,KAAKV,IAAG,EAAM,EAAEU,KAAKV,EAAE,SAAS,GAAG,KAAK,GAAGU,KAAKV,GAAG,OAAM,EAAc,GAAXU,KAAKV,IAAG,EAAMU,KAAKY,IAAIlB,GAAE,OAAM,EAAsB,GAAnBM,KAAKY,EAAElB,GAAEM,KAAKV,GAAG,EAAKU,KAAKjB,EAAE,IAAIS,GAAEQ,MAAkB,OAAXA,KAAKV,IAAG,GAAS,EAAG,IAAIP,EAAEQ,EAAE,IAAIgB,GAAEP,MAAMT,EAAES,KAAK,IAAId,EAAEc,KAAKF,KAAO,GAAGE,KAAKV,GAAGU,KAAKN,IAAIR,GAAG,IAAIc,KAAKjB,KAAGiB,KAAKN,EAAER,EAAEc,KAAKV,IAAG,GAAIU,KAAKjB,IAAI,OAAOA,GAAGiB,KAAKN,EAAEX,EAAEiB,KAAKV,GAAG,GAAGU,KAAKjB,GAAG,CAAwB,OAAvBQ,EAAER,EAAEyB,GAAER,MAAMA,KAAKV,IAAG,GAAS,CAAE,EAAEoB,GAAEoB,UAAUlC,EAAE,SAASb,GAAG,QAAG,IAASiB,KAAKd,EAAE,CAACc,KAAKV,GAAG,GAAG,IAAA,IAAQJ,EAAEc,KAAKb,OAAE,IAASD,EAAEA,EAAEA,EAAEO,EAAEP,EAAEU,EAAEA,EAAEV,EAAE,CAACa,GAAE+B,UAAUlC,EAAEe,KAAKX,KAAKjB,EAAE,EAAE2B,GAAEoB,UAAUrB,EAAE,SAAS1B,GAAG,QAAG,IAASiB,KAAKd,IAAGa,GAAE+B,UAAUrB,EAAEE,KAAKX,KAAKjB,QAAM,IAASiB,KAAKd,GAAE,CAACc,KAAKV,IAAG,GAAI,IAAA,IAAQJ,EAAEc,KAAKb,OAAE,IAASD,EAAEA,EAAEA,EAAEO,EAAEP,EAAEU,EAAEa,EAAEvB,EAAE,CAAE,EAAEwB,GAAEoB,UAAUmD,EAAE,WAAW,KAAK,EAAEjF,KAAKV,GAAG,CAACU,KAAKV,GAAG,EAAE,IAAA,IAAQP,EAAEiB,KAAKd,OAAE,IAASH,EAAEA,EAAEA,EAAEe,EAAEf,EAAEG,EAAE+F,GAAG,CAAC,EAAEpD,OAAOiD,eAAepE,GAAEoB,UAAU,QAAQ,CAACiD,IAAI,WAAW,GAAG,EAAE/E,KAAKV,EAAE,MAAM,IAAI0B,MAAM,kBAAkB,IAAIjC,EAAEY,GAAEK,MAAwC,GAAlCA,KAAKZ,SAAO,IAASL,IAAEA,EAAEA,EAAEiB,KAAKjB,GAAK,GAAGiB,KAAKV,EAAE,MAAMU,KAAKN,EAAE,OAAOM,KAAKN,CAAC,IAAoeG,GAAEiC,UAAUtC,EAAE,WAAW,IAAIT,EAAEiB,KAAKJ,IAAI,IAAI,GAAG,EAAEI,KAAKV,EAAE,OAAO,QAAG,IAASU,KAAKF,EAAE,OAAO,IAAIZ,EAAEc,KAAKF,IAAO,mBAAmBZ,IAAEc,KAAKD,EAAEb,EAAC,CAAA,QAASH,GAAG,CAAC,EAAEc,GAAEiC,UAAUlC,EAAE,WAAW,GAAG,EAAEI,KAAKV,EAAE,MAAM,IAAI0B,MAAM,kBAAkBhB,KAAKV,GAAG,EAAEU,KAAKV,IAAG,EAAGwB,GAAEd,MAAMO,GAAEP,MAAMb,KAAI,IAAIJ,EAAEQ,EAAS,OAAPA,EAAES,KAAYY,GAAEM,KAAKlB,KAAKjB,EAAE,EAAEc,GAAEiC,UAAUmD,EAAE,WAAgB,EAAEjF,KAAKV,IAAIU,KAAKV,GAAG,EAAEU,KAAKT,EAAEH,GAAEA,GAAEY,KAAK,EAAEH,GAAEiC,UAAUxB,EAAE,WAAWN,KAAKV,GAAG,EAAO,EAAEU,KAAKV,MAAKU,KAAK,EAAEH,GAAEiC,UAAUX,QAAQ,WAAWnB,KAAKM,GAAG,EGE71I,MAAM4E,GAYpB,WAAAf,CAAavC,EAAMuD,SAUlB,GApBDC,EAAApF,KAAA,QACAoF,EAAApF,KAAA,aACAoF,EAAApF,KAAA,cAEAoF,EAAApF,KAAA,SAOqB,iBAAT4B,IACV5B,KAAKmF,UAAYvD,GAGduD,IACHnF,KAAKmF,UAAYA,EACjBnF,KAAKqF,WAAa,OAAAb,EAAAW,EAAUG,OAAVd,EAAmBW,EAAUI,UAG5B,iBAAT3D,EAAmB,CAC7B,IAAI4D,EAAS5D,EACX6D,OACAzD,MAAM,kEAER,IAAKwD,EACJ,MAAM,IAAIE,UAAU,gBAAgB9D,2BAGrC5B,KAAK4B,KAAO4D,EAAOG,OAAO/D,KAC1B,IAAI4B,IAAEA,EAAKE,IAAAA,GAAQ8B,EAAOG,QAEtBnC,GAAOE,KACV1D,KAAKsF,MAAQ,EAAE9B,GAAME,GAEvB,CACD,CAGA,iBAAIkC,GACH,OAAI5F,KAAKsF,MACDtF,KAAKsF,MAEK,iBAAdtF,KAAK4B,KACD5B,KAAK6F,kBAEU,YAAd7F,KAAK4B,KACN,CAAC,EAAG,KAEL,IACR,CAEA,QAAIQ,GACH,MAAkB,iBAAdpC,KAAK4B,KACD,IAEe,YAAd5B,KAAK4B,KACN,MAGD,EACR,CAMA,OAAAkE,CAASC,GACR,GAAkB,YAAd/F,KAAK4B,KACR,OAAOmE,EAGR,IAAIC,EAAYhG,KAAK4F,cACjBK,EAAUjG,KAAKqF,WAMnB,MAJkB,iBAAdrF,KAAK4B,OACR,MAAAqE,IAAAA,EAAYjG,KAAK6F,oBAGX3C,GAAS8C,EAAWC,EAASF,EACrC,CAOA,SAAAG,CAAWH,EAAQ5D,GAClB,IAAI8D,EAAwB,iBAAdjG,KAAK4B,KAA0B5B,KAAK6F,gBAAgB,KAAO7F,KAAK4F,cAE1ExD,EAAOpC,KAAKoC,KAGhB,OAAOF,GADP6D,EAAS7C,GAASlD,KAAKqF,WAAYY,EAASF,GACb,CAAE3D,OAAMD,aACxC,CAEA,QAAAJ,GACC,IAAIoE,EAAMnG,KAAK4B,KAEf,GAAI5B,KAAKsF,MAAO,CACf,IAAK9B,EAAM,GAAIE,EAAM,IAAM1D,KAAKsF,MAChCa,GAAO,IAAI3C,KAAOE,IACnB,CAEA,OAAOyC,CACR,CAOA,eAAAN,CAAiBO,EAAQ,GACxB,IAAId,EAUJ,OALCA,EAHCtF,KAAKmF,WAAanF,KAAKmF,UAAUG,OACjCtF,KAAKqF,YAAcrF,KAAKqF,WAAW,IAAM,EAElC,CAAC,EAAG,GAGJ,IAAK,GAEP,CAACC,EAAM,GAAKc,EAAOd,EAAM,GAAKc,EACtC,CAEA,UAAOrB,CAAKnD,EAAMuD,GACjB,OAAIlB,GAAWrC,EAAM5B,MACb4B,EAGD,IAAI5B,KAAK4B,EAAMuD,EACvB,EC3HM,MAAMkB,GAAWrH,OAAO,YAahB,MAAMsH,GAgBpB,WAAAnC,CAAaoC,EAAQC,EAAQD,EAAOC,OAdpCpB,EAAApF,KAAA,QACAoF,EAAApF,KAAA,QACAoF,EAAApF,KAAA,eAEAoF,EAAApF,KAAA,UAEAoF,EAAApF,KAAA,MAEAoF,EAAApF,KAAA,SAOCuG,EAAOF,IAAYrG,KACnBA,KAAK4B,KAAO,WACZ5B,KAAKK,KAAO,QAEZwB,OAAO4E,OAAOzG,KAAMuG,GAEpBvG,KAAKwG,MAAQA,EAEK,WAAdxG,KAAK4B,OAKT5B,KAAK0G,YAAc7E,OAAO8E,OAAOH,EAAMI,QAElC5G,KAAK4G,SAET5G,KAAK4G,OAAS5G,KAAK0G,YAAYG,IAAI1B,IAClC,IAAIgB,EAAM,CAAC,WAAY,gBAMvB,MAJuB,UAAnBhB,EAAUvD,MACbuE,EAAIW,KAAK,WAGHX,KAITnG,KAAK4G,OAAS5G,KAAK4G,OAAOC,IACwB,CAACE,EAAOhI,KACxD,IAAIoG,EAAYnF,KAAK0G,YAAY3H,GAMjC,MAJqB,iBAAVgI,IACVA,EAAQA,EAAMtB,OAAOuB,MAAM,aAGrBD,EAAMF,IAAIjF,GAAQsD,GAAKH,IAAInD,EAAMuD,MAG3C,CAOA,eAAA8B,CAAiBL,EAAQzE,EAAW4E,GAGnC,OAFAA,EAAQH,EAAOC,IAAI,CAAC/F,EAAG/B,WACtB,OAAAmG,GAAKH,IAAI,OAAAP,EAAA,MAAAuC,OAAA,EAAAA,EAAQhI,IAARyF,EAAcxE,KAAK4G,OAAO7H,GAAG,GAAIiB,KAAK0G,YAAY3H,MACrD6H,EAAOC,IAAI,CAACrH,EAAGT,IAAMgI,EAAMhI,GAAGmH,UAAU1G,EAAG2C,GACnD,CAQA,YAAA+E,CAAcN,EAAQG,GACrB,OAAOlF,OAAOsF,QAAQnH,KAAKwG,MAAMI,QAAQC,IAAI,EAAEO,EAAIjC,GAAYpG,WAC9D,IAAImF,EAAM0C,EAAO7H,GAEjB,GAAIsD,GAAO6B,IAAQjB,MAAMiB,GAExB,OAAOA,EAKR,IAAImD,EAAeN,EAAMhI,GACrB6C,EAAO5B,KAAK4G,OAAO7H,GAAGuI,KAAK9H,GAAKA,EAAEoC,MAAQyF,GAG9C,IAAKzF,EAAM,CAEV,IAAI2F,EAAYpC,EAAU9E,MAAQ+G,EAClC,MAAM,IAAI1B,UACT,GAAG,OAAAlB,EAAA,MAAA6C,EAAAA,EAAoC,MAAAnD,OAAA,EAAAA,EAAMsD,KAA1ChD,EAAiDN,qBAAuBqD,QAAgBvH,KAAKK,SAElG,CASA,OAPA6D,EAAMtC,EAAKkE,QAAQ5B,GAEftC,EAAK0D,QAERyB,EAAMhI,GAAK6C,EAAKG,YAGVmC,GAET,CAKA,YAAAuD,GACC,MAAqB,aAAdzH,KAAK4B,MAA2C5B,KAAMkG,SAC9D,CAMA,KAAAwB,CAAO/F,GACN,OAAO,IACR,CAOA,UAAOoD,CAAKwB,KAAWoB,GACtB,OAAKpB,GAAUtC,GAAWsC,EAAQvG,MACjC,EAGGuG,EAAOF,IACHE,EAAOF,IAGR,IAAIC,GAAOC,KAAWoB,EAC9B,ECnID,MAAMC,GAAQ,IA/BP,MACN,GAAAC,CAAKxH,EAAMyH,EAAUC,GACpB,GAA2B,iBAAhBC,UAAU,IASpBC,MAAMC,QAAQ7H,GAAQA,EAAO,CAACA,IAAO8H,QAAQ,SAAU9H,GACvDL,KAAKK,GAAQL,KAAKK,IAAS,GAEvByH,GACH9H,KAAKK,GAAM0H,EAAQ,UAAY,QAAQD,EAEzC,EAAG9H,WAbF,IAAA,IAASK,KAAQ2H,UAAU,GAC1BhI,KAAK6H,IAAIxH,EAAM2H,UAAU,GAAG3H,GAAO2H,UAAU,GAahD,CAEA,GAAAI,CAAK/H,EAAMgI,GACVrI,KAAKK,GAAQL,KAAKK,IAAS,GAC3BL,KAAKK,GAAM8H,QAAQ,SAAUL,GAC5BA,EAASnH,KAAK0H,GAAOA,EAAIC,QAAUD,EAAIC,QAAUD,EAAKA,EACvD,EACD,GCpBYE,GAAS,CAErBC,IAAK,CAAC,MAAS,MAAQ,QAAmC,OAC1DC,IAAK,CAAC,MAAS,KAAQ,QAAmC,OAQpD,SAASC,GAAUrI,GACzB,OAAI4H,MAAMC,QAAQ7H,GACVA,EAGDkI,GAAOlI,EACf,CAUe,SAASsI,GAAOC,EAAIC,EAAIC,EAAKC,EAAU,CAAA,GAIrD,GAHAH,EAAKF,GAASE,GACdC,EAAKH,GAASG,IAETD,IAAOC,EACX,MAAM,IAAInD,UACT,kCAAmCkD,EAAc,GAAT,SAAeA,GAAOC,EAAW,GAAN,MAAYA,EAAY,GAAP,QAItF,GAAID,IAAOC,EAEV,OAAOC,EAGR,IAAIT,EAAM,CAAEO,KAAIC,KAAIC,MAAKC,WAyBzB,GAvBAnB,GAAMQ,IAAI,6BAA8BC,GAEnCA,EAAIW,IACJX,EAAIO,KAAOL,GAAOE,KAAOJ,EAAIQ,KAAON,GAAOC,IAE9CH,EAAIW,EAAI,CACP,CAAG,mBAAsB,qBAAsB,oBAC/C,CAAG,mBAAsB,mBAAsB,qBAC/C,EAAE,oBAAuB,oBAAuB,oBAGzCX,EAAIO,KAAOL,GAAOC,KAAOH,EAAIQ,KAAON,GAAOE,MAEnDJ,EAAIW,EAAI,CACP,CAAG,kBAAsB,mBAAuB,oBAChD,EAAE,kBAAwB,mBAAsB,qBAChD,CAAG,qBAAsB,oBAAuB,sBAKnDpB,GAAMQ,IAAI,2BAA4BC,GAElCA,EAAIW,EACP,OAAO3H,GAAiBgH,EAAIS,IAAKT,EAAIW,GAGrC,MAAM,IAAItD,UAAU,qEAEtB,CChFA,MAAAuD,GAAe,CACdC,cAAe,MACf/G,UAAW,EACXgH,OAAQ,KACRC,QAA+D,UAAtD,OAAAC,EAAA,SAAA,4CAAYC,cAAZ,EAAA9E,EAAqB6D,UAArB,EAAAkB,EAA0BC,mBAAUvH,eAC7CwH,KAAM,SAAeC,WAChB1J,KAAKoJ,UACR,OAAAG,EAAA,OAAA/E,EAAA,MAAAmF,gBAAA,EAAAA,WAAYC,cAAZ,EAAApF,EAAqBiF,OAArBF,EAAA5I,KAAA6D,EAA4BkF,GAE9B,GCQc,SAAShC,GAAO/F,EAAKoH,eACnC,IAYI5C,EAZAkC,EAAM,CACT1G,IAAK,OAAA6C,EAAAqF,OAAOlI,WAAP6C,EAAaiB,OAClBsD,WAKD,GAFAnB,GAAMQ,IAAI,cAAeC,GAErBA,EAAIyB,MACP,OAAOzB,EAAIyB,MAGZzB,EAAI0B,OA4ME,SAAwBpI,GAC9B,IAAKA,EACJ,OAKD,IAAIqI,GAFJrI,EAAMA,EAAI8D,QAEMzD,MAAMiI,GAAMC,UAE5B,GAAIF,EAAO,CAEV,IAAIrC,EAAO,GACPwC,EAAU,GACVC,GAAY,EACZ/J,EAAO2J,EAAM,GAAG/H,cAEhBoI,EAAaL,EAAM,GAAGM,QAAQL,GAAMM,eAAgB,CAACC,EAAIC,KAC5D,IAAIpH,MAAEA,EAAAqH,KAAOA,GAzDT,SAAwBD,SAE9B,IAAIC,EAAO,CAAA,EACPtI,EAAO,OAAAoC,EAAAiG,EAAOzI,MAAMiI,GAAMU,mBAAnBnG,EAAgC,GAEvCnB,EAASqH,EAAKlD,IAAMiD,EA2BxB,OAzBIrI,GAEHsI,EAAK9I,KAAgB,MAATQ,EAAe,eAAiB,UAC5CsI,EAAKtI,KAAOA,EACZsI,EAAKE,SAAWC,OAAOxH,EAAMyH,MAAM,GAAI1I,EAAK2I,SAE5C1H,EAAQqH,EAAKE,SAAWI,GAAM5I,IAEtB6H,GAAMlE,OAAOkF,KAAK5H,IAG1BA,EAAQwH,OAAOxH,GACfqH,EAAK9I,KAAO,YAEM,SAAVyB,EACRA,EAAQ,KAEU,QAAVA,GAA6B,cAAVA,GAC3BA,EAAQ6H,IACRR,EAAK9I,KAAO,YAGZ8I,EAAK9I,KAAO,UAGN,CAAEyB,MAAA,EAAsCqH,KAAA,EAChD,CAwByBS,CAAcV,GAcpC,OAVCD,EAAGY,WAAW,MAEJ,UAAT/K,GAAoC,IAAhBsH,EAAKoD,UAG1BX,GAAY,GAGbzC,EAAKb,KAAKzD,GACV8G,EAAQrD,KAAK4D,GACN,KAGR,MAAO,CACNrK,OACAsH,OACAwC,UACAC,YACAiB,OAAQhB,EAAWiB,SAAS,KAC5BC,QAASvB,EAAM,GACfwB,QAASxB,EAAM,GAEjB,CACD,CAxPcyB,CAAcpD,EAAI1G,KAE/B,IAAI+I,EAAOrC,EAAIU,QAAW,OAAAQ,EAAAlB,EAAIU,QAAQ2C,WAAZnC,EAAyBlB,EAAIU,QAAQ2B,KAAQ,KAEvE,GAAIrC,EAAI0B,OAAQ,CAEf,IACIxD,EACAC,EAFAnG,EAAOgI,EAAI0B,OAAO1J,KAGlBuG,EAASyB,EAAI0B,OAAOpC,KACpBZ,EAAQH,EAAOC,IAAI,CAACrH,EAAGT,WAAM,OAAA,OAAAyF,EAAA6D,EAAI0B,OAAOI,QAAQpL,WAAnByF,EAAuB5C,OAExD,GAAa,UAATvB,EAAkB,CAErB,IAAI+G,EAAKR,EAAO+E,QAChB5E,EAAM4E,QAEN,IAAIC,EAAcxE,EAAGgE,WAAW,MAAQhE,EAAGyE,UAAU,GAAK,KAAKzE,IAC3D0E,EAAM,CAAC1E,EAAIwE,GAGf,GAFArF,EAASwF,GAAWC,WAAW,CAAE3L,OAAM+G,GAAI0E,EAAKlK,KAAM,cAEjD2E,EAAQ,CAEZ,IAAI0F,EAEAC,EAAa9E,KAAM2E,GAAWI,SAAW/E,EAAKwE,EAClD,GAAIM,KAAcH,GAAWI,SAAU,CAEtC,IAAIC,EAAQ,OAAAC,EAAA,OAAAhD,EAAA0C,GAAWI,SAASD,GAAYI,cAAhC,EAAAjD,EAAyCS,YAAzC,EAAAuC,EAAgDjF,GAExDgF,IAEHH,EAAa,gBADEtK,EAAI2I,QAAQ,SAAWlD,EAAI,SAAWgF,MAGvD,CAEA,MAAM,IAAI1G,UACT,gBAAgB2C,EAAI1G,SAAW,MAAAsK,EAAAA,EAAc,qBAE/C,CAEAzF,EAAQD,EAAOC,MAEXD,EAAOa,GAAGgE,WAAW,QAAUhE,EAAGgE,WAAW,OAChDnC,GAASQ,KACR,GAAGjD,EAAMnG,gGACckG,EAAOa,wBAAwBA,OAGpDA,EAAGgE,WAAW,QAAU7E,EAAOa,GAAGgE,WAAW,OAChDnC,GAASQ,KACR,GAAGjD,EAAMnG,qEACKkG,EAAOa,iCAAiCA,MAGzD,MAECb,EAASwF,GAAWC,WAAW,CAAE3L,OAAMuB,KAAM,aAC7C4E,EAAQD,EAAOC,MAGZkE,GACH7I,OAAO4E,OAAOiE,EAAM,CACnBnE,SACAgG,SAAUhG,EAAOlG,KACjB0G,QACAsE,OAAQhD,EAAI0B,OAAOsB,SAIrB,IAAImB,EAAQ,EAERnE,EAAI0B,OAAOK,YACdoC,EAAQnE,EAAI0B,OAAOpC,KAAK8E,MAEpB/B,IACHA,EAAKgC,UAAY3F,EAAM0F,QAIzB,IAAIE,EAAapG,EAAOK,OAAOmE,OAE/B,GAAInE,EAAOmE,SAAW4B,EACrB,MAAM,IAAIjH,UACT,YAAYiH,qBAA8BnG,EAAMY,SAASiB,EAAI1G,aAAaiF,EAAOmE,UAInFnE,EAASL,EAAOW,aAAaN,EAAQG,GAErCZ,EAAM,CAAEyG,QAASpG,EAAMY,GAAIR,SAAQ4F,QACpC,MAGCK,EAAW,IAAA,IAASrG,KAASuF,GAAWe,IACvC,IAAA,IAASP,KAAY/F,EAAM8F,QAAS,CACnC,IAAI/F,EAASC,EAAM8F,QAAQC,GAE3B,GAAoB,WAAhBhG,EAAO3E,KACV,SAGD,GAAI2E,EAAO0E,OAAS1E,EAAO0E,KAAK5C,EAAI1G,KACnC,SAID,IAAIoL,EAAevG,EAAMwG,UAAUzG,GAE/BuD,EAAQiD,EAAarF,MAAMW,EAAI1G,KAEnC,GAAImI,EAAO,CACNY,GACH7I,OAAO4E,OAAOiE,EAAM,CAAEnE,OAAQwG,EAAcR,aAG7CpG,EAAM2D,EACN,MAAM+C,CACP,CACD,CAIF,IAAK1G,EAEJ,MAAM,IAAIT,UAAU,mBAAmB/D,mCAUxC,OANAwE,EAAIqG,MAAQnK,GAAO8D,EAAIqG,OACpBrG,EAAIqG,WACU,IAAdrG,EAAIqG,MACH,EACAjJ,GAAM,EAAG4C,EAAIqG,MAAO,GAEjBrG,CACR,CAKO,MAAM6E,GAAQ,CACpB,IAAK,IACLiC,IAAK,EACLC,KAAM,GACNC,IAAK,IAAM1K,KAAK2K,GAChBC,KAAM,KAGMpD,GAAQ,CAEpBC,SAAU,uCACVnE,OAAQ,+CACR4E,UAAW2C,OAAO,IAAIzL,OAAO0L,KAAKvC,IAAOwC,KAAK,UAG9CjD,eAAgB,+DCvKF,SAASkD,GAAU3D,EAAOf,GACxC,GAAId,MAAMC,QAAQ4B,GACjB,OAAOA,EAAMjD,IAAIrH,GAAKiO,GAASjO,EAAGuJ,IAGnC,IAAKe,EACJ,MAAM,IAAIpE,UAAU,yBAGjBhE,GAASoI,KACZA,EAAQpC,GAAMoC,EAAOf,IAItB,IAAIvC,EAAQsD,EAAMtD,OAASsD,EAAM8C,QAWjC,MATqB,iBAAVpG,IAEVsD,EAAMtD,MAAQuF,GAAWhH,IAAIyB,SAGV,IAAhBsD,EAAM0C,QACT1C,EAAM0C,MAAQ,GAGR1C,CACR,CClCA,MAKqB4D,GAAN,MAAMA,EACpB,WAAAvJ,CAAa4E,mBACZ/I,KAAKoH,GAAK2B,EAAQ3B,GAClBpH,KAAKK,KAAO0I,EAAQ1I,KACpBL,KAAK8D,KAAOiF,EAAQjF,KAAO4J,EAAW3I,IAAIgE,EAAQjF,MAAQ,KAC1D9D,KAAK2N,QAAU5E,EAAQ4E,QAEnB3N,KAAK8D,OACR9D,KAAK4N,SAAW7E,EAAQ6E,SACxB5N,KAAK6N,OAAS9E,EAAQ8E,QAKvB,IAAIjH,EAAS,OAAApC,EAAAuE,EAAQnC,QAARpC,EAAkBxE,KAAK8D,KAAK8C,OAEzC,IAAA,IAASvG,KAAQuG,EACV,SAAUA,EAAOvG,KACtBuG,EAAOvG,GAAMA,KAAOA,GAGtBL,KAAK4G,OAASA,EAId,IAAIkH,EAAQ,OAAAzE,EAAA,OAAAE,EAAAR,EAAQ+E,OAARvE,EAAiBvJ,KAAK8D,KAAKgK,OAA3BzE,EAAoC,MAChDrJ,KAAK8N,MAAQpF,GAASoF,GAItB9N,KAAKsM,QAAU,OAAAD,EAAAtD,EAAQuD,SAARD,EAAmB,CAAA,EAElC,IAAA,IAAShM,KAAQL,KAAKsM,QAAS,CAC9B,IAAI/F,EAASvG,KAAKsM,QAAQjM,GAC1BkG,EAAO3E,OAAP2E,EAAO3E,KAAS,YAChB2E,EAAOlG,OAAPkG,EAAOlG,KAASA,EACjB,EAEK,OAAA0N,EAAA/N,KAAKsM,QAAQxC,gBAAO1C,MACxBpH,KAAKsM,QAAQxC,MAAQ,IAChB,OAAAkE,EAAAhO,KAAKsM,QAAQxC,SAAS,GAC1B1C,GAAI2B,EAAQqD,OAASpM,KAAKoH,KAMxB2B,EAAQkF,WAEXjO,KAAKiO,WACmB,SAAvBlF,EAAQkF,WAAwBjO,KAAO0N,EAAW3I,IAAIgE,EAAQkF,YAI3DjO,KAAKkO,QAERlO,KAAKiO,WAAajO,KAAK8D,KAGvB9D,KAAKiO,WAAajO,KAKhBA,KAAKiO,WAAWE,cACnBnO,KAAKoO,QAAU,CAACxH,EAAQmC,KAChB,GAKT/I,KAAKqO,SAAWtF,EAAQsF,SAGxBxM,OAAOiD,eAAe9E,KAAM,OAAQ,CACnCqD,MAAOiL,GAAQtO,MAAMuO,UACrBC,UAAU,EACVC,YAAY,EACZC,cAAc,IAGf9G,GAAMQ,IAAI,sBAAuBpI,KAClC,CAEA,OAAAoO,CAASxH,GAAQ+H,QAAEA,EAzFV,OAyF0B,CAAA,GAClC,IAAK3O,KAAK4O,OAAO5O,KAAKiO,YAErB,OADArH,EAAS5G,KAAKoD,GAAGpD,KAAKiO,WAAYrH,GAC3B5G,KAAKiO,WAAWG,QAAQxH,EAAQ,CAAE+H,YAG1C,IAAIxJ,EAAYtD,OAAO8E,OAAO3G,KAAK4G,QAEnC,OAAOA,EAAOiI,MAAM,CAACrP,EAAGT,KACvB,IAAI2L,EAAOvF,EAAUpG,GAErB,GAAkB,UAAd2L,EAAK9I,MAAoB8I,EAAKpF,MAAO,CACxC,GAAIjD,GAAO7C,GAEV,OAAO,EAGR,IAAKgE,EAAKE,GAAOgH,EAAKpF,MACtB,YACU,IAAR9B,GAAqBhE,GAAKgE,EAAMmL,UACxB,IAARjL,GAAqBlE,GAAKkE,EAAMiL,EAEnC,CAEA,OAAO,GAET,CAEA,eAAIR,GACH,OAAOtM,OAAO8E,OAAO3G,KAAK4G,QAAQiI,MAAMC,KAAW,UAAWA,GAC/D,CAEA,SAAI1C,WACH,OAAO,OAAA7C,EAAA,OAAA/E,EAAAxE,KAAKsM,cAAL,EAAA9H,EAAcsF,YAAd,EAAAP,EAAqBnC,KAAMpH,KAAKoH,EACxC,CAEA,WAAI8G,GACH,IAAA,IAAS9G,KAAMpH,KAAK4G,OACnB,GAA6B,UAAzB5G,KAAK4G,OAAOQ,GAAIxF,KACnB,OAAO,EAIT,OAAO,CACR,CAOA,SAAAoL,CAAWzG,GACV,IAAKA,EACJ,OAAO,KAGO,YAAXA,EACHA,EAAS1E,OAAO8E,OAAO3G,KAAKsM,SAAS,GAEX,iBAAX/F,IACfA,EAASvG,KAAKsM,QAAQ/F,IAGvB,IAAIJ,EAAMG,GAAOvB,IAAIwB,EAAQvG,MAO7B,OALImG,IAAQI,GAAUA,EAAOlG,QAAQL,KAAKsM,UAEzCtM,KAAKsM,QAAQ/F,EAAOlG,MAAQ8F,GAGtBA,CACR,CAQA,MAAAyI,CAAQpI,GACP,QAAKA,IAIExG,OAASwG,GAASxG,KAAKoH,KAAOZ,GAASxG,KAAKoH,KAAOZ,EAAMY,GACjE,CAEA,EAAAhE,CAAIoD,EAAOI,GACV,GAAyB,IAArBoB,UAAU+C,OAAc,CAC3B,MAAMjB,EAAQ2D,GAASjH,IACtBA,EAAOI,GAAU,CAACkD,EAAMtD,MAAOsD,EAAMlD,OACvC,CAIA,GAFAJ,EAAQkH,EAAW3I,IAAIyB,GAEnBxG,KAAK4O,OAAOpI,GAEf,OAAOI,EAIRA,EAASA,EAAOC,IAAIrH,GAAM6C,GAAO7C,GAAK,EAAIA,GAG1C,IAGIuP,EAAiBC,EAHjBC,EAASjP,KAAKkP,KACdC,EAAY3I,EAAM0I,KAItB,IAAA,IAASnQ,EAAI,EAAGA,EAAIkQ,EAAOlE,QACtBkE,EAAOlQ,GAAG6P,OAAOO,EAAUpQ,IADGA,IAEjCgQ,EAAkBE,EAAOlQ,GACzBiQ,EAAuBjQ,EAOzB,IAAKgQ,EAEJ,MAAM,IAAI/N,MACT,uCAAuChB,YAAYwG,oCAKrD,IAAA,IAASzH,EAAIkQ,EAAOlE,OAAS,EAAGhM,EAAIiQ,EAAsBjQ,IACzD6H,EAASqI,EAAOlQ,GAAG8O,OAAOjH,GAI3B,IAAA,IAAS7H,EAAIiQ,EAAuB,EAAGjQ,EAAIoQ,EAAUpE,OAAQhM,IAC5D6H,EAASuI,EAAUpQ,GAAG6O,SAAShH,GAGhC,OAAOA,CACR,CAEA,IAAAzD,CAAMqD,EAAOI,GACZ,GAAyB,IAArBoB,UAAU+C,OAAc,CAC3B,MAAMjB,EAAQ2D,GAASjH,IACtBA,EAAOI,GAAU,CAACkD,EAAMtD,MAAOsD,EAAMlD,OACvC,CAIA,OAFAJ,EAAQkH,EAAW3I,IAAIyB,IAEVpD,GAAGpD,KAAM4G,EACvB,CAEA,QAAA7E,GACC,MAAO,GAAG/B,KAAKK,SAASL,KAAKoH,KAC9B,CAEA,YAAAgI,SACC,IAAIjJ,EAAM,GAEV,IAAA,IAASiB,KAAMpH,KAAK4G,OAAQ,CAC3B,IAAI8D,EAAO1K,KAAK4G,OAAOQ,GACnB9B,EAAQoF,EAAKpF,OAASoF,EAAKnF,SAC/BY,EAAIW,KAAK,OAAAtC,EAAA,MAAAc,OAAA,EAAAA,EAAO9B,KAAPgB,EAAc,EACxB,CAEA,OAAO2B,CACR,CAKA,cAAW2G,GACV,MAAO,IAAI,IAAIuC,IAAIxN,OAAO8E,OAAO+G,EAAWvB,WAC7C,CAEA,eAAOmD,CAAUlI,EAAIZ,GAQpB,GAPyB,IAArBwB,UAAU+C,SAEb3D,GADAZ,EAAQwB,UAAU,IACPZ,IAGZZ,EAAQxG,KAAK+E,IAAIyB,GAEbxG,KAAKmM,SAAS/E,IAAOpH,KAAKmM,SAAS/E,KAAQZ,EAC9C,MAAM,IAAIxF,MAAM,wCAAwCoG,MAKzD,GAHApH,KAAKmM,SAAS/E,GAAMZ,EAGK,IAArBwB,UAAU+C,QAAgBvE,EAAMmH,QACnC,IAAA,IAAS4B,KAAS/I,EAAMmH,QACvB3N,KAAKsP,SAASC,EAAO/I,GAIvB,OAAOA,CACR,CAMA,UAAOzB,CAAKyB,KAAUgJ,GACrB,IAAKhJ,GAASvC,GAAWuC,EAAOxG,MAC/B,OAAOwG,EAKR,GAAgB,WAFF5E,GAAK4E,GAEO,CAEzB,IAAIL,EAAMuH,EAAWvB,SAAS3F,EAAMvE,eAEpC,IAAKkE,EACJ,MAAM,IAAIT,UAAU,mCAAmCc,MAGxD,OAAOL,CACR,CAEA,GAAIqJ,EAAazE,OAChB,OAAO2C,EAAW3I,OAAOyK,GAG1B,MAAM,IAAI9J,UAAU,GAAGc,+BACxB,CAQA,iBAAOwF,CAAYyD,EAASC,EAAShC,EAAWZ,KAC/C,IAAK2C,EACJ,OAAO,KAGe,iBAAZA,IACVA,EAAU,CAAEpP,KAAMoP,IAGnB,IAAA,IAASjJ,KAASkJ,EACjB,IAAA,IAAUrP,EAAMkG,KAAW1E,OAAOsF,QAAQX,EAAM8F,SAAU,CACzD,MAAA/F,EAAOlG,OAAPkG,EAAOlG,KAASA,GAChB,MAAAkG,EAAO3E,OAAP2E,EAAO3E,KAAS,YAEhB,IAAI+N,IACDF,EAAQpP,MAAQkG,EAAOlG,OAASoP,EAAQpP,MACxCoP,EAAQ7N,MAAQ2E,EAAO3E,OAAS6N,EAAQ7N,MAE3C,GAAI6N,EAAQrI,GAAI,CACf,IAAI0E,EAAMvF,EAAOuF,KAAO,CAACvF,EAAOa,IAC5BwI,EAAY3H,MAAMC,QAAQuH,EAAQrI,IAAMqI,EAAQrI,GAAK,CAACqI,EAAQrI,IAClEuI,IAAAA,EAAYC,EAAUC,KAAKzI,GAAM0E,EAAIR,SAASlE,IAC/C,CAEA,GAAIuI,EAAS,CACZ,IAAIxJ,EAAMG,GAAOvB,IAAIwB,EAAQC,GAM7B,OAJIL,IAAQI,IACXC,EAAM8F,QAAQ/F,EAAOlG,MAAQ8F,GAGvBA,CACR,CACD,CAGD,OAAO,IACR,CAUA,mBAAO2J,CAAcC,EAAKC,SACzB,IACIxJ,EAAOsI,EADPmB,EAAYrO,GAAKmO,GA4BrB,GAzBkB,WAAdE,EACCF,EAAIzE,SAAS,MAEf9E,EAAOsI,GAASiB,EAAI/I,MAAM,MAI1BR,EAAOsI,GAAS,CAAA,CAAGiB,GAGb9H,MAAMC,QAAQ6H,IACrBvJ,EAAOsI,GAASiB,GAIjBvJ,EAAQuJ,EAAIvJ,MACZsI,EAAQiB,EAAIG,SAGb1J,EAAQkH,EAAW3I,IAAIyB,GAElBA,IACJA,EAAQwJ,IAGJxJ,EACJ,MAAM,IAAId,UACT,uCAAuCqK,4EAMzC,GAFAE,EAAYrO,GAAKkN,GAEC,WAAdmB,GAAyC,WAAdA,GAA0BnB,GAAS,EAAI,CAErE,IAAIpE,EAAO7I,OAAOsF,QAAQX,EAAMI,QAAQkI,GAExC,GAAIpE,EACH,MAAO,CAAElE,QAAOY,GAAIsD,EAAK,GAAIyF,MAAOrB,KAAUpE,EAAK,GAErD,CAEAlE,EAAQkH,EAAW3I,IAAIyB,GAEvB,IAAI4J,EAAkBtB,EAAM7M,cAExBlD,EAAI,EACR,IAAA,IAASqI,KAAMZ,EAAMI,OAAQ,CAC5B,IAAI8D,EAAOlE,EAAMI,OAAOQ,GAExB,GACCA,EAAGnF,gBAAkBmO,IACrB,OAAA5L,EAAAkG,EAAKrK,WAAL,EAAAmE,EAAWvC,iBAAkBmO,EAE7B,MAAO,CAAE5J,QAAOY,KAAI+I,MAAOpR,KAAM2L,GAGlC3L,GACD,CAEA,MAAM,IAAI2G,UACT,OAAOoJ,0BAA8BtI,EAAMnG,8BAA8BwB,OAAO0L,KAAK/G,EAAMI,QAAQ4G,KAAK,QAE1G,GAnLApI,EA1PoBsI,GA0Pb,WAAW,CAAA,GAqLlBtI,EA/aoBsI,GA+ab,iBAAiB,CACvB9L,KAAM,YACNvB,KAAM,UAjbO,IAAM0L,GAAN2B,GAqbf,SAASY,GAAS9H,GACjB,IAAIL,EAAM,CAACK,GAEX,IAAA,IAASrH,EAAIqH,EAAQrH,EAAIA,EAAE2E,MAC1BqC,EAAIW,KAAK3H,GAGV,OAAOgH,CACR,CC3cA,MAAAkK,GAAe,IAAItE,GAAW,CAC7B3E,GAAI,UACJ/G,KAAM,UACNuG,OAAQ,CACP9G,EAAG,CACFyF,SAAU,CAAC,EAAG,GACdlF,KAAM,KAEPK,EAAG,CACF6E,SAAU,CAAC,EAAG,GACdlF,KAAM,KAEPoB,EAAG,CACF8D,SAAU,CAAC,EAAG,GACdlF,KAAM,MAGRyN,MAAO,MACPxB,QAAS,CACRxC,MAAO,CACNgC,IAAK,CAAC,UAAW,SAGnB6B,QAAS,CAAC,SChBI,MAAM2C,WAAsBvE,GAQ1C,WAAA5H,CAAa4E,GACPA,EAAQnC,SACZmC,EAAQnC,OAAS,CAChBvH,EAAG,CACFiG,MAAO,CAAC,EAAG,GACXjF,KAAM,OAEPO,EAAG,CACF0E,MAAO,CAAC,EAAG,GACXjF,KAAM,SAEPU,EAAG,CACFuE,MAAO,CAAC,EAAG,GACXjF,KAAM,UAKJ0I,EAAQjF,OACZiF,EAAQjF,KAAOyM,IAGZxH,EAAQyH,SAAWzH,EAAQ0H,YAC9B,MAAA1H,EAAQ8E,SAAR9E,EAAQ8E,OAAW6C,IAClB,IAAIC,EAAMtP,GAAiBqP,EAAK3H,EAAQyH,SAOxC,OALIxQ,KAAK8N,QAAU9N,KAAK8D,KAAKgK,QAE5B6C,EAAMhI,GAAM3I,KAAK8N,MAAO9N,KAAK8D,KAAKgK,MAAO6C,IAGnCA,IAGR,MAAA5H,EAAQ6E,WAAR7E,EAAQ6E,SAAa+C,GAEbtP,GADPsP,EAAMhI,GAAM3I,KAAK8D,KAAKgK,MAAO9N,KAAK8N,MAAO6C,GACZ5H,EAAQ0H,aAIvC,MAAA1H,EAAQsF,WAARtF,EAAQsF,SAAa,WAErBuC,MAAM7H,EACP,EChCc,SAAS8H,GAAQ/G,EAAOf,GACtCe,EAAQ2D,GAAS3D,GAEjB,IAGIlD,EAHAJ,EAAQuF,GAAWhH,IAAIgE,QAASA,WAASvC,OACzCrE,EAAY,MAAA4G,OAAA,EAAAA,EAAS5G,UAWzB,OANCyE,GAFIJ,GAASsD,EAAMtD,MAAMoI,OAAOpI,GAEvBsD,EAAMlD,OAAOkE,QAGbtE,EAAMrD,KAAK2G,QAGA,IAAd3H,EAA0ByE,EAASA,EAAOC,IAAIiI,GAASxM,GAAYwM,EAAO3M,GAClF,CCjCe,SAAS4C,GAAK+E,EAAOgH,SAGnC,GAFAhH,EAAQ2D,GAAS3D,GAEJ,UAATgH,EACH,OAAO,OAAAtM,EAAAsF,EAAM0C,OAANhI,EAAe,EAGvB,IAAIgC,MAAEA,QAAO2J,GAAUpE,GAAW+D,aAAagB,EAAMhH,EAAMtD,OAE3D,OADaqK,GAAO/G,EAAOtD,GACb2J,EACf,CCCe,SAASY,GAAQjH,EAAOtD,EAAOI,EAAQ4F,GAerD,OAdA1C,EAAQ2D,GAAS3D,GAEb7B,MAAMC,QAAQ1B,MAEhBA,EAAOI,EAAQ4F,GAAS,CAAC1C,EAAMtD,MAAOA,EAAOI,IAG/CJ,EAAQuF,GAAWhH,IAAIyB,GACvBsD,EAAMlD,OAASJ,IAAUsD,EAAMtD,MAAQI,EAAOkE,QAAUtE,EAAMpD,GAAG0G,EAAMtD,MAAOI,QAEhE,IAAV4F,IACH1C,EAAM0C,MAAQA,GAGR1C,CACR,CCfe,SAAS9E,GAAK8E,EAAOgH,EAAMzN,GAGzC,GAFAyG,EAAQ2D,GAAS3D,GAEQ,IAArB9B,UAAU+C,QAAuC,WAAvBnJ,GAAKoG,UAAU,IAAkB,CAE9D,IAAIgJ,EAAShJ,UAAU,GACvB,IAAA,IAASnI,KAAKmR,EACbhM,GAAI8E,EAAOjK,EAAGmR,EAAOnR,GAEvB,MAMC,GAJqB,mBAAVwD,IACVA,EAAQA,EAAM0B,GAAI+E,EAAOgH,KAGb,UAATA,EACHhH,EAAM0C,MAAQnJ,MAEV,CACJ,IAAImD,MAAEA,QAAO2J,GAAUpE,GAAW+D,aAAagB,EAAMhH,EAAMtD,OACvDI,EAASiK,GAAO/G,EAAOtD,GAC3BI,EAAOuJ,GAAS9M,EAChB0N,GAAOjH,EAAOtD,EAAOI,EACtB,CAGD,OAAOkD,CACR,CDTAiH,GAAOE,QAAU,QCYjBjM,GAAIiM,QAAU,QCjDd,MAAAC,GAAe,IAAInF,GAAW,CAC7B3E,GAAI,UACJ/G,KAAM,UACNyN,MAAO,MACPhK,KAAMyM,GACN3C,SAAUhH,GAAU+B,GAAM4H,GAAQzC,MAAO,MAAOlH,GAChDiH,OAAQjH,GAAU+B,GAAM,MAAO4H,GAAQzC,MAAOlH,KCLzCuK,GAAI,IAAM,MACVC,GAAK,GAAK,IACVC,GAAI,MAAQ,GAElB,IAAIvD,GAAQvF,GAAOC,IAEnB,MAAA8I,GAAe,IAAIvF,GAAW,CAC7B3E,GAAI,MACJ/G,KAAM,MACNuG,OAAQ,CACPpG,EAAG,CACF+E,SAAU,CAAC,EAAG,KACdlF,KAAM,aAEPE,EAAG,CACFgF,SAAU,EAAC,IAAM,MAElBxE,EAAG,CACFwE,SAAU,EAAC,IAAM,OAMpBuI,MAACA,GAEAhK,KAAMyN,GAGN,QAAA3D,CAAU9E,GAET,IACIxJ,EADMwJ,EAAIjC,IAAI,CAACxD,EAAOtE,IAAMsE,EAAQyK,GAAM/O,IAClC8H,IAAIxD,GAAUA,EAAQ8N,GAAI1O,KAAK+O,KAAKnO,IAAUgO,GAAIhO,EAAQ,IAAM,KAM5E,MAAO,CAJC,IAAM/D,EAAE,GAAK,GACb,KAAOA,EAAE,GAAKA,EAAE,IAChB,KAAOA,EAAE,GAAKA,EAAE,IAGzB,EAIA,MAAAuO,CAAQ4D,GAEP,IAAKC,EAAGnR,EAAGQ,GAAK0Q,EACZnS,EAAI,GAcR,OAbAA,EAAE,IAAMoS,EAAI,IAAM,IAClBpS,EAAE,GAAKiB,EAAI,IAAMjB,EAAE,GACnBA,EAAE,GAAKA,EAAE,GAAKyB,EAAI,IAIR,CACTzB,EAAE,GAAO8R,GAAK3O,KAAKkP,IAAIrS,EAAE,GAAI,IAAqB,IAAMA,EAAE,GAAK,IAAM+R,GACrEI,EAAI,GAAK,EAAKhP,KAAKkP,KAAKF,EAAI,GAAK,IAAM,IAAK,GAAKA,EAAI,GAAKJ,GAC1D/R,EAAE,GAAO8R,GAAK3O,KAAKkP,IAAIrS,EAAE,GAAI,IAAqB,IAAMA,EAAE,GAAK,IAAM+R,IAI3DxK,IAAI,CAACxD,EAAOtE,IAAMsE,EAAQyK,GAAM/O,GAC5C,EAEAuN,QAAS,CACRgF,IAAK,CACJ1K,OAAQ,CACP,0BACA,0BACA,+BClEG,SAASgL,GAAWC,GAC1B,MAAqB,iBAAVA,EACHA,GAGCA,EAAQ,IAAO,KAAO,GAChC,CCRA,MAAAC,GAAe,IAAI/F,GAAW,CAC7B3E,GAAI,MACJ/G,KAAM,MACNuG,OAAQ,CACPpG,EAAG,CACF+E,SAAU,CAAC,EAAG,KACdlF,KAAM,aAEPb,EAAG,CACF+F,SAAU,CAAC,EAAG,KACdlF,KAAM,UAEPjB,EAAG,CACFmG,SAAU,CAAC,EAAG,KACd3D,KAAM,QACNvB,KAAM,QAIRyD,KAAM2N,GACN,QAAA7D,CAAU6D,GAET,QAAe,IAAXzR,KAAK,EAAiB,CAEzB,IAAIsF,EAAQzD,OAAO8E,OAAO3G,KAAK8D,KAAK8C,QAAQ,GAAGrB,SAC3CwM,EAASzM,EAAM,GAAKA,EAAM,GAC9BtF,KAAK,EAAI+R,EAAS,GACnB,CAGA,IAAKL,EAAGnR,EAAGQ,GAAK0Q,EACZO,EAAevP,KAAKE,IAAIpC,GAAKP,KAAK,GAAKyC,KAAKE,IAAI5B,GAAKf,KAAK,EAC1DZ,EAAI4S,EAAe,KAAOC,GAAmC,IAAnBxP,KAAKyP,MAAMnR,EAAGR,GAAYkC,KAAK2K,IAG7E,MAAO,CAACsE,EAFAM,EAAe,EAAIvP,KAAK0P,KAAK5R,GAAK,EAAIQ,GAAK,GAErC3B,EACf,EACA,MAAAyO,CAAQiE,GAEP,IAAKJ,EAAGU,EAAGhT,GAAK0S,EACZvR,EAAI,KACPQ,EAAI,KAQL,OANKsB,GAAOjD,KACXgT,EAAIA,EAAI,EAAI,EAAIA,EAChB7R,EAAI6R,EAAI3P,KAAK4P,IAAKjT,EAAIqD,KAAK2K,GAAM,KACjCrM,EAAIqR,EAAI3P,KAAK6P,IAAKlT,EAAIqD,KAAK2K,GAAM,MAG3B,CAACsE,EAAGnR,EAAGQ,EACf,EAEAuL,QAAS,CACRwF,IAAK,CACJlL,OAAQ,CAAC,0BAA2B,0BAA2B,0BC9C5D2L,GAAU,IAAM,EAChBC,GAAI/P,KAAK2K,GACTqF,GAAM,IAAMD,GACZE,GAAMF,GAAI,IAEhB,SAASG,GAAM7S,GAGd,MAAM8S,EAAK9S,EAAIA,EAGf,OAFW8S,EAAKA,EAAKA,EAAK9S,CAG3B,CAQe,SAAA+S,GAAU/I,EAAOgJ,GAAQC,GAAEA,EAAK,EAAAC,GAAGA,EAAK,EAAAC,GAAGA,EAAK,GAAM,KACnEnJ,EAAOgJ,GAAUrF,GAAS,CAAC3D,EAAOgJ,IAanC,IAAKI,EAAIC,EAAIC,GAAM9B,GAAInO,KAAK2G,GACxBuJ,EAAKvB,GAAI3O,KAAKmO,GAAK,CAAC4B,EAAIC,EAAIC,IAAK,IAChCE,EAAIC,EAAIC,GAAMlC,GAAInO,KAAK2P,GACxBW,EAAK3B,GAAI3O,KAAKmO,GAAK,CAACgC,EAAIC,EAAIC,IAAK,GAMjCH,EAAK,IACRA,EAAK,GAEFI,EAAK,IACRA,EAAK,GAGN,IAIIC,EAAKf,IAJGU,EAAKI,GAAM,GAMnBE,EAAI,IAAO,EAAIlR,KAAK0P,KAAKuB,GAAMA,EAAKnB,MAIpCqB,GAAU,EAAID,GAAKR,EACnBU,GAAU,EAAIF,GAAKJ,EAGnBO,EAASrR,KAAK0P,KAAKyB,GAAU,EAAIR,GAAM,GACvCW,EAAStR,KAAK0P,KAAK0B,GAAU,EAAIL,GAAM,GAKvCQ,EAAgB,IAAXJ,GAAuB,IAAPR,EAAW,EAAI3Q,KAAKyP,MAAMkB,EAAIQ,GACnDK,EAAgB,IAAXJ,GAAuB,IAAPL,EAAW,EAAI/Q,KAAKyP,MAAMsB,EAAIK,GAEnDG,EAAK,IACRA,GAAM,EAAIxB,IAEPyB,EAAK,IACRA,GAAM,EAAIzB,IAGXwB,GAAMvB,GACNwB,GAAMxB,GAGN,IAOI,EAPA,EAAKa,EAAKJ,EACV,EAAKa,EAASD,EAGdI,EAAQD,EAAKD,EACbG,EAAOH,EAAKC,EACZG,EAAO3R,KAAKE,IAAIuR,GAGhBJ,EAASC,IAAW,EACvB,EAAK,EAEGK,GAAQ,IAChB,EAAKF,EAEGA,EAAQ,IAChB,EAAKA,EAAQ,IAELA,GAAQ,IAChB,EAAKA,EAAQ,IAGbjL,GAASQ,KAAK,gCAIf,IAUI4K,EAVA,EAAK,EAAI5R,KAAK0P,KAAK4B,EAASD,GAAUrR,KAAK6P,IAAK,EAAKI,GAAO,GAG5D4B,GAASpB,EAAKI,GAAM,EACpBiB,GAAST,EAASC,GAAU,EAC5BS,EAAS7B,GAAK4B,GAOjBF,EADGP,EAASC,IAAW,EACfI,EAEAC,GAAQ,IACRD,EAAO,EAEPA,EAAO,KACNA,EAAO,KAAO,GAGdA,EAAO,KAAO,EAQxB,IAAIM,GAAOH,EAAQ,KAAO,EACtBI,EAAK,EAAK,KAAQD,EAAOhS,KAAK0P,KAAK,GAAKsC,GAGxCE,EAAK,EAAI,KAAQJ,EAGjBK,EAAI,EACRA,GAAK,IAAOnS,KAAK4P,KAAKgC,EAAQ,IAAM3B,IACpCkC,GAAK,IAAOnS,KAAK4P,IAAI,EAAIgC,EAAQ3B,IACjCkC,GAAK,IAAOnS,KAAK4P,KAAK,EAAIgC,EAAQ,GAAK3B,IACvCkC,GAAK,GAAMnS,KAAK4P,KAAK,EAAIgC,EAAQ,IAAM3B,IAIvC,IAAImC,EAAK,EAAI,KAAQN,EAAQK,EAMzB,EAAK,GAAKnS,KAAKsB,SAAWsQ,EAAQ,KAAO,KAAO,GAChDS,EAAK,EAAIrS,KAAK0P,KAAKqC,GAAUA,EAASjC,KAItCwC,GAAM,GAAMhC,EAAK2B,KAAQ,EAI7B,OAHAK,IAAO,GAAM/B,EAAK2B,KAAQ,EAC1BI,IAAO,GAAM9B,EAAK4B,KAAQ,EAC1BE,IANS,EAAKtS,KAAK6P,IAAI,EAAI,EAAKI,IAAOoC,GAM3B,GAAM9B,EAAK2B,KAAQ,GAAM1B,EAAK4B,IACnCpS,KAAK0P,KAAK4C,EAElB,CC9KA,MAAMC,GAAa,CAClB,CAAE,iBAAoB,mBAAoB,mBAC1C,CAAE,kBAAoB,kBAAqB,mBAC3C,CAAE,kBAAoB,kBAAqB,oBAKtCC,GAAa,CAClB,CAAG,oBAAoB,kBAAsB,mBAC7C,EAAE,kBAAsB,mBAAoB,mBAC5C,EAAE,mBAAqB,kBAAsB,qBAIjCC,GAAa,CACzB,CAAE,iBAAqB,mBAAoB,mBAC3C,CAAE,oBAAoB,iBAAsB,kBAC5C,CAAE,kBAAqB,mBAAoB,oBAK/BC,GAAa,CACzB,CAAE,EAAqB,kBAAqB,mBAC5C,CAAE,GAAoB,mBAAqB,mBAC3C,CAAE,GAAoB,mBAAqB,qBAG5CC,GAAe,IAAIrJ,GAAW,CAC7B3E,GAAI,QACJ/G,KAAM,QACNuG,OAAQ,CACPpG,EAAG,CACF+E,SAAU,CAAC,EAAG,GACdlF,KAAM,aAEPE,EAAG,CACFgF,SAAU,EAAC,GAAM,KAElBxE,EAAG,CACFwE,SAAU,EAAC,GAAM,MAKnBuI,MAAO,MACPhK,KAAMyM,GACN,QAAA3C,CAAU9E,GAET,IAAIuM,EAAMhU,GAAiByH,EAAKkM,IAOhC,OAJAK,EAAI,GAAK5S,KAAK+O,KAAK6D,EAAI,IACvBA,EAAI,GAAK5S,KAAK+O,KAAK6D,EAAI,IACvBA,EAAI,GAAK5S,KAAK+O,KAAK6D,EAAI,IAEhBhU,GAAiBgU,EAAKH,GAAYG,EAC1C,EACA,MAAAxH,CAAQyH,GAEP,IAAIC,EAAOlU,GAAiBiU,EAAOH,IAOnC,OAJAI,EAAK,GAAKA,EAAK,IAAM,EACrBA,EAAK,GAAKA,EAAK,IAAM,EACrBA,EAAK,GAAKA,EAAK,IAAM,EAEdlU,GAAiBkU,EAAMN,GAAYM,EAC3C,EAEAjJ,QAAS,CACRkJ,MAAO,CACN5O,OAAQ,CACP,0BACA,0BACA,+BC5EW,SAAA6O,GAAU3L,EAAOgJ,IAC9BhJ,EAAOgJ,GAAUrF,GAAS,CAAC3D,EAAOgJ,IAKnC,IAAKI,EAAIC,EAAIC,GAAMoC,GAAMrS,KAAK2G,IACzBwJ,EAAIC,EAAIC,GAAMgC,GAAMrS,KAAK2P,GAC1B,EAAKI,EAAKI,EACV,EAAKH,EAAKI,EACV,EAAKH,EAAKI,EACd,OAAO/Q,KAAK0P,KAAK,GAAM,EAAI,GAAM,EAAI,GAAM,EAC5C,CCRe,SAAS/D,GAAStE,EAAOtD,GAAOmI,QAAEA,EATvC,OASuD,IAChE7E,EAAQ2D,GAAS3D,GAEZtD,IACJA,EAAQsD,EAAMtD,OAGfA,EAAQuF,GAAWhH,IAAIyB,GACvB,IAAII,EAASkD,EAAMlD,OAMnB,OAJIJ,IAAUsD,EAAMtD,QACnBI,EAASJ,EAAMrD,KAAK2G,IAGdtD,EAAM4H,QAAQxH,EAAQ,CAAE+H,WAChC,CCvBe,SAAS+G,GAAO5L,GAC9B,MAAO,CACNtD,MAAOsD,EAAMtD,MACbI,OAA+BkD,EAAMlD,OAAOkE,QAC5C0B,MAAO1C,EAAM0C,MAEf,CCCA,MACMkG,GADIjQ,KAAK2K,GACC,ICThBuI,GAAe,IAAI5J,GAAW,CAK7B3E,GAAI,cACJgF,MAAO,gBACP/L,KAAM,mBACNuG,OAAQ,CACP9G,EAAG,CACFyF,SAAU,CAAC,EAAG,QACdlF,KAAM,MAEPK,EAAG,CACF6E,SAAU,CAAC,EAAG,KACdlF,KAAM,MAEPoB,EAAG,CACF8D,SAAU,CAAC,EAAG,SACdlF,KAAM,OAIRyD,KAAMyM,GACN3C,SAAU9E,GAIFA,EAAIjC,IAAInH,GA9BN,IA8BWA,GAErBmO,OAAQ+H,GAEAA,EAAO/O,IAAInH,GAAKA,EAlCd,OCILqB,GAAI,KACJH,GAAI,IACJnB,GAAI,KAAO,MACXoW,GAAO,MAAU,KACjBC,GAAK,SACLC,GAAK,KAAO,IACZC,GAAK,QACLnW,GAAK,IAAM,KAAQ,GACnBoW,GAAO,IAAU,IAAM,MACvB3V,IAAI,IACJ4V,GAAK,sBAILC,GAAc,CACnB,CAAG,UAAY,QAAW,SAC1B,EAAE,OAAa,SAAW,UAC1B,EAAE,SAAa,MAAW,WAKrBC,GAAc,CACnB,CAAG,oBAAqB,mBAAsB,kBAC9C,CAAG,mBAAsB,mBAAoB,oBAC7C,EAAE,oBAAsB,kBAAsB,qBAIzCC,GAAc,CACnB,CAAG,GAAW,GAAW,GACzB,CAAG,OAAU,SAAY,SACzB,CAAG,QAAW,UAAU,WAKnBC,GAAc,CACnB,CAAE,EAAqB,mBAAuB,oBAC9C,CAAE,GAAoB,mBAAuB,qBAC7C,CAAE,GAAoB,oBAAuB,mBAG9CC,GAAe,IAAIxK,GAAW,CAC7B3E,GAAI,SACJ/G,KAAM,SACNuG,OAAQ,CACP4P,GAAI,CACHjR,SAAU,CAAC,EAAG,GACdlF,KAAM,MAEPoW,GAAI,CACHlR,SAAU,EAAC,IAAO,MAEnBmR,GAAI,CACHnR,SAAU,EAAC,IAAO,OAIpBzB,KAAM6R,GACN,QAAA/H,CAAU9E,GAMT,IAAK6N,EAAIC,EAAIC,GAAM/N,EAUfgO,EAHMzV,GAAiB,CAJlBN,GAAI4V,GAAM5V,GAAI,GAAK8V,EACnBjW,GAAIgW,GAAMhW,GAAI,GAAK+V,EAGQE,GAAKV,IAIpCtP,IAAI,SAAUpD,GACjB,IAAIsT,EAAMjB,GAAKC,GAAKlS,GAAKJ,EAAM,IAAOhE,IAClCuX,EAAQ,EAAIhB,GAAKnS,GAAKJ,EAAM,IAAOhE,IAEvC,OAAOoE,GAAKkT,EAAMC,EAAOnX,GAC1B,IAIIoX,EAAIR,EAAIC,GAAMrV,GAAiByV,EAAOT,IAI3C,MAAO,EADI,EAAI/V,IAAK2W,GAAO,EAAI3W,GAAI2W,GAAMf,GAC7BO,EAAIC,EACjB,EACA,MAAA7I,CAAQ0I,GACP,IAAKW,EAAIT,EAAIC,GAAMH,EAOflB,EAHQhU,GAAiB,EAHnB6V,EAAKhB,KAAO,EAAI5V,GAAIA,IAAK4W,EAAKhB,KAGNO,EAAIC,GAAKJ,IAIpCzP,IAAI,SAAUpD,GACnB,IAAIsT,EAAMjB,GAAKjS,GAAKJ,EAAKwS,IACrBe,EAAQhB,GAAKnS,GAAKJ,EAAKwS,IAAQF,GAGnC,OAFQ,IAAQlS,GAAKkT,EAAMC,EAAOnB,GAGnC,IAIIsB,EAAIC,EAAIP,GAAMxV,GAAiBgU,EAAKe,IAGrCO,GAAMQ,GAAMpW,GAAI,GAAK8V,GAAM9V,GAE/B,MAAO,CAAC4V,GADES,GAAMxW,GAAI,GAAK+V,GAAM/V,GACfiW,EACjB,EAEAvK,QAAS,CAER+K,OAAQ,CACPzQ,OAAQ,CACP,0BACA,0BACA,+BChIJ0Q,GAAe,IAAIvL,GAAW,CAC7B3E,GAAI,SACJ/G,KAAM,SACNuG,OAAQ,CACP4P,GAAI,CACHjR,SAAU,CAAC,EAAG,GACdlF,KAAM,MAEPkX,GAAI,CACHhS,SAAU,CAAC,EAAG,KACdlF,KAAM,UAEPmX,GAAI,CACHjS,SAAU,CAAC,EAAG,KACd3D,KAAM,QACNvB,KAAM,QAIRyD,KAAMyS,GACN3I,SAAUkE,GAAIlE,SACdC,OAAQiE,GAAIjE,OAEZvB,QAAS,CAERgL,OAAQ,CACP1Q,OAAQ,CAAC,0BAA2B,0BAA2B,0BCxB5DkP,GAAK,SACLC,GAAK,KAAO,IACZC,GAAK,QACLyB,GAAK,KAAO,MAEZC,GAAM,MAAQ,KACdC,GAAM,GAAK,KAMX3C,GAAa,CAClB,CAAG,kBAAqB,mBAAoB,kBAC5C,EAAE,kBAAsB,kBAAqB,mBAC7C,CAAG,kBAAqB,kBAAqB,oBAmBxC4C,GAAa,CAClB,CAAG,GAAe,GAAmB,GACrC,CAAG,KAAO,MAAM,MAAS,KAAO,KAAO,MACvC,CAAE,MAAQ,MAAM,MAAS,UAAc,OAMlCC,GAAa,CAClB,CAAE,kBAAqB,kBAAqB,kBAC5C,CAAE,mBAAoB,mBAAqB,mBAC3C,CAAE,kBAAqB,mBAAoB,oBAYtC5C,GAAa,CAClB,CAAG,oBAAoB,mBAAsB,mBAC7C,CAAG,kBAAqB,mBAAoB,mBAC5C,EAAE,mBAAqB,kBAAsB,qBAU9C6C,GAAe,IAAI/L,GAAW,CAC7B3E,GAAI,QACJ/G,KAAM,QAUNuG,OAAQ,CACP7H,EAAG,CACFwG,SAAU,CAAC,EAAG,GACdlF,KAAM,KAEP0X,GAAI,CACHxS,SAAU,EAAC,GAAM,IACjBlF,KAAM,MAEP2X,GAAI,CACHzS,SAAU,EAAC,GAAM,IACjBlF,KAAM,OAIRyD,KAAM6R,GACN/H,SAAU9E,IAIT,OAwBmBuM,EA1BThU,GAAiByH,EAAKkM,IAuC1B3T,GATNgU,EAAIxO,IAAI,SAAUpD,GAIjB,QAHUqS,GAAKC,IAAMtS,EAAM,MAAUgU,KACzB,EAAIzB,IAAMvS,EAAM,MAAUgU,MAjI9B,QAoIT,GAI8BG,IAbhC,IAAqBvC,CAvBpB,EACA,MAAAxH,CAAQoK,GACP,IAAI5C,EA0CN,SAAqB4C,GAYpB,OAXY5W,GAAiB4W,EAAOJ,IAI7BhR,IAAI,SAAUpD,GAGnB,OAAO,KAFGhB,KAAKiB,IAAID,GAAOkU,GAAM7B,GAAI,IACxBC,GAAKC,GAAKvS,GAAOkU,MACGD,EACjC,EAIF,CAvDYQ,CAAWD,GAErB,OAAO5W,GAAiBgU,EAAKJ,GAC9B,EAEA3I,QAAS,CACRwL,MAAO,CACNlR,OAAQ,CACP,0BACA,0BACA,+BC7GEkH,GAAQvF,GAAOE,IAEf0P,GAAiB,EADH,IAEdC,GAAM,EAAI3V,KAAK2K,GAIfiL,GAAQ,CACb,CAAG,QAAW,SAAU,SACxB,EAAE,QAAY,SAAW,SACzB,EAAE,QAAY,QAAW,UAIpBC,GAAW,CAChB,CAAC,oBAAoB,mBAAqB,oBAC1C,CAAC,mBAAqB,mBAAoB,qBAC1C,EAAC,qBAAuB,mBAAsB,qBAIzCb,GAAK,CACV,CAAC,IAAO,IAAO,KACf,CAAC,KAAO,KAAQ,KAChB,CAAC,KAAO,KAAQ,OAGXc,GAAc,CACnBC,KAAM,CAAC,GAAK,KAAO,IACnBC,IAAK,CAAC,GAAK,IAAM,IACjBC,QAAS,CAAC,EAAG,IAAM,IAGdC,GAAa,CAElBvZ,EAAG,CAAC,MAAO,GAAM,OAAQ,OAAQ,QACjCO,EAAG,CAAC,GAAK,GAAK,EAAK,IAAK,IACxBiZ,EAAG,CAAC,EAAK,IAAO,IAAO,IAAO,MAGzBC,GAAU,IAAMpW,KAAK2K,GACrB0L,GAAUrW,KAAK2K,GAAK,IAOnB,SAASzE,GAAO/B,EAAQmS,GAO9B,OALCnS,EAAOC,IAAIrH,IACV,MAAMM,EAAI+D,GAAKkV,EAAKtW,KAAKE,IAAInD,GAAK,IAlDjB,KAmDjB,OAAQ,IAAMmE,GAAS7D,EAAGN,IAAOM,EAAI,QAIxC,CAwDO,SAASkZ,GACfC,EACAC,EACAC,EACAC,EACAC,GAEA,MAAMhR,EAAM,CAAA,EAEZA,EAAIgR,YAAcA,EAClBhR,EAAI4Q,SAAWA,EACf5Q,EAAI+Q,SAAWA,EACf,MAAME,EACLL,EAASpS,IAAIrH,GACD,IAAJA,GAKT6I,EAAIkR,GAAKL,EAET7Q,EAAImR,GAAKL,EAET,MAAMM,EAAKH,EAAK,GAGVI,EAAOrY,GAAiBiY,EAAMjB,IAGpC,IAAI1R,EAAS4R,GAAYlQ,EAAI+Q,UAC7B,MAAM9Z,EAAIqH,EAAO,GACjB0B,EAAI7I,EAAImH,EAAO,GACf0B,EAAIsR,GAAKhT,EAAO,GAEhB,MACMiT,GADI,GAAK,EAAIvR,EAAIkR,GAAK,KACZ,EAGhBlR,EAAI0Q,GAAKa,EAAKvR,EAAIkR,GAAK,IAAO,EAAIK,IAAO,EAAIA,GAAMnX,KAAK+O,KAAK,EAAInJ,EAAIkR,IACrElR,EAAIwR,OAASxR,EAAI0Q,IAAM,IAEvB1Q,EAAI5I,EAAI4I,EAAImR,GAAKC,EACjBpR,EAAI5G,EAAI,KAAOgB,KAAK0P,KAAK9J,EAAI5I,GAC7B4I,EAAIyR,IAAM,KAAQzR,EAAI5I,IAAK,GAC3B4I,EAAI0R,IAAM1R,EAAIyR,IAId,MAAMxZ,EAEHmC,KAAKiB,IAAIjB,KAAKe,IAAIlE,GAAK,EAAK,EAAI,IAAOmD,KAAKsB,MAAMsE,EAAIkR,GAAK,IAAM,KAAM,GAAI,GAC9ElR,EAAI2R,KACHN,EAAK7S,IAAIrH,GACDsD,GAAY,EAAG2W,EAAKja,EAAGc,IAGhC+H,EAAI4R,QACH5R,EAAI2R,KAAKnT,IAAIrH,GACL,EAAIA,GAKb,MAKM0a,EAAQvR,GAJb+Q,EAAK7S,IAAI,CAACrH,EAAGT,IACLS,EAAI6I,EAAI2R,KAAKjb,IAGKsJ,EAAI0Q,IAK/B,OAJA1Q,EAAI8R,GAAK9R,EAAIyR,KAAO,EAAII,EAAM,GAAKA,EAAM,GAAK,IAAOA,EAAM,IAIpD7R,CACR,CAGA,MAAM+R,GAAoBpB,GAAYlL,GAAQ,GAAKrL,KAAK2K,GAAM,GAAK,GAAI,WAAW,GAO3E,SAASiN,GAAWC,EAAOjS,GAIjC,UAAmB,IAAZiS,EAAMC,OAAgC,IAAZD,EAAME,GACtC,MAAM,IAAIxZ,MAAM,oDAIjB,UAAmB,IAAZsZ,EAAMlI,OAAgC,IAAZkI,EAAMtR,OAAgC,IAAZsR,EAAMnb,GAChE,MAAM,IAAI6B,MAAM,yDAKjB,UAAmB,IAAZsZ,EAAMlb,OAAgC,IAAZkb,EAAM1B,GACtC,MAAM,IAAI5X,MAAM,oDAIjB,GAAgB,IAAZsZ,EAAMC,GAAyB,IAAZD,EAAME,EAC5B,MAAO,CAAC,EAAK,EAAK,GAInB,IAAIC,EAAO,EAEVA,OADe,IAAZH,EAAMlb,EACFwS,GAAU0I,EAAMlb,GAAK0Z,GAjIvB,SAA2BF,GACjC,IAAI8B,GAAO9B,EAAI,IAAO,KAAO,IAC7B,MAAM7Z,EAAI0D,KAAKI,MAAM,IAAO6X,GAC5BA,GAAU,IACV,MAAOC,EAAIC,GAAOjC,GAAWvZ,EAAE0L,MAAM/L,EAAGA,EAAI,IACrC8b,EAAIC,GAAOnC,GAAWhZ,EAAEmL,MAAM/L,EAAGA,EAAI,GAE5C,OAAO6S,IAAW8I,GAAMI,EAAMH,EAAKE,EAAKD,GAAO,IAAMD,EAAKG,IAAQJ,GAAMI,EAAMD,GAAM,IAAMC,GAC3F,CA4HSC,CAAiBT,EAAM1B,GAAKE,GAGpC,MAAMkC,EAAOvY,KAAK4P,IAAIoI,GAChBQ,EAAOxY,KAAK6P,IAAImI,GAGtB,IAAIS,EAAQ,OACI,IAAZZ,EAAMC,EACTW,EAA+B,GAAvBrX,GAAKyW,EAAMC,EAAG,SAEF,IAAZD,EAAME,IACdU,EAAS,IAAO7S,EAAI7I,EAAI8a,EAAME,IAAOnS,EAAI8R,GAAK,GAAK9R,EAAIwR,SAIxD,IAAIrN,EAAQ,OACI,IAAZ8N,EAAMlI,EACT5F,EAAQ8N,EAAMlI,EAAI8I,OAEE,IAAZZ,EAAMtR,EACdwD,EAAQ8N,EAAMtR,EAAIX,EAAIwR,OAASqB,OAEX,IAAZZ,EAAMnb,IACdqN,EAAS,KAAS8N,EAAMnb,GAAK,GAAKkJ,EAAI8R,GAAK,GAAM9R,EAAI7I,GAEtD,MAAMN,EAAI2E,GAAK2I,EAAQ/J,KAAKkP,IAAI,KAAOlP,KAAKkP,IAAI,IAAMtJ,EAAI5I,IAAI,KAAQ,GAAK,GAGrE0b,EAAK,KAAQ1Y,KAAK4P,IAAIoI,EAAO,GAAK,KAGlCW,EAAI/S,EAAI8R,GAAKtW,GAAKqX,EAAO,EAAI7S,EAAI7I,EAAI6I,EAAI5G,GAGzC4Z,EAAM,IAAM,GAAMhT,EAAIsR,GAAKtR,EAAI0R,IAAMoB,EACrCG,EAAKF,EAAI/S,EAAIyR,IACbza,EAAI,IAAMic,EAAK,MAAStX,GAAK9E,EAAG,GAAKmc,EAAKnc,GAAK,GAAK8b,EAAO,IAAMC,IAKjEM,EA7MA,SAAkBC,EAASzC,GACjC,MAAM0C,EAAY,IAAM1C,EAAM,kBAC9B,OACCyC,EAAQ3U,IAAIrH,IACX,MAAMkc,EAAOjZ,KAAKE,IAAInD,GACtB,OAAOmE,GAAS8X,EAAW5X,GAAK6X,GAAQ,IAAMA,GAAOvD,IAAiB3Y,IAGzE,CAqMemc,CAGZta,GAAiB,CAACia,EAPVjc,EAAI2b,EACJ3b,EAAI4b,GAMiBxD,IAAI5Q,IAAIrH,GACxB,EAAJA,EAAS,MAGnB6I,EAAI0Q,IAEL,OACC1X,GAEEka,EAAM1U,IAAI,CAACrH,EAAGT,IACNS,EAAI6I,EAAI4R,QAAQlb,IAGzBuZ,IACCzR,IAAIrH,GACEA,EAAI,IAGd,CAOO,SAASoc,GAASC,EAAQxT,GAEhC,MAKMyT,EAAOnT,GAGXtH,GAPDwa,EAAOhV,IAAIrH,GACC,IAAJA,GAMkB6Y,IAAOxR,IAAI,CAACrH,EAAGT,IAChCS,EAAI6I,EAAI2R,KAAKjb,IAGtBsJ,EAAI0Q,IAICxY,EAAIub,EAAK,KAAM,GAAMA,EAAK,GAAKA,EAAK,IAAM,GAC1C/a,GAAK+a,EAAK,GAAKA,EAAK,GAAK,EAAIA,EAAK,IAAM,EACxCrB,GAAShY,KAAKyP,MAAMnR,EAAGR,GAAK6X,GAAOA,IAAOA,GAG1C+C,EAAK,KAAQ1Y,KAAK4P,IAAIoI,EAAO,GAAK,KAOlCjO,EAAQ3I,GAJZ,IAAM,GACPwE,EAAIsR,GACJtR,EAAI0R,IACJ/V,GAAKmX,EAAK1Y,KAAK0P,KAAK5R,GAAK,EAAIQ,GAAK,GAAI+a,EAAK,GAAKA,EAAK,GAAK,KAAOA,EAAK,GAAK,MACtD,IAAOrZ,KAAKkP,IAAI,KAAOlP,KAAKkP,IAAI,IAAMtJ,EAAI5I,GAAI,KAK9Dyb,EAAQrX,GAFJwE,EAAIyR,KAAO,EAAIgC,EAAK,GAAKA,EAAK,GAAK,IAAOA,EAAK,IAElCzT,EAAI8R,GAAI,GAAM9R,EAAI7I,EAAI6I,EAAI5G,GAG3C8Y,EAAI,IAAM1W,GAAKqX,EAAO,GAGtBV,EAAK,EAAInS,EAAI7I,EAAK0b,GAAS7S,EAAI8R,GAAK,GAAK9R,EAAIwR,OAG7CzH,EAAI5F,EAAQ0O,EAGZlS,EAAIoJ,EAAI/J,EAAIwR,OAGZza,EAAIwS,GAAU6I,EAAO5B,IAGrBD,EAjRA,SAAwBxZ,GAC9B,IAAI2c,EAAKnK,GAAUxS,GACf2c,GAAMpD,GAAWvZ,EAAE,KACtB2c,GAAM,KAGP,MAAMhd,E7B0EA,SAAqBid,EAAK3Y,EAAO4Y,EAAK,EAAGtB,EAAKqB,EAAIjR,QACxD,KAAOkR,EAAKtB,GAAI,CACf,MAAMuB,EAAOD,EAAKtB,GAAO,EACrBqB,EAAIE,GAAO7Y,EACd4Y,EAAKC,EAAM,EAGXvB,EAAKuB,CAEP,CACA,OAAOD,CACR,C6BrFWE,CAAWxD,GAAWvZ,EAAG2c,GAAM,GAClCpB,EAAIC,GAAOjC,GAAWvZ,EAAE0L,MAAM/L,EAAGA,EAAI,IACrC8b,EAAIC,GAAOnC,GAAWhZ,EAAEmL,MAAM/L,EAAGA,EAAI,GAGtCG,GAAK6c,EAAKpB,GAAME,EACtB,OAHWlC,GAAWC,EAAE7Z,GAGX,IAAMG,GAAMA,GAAK0b,EAAMmB,GAAMjB,EAC3C,CAoQWsB,CAAchd,GAOxB,MAAO,CAAEmb,IAAMnI,IAAMhT,EAAGA,EAAGD,EAJjB,GAAK0E,GAAMwE,EAAI7I,EAAIgN,GAAUnE,EAAI8R,GAAK,GAAI,IAInBK,IAAMxR,IAAM4P,IAC9C,CAQe,IAAI7M,GAAW,CAC7B3E,GAAI,YACJgF,MAAO,cACP/L,KAAM,YACNuG,OAAQ,CACPyV,EAAG,CACF9W,SAAU,CAAC,EAAG,KACdlF,KAAM,KAEPic,EAAG,CACF/W,SAAU,CAAC,EAAG,KACdlF,KAAM,gBAEPjB,EAAG,CACFmG,SAAU,CAAC,EAAG,KACd3D,KAAM,QACNvB,KAAM,QAIRyD,KAAMuM,GAEN,QAAAzC,CAAU+C,QAEM,IAAX3Q,KAAK,IACRA,KAAK,EAAI6B,OAAO8E,OAAO3G,KAAK4G,QAAQ,GAAGrB,SAAS,GAAK,KAEtD,MAAM+U,EAAQsB,GAAQjL,EAAKyJ,IACrBpI,EAAevP,KAAKE,IAAI2X,EAAMtR,GAAKhJ,KAAK,EAC9C,MAAO,CAACsa,EAAMC,EAAGvI,EAAe,EAAIsI,EAAMtR,EAAGgJ,EAAe,KAAOsI,EAAMlb,EAC1E,EACAyO,OAAQyM,GACAD,GAAU,CAAEE,EAAGD,EAAM,GAAItR,EAAGsR,EAAM,GAAIlb,EAAGkb,EAAM,IAAMF,MCpZ9D,MACMjJ,GAAI,IAAM,MACVE,GAAI,MAAQ,GASlB,SAASkL,GAAWC,GAGnB,OAAOA,EAAQ,EAAI/Z,KAAKkP,KAAK6K,EAAQ,IAAM,IAAK,GAAKA,EAAQnL,EAC9D,CAsFO,MAAM+I,GAAoBpB,GArGnBzQ,GAAOE,IAuGnB,IAAMhG,KAAK2K,GAAMmP,GAAU,IACV,IAAlBA,GAAU,IACV,WACA,GAYDE,GAAe,IAAI1Q,GAAW,CAC7B3E,GAAI,MACJ/G,KAAM,MACNuG,OAAQ,CACPxH,EAAG,CACFmG,SAAU,CAAC,EAAG,KACd3D,KAAM,QACNvB,KAAM,OAEPb,EAAG,CACF+F,SAAU,CAAC,EAAG,KACdlF,KAAM,gBAEPnB,EAAG,CACFqG,SAAU,CAAC,EAAG,KACdlF,KAAM,SAIRyD,KAAMuM,GAEN,QAAAzC,CAAU+C,QACM,IAAX3Q,KAAK,IACRA,KAAK,EAAI6B,OAAO8E,OAAO3G,KAAK4G,QAAQ,GAAGrB,SAAS,GAAK,KAEtD,IAAIkX,EAtDN,SAAgB9L,GAGf,MAAMzR,EApFC,MAJUwB,EAwFCiQ,EAAI,IArFPQ,GAAI1O,KAAK+O,KAAK9Q,IAAM2Q,GAAI3Q,EAAI,IAAM,KAC7B,GAJrB,IAAkBA,EAyFjB,GAAU,IAANxB,EACH,MAAO,CAAC,EAAK,EAAK,GAEnB,MAAMob,EAAQsB,GAAQjL,EAAKyJ,IAC3B,MAAO,CAACxI,GAAU0I,EAAMlb,GAAIkb,EAAMlI,EAAGlT,EACtC,CA6CYwd,CAAM/L,GAKhB,OAJI8L,EAAI,GAAKzc,KAAK,IACjByc,EAAI,GAAK,EACTA,EAAI,GAAK,MAEHA,CACR,EACA5O,OAAQ4O,GArIT,SAAkB7V,EAAQyB,GASzB,IAAKjJ,EAAGI,EAAGN,GAAK0H,EACZ+J,EAAM,GACN0L,EAAI,EAGR,GAAU,IAANnd,EACH,MAAO,CAAC,EAAK,EAAK,GAInB,IAAIwB,EAAI6b,GAAUrd,GAKjBmd,EADGnd,EAAI,EACH,mBAAsBA,GAAK,EAAI,iBAAoBA,EAAI,kBAGvD,qBAAuBA,GAAK,EAAI,mBAAsBA,EAAI,mBAW/D,IAAIyd,EAAU,EACVC,EAAOC,IAIX,KAAOF,GAPc,IAOW,CAC/BhM,EAAM0J,GAAU,CAAEE,EAAG8B,EAAGjK,EAAG5S,EAAGJ,EAAGA,GAAKiJ,GAItC,MAAMyU,EAAQra,KAAKE,IAAIgO,EAAI,GAAKjQ,GAChC,GAAIoc,EAAQF,EAAM,CACjB,GAAIE,GAfY,MAgBf,OAAOnM,EAGRiM,EAAOE,CACR,CAOAT,IAAU1L,EAAI,GAAKjQ,GAAK2b,GAAM,EAAI1L,EAAI,IAEtCgM,GAAW,CACZ,CAIA,OAAOtC,GAAU,CAAEE,EAAG8B,EAAGjK,EAAG5S,EAAGJ,EAAGA,GAAKiJ,EACxC,CAgES0U,CAAQN,EAAKrC,IAErB9N,QAAS,CACRxC,MAAO,CACN1C,GAAI,QACJR,OAAQ,CAAC,qBAAsB,0BAA2B,+BC3JvDkS,GAAUrW,KAAK2K,GAAK,IACpB4P,GAAW,CAAC,EAAK,KAAO,OAO9B,SAASC,GAAcrW,GAMlBA,EAAO,GAAK,IACfA,EAAS6V,GAAI7O,SAAS6O,GAAI5O,OAAOjH,KAMlC,MAAMoC,EACLvG,KAAKya,IAAIza,KAAKiB,IAAI,EAAIsZ,GAAS,GAAKpW,EAAO,GAAKwT,GAAkBP,OAAQ,IAC1EmD,GAAS,GACJG,EAAOvW,EAAO,GAAKkS,GACnBvY,EAAIyI,EAAIvG,KAAK4P,IAAI8K,GACjBpc,EAAIiI,EAAIvG,KAAK6P,IAAI6K,GAEvB,MAAO,CAACvW,EAAO,GAAIrG,EAAGQ,EACvB,CCrBA,MAAAqc,GAAe,CACdC,SCRc,SAAmBvT,EAAOgJ,GAExC,OCEc,SAAmBwK,EAAQC,EAAQ/W,EAAQ,OAIzD,IAAIgX,GAHJhX,EAAQuF,GAAWhH,IAAIyB,IAGHrD,KAAKma,GACrBG,EAAUjX,EAAMrD,KAAKoa,GAEzB,OAAO9a,KAAK0P,KACXqL,EAAQE,OAAO,CAACC,EAAK7H,EAAI/W,KACxB,IAAIgX,EAAK0H,EAAQ1e,GACjB,OAAIsD,GAAOyT,IAAOzT,GAAO0T,GACjB4H,EAGDA,GAAO5H,EAAKD,IAAO,GACxB,GAEL,CDnBQ8H,CAAS9T,EAAOgJ,EAAQ,MAChC,EDMC+K,URKc,SAAU/T,EAAOgJ,GAAUtS,EAAAA,EAAI,EAAGhB,EAAAA,EAAI,GAAM,KACzDsK,EAAOgJ,GAAUrF,GAAS,CAAC3D,EAAOgJ,IAUnC,IAAKI,EAAIC,EAAIC,GAAM9B,GAAInO,KAAK2G,KACrBuJ,EAAIyK,GAAMhM,GAAI3O,KAAKmO,GAAK,CAAC4B,EAAIC,EAAIC,KACnCE,EAAIC,EAAIC,GAAMlC,GAAInO,KAAK2P,GACxBW,EAAK3B,GAAI3O,KAAKmO,GAAK,CAACgC,EAAIC,EAAIC,IAAK,GAYjCH,EAAK,IACRA,EAAK,GAEFI,EAAK,IACRA,EAAK,GAON,IAAI,EAAKP,EAAKI,EACV,EAAKD,EAAKI,EAOVsK,GALK5K,EAAKI,IAKC,GAJNH,EAAKI,IAIW,EAAI,GAAM,EAmB/BkB,EAAK,KACLxB,GAAM,KAETwB,EAAM,QAAWxB,GAAO,EAAI,OAAUA,IAIvC,IAGI0B,EAHAD,EAAM,MAAStB,GAAO,EAAI,MAASA,GAAM,KAIzChR,GAAOyb,KACVA,EAAK,GAILlJ,EADGkJ,GAAM,KAAOA,GAAM,IAClB,IAAOrb,KAAKE,IAAI,GAAMF,KAAK4P,KAAKyL,EAAK,KAAOpL,KAG5C,IAAOjQ,KAAKE,IAAI,GAAMF,KAAK4P,KAAKyL,EAAK,IAAMpL,KAKhD,IAAIsL,EAAKvb,KAAKkP,IAAI0B,EAAI,GAClB4K,EAAIxb,KAAK0P,KAAK6L,GAAMA,EAAK,OAIzBjJ,GAAM,GAAMvU,EAAIkU,KAAQ,EAI5B,OAHAK,IAAO,GAAMvV,EAAImV,KAAQ,EACzBI,GAAMgJ,GALGpJ,GAAMsJ,EAAIrJ,EAAI,EAAIqJ,KAKV,EAEVxb,KAAK0P,KAAK4C,EAElB,EQvGClC,cACAqL,SGJc,SAAUpU,EAAOgJ,IAC9BhJ,EAAOgJ,GAAUrF,GAAS,CAAC3D,EAAOgJ,IAKnC,IAAKqL,EAAKC,EAAKC,GAAO/G,GAAOnU,KAAK2G,IAC7BwU,EAAKC,EAAKC,GAAOlH,GAAOnU,KAAK2P,GAI9B,EAAKqL,EAAMG,EACX,EAAKF,EAAMG,EAGXlc,GAAOgc,IAAQhc,GAAOmc,IAEzBH,EAAM,EACNG,EAAM,GAEEnc,GAAOgc,GAEfA,EAAMG,EAEEnc,GAAOmc,KACfA,EAAMH,GAGP,IAAI,EAAKA,EAAMG,EACX,EAAK,EAAI/b,KAAK0P,KAAKiM,EAAMG,GAAO9b,KAAK6P,IAAK,EAAK,GAAM7P,KAAK2K,GAAK,MAEnE,OAAO3K,KAAK0P,KAAK,GAAM,EAAI,GAAM,EAAI,GAAM,EAC5C,EH3BCsM,UITc,SAAU3U,EAAOgJ,IAC9BhJ,EAAOgJ,GAAUrF,GAAS,CAAC3D,EAAOgJ,IAOnC,IAAK4L,EAAIC,EAAIC,GAAM9G,GAAM3U,KAAK2G,IACzB+U,EAAIC,EAAIC,GAAMjH,GAAM3U,KAAK2P,GAM9B,OAAO,IAAMrQ,KAAK0P,MAAMuM,EAAKG,IAAO,EAAI,KAAQF,EAAKG,IAAO,GAAKF,EAAKG,IAAO,EAC9E,EJNCtJ,YACAuJ,UKLc,SAAUlV,EAAOgJ,IAC9BhJ,EAAOgJ,GAAUrF,GAAS,CAAC3D,EAAOgJ,IAKnC,IACKI,EAAIC,EAAIC,GAAMoC,GAAMrS,KAAK2G,IACzBwJ,EAAIC,EAAIC,GAAMgC,GAAMrS,KAAK2P,GAC1B,EAAKI,EAAKI,EACV,EAJU,GAIMH,EAAKI,GACrB,EALU,GAKMH,EAAKI,GACzB,OAAO/Q,KAAK0P,KAAK,GAAM,EAAI,GAAM,EAAI,GAAM,EAC5C,ELPC8M,UDqBc,SAAUnV,EAAOgJ,IAC9BhJ,EAAOgJ,GAAUrF,GAAS,CAAC3D,EAAOgJ,IAEnC,IAAKoM,EAAI/L,EAAIC,GAAM6J,GAAaR,GAAItZ,KAAK2G,KACpCqV,EAAI5L,EAAIC,GAAMyJ,GAAaR,GAAItZ,KAAK2P,IAIzC,OAAOrQ,KAAK0P,MAAM+M,EAAKC,IAAO,GAAKhM,EAAKI,IAAO,GAAKH,EAAKI,IAAO,EACjE,GOpBM4L,GAAa,CAClB3C,IAAK,CACJ4C,OAAQ,QACRC,IAAK,EACLC,aAAc,MACdC,gBAAiB,CAAA,GAElB,YAAa,CACZH,OAAQ,QACRC,IAAK,EACLC,aAAc,MACdC,gBAAiB,CAAEC,QAAS,QAASjc,IAAK,EAAGE,IAAK,OAuBrC,SAASgc,GACvB5V,GACAuV,OACCA,EAASpW,GAASC,cAAA1C,MAClBA,EAAQ+Y,aACRA,EAAe,GAAAD,IACfA,EAAM,EAAAE,gBACNA,GACG,CAAA,GAkBJ,GAhBA1V,EAAQ2D,GAAS3D,GAEb6V,GAAc3X,UAAU,IAC3BxB,EAAQwB,UAAU,GAETxB,IACTA,EAAQsD,EAAMtD,OAUX4H,GAAQtE,EAPZtD,EAAQuF,GAAWhH,IAAIyB,GAOG,CAAEmI,QAAS,IACpC,OAAA,EAGD,IAAIiR,EACJ,GAAe,QAAXP,EACHO,EA2IK,SAAqBC,GAAQrZ,MAAEA,GAAU,CAAA,GAC/C,MAAMsZ,EAAM,IACN3O,EAAI,KAEV0O,EAASpS,GAASoS,GAEbrZ,IACJA,EAAQqZ,EAAOrZ,OAGhBA,EAAQuF,GAAWhH,IAAIyB,GACvB,MAAMuZ,EAAahU,GAAWhH,IAAI,SAElC,GAAIyB,EAAM2H,YACT,OAAO/K,GAAGyc,EAAQrZ,GAGnB,MAAMwZ,EAAe5c,GAAGyc,EAAQE,GAChC,IAAIrO,EAAIsO,EAAapZ,OAAO,GAG5B,GAAI8K,GAAK,EAAG,CACX,MAAM5D,EAAQ1K,GAAG6c,GAAOC,MAAO1Z,GAE/B,OADAsH,EAAMtB,MAAQqT,EAAOrT,MACdpJ,GAAG0K,EAAOtH,EAClB,CACA,GAAIkL,GAAK,EAAG,CACX,MAAMyO,EAAQ/c,GAAG6c,GAAOG,MAAO5Z,GAE/B,OADA2Z,EAAM3T,MAAQqT,EAAOrT,MACdpJ,GAAG+c,EAAO3Z,EAClB,CAEA,GAAI4H,GAAQ4R,EAAcxZ,EAAO,CAAEmI,QAAS,IAC3C,OAAOvL,GAAG4c,EAAcxZ,GAGzB,SAAS6Z,EAAMC,GACd,MAAMC,EAAYnd,GAAGkd,EAAQ9Z,GACvBE,EAAc7E,OAAO8E,OAAkCH,EAAOI,QAUpE,OATA2Z,EAAU3Z,OACT2Z,EAAU3Z,OAAOC,IAAI,CAACiI,EAAOqB,KAC5B,GAAI,UAAWzJ,EAAYyJ,GAAQ,CAClC,MAAO3M,EAAKE,GAAOgD,EAAYyJ,GAAO7K,MACtC,OAAOkb,GAAWhd,EAAKsL,EAAOpL,EAC/B,CACA,OAAOoL,IAGFyR,CACR,CACA,IAAI/c,EAAM,EACNE,EAAMsc,EAAapZ,OAAO,GAC1B6Z,GAAc,EACdC,EAAUhL,GAAMsK,GAChBW,EAAUN,EAAKK,GAEfzf,EAAIwU,GAASkL,EAASD,GAC1B,GAAIzf,EAAI6e,EACP,OAAOa,EAGR,KAAOjd,EAAMF,EAAM2N,GAAG,CACrB,MAAMyP,GAAUpd,EAAME,GAAO,EAE7B,GADAgd,EAAQ9Z,OAAO,GAAKga,EAChBH,GAAerS,GAAQsS,EAASla,EAAO,CAAEmI,QAAS,IACrDnL,EAAMod,OAKN,GAFAD,EAAUN,EAAKK,GACfzf,EAAIwU,GAASkL,EAASD,GAClBzf,EAAI6e,EAAK,CACZ,GAAIA,EAAM7e,EAAIkQ,EACb,MAGAsP,GAAc,EACdjd,EAAMod,CAER,MAECld,EAAMkd,CAGT,CACA,OAAOD,CACR,CAhOeE,CAAW/W,EAAO,CAAEtD,cAE7B,CACJ,GAAe,SAAX6Y,GAAsBjR,GAAQtE,EAAOtD,GA6ExCoZ,EAAaxc,GAAG0G,EAAOtD,OA7EyB,CAC5C3E,OAAOC,UAAUgf,eAAengB,KAAKye,GAAYC,MACjDA,SAAQC,MAAKC,eAAcC,mBAAoBJ,GAAWC,IAI9D,IAAI0B,EAAKlO,GACT,GAAqB,KAAjB0M,EACH,IAAA,IAASjD,KAAKc,GACb,GAAI,SAAWmC,EAAatd,gBAAkBqa,EAAEra,cAAe,CAC9D8e,EAAK3D,GAAcd,GACnB,KACD,CAIU,IAARgD,IACHA,EAAM,OAGP,IAAIqB,EAAUjB,GAAQtc,GAAG0G,EAAOtD,GAAQ,CAAE6Y,OAAQ,OAAQ7Y,UAC1D,GAAIua,EAAGjX,EAAO6W,GAAWrB,EAAK,CAE7B,GAAIE,GAA2D,IAAxC3d,OAAO0L,KAAKiS,GAAiBzU,OAAc,CACjE,IAAIiW,EAAcjV,GAAW+D,aAAa0P,EAAgBC,SACtDA,EAAU1a,GAAI3B,GAAG0G,EAAOkX,EAAYxa,OAAQwa,EAAY5Z,IAI5D,GAHI6Z,GAAYxB,KACfA,EAAU,GAEPA,GAAWD,EAAgB9b,IAC9B,OAAON,GAAG,CAAEoD,MAAO,UAAWI,OAAQ2B,GAAY,KAAKuB,EAAMtD,OAC9D,GACSiZ,GAAWD,EAAgBhc,IACnC,OAAOJ,GAAG,CAAEoD,MAAO,UAAWI,OAAQ,CAAC,EAAG,EAAG,IAAMkD,EAAMtD,MAE3D,CAGA,IAAIrB,EAAY4G,GAAW+D,aAAauP,GACpC6B,EAAW/b,EAAUqB,MACrB0J,EAAU/K,EAAUiC,GAEpB+Z,EAAc/d,GAAG0G,EAAOoX,GAE5BC,EAAYva,OAAOuB,QAAQ,CAAC3I,EAAGT,KAC1BkiB,GAAYzhB,KACf2hB,EAAYva,OAAO7H,GAAK,KAG1B,IACIyE,GADS2B,EAAUG,OAASH,EAAUI,UACzB,GACb4L,EAhIR,SAAsBmO,GAGrB,MAAM8B,EAAS9B,EAAU7c,KAAKI,MAAMJ,KAAKC,MAAMD,KAAKE,IAAI2c,KAAnC,EAErB,OAAO7c,KAAKiB,IAAI2d,WAAW,MAAKD,EAAQ,IAAM,KAC/C,CA0HYE,CAAYhC,GAChBiC,EAAM/d,EACNge,EAAOzc,GAAIoc,EAAajR,GAE5B,KAAOsR,EAAOD,EAAMpQ,GAAG,CACtB,IAAIwP,EAAUjL,GAAMyL,GACpBR,EAAUjB,GAAQiB,EAAS,CAAEna,QAAO6Y,OAAQ,SAC/B0B,EAAGI,EAAaR,GAEhBrB,EAAMnO,EAClBoQ,EAAMxc,GAAIoc,EAAajR,GAGvBsR,EAAOzc,GAAIoc,EAAajR,GAGzBlL,GAAImc,EAAajR,GAAUqR,EAAMC,GAAQ,EAC1C,CAEA5B,EAAaxc,GAAG+d,EAAa3a,EAC9B,MAECoZ,EAAae,CAEf,CAKA,GACY,SAAXtB,IAECjR,GAAQwR,EAAYpZ,EAAO,CAAEmI,QAAS,IACtC,CACD,IAAI8S,EAAS5f,OAAO8E,OAAOH,EAAMI,QAAQC,IAAIrH,GAAKA,EAAE8F,OAAS,IAE7Dsa,EAAWhZ,OACVgZ,EAAWhZ,OAAOC,IAAI,CAACrH,EAAGT,KACzB,IAAKyE,EAAKE,GAAO+d,EAAO1iB,GAUxB,YARY,IAARyE,IACHhE,EAAIiD,KAAKiB,IAAIF,EAAKhE,SAGP,IAARkE,IACHlE,EAAIiD,KAAKe,IAAIhE,EAAGkE,IAGVlE,GAGV,CACD,CAOA,OALIgH,IAAUsD,EAAMtD,QACnBoZ,EAAaxc,GAAGwc,EAAY9V,EAAMtD,QAGnCsD,EAAMlD,OAASgZ,EAAWhZ,OAC1B,CACD,CAGA8Y,GAAQzO,QAAU,QAQlB,MAAMgP,GAAS,CACdC,MAAO,CAAE1Z,MAAOgP,GAAO5O,OAAQ,CAAC,EAAG,EAAG,GAAI4F,MAAO,GACjD4T,MAAO,CAAE5Z,MAAOgP,GAAO5O,OAAQ,CAAC,EAAG,EAAG,GAAI4F,MAAO,ICrNnC,SAASpJ,GAAI0G,EAAOtD,GAAS4H,QAAAA,GAAY,CAAA,GACvDtE,EAAQ2D,GAAS3D,GAGjB,IAAIlD,GAFJJ,EAAQuF,GAAWhH,IAAIyB,IAEJrD,KAAK2G,GACpB3D,EAAM,CAAEK,QAAOI,SAAQ4F,MAAO1C,EAAM0C,OAMxC,OAJI4B,IACHjI,EAAMuZ,GAAQvZ,GAAiB,IAAZiI,OAAmB,EAAYA,IAG5CjI,CACR,CAGA/C,GAAG6N,QAAU,QClBb,MAeAyQ,GAAe,IAAIpR,GAAc,CAChClJ,GAAI,iBACJgF,MAAO,mBACP/L,KAAM,kBACNyN,MAAO,MACR0C,QApBgB,CACf,CAAE,kBAAoB,mBAAsB,mBAC5C,CAAE,kBAAoB,kBAAsB,oBAC5C,CAAE,EAAoB,oBAAsB,oBAkB7CC,UAZkB,CACjB,CAAG,mBAAoB,kBAAoB,iBAC3C,EAAE,iBAAsB,kBAAoB,mBAC5C,CAAG,kBAAoB,iBAAqB,qBClB7CkR,GAAe,IAAIrR,GAAc,CAChClJ,GAAI,UACJ/G,KAAM,WACNyD,KAAM8d,GAIN/T,OAAQgU,GACAA,EAAIhb,IAAI,SAAUpD,GACxB,IAAIG,EAAOH,EAAM,GAAI,EAAK,EACtBd,EAAMc,EAAMG,EAChB,OAAOA,EAAOnB,KAAKkP,IAAIhP,EAAK,IAC7B,GAEDiL,SAAUiU,GACFA,EAAIhb,IAAI,SAAUpD,GACxB,IAAIG,EAAOH,EAAM,GAAI,EAAK,EACtBd,EAAMc,EAAMG,EAChB,OAAOA,EAAOnB,KAAKkP,IAAIhP,EAAK,EAAI,IACjC,KCHFmf,GAAe,IAAIxR,GAAc,CAChClJ,GAAI,YACJgF,MAAO,oBACP/L,KAAM,YACNyN,MAAO,MACR0C,QAnBgB,CACf,CAAC,kBAAoB,mBAAqB,mBAC1C,CAAC,kBAAoB,kBAAqB,kBAC1C,CAAC,EAAoB,mBAAqB,oBAiB3CC,UAZkB,CACjB,CAAE,mBAAqB,mBAAqB,oBAC5C,EAAC,kBAAuB,mBAAqB,qBAC7C,CAAE,oBAAqB,mBAAsB,sBCY9CsR,GAAe,IAAIzR,GAAc,CAChClJ,GAAI,cACJ/G,KAAM,cACNyN,MAAO,MACR0C,QApBgB,CACf,CAAE,mBAAqB,iBAAqB,mBAC5C,CAAE,mBAAqB,iBAAqB,oBAC5C,CAAE,mBAAqB,mBAAqB,oBAkB7CC,UAXyB,CACxB,CAAG,oBAAqB,mBAAsB,mBAC9C,EAAE,kBAAuB,mBAAsB,oBAC/C,CAAG,oBAAqB,mBAAuB,uBChBhDuR,GAAe,CACdC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,GAClCC,aAAc,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAC3CC,KAAM,CAAC,EAAG,EAAG,GACbC,WAAY,CAAC,IAAM,IAAK,EAAG,IAAM,KACjCC,MAAO,CAAC,IAAM,IAAK,EAAG,GACtBC,MAAO,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACpCC,OAAQ,CAAC,EAAG,IAAM,IAAK,IAAM,KAC7BpC,MAAO,CAAC,EAAG,EAAG,GACdqC,eAAgB,CAAC,EAAG,IAAM,IAAK,IAAM,KACrCC,KAAM,CAAC,EAAG,EAAG,GACbC,WAAY,CAAC,IAAM,IAAK,GAAK,IAAK,IAAM,KACxCC,MAAO,CAAC,IAAM,IAAK,GAAK,IAAK,GAAK,KAClCC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACxCC,UAAW,CAAC,GAAK,IAAK,IAAM,IAAK,IAAM,KACvCC,WAAY,CAAC,IAAM,IAAK,EAAG,GAC3BC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,GAAK,KACvCC,MAAO,CAAC,EAAG,IAAM,IAAK,GAAK,KAC3BC,eAAgB,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAC7CC,SAAU,CAAC,EAAG,IAAM,IAAK,IAAM,KAC/BC,QAAS,CAAC,IAAM,IAAK,GAAK,IAAK,GAAK,KACpCC,KAAM,CAAC,EAAG,EAAG,GACbC,SAAU,CAAC,EAAG,EAAG,IAAM,KACvBC,SAAU,CAAC,EAAG,IAAM,IAAK,IAAM,KAC/BC,cAAe,CAAC,IAAM,IAAK,IAAM,IAAK,GAAK,KAC3CC,SAAU,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACvCC,UAAW,CAAC,EAAG,IAAM,IAAK,GAC1BC,SAAU,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACvCC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACxCC,YAAa,CAAC,IAAM,IAAK,EAAG,IAAM,KAClCC,eAAgB,CAAC,GAAK,IAAK,IAAM,IAAK,GAAK,KAC3CC,WAAY,CAAC,EAAG,IAAM,IAAK,GAC3BC,WAAY,CAAC,GAAW,GAAK,IAAK,IAClCC,QAAS,CAAC,IAAM,IAAK,EAAG,GACxBC,WAAY,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACzCC,aAAc,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAC3CC,cAAe,CAAC,GAAK,IAAK,GAAK,IAAK,IAAM,KAC1CC,cAAe,CAAC,GAAK,IAAK,GAAK,IAAK,GAAK,KACzCC,cAAe,CAAC,GAAK,IAAK,GAAK,IAAK,GAAK,KACzCC,cAAe,CAAC,EAAG,IAAM,IAAK,IAAM,KACpCC,WAAY,CAAC,IAAM,IAAK,EAAG,IAAM,KACjCC,SAAU,CAAC,EAAG,GAAK,IAAK,IAAM,KAC9BC,YAAa,CAAC,EAAG,IAAM,IAAK,GAC5BC,QAAS,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACtCC,QAAS,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACtCC,WAAY,CAAC,GAAK,IAAK,IAAM,IAAK,GAClCC,UAAW,CAAC,IAAM,IAAK,GAAK,IAAK,GAAK,KACtCC,YAAa,CAAC,EAAG,IAAM,IAAK,IAAM,KAClCC,YAAa,CAAC,GAAK,IAAK,IAAM,IAAK,GAAK,KACxCC,QAAS,CAAC,EAAG,EAAG,GAChBC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACxCC,WAAY,CAAC,IAAM,IAAK,IAAM,IAAK,GACnCC,KAAM,CAAC,EAAG,IAAM,IAAK,GACrBC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,GAAK,KACvCC,KAAM,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACnCC,MAAO,CAAC,EAAG,IAAM,IAAK,GACtBC,YAAa,CAAC,IAAM,IAAK,EAAG,GAAK,KACjCC,KAAM,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACnCC,SAAU,CAAC,IAAM,IAAK,EAAG,IAAM,KAC/BC,QAAS,CAAC,EAAG,IAAM,IAAK,IAAM,KAC9BC,UAAW,CAAC,IAAM,IAAK,GAAK,IAAK,GAAK,KACtCC,OAAQ,CAAC,GAAK,IAAK,EAAG,IAAM,KAC5BC,MAAO,CAAC,EAAG,EAAG,IAAM,KACpBC,MAAO,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACpCC,SAAU,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACvCC,cAAe,CAAC,EAAG,IAAM,IAAK,IAAM,KACpCC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,GAClCC,aAAc,CAAC,EAAG,IAAM,IAAK,IAAM,KACnCC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACxCC,WAAY,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACzCC,UAAW,CAAC,IAAM,IAAK,EAAG,GAC1BC,qBAAsB,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACnDC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACxCC,WAAY,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACzCC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACxCC,UAAW,CAAC,EAAG,IAAM,IAAK,IAAM,KAChCC,YAAa,CAAC,EAAG,IAAM,IAAK,IAAM,KAClCC,cAAe,CAAC,GAAK,IAAK,IAAM,IAAK,IAAM,KAC3CC,aAAc,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAC3CC,eAAgB,CAAC,IAAM,IAAK,IAAM,IAAK,IACvCC,eAAgB,CAAC,IAAM,IAAK,IAAM,IAAK,IACvCC,eAAgB,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAC7CC,YAAa,CAAC,EAAG,EAAG,IAAM,KAC1BC,KAAM,CAAC,EAAG,EAAG,GACbC,UAAW,CAAC,GAAK,IAAK,IAAM,IAAK,GAAK,KACtCC,MAAO,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACpCC,QAAS,CAAC,EAAG,EAAG,GAChBC,OAAQ,CAAC,IAAM,IAAK,EAAG,GACvBC,iBAAkB,CAAC,GAAW,IAAM,IAAK,IAAM,KAC/CC,WAAY,CAAC,EAAG,EAAG,IAAM,KACzBC,aAAc,CAAC,IAAM,IAAK,GAAK,IAAK,IAAM,KAC1CC,aAAc,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAC3CC,eAAgB,CAAC,GAAK,IAAK,IAAM,IAAK,IAAM,KAC5CC,gBAAiB,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAC9CC,kBAAmB,CAAC,EAAG,IAAM,IAAK,IAAM,KACxCC,gBAAiB,CAAC,GAAK,IAAK,IAAM,IAAK,IACvCC,gBAAiB,CAAC,IAAM,IAAK,GAAK,IAAK,IAAM,KAC7CC,aAAc,CAAC,GAAK,IAAK,GAAK,IAAK,IAAM,KACzCC,UAAW,CAAC,IAAM,IAAK,EAAG,IAAM,KAChCC,UAAW,CAAC,EAAG,IAAM,IAAK,IAAM,KAChCC,SAAU,CAAC,EAAG,IAAM,IAAK,IAAM,KAC/BC,YAAa,CAAC,EAAG,IAAM,IAAK,IAAM,KAClCC,KAAM,CAAC,EAAG,EAAG,IAAM,KACnBC,QAAS,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACtCC,MAAO,CAAC,IAAM,IAAK,IAAM,IAAK,GAC9BC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,GAAK,KACvCC,OAAQ,CAAC,EAAG,IAAM,IAAK,GACvBC,UAAW,CAAC,EAAG,GAAK,IAAK,GACzBC,OAAQ,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACrCC,cAAe,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAC5CC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACxCC,cAAe,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAC5CC,cAAe,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAC5CC,WAAY,CAAC,EAAG,IAAM,IAAK,IAAM,KACjCC,UAAW,CAAC,EAAG,IAAM,IAAK,IAAM,KAChCC,KAAM,CAAC,IAAM,IAAK,IAAM,IAAK,GAAK,KAClCC,KAAM,CAAC,EAAG,IAAM,IAAK,IAAM,KAC3BC,KAAM,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACnCC,WAAY,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACzCC,OAAQ,CAAC,IAAM,IAAK,EAAG,IAAM,KAC7BC,cAAe,CAAC,GAAW,GAAU,IACrCC,IAAK,CAAC,EAAG,EAAG,GACZC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACxCC,UAAW,CAAC,GAAK,IAAK,IAAM,IAAK,IAAM,KACvCC,YAAa,CAAC,IAAM,IAAK,GAAK,IAAK,GAAK,KACxCC,OAAQ,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACrCC,WAAY,CAAC,IAAM,IAAK,IAAM,IAAK,GAAK,KACxCC,SAAU,CAAC,GAAK,IAAK,IAAM,IAAK,GAAK,KACrCC,SAAU,CAAC,EAAG,IAAM,IAAK,IAAM,KAC/BC,OAAQ,CAAC,IAAM,IAAK,GAAK,IAAK,GAAK,KACnCC,OAAQ,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACrCC,QAAS,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACtCC,UAAW,CAAC,IAAM,IAAK,GAAK,IAAK,IAAM,KACvCC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACxCC,UAAW,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACxCC,KAAM,CAAC,EAAG,IAAM,IAAK,IAAM,KAC3BC,YAAa,CAAC,EAAG,EAAG,IAAM,KAC1BC,UAAW,CAAC,GAAK,IAAK,IAAM,IAAK,IAAM,KACvCC,IAAK,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KAClCC,KAAM,CAAC,EAAG,IAAM,IAAK,IAAM,KAC3BC,QAAS,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACtCC,OAAQ,CAAC,EAAG,GAAK,IAAK,GAAK,KAC3BC,UAAW,CAAC,GAAK,IAAK,IAAM,IAAK,IAAM,KACvCC,OAAQ,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACrCC,MAAO,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACpCjd,MAAO,CAAC,EAAG,EAAG,GACdkd,WAAY,CAAC,IAAM,IAAK,IAAM,IAAK,IAAM,KACzCC,OAAQ,CAAC,EAAG,EAAG,GACfC,YAAa,CAAC,IAAM,IAAK,IAAM,IAAK,GAAK,MCxJ1C,IAAIC,GAAeljB,MAAM,GAAGmjB,KAAK,mCAC7BC,GAAqBpjB,MAAM,GAAGmjB,KAAK,oBAEvC,MAAAE,GAAe,IAAIhb,GAAc,CAChClJ,GAAI,OACJ/G,KAAM,OACNyD,KAAMie,GACNnU,SAAU8C,GAIFA,EAAI7J,IAAIpD,IACd,IAAIG,EAAOH,EAAM,GAAI,EAAK,EACtBd,EAAMc,EAAMG,EAEhB,OAAIjB,EAAM,SACFiB,GAAQ,MAAQjB,IAAQ,EAAI,KAAO,MAGpC,MAAQc,IAGjBoK,OAAQ6C,GAIAA,EAAI7J,IAAIpD,IACd,IAAIG,EAAOH,EAAM,GAAI,EAAK,EACtBd,EAAMc,EAAMG,EAEhB,OAAIjB,GAAO,OACHc,EAAM,MAGPG,IAASjB,EAAM,MAAS,QAAU,MAG3C2J,QAAS,CACRoE,IAAK,CACJ9J,OAAQukB,IAETI,WAAY,CACXlrB,KAAM,MACNgL,QAAQ,EACRzE,OAAQykB,GACR7e,OAAO,GAER1C,MAAO,CAET,EACE0hB,KAAM,CACL5kB,OAAQukB,GACR9f,QAAQ,EACRmB,OAAO,GAERif,YAAa,CACZprB,KAAM,OACNgL,QAAQ,EACRzE,OAAQykB,IAETK,IAAK,CACJ9pB,KAAM,SACN8d,SAAS,EACTzU,KAAMtJ,GAAO,yCAAyCsJ,KAAKtJ,GAC3D,KAAA+F,CAAO/F,GACFA,EAAIoJ,QAAU,IAEjBpJ,EAAMA,EAAI2I,QAAQ,aAAc,SAIjC,IAAIkhB,EAAO,GAMX,OAJA7pB,EAAI2I,QAAQ,gBAAiBqhB,IAC5BH,EAAK1kB,KAAK8kB,SAASD,EAAW,IAAM,OAG9B,CACN/e,QAAS,OACThG,OAA+B4kB,EAAK1gB,MAAM,EAAG,GAC7C0B,MAA8Bgf,EAAK1gB,MAAM,GAAG,GAE9C,EACA5E,UAAW,CACVU,EACA4F,GAECqf,YAAW,EACXrf,MAAOsf,GACJ,CAAA,OAEiB,IAAhBA,GAAyBtf,EAAQ,IAAsB,IAAhBsf,IAC3CllB,EAAOE,KAAK0F,GAGb5F,EACCA,EAAOC,IAAIrH,GAAKiD,KAAKspB,MAAU,IAAJvsB,IAG5B,IAAIwsB,EAAcH,GAAYjlB,EAAOiI,MAAMrP,GAAKA,EAAI,IAAO,GAY3D,MAAO,IAVGoH,EACRC,IAAIrH,GACAwsB,GACKxsB,EAAI,IAAIuC,SAAS,IAGnBvC,EAAEuC,SAAS,IAAIkqB,SAAS,EAAG,MAElCze,KAAK,MAKT0e,QAAS,CACRtqB,KAAM,SACNqJ,KAAMtJ,GAAO,YAAYsJ,KAAKtJ,GAC9B,KAAA+F,CAAO/F,GAEN,IAAIwE,EAAM,CAAEyG,QAAS,OAAQhG,OAAQ,KAAM4F,MAAO,GAUlD,GARY,iBAHZ7K,EAAMA,EAAIM,gBAITkE,EAAIS,OAASob,GAAS7B,MACtBha,EAAIqG,MAAQ,GAGZrG,EAAIS,OAASob,GAASrgB,GAGnBwE,EAAIS,OACP,OAAOT,CAET,MCtIHgmB,GAAe,IAAI7b,GAAc,CAChClJ,GAAI,KACJgF,MAAO,aACP/L,KAAM,KACNyD,KAAMge,GAENlU,SAAU0d,GAAK1d,SACfC,OAAQyd,GAAKzd,SCGP,SAASue,GAActiB,GAE7B,OAAO/E,GAAI+E,EAAO,CAACuG,GAAS,KAC7B,CCUA,SAASgc,GAAQC,GAChB,OAAIA,GAbW,KAcPA,EAEDA,GAhBQ,KAgBOA,IAfP,KAgBhB,CAEA,SAASC,GAAW9oB,GACnB,IAAIG,EAAOH,EAAM,GAAI,EAAK,EACtBd,EAAMF,KAAKE,IAAIc,GACnB,OAAOG,EAAOnB,KAAKkP,IAAIhP,EAAK,IAC7B,CCzBe,SAAS6pB,GAAelP,EAAQC,GAC9CD,EAAS7P,GAAS6P,GAClBC,EAAS9P,GAAS8P,GAElB,IAAIrK,EAAKnO,GAAIuY,EAAQ,CAAChM,GAAK,MACvBgC,EAAKvO,GAAIwY,EAAQ,CAACjM,GAAK,MAE3B,OAAO7O,KAAKE,IAAIuQ,EAAKI,EACtB,CChBA,MAAM,GAAI,IAAM,MACV,GAAK,GAAK,IACV,GAAI,MAAQ,GAElB,IAAIxF,GAAQvF,GAAOE,IAEnB,MAAAgkB,GAAe,IAAI1gB,GAAW,CAC7B3E,GAAI,UACJ/G,KAAM,UACNuG,OAAQ,CACPpG,EAAG,CACF+E,SAAU,CAAC,EAAG,KACdlF,KAAM,aAEPE,EAAG,CACFgF,SAAU,EAAC,IAAM,MAElBxE,EAAG,CACFwE,SAAU,EAAC,IAAM,OAMnBuI,SAEAhK,KAAMuM,GAGN,QAAAzC,CAAU9E,GAET,IAGIxJ,EAHMwJ,EAAIjC,IAAI,CAACxD,EAAOtE,IAAMsE,EAAQyK,GAAM/O,IAGlC8H,IAAIxD,GAAUA,EAAQ,GAAIZ,KAAK+O,KAAKnO,IAAU,GAAIA,EAAQ,IAAM,KAE5E,MAAO,CACN,IAAM/D,EAAE,GAAK,GACb,KAAOA,EAAE,GAAKA,EAAE,IAChB,KAAOA,EAAE,GAAKA,EAAE,IAElB,EAIA,MAAAuO,CAAQ4D,GAEP,IAAInS,EAAI,GAaR,OAZAA,EAAE,IAAMmS,EAAI,GAAK,IAAM,IACvBnS,EAAE,GAAKmS,EAAI,GAAK,IAAMnS,EAAE,GACxBA,EAAE,GAAKA,EAAE,GAAKmS,EAAI,GAAK,IAGb,CACTnS,EAAE,GAAK,GAAKmD,KAAKkP,IAAIrS,EAAE,GAAI,IAAM,IAAMA,EAAE,GAAK,IAAM,GACpDmS,EAAI,GAAK,EAAIhP,KAAKkP,KAAKF,EAAI,GAAK,IAAM,IAAK,GAAKA,EAAI,GAAK,GACzDnS,EAAE,GAAK,GAAKmD,KAAKkP,IAAIrS,EAAE,GAAI,IAAM,IAAMA,EAAE,GAAK,IAAM,IAI1CuH,IAAI,CAACxD,EAAOtE,IAAMsE,EAAQyK,GAAM/O,GAC5C,EAEAuN,QAAS,CACR,UAAW,CACV1F,OAAQ,CACP,0BACA,0BACA,+BChEE8lB,GAAyB,GAAnBjqB,KAAKkP,IAAI,EAAG,IAAa,uEHqCtB,SAAuBgb,EAAYC,GAIjD,IAAIhtB,EACAwS,EACAya,EAGAC,EAAGnZ,EAAGoZ,EARVH,EAAanf,GAASmf,GACtBD,EAAalf,GAASkf,GAStBC,EAAaxpB,GAAGwpB,EAAY,SAK3BE,EAAGnZ,EAAGoZ,GAAKH,EAAWhmB,OAAOC,IAAIrH,GAC1B6C,GAAO7C,GAAK,EAAIA,GAExB,IAAIwtB,EAAwB,SAAfT,GAAUO,GAAgC,SAAfP,GAAU5Y,GAAgC,QAAf4Y,GAAUQ,GAE7EJ,EAAavpB,GAAGupB,EAAY,SAC3BG,EAAGnZ,EAAGoZ,GAAKJ,EAAW/lB,OAAOC,IAAIrH,GAC1B6C,GAAO7C,GAAK,EAAIA,GAExB,IAAIytB,EAAuB,SAAfV,GAAUO,GAAgC,SAAfP,GAAU5Y,GAAgC,QAAf4Y,GAAUQ,GAGxEG,EAAOb,GAAOW,GACdG,EAAMd,GAAOY,GAGbG,EAAMD,EAAMD,EAgChB,OA3BIzqB,KAAKE,IAAIwqB,EAAMD,GAjEF,KAkEhB9a,EAAI,EAGAgb,GAEHxtB,EAAIutB,GAhFQ,IAgFQD,GA/EP,IAgFb9a,EApEc,KAoEVxS,IAIJA,EAAIutB,GAlFO,IAkFQD,GAnFP,IAoFZ9a,EAvEc,KAuEVxS,GAILitB,EADGpqB,KAAKE,IAAIyP,GAjFC,GAkFN,EAECA,EAAI,EAGLA,EAjFW,KAoFXA,EApFW,KAuFL,IAAPya,CACR,mBG/Fe,SAA2BvP,EAAQC,GACjDD,EAAS7P,GAAS6P,GAClBC,EAAS9P,GAAS8P,GAElB,IAAI8P,EAAQtoB,GAAIuY,EAAQ,CAACmP,GAAS,MAC9Ba,EAAQvoB,GAAIwY,EAAQ,CAACkP,GAAS,MAE9Bc,EAAe9qB,KAAKE,IAAIF,KAAKkP,IAAI0b,EAAOX,IAAOjqB,KAAKkP,IAAI2b,EAAOZ,KAE/Dc,EAAW/qB,KAAKkP,IAAI4b,EAAc,EAAIb,IAAOjqB,KAAKgrB,MAAQ,GAE9D,OAAOD,EAAW,IAAM,EAAMA,CAC/B,qCCfe,SAA4BlQ,EAAQC,GAClDD,EAAS7P,GAAS6P,GAClBC,EAAS9P,GAAS8P,GAElB,IAAImQ,EAAKjrB,KAAKiB,IAAI0oB,GAAa9O,GAAS,GACpCqQ,EAAKlrB,KAAKiB,IAAI0oB,GAAa7O,GAAS,GAEpCoQ,EAAKD,KACPA,EAAIC,GAAM,CAACA,EAAID,IAGjB,IAAI1W,EAAQ0W,EAAKC,EACjB,OAAiB,IAAV3W,EAAc,GAAK0W,EAAKC,GAAM3W,CACtC,iBCde,SAAyBsG,EAAQC,GAC/CD,EAAS7P,GAAS6P,GAClBC,EAAS9P,GAAS8P,GAElB,IAAImQ,EAAKjrB,KAAKiB,IAAI0oB,GAAa9O,GAAS,GACpCqQ,EAAKlrB,KAAKiB,IAAI0oB,GAAa7O,GAAS,GAMxC,OAJIoQ,EAAKD,KACPA,EAAIC,GAAM,CAACA,EAAID,KAGTA,EAAK,MAASC,EAAK,IAC5B,gBCLe,SAAwBrQ,EAAQC,GAC9CD,EAAS7P,GAAS6P,GAClBC,EAAS9P,GAAS8P,GAElB,IAAImQ,EAAKjrB,KAAKiB,IAAI0oB,GAAa9O,GAAS,GACpCqQ,EAAKlrB,KAAKiB,IAAI0oB,GAAa7O,GAAS,GAMxC,OAJIoQ,EAAKD,KACPA,EAAIC,GAAM,CAACA,EAAID,IAGH,IAAPC,EAlBI,KAkBcD,EAAKC,GAAMA,CACrC,yCCZe,SAASH,GAAUb,EAAYC,EAAYrtB,GACrDmC,GAASnC,KACZA,EAAI,CAAEquB,UAAWruB,IAGlB,IAAIquB,UAAEA,KAAcC,GAAStuB,GAAK,CAAA,EAElC,IAAKquB,EAAW,CACf,IAAIE,EAAajsB,OAAO0L,KAAKwgB,IAC3BlnB,IAAItG,GAAKA,EAAE+J,QAAQ,YAAa,KAChCkD,KAAK,MACP,MAAM,IAAI9H,UACT,0EAA0EooB,IAE5E,CAEAnB,EAAalf,GAASkf,GACtBC,EAAanf,GAASmf,GAEtB,IAAA,IAASrsB,KAAKwtB,GACb,GAAI,WAAaH,EAAU3rB,gBAAkB1B,EAAE0B,cAC9C,OAAO8rB,GAAmBxtB,GAAGosB,EAAYC,EAAYiB,GAIvD,MAAM,IAAInoB,UAAU,+BAA+BkoB,IACpD,CC1CA,MAAAI,GAAe,IAAIjiB,GAAW,CAC7B3E,GAAI,MACJ/G,KAAM,MACNuG,OAAQ,CACPxH,EAAG,CACFmG,SAAU,CAAC,EAAG,KACd3D,KAAM,QACNvB,KAAM,OAEPlB,EAAG,CACFmG,MAAO,CAAC,EAAG,KACXjF,KAAM,cAEPG,EAAG,CACF8E,MAAO,CAAC,EAAG,KACXjF,KAAM,cAIRyD,KAAMwnB,GAGN1d,SAAU8C,IACT,IAAIhN,EAAMjB,KAAKiB,OAAOgN,GAClBlN,EAAMf,KAAKe,OAAOkN,IACjBrR,EAAGuB,EAAGG,GAAK2P,GACXtR,EAAGD,EAAGqB,GAAK,CAAC,KAAM,GAAIgD,EAAME,GAAO,GACpCpD,EAAIoD,EAAMF,EAEd,GAAU,IAANlD,EAAS,CAGZ,OAFAnB,EAAU,IAANqB,GAAiB,IAANA,EAAU,GAAKkD,EAAMlD,GAAKiC,KAAKe,IAAIhD,EAAG,EAAIA,GAEjDkD,GACP,KAAKrE,EACJD,GAAKwB,EAAIG,GAAKT,GAAKM,EAAIG,EAAI,EAAI,GAC/B,MACD,KAAKH,EACJxB,GAAK2B,EAAI1B,GAAKiB,EAAI,EAClB,MACD,KAAKS,EACJ3B,GAAKC,EAAIuB,GAAKN,EAAI,EAGpBlB,GAAQ,EACT,CAcA,OATID,EAAI,IACPC,GAAK,IACLD,EAAIsD,KAAKE,IAAIxD,IAGVC,GAAK,MACRA,GAAK,KAGC,CAACA,EAAO,IAAJD,EAAa,IAAJqB,IAIrBqN,OAAQmgB,IACP,IAAK5uB,EAAGD,EAAGqB,GAAKwtB,EAUhB,SAAS1uB,EAAGG,GACX,IAAIwuB,GAAKxuB,EAAIL,EAAI,IAAM,GACnBmB,EAAIpB,EAAIsD,KAAKe,IAAIhD,EAAG,EAAIA,GAC5B,OAAOA,EAAID,EAAIkC,KAAKiB,KAAI,EAAIjB,KAAKe,IAAIyqB,EAAI,EAAG,EAAIA,EAAG,GACpD,CAEA,OAfA7uB,GAAQ,IAEJA,EAAI,IACPA,GAAK,KAGND,GAAK,IACLqB,GAAK,IAQE,CAAClB,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAGvBgN,QAAS,CACR0hB,IAAK,CACJpnB,OAAQ,CAAC,qBAAsB,0BAA2B,4BAE3DsnB,KAAM,CACLtnB,OAAQ,CAAC,qBAAsB,0BAA2B,2BAC1DyE,QAAQ,EACRmB,OAAO,MCtFV2hB,GAAe,IAAIpiB,GAAW,CAC7B3E,GAAI,MACJ/G,KAAM,MACNuG,OAAQ,CACPxH,EAAG,CACFmG,SAAU,CAAC,EAAG,KACd3D,KAAM,QACNvB,KAAM,OAEPlB,EAAG,CACFmG,MAAO,CAAC,EAAG,KACXjF,KAAM,cAEPX,EAAG,CACF4F,MAAO,CAAC,EAAG,KACXjF,KAAM,UAIRyD,KAAMwnB,GAEN,QAAA1d,CAAU8C,GACT,IAAIhN,EAAMjB,KAAKiB,OAAOgN,GAClBlN,EAAMf,KAAKe,OAAOkN,IACjBrR,EAAGuB,EAAGG,GAAK2P,GACXtR,EAAGD,EAAGO,GAAK,CAAC,KAAM,EAAGgE,GACtBpD,EAAIoD,EAAMF,EAEd,GAAU,IAANlD,EAAS,CACZ,OAAQoD,GACP,KAAKrE,EACJD,GAAKwB,EAAIG,GAAKT,GAAKM,EAAIG,EAAI,EAAI,GAC/B,MACD,KAAKH,EACJxB,GAAK2B,EAAI1B,GAAKiB,EAAI,EAClB,MACD,KAAKS,EACJ3B,GAAKC,EAAIuB,GAAKN,EAAI,EAGpBlB,GAAQ,EACT,CAUA,OARIM,IACHP,EAAImB,EAAIZ,GAGLN,GAAK,MACRA,GAAK,KAGC,CAACA,EAAO,IAAJD,EAAa,IAAJO,EACrB,EAEA,MAAAmO,CAAQugB,GACP,IAAKhvB,EAAGD,EAAGO,GAAK0uB,EAUhB,SAAS9uB,EAAGG,GACX,IAAIwuB,GAAKxuB,EAAIL,EAAI,IAAM,EACvB,OAAOM,EAAIA,EAAIP,EAAIsD,KAAKiB,IAAI,EAAGjB,KAAKe,IAAIyqB,EAAG,EAAIA,EAAG,GACnD,CAEA,OAdA7uB,GAAQ,IAEJA,EAAI,IACPA,GAAK,KAGND,GAAK,IACLO,GAAK,IAOE,CAACJ,EAAE,GAAIA,EAAE,GAAIA,EAAE,GACvB,EAEAgN,QAAS,CACRxC,MAAO,CACN1C,GAAI,QACJR,OAAQ,CAAC,qBAAsB,0BAA2B,+BC1E7DynB,GAAe,IAAItiB,GAAW,CAC7B3E,GAAI,MACJ/G,KAAM,MACNuG,OAAQ,CACPxH,EAAG,CACFmG,SAAU,CAAC,EAAG,KACd3D,KAAM,QACNvB,KAAM,OAEPQ,EAAG,CACFyE,MAAO,CAAC,EAAG,KACXjF,KAAM,aAEPU,EAAG,CACFuE,MAAO,CAAC,EAAG,KACXjF,KAAM,cAIRyD,KAAMqqB,GACN,QAAAvgB,CAAUwgB,GACT,IAAKhvB,EAAGD,EAAGO,GAAK0uB,EAEhB,MAAO,CAAChvB,EAAIM,GAAK,IAAMP,GAAM,IAAK,IAAMO,EACzC,EACA,MAAAmO,CAAQwgB,GACP,IAAKjvB,EAAGyB,EAAGE,GAAKstB,EAGhBxtB,GAAK,IACLE,GAAK,IAGL,IAAIutB,EAAMztB,EAAIE,EACd,GAAIutB,GAAO,EAEV,MAAO,CAAClvB,EAAG,EADAyB,EAAIytB,EACM,KAGtB,IAAI5uB,EAAI,EAAIqB,EAEZ,MAAO,CAAC3B,EAAO,KADD,IAANM,EAAU,EAAI,EAAImB,EAAInB,GACN,IAAJA,EACrB,EAEA4M,QAAS,CACR+hB,IAAK,CACJznB,OAAQ,CAAC,qBAAsB,0BAA2B,+BC3B7D2nB,GAAe,IAAIje,GAAc,CAChClJ,GAAI,gBACJgF,MAAO,mBACP/L,KAAM,kCACNyN,MAAO,MACR0C,QAnBgB,CACf,CAAE,kBAAsB,kBAAsB,mBAC9C,CAAE,mBAAsB,kBAAsB,oBAC9C,CAAE,mBAAsB,mBAAsB,oBAiB/CC,UAZkB,CACjB,CAAG,oBAAuB,mBAAuB,oBACjD,EAAE,kBAAyB,mBAAuB,oBAClD,CAAG,qBAAuB,mBAAwB,uBCrBnD+d,GAAe,IAAIle,GAAc,CAChClJ,GAAI,SACJgF,MAAO,UACP/L,KAAM,2BACNyD,KAAMyqB,GACN1gB,OAAQgU,GAAOA,EAAIhb,IAAIpD,GAAOhB,KAAKkP,IAAIlP,KAAKE,IAAIc,GAAM,IAAM,KAAOhB,KAAKmB,KAAKH,IAC7EmK,SAAUiU,GAAOA,EAAIhb,IAAIpD,GAAOhB,KAAKkP,IAAIlP,KAAKE,IAAIc,GAAM,IAAM,KAAOhB,KAAKmB,KAAKH,MCgBhFgrB,GAAe,IAAIne,GAAc,CAChClJ,GAAI,kBACJgF,MAAO,wBACP/L,KAAM,kBACNyN,MAAO,MACPhK,KAAMoN,GACNV,QApBe,CACf,CAAE,kBAAsB,mBAAsB,mBAC9C,CAAE,kBAAsB,iBAAsB,mBAC9C,CAAE,EAAsB,EAAsB,oBAkB9CC,UAbiB,CACjB,CAAG,oBAAqB,oBAAsB,oBAC9C,EAAE,kBAAuB,mBAAsB,oBAC/C,CAAG,EAAsB,EAAsB,uBCnB1Cie,GAAK,EAAI,IAGfC,GAAe,IAAIre,GAAc,CAChClJ,GAAI,WACJgF,MAAO,eACP/L,KAAM,WACNyD,KAAM2qB,GACN5gB,OAAQgU,GAEAA,EAAIhb,IAAInH,IACd,IAAIkE,EAAOlE,EAAI,GAAI,EAAK,EACpBiD,EAAMjD,EAAIkE,EAEd,OAAIjB,EAbK,OAcDjD,EAAI,GAGLkE,EAAOjB,GAAO,MAGvBiL,SAAUiU,GACFA,EAAIhb,IAAInH,IACd,IAAIkE,EAAOlE,EAAI,GAAI,EAAK,EACpBiD,EAAMjD,EAAIkE,EAEd,OAAIjB,GAAO+rB,GACH9qB,EAAOjB,IAAQ,EAAI,KAGpB,GAAKjD,MC7BfkvB,GAAe,IAAI7iB,GAAW,CAC7B3E,GAAI,QACJ/G,KAAM,QACNuG,OAAQ,CACPpG,EAAG,CACF+E,SAAU,CAAC,EAAG,GACdlF,KAAM,aAEPb,EAAG,CACF+F,SAAU,CAAC,EAAG,IACdlF,KAAM,UAEPjB,EAAG,CACFmG,SAAU,CAAC,EAAG,KACd3D,KAAM,QACNvB,KAAM,QAGRyN,MAAO,MAEPhK,KAAMwR,GACN1H,SAAUkE,GAAIlE,SACdC,OAAQiE,GAAIjE,OAEZvB,QAAS,CACRsiB,MAAO,CACNhoB,OAAQ,CAAC,0BAA2B,0BAA2B,0BCmC3D,SAASioB,GAAkBroB,GAChC,MAAc,eAAVA,EAA+B,KACrB,YAAVA,EAA4B,SACzBA,CACT,CAEO,SAASsoB,GAAsBtoB,GACpC,MAAc,OAAVA,EAAuB,aACb,WAAVA,EAA2B,UACxBA,CACT,CAEO,SAASuoB,GAAcviB,GAC5B,MAAiB,QAAVA,GAA6B,MAAVA,EAAgB,GAAK,MAAMA,IACvD,CAEO,SAASwiB,GAAUxoB,GACxB,MAAO,CACL,cACA,aACA,UACA,UACA,WACA,MACA,UACA,WACA8E,SAAS9E,EACb,CCrFO,SAASyoB,GAAQxvB,EAAkB+C,EAAS,GACjD,OAAS,MAAL/C,EACK,IAEFoL,OAAOpL,EAAEwvB,QAAQzsB,IAAST,UACnC,CCiBO,SAASmtB,GAAS1oB,EAAmB2oB,2BAC1C,MAAMzd,EAAK,OAAAlN,EAAA2qB,EAAGzd,GAAHlN,EAAQ,GACb4W,EAAK,OAAA7R,EAAA4lB,EAAG/T,GAAH7R,EAAQ,EACbwjB,EAAK,OAAA1jB,EAAA8lB,EAAGpC,GAAH1jB,EAAQ,EACb+I,EAAK,OAAA/F,EAAA8iB,EAAG/c,GAAH/F,EAAQ,EACbuM,EAAK,OAAA7K,EAAAohB,EAAGvW,GAAH7K,EAAQ,EACbnO,EAAK,OAAAoO,EAAAmhB,EAAGvvB,GAAHoO,EAAQ,EACb/N,EAAK,OAAAmvB,EAAAD,EAAGlvB,GAAHmvB,EAAQ,EACbtC,EAAK,OAAAuC,EAAAF,EAAGrC,GAAHuC,EAAQ,EACb1b,EAAK,OAAA2b,EAAAH,EAAGxb,GAAH2b,EAAQ,EACbC,EAAO,OAAAC,EAAAL,EAAGI,KAAHC,EAAU,IAEvB,OAAQhpB,GACN,IAAK,QAAS,MAAO,SAASkL,MAAM0J,KAAK2R,IAAIgC,GAAcQ,MAC3D,IAAK,QAAS,MAAO,SAAS7d,MAAMU,MAAMwG,IAAImW,GAAcQ,MAC5D,IAAK,MAAO,MAAO,OAAO7d,MAAM0J,KAAK2R,IAAIgC,GAAcQ,MACvD,IAAK,MAAO,MAAO,OAAO7d,MAAMU,MAAMwG,IAAImW,GAAcQ,MACxD,IAAK,MAAO,MAAO,OAAO3W,KAAKhZ,MAAM8R,KAAKqd,GAAcQ,MACxD,IAAK,MAAO,MAAO,OAAO3W,KAAK3Y,MAAM8sB,KAAKgC,GAAcQ,MACxD,IAAK,OAAQ,MAAO,OAAOzC,MAAMnZ,MAAMoZ,KAAKgC,GAAcQ,MAC1D,IAAK,MAAO,CAEV,MAAMlwB,EAAIoD,KAAKspB,MAAkB,KAAZlhB,OAAOiiB,IACtBlsB,EAAI6B,KAAKspB,MAAkB,KAAZlhB,OAAO8I,IACtB5S,EAAI0B,KAAKspB,MAAkB,KAAZlhB,OAAOkiB,IACtBxsB,EAAIsK,OAAO0kB,GAEXE,EAAKpwB,EAAE0C,SAAS,IAAIkqB,SAAS,EAAG,KAChCyD,EAAK9uB,EAAEmB,SAAS,IAAIkqB,SAAS,EAAG,KAChC0D,EAAK5uB,EAAEgB,SAAS,IAAIkqB,SAAS,EAAG,KAGhC2D,EAAaH,EAAG,KAAOA,EAAG,IAAMC,EAAG,KAAOA,EAAG,IAAMC,EAAG,KAAOA,EAAG,GAEtE,GAAIpvB,EAAI,IAAK,CACX,MACMsvB,EADQptB,KAAKspB,MAAOxrB,EAAI,IAAO,KACpBwB,SAAS,IAAIkqB,SAAS,EAAG,KAE1C,OAAI2D,GAAcC,EAAG,KAAOA,EAAG,GAEtB,IAAIJ,EAAG,KAAKC,EAAG,KAAKC,EAAG,KAAKE,EAAG,KAEjC,IAAIJ,IAAKC,IAAKC,IAAKE,GAC5B,CAEA,OAAID,EAEK,IAAIH,EAAG,KAAKC,EAAG,KAAKC,EAAG,KAEzB,IAAIF,IAAKC,IAAKC,GACvB,CACA,QACE,OAAIX,GAAUxoB,GFab,SAAkBA,EAAenH,EAAoBuB,EAAoBG,EAAoBR,GAElG,MAAO,SADa,aAAViG,EAAuB,eAAiBA,KAC7BnH,MAAMuB,MAAMG,KAAKguB,GAAcxuB,KACtD,CEhBmCuvB,CAAStpB,EAAOsmB,EAAGnZ,EAAGoZ,EAAGwC,GAC/C,qBAEb,CAkBO,SAASQ,GAAkBvpB,EAAmBwpB,iBAEnD,IAAIxwB,EAAIiO,GAAS/F,GAAMsoB,IAEvB,MAEMC,EAAWpB,GAFa,QAAVroB,EAAkB,OAASA,GAG3ChH,EAAEgH,MAAMY,KAAO6oB,IACjBzwB,EAAI4D,GAAG5D,EAAGywB,IAEZ,MAAM7oB,EAAK0nB,GAAsBtvB,EAAEgH,MAAMY,IACnCjI,EAAY,QAAPiI,EAAe,OAASA,EAE7B+nB,EAAoB,CAAA,EAGpB3iB,EAAQ,OAAAhI,EAAAhF,EAAEgN,OAAFhI,EAAW,EACzB,GAAU,UAANrF,EAAe,CACjB,MAAOqB,EAAGD,EAAGQ,GAAKvB,EAAEoH,OACpBuoB,EAAGzd,EAAIud,GAAmB,KAAV,MAAAzuB,EAAAA,EAAK,IACrB2uB,EAAG/T,EAAI6T,GAAQ1uB,EAAG,GAClB4uB,EAAGpC,EAAIkC,GAAQluB,EAAG,GAClBouB,EAAGI,IAAMN,GAAgB,IAARziB,EACnB,MAAA,GAAiB,UAANrN,EAAe,CACxB,MAAOqB,EAAG0vB,EAAI9wB,GAAKI,EAAEoH,OACrBuoB,EAAGzd,EAAIud,GAAmB,KAAV,MAAAzuB,EAAAA,EAAK,IACrB2uB,EAAG/c,EAAI6c,GAAQxsB,KAAKe,IAAI,IAAiB,KAAX,MAAA0sB,EAAAA,EAAM,IAAW,GAC/Cf,EAAGvW,EAAIqW,GAAQ7vB,GACf+vB,EAAGI,IAAMN,GAAgB,IAARziB,EACnB,MAAA,GAAiB,QAANrN,EAAa,CACtB,MAAOqB,EAAGD,EAAGQ,GAAKvB,EAAEoH,OACpBuoB,EAAGzd,EAAIud,GAAQzuB,GACf2uB,EAAG/T,EAAI6T,GAAQ1uB,GACf4uB,EAAGpC,EAAIkC,GAAQluB,GACfouB,EAAGI,IAAMN,GAAgB,IAARziB,EACnB,MAAA,GAAiB,QAANrN,EAAa,CACtB,MAAOqB,EAAG0vB,EAAI9wB,GAAKI,EAAEoH,OACrBuoB,EAAGzd,EAAIud,GAAQzuB,GACf2uB,EAAG/c,EAAI6c,GAAQxsB,KAAKe,IAAI,KAAM,MAAA0sB,EAAAA,EAAM,GAAK,KAAM,GAC/Cf,EAAGvW,EAAIqW,GAAQ7vB,GACf+vB,EAAGI,IAAMN,GAAgB,IAARziB,EACnB,MAAA,GAAiB,QAANrN,EAAa,CACtB,MAAMC,EAAII,EAAEoH,OAAO,GACbupB,EAAK,OAAA5mB,EAAA/J,EAAEoH,OAAO,IAAT2C,EAAe,EACpB/I,EAAI,OAAA6I,EAAA7J,EAAEoH,OAAO,IAATyC,EAAe,EACzB8lB,EAAGvW,EAAIqW,GAAQ7vB,GAEf+vB,EAAGvvB,EAAIqvB,GAAQkB,EAAK,EAAIA,EAAU,IAALA,GAC7BhB,EAAGzd,EAAIud,GAAQzuB,EAAI,EAAIA,EAAQ,IAAJA,GAC3B2uB,EAAGI,IAAMN,GAAgB,IAARziB,EACnB,MAAA,GAAiB,QAANrN,EAAa,CACtB,MAAMC,EAAII,EAAEoH,OAAO,GACb/F,EAAI,OAAAwL,EAAA7M,EAAEoH,OAAO,IAATyF,EAAe,EACnBtL,EAAI,OAAAgN,EAAAvO,EAAEoH,OAAO,IAATmH,EAAe,EACzBohB,EAAGvW,EAAIqW,GAAQ7vB,GAEf+vB,EAAGlvB,EAAIgvB,GAAQpuB,EAAI,EAAIA,EAAQ,IAAJA,GAC3BsuB,EAAGpC,EAAIkC,GAAQluB,EAAI,EAAIA,EAAQ,IAAJA,GAC3BouB,EAAGI,IAAMN,GAAgB,IAARziB,EACnB,MAAA,GAAiB,SAANrN,GAAsB,QAANA,EAAa,CACtC,MAAOE,EAAGuB,EAAGG,GAAK2e,GAAQlgB,EAAG,CAAEgH,MAAO,OAAQ6Y,OAAQ,SAAUzY,OAChEuoB,EAAGrC,EAAImC,GAAmB,KAAV,MAAA5vB,EAAAA,EAAK,IACrB8vB,EAAGxb,EAAIsb,GAAmB,KAAV,MAAAruB,EAAAA,EAAK,IACrBuuB,EAAGpC,EAAIkC,GAAmB,KAAV,MAAAluB,EAAAA,EAAK,IACrBouB,EAAGI,IAAMN,GAAgB,IAARziB,EACnB,MAAA,GAAWwiB,GAAU7vB,GAAI,CACvB,MAAOE,EAAGuB,EAAGG,GAAKvB,EAAEoH,OACpBuoB,EAAGrC,EAAImC,GAAmB,KAAV,MAAA5vB,EAAAA,EAAK,IACrB8vB,EAAGxb,EAAIsb,GAAmB,KAAV,MAAAruB,EAAAA,EAAK,IACrBuuB,EAAGpC,EAAIkC,GAAmB,KAAV,MAAAluB,EAAAA,EAAK,IACrBouB,EAAGI,IAAMN,GAAgB,IAARziB,EACnB,CAEA,MAAO,CAAEhG,MAAOrH,EAAGgwB,KACrB,CFvKAiB,GAAmB9gB,SAAS+gB,IAC5BD,GAAmB9gB,SAASghB,IAC5BF,GAAmB9gB,SAASihB,IAC5BH,GAAmB9gB,SAASkhB,IAC5BJ,GAAmB9gB,SAASmhB,IAC5BL,GAAmB9gB,SAASohB,IAC5BN,GAAmB9gB,SAASqhB,IAC5BP,GAAmB9gB,SAASshB,IAC5BR,GAAmB9gB,SAASuhB,IAC5BT,GAAmB9gB,SAASwhB,IAC5BV,GAAmB9gB,SAASyhB,IAC5BX,GAAmB9gB,SAAS0hB,IAC5BZ,GAAmB9gB,SAAS2hB,IAC5Bb,GAAmB9gB,SAAS4hB,IGiB5B,IAAIC,GAAoF,KAiKjF,SAASC,GAAWC,EAAsBC,GAC/C,OACED,EAAUE,MAAQD,EAASC,MAC3BF,EAAUG,KAAOF,EAASE,KAC1BH,EAAUI,OAASH,EAASG,OAC5BJ,EAAUK,QAAUJ,EAASI,MAEjC,CAKO,SAASC,GAAYN,EAAsBC,GAChD,MAAMC,EAAO9uB,KAAKiB,IAAI2tB,EAAUE,KAAMD,EAASC,MACzCC,EAAM/uB,KAAKiB,IAAI2tB,EAAUG,IAAKF,EAASE,KACvCC,EAAQhvB,KAAKe,IAAI6tB,EAAUI,MAAOH,EAASG,OAC3CC,EAASjvB,KAAKe,IAAI6tB,EAAUK,OAAQJ,EAASI,QAEnD,OAAID,GAASF,GAAQG,GAAUF,EAAY,GACnCC,EAAQF,IAASG,EAASF,EACpC,29KC9LMI,GAAgB,qBAChBC,GAA4B,QAG5BC,GAAQ,IAAIC,cAEe,mBAAtBD,GAAME,aACfF,GAAME,YAAYC,IAGb,MAAMC,WAAmBC,YA0G9B,WAAAhuB,GAKE,GAJAyM,QA3GGwhB,EAAApyB,KAAAqyB,GAMLD,EAAApyB,KAAAsyB,EAASC,GAAeX,KACxBQ,EAAApyB,KAAAwyB,EAASD,GAAmBV,KAC5BO,EAAApyB,KAAAyyB,EAASF,GAAc,SACvBH,EAAApyB,KAAA0yB,EAAQH,IAAO,IACfH,EAAApyB,KAAA2yB,EAAsCJ,GAAO,OAC7CH,EAAApyB,KAAA4yB,EAASL,GAAsB,OAC/BH,EAAApyB,KAAA6yB,EAAWN,IAAO,IAElBH,EAAApyB,KAAA8yB,EAAYC,GAAS,IJzBhB,SAAuBvzB,WAC5B,IACE,MAAMsK,EAAQpC,GAAMlI,GACpB,IAAIwzB,EACAC,EACJ,IACED,EAAK,OAAAxuB,EAAAgpB,GAAS1jB,EAAO,QAAS,WAAzBtF,EAAsCgoB,GAAc1iB,EAAO,SAChEmpB,EAAK,OAAA1pB,EAAAikB,GAAS1jB,EAAO,QAAS,WAAzBP,EAAsCijB,GAAc1iB,EAAO,QAClE,CAAA,MACEkpB,EAAKxG,GAAc1iB,EAAO,SAC1BmpB,EAAKzG,GAAc1iB,EAAO,QAC5B,CACA,OAAOkpB,EAAKC,EAAK,QAAU,OAC7B,CAAA,MACE,MAAO,OACT,CACF,CIS6BC,CAAcC,EAAAnzB,KAAKsyB,GAAOjvB,SACrD+uB,EAAApyB,KAAAozB,EAASL,GAAS,IJPb,SAAqB/C,GAC1B,IAAIqD,EAAe,OACnB,IAAKrD,GAAYA,EAAS5kB,WAAW,KAAM,OAAOioB,EAClD,IACE,MAAM7zB,EAAIkI,GAAMsoB,GACVsD,EAAyB,CAAE1mB,QAAS,OAAQhG,OAAQxD,GAAG5D,EAAG,QAAQoH,OAAQ4F,MAAO,MACjF+mB,EAAuB,CAAE3mB,QAAS,KAAMhG,OAAQxD,GAAG5D,EAAG,MAAMoH,OAAQ4F,MAAO,MAC3EgnB,EAA4B,CAAE5mB,QAAS,UAAWhG,OAAQxD,GAAG5D,EAAG,WAAWoH,OAAQ4F,MAAO,MAE5F4B,GAD0B,CAAExB,QAAS,MAAOhG,OAAQxD,GAAG5D,EAAG,OAAOoH,OAAQ4F,MAAO,SAClE6mB,EAAQ,OACtBjlB,GAAQolB,KAAUH,EAAQ,WAC1BjlB,GAAQmlB,KAAKF,EAAQ,MACrBjlB,GAAQklB,KAAOD,EAAQ,OAC7B,CAAA,MAAU,CACV,OAAOA,CACT,CIR0BI,CAAYN,EAAAnzB,KAAKsyB,GAAOjvB,SAEhD+uB,EAAApyB,KAAA0zB,EAA0D,MAC1DtB,EAAApyB,KAAA2zB,EAA8D,MAC9DvB,EAAApyB,KAAA4zB,EAAwD,MACxDxB,EAAApyB,KAAA6zB,EAA2D,MAC3DzB,EAAApyB,KAAA8zB,GAAsB,GA0EtB1B,EAAApyB,KAAA+zB,GACA3B,EAAApyB,KAAAg0B,GACA5B,EAAApyB,KAAAi0B,GACA7B,EAAApyB,KAAAk0B,GACA9B,EAAApyB,KAAAm0B,GACA/B,EAAApyB,KAAAo0B,GACAhC,EAAApyB,KAAAq0B,GACAjC,EAAApyB,KAAAs0B,GACAlC,EAAApyB,KAAAu0B,GACAnC,EAAApyB,KAAAw0B,EAAmC,MAqPnCpC,EAAApyB,KAAAy0B,EAAmC,MACnCrC,EAAApyB,KAAA00B,EAA8B,MAC9BtC,EAAApyB,KAAA20B,EAA8B,IAC9BvC,EAAApyB,KAAA40B,EAAwB,MApPtBC,EAAA70B,KAAK+zB,EAAQ/zB,KAAK80B,aAAa,CAAEC,KAAM,OAAQC,gBAAgB,KAG3D,uBAAwB7B,EAAAnzB,KAAK+zB,IAAsC,mBAAtBjC,GAAME,YACrDmB,EAAAnzB,KAAK+zB,GAAMkB,mBAAqB,CAACnD,QAC5B,CAEL,MAAMoD,EAAUC,SAASC,cAAc,SACvCF,EAAQG,YAAcpD,GACtBkB,EAAAnzB,KAAK+zB,GAAMuB,YAAYJ,EACzB,CAGA,MAAMK,ECxJH,WACL,MAAMA,EAAWJ,SAASC,cAAc,YA2BxC,OA1BAG,EAASC,UAAY,k3CA0BdD,CACT,CD2HqBE,GACjBtC,EAAAnzB,KAAK+zB,GAAMuB,YAAYC,EAASG,QAAQC,WAAU,GACpD,CA1HA,6BAAWC,GAAuB,MAAO,CAAC,QAAS,aAAc,QAAS,WAAY,CAsBtF,SAAIvyB,GAAU,OAAO8vB,OAAKb,GAAOjvB,KAAM,CACvC,SAAIA,CAAM3D,GACR,GAAiB,iBAANA,GAAmBA,EAC9B,IACE,MACMm2B,EAAM/G,GADGpnB,GAAMhI,GACoBkN,SACnCkpB,EAAqB,iBAANp2B,GAAkBA,EAAE+F,OAAO2F,WAAW,KAC3D+nB,EAAAnzB,KAAKwyB,GAAOnvB,MAAQyyB,EAAQ,MAAiB,QAARD,EAAgB,OAAUA,EAC/D1C,EAAAnzB,KAAKsyB,GAAOjvB,MAAQ3D,EACpBm1B,EAAA70B,KAAK8zB,GAAsB,GAC3B9zB,KAAK+1B,aAAa,QAASr2B,GAC3BM,KAAK+1B,aAAa,aAAc5C,EAAAnzB,KAAKwyB,GAAOnvB,OAC5CwxB,EAAA70B,KAAK8zB,GAAsB,GAC3BkC,EAAAh2B,KAAKqyB,EAAA4D,GAALt1B,KAAAX,KACF,CAAA,MAAU,CACZ,CAEA,cAAIk2B,GAAe,OAAO/C,OAAKX,GAAOnvB,KAAM,CAC5C,cAAI6yB,CAAW/2B,GACb,MAAMg3B,EAAQh3B,GAAoB0yB,GAClCsB,EAAAnzB,KAAKwyB,GAAOnvB,MAAQ8yB,EACpBtB,EAAA70B,KAAK8zB,GAAsB,GAC3B9zB,KAAK+1B,aAAa,aAAcI,GAChC,IACE,MAAMzV,EAAUhZ,GAAMyrB,EAAAnzB,KAAKsyB,GAAOjvB,OAK5B+yB,EAAWlH,GAASiH,EADXpG,GAAkBoG,EErExB,SAAoBrsB,EAAOf,EAAU,gBACnD,IAQI5C,GARAhE,UACHA,EAAY8G,GAAS9G,UAAAoE,OACrBA,EACF6H,QAAEA,GAAU,EACVxH,OAAQyvB,EACR7pB,MAAOsf,EAAAzgB,OACPA,GACGtC,EAGAutB,EAAgE7oB,GAAS3D,GAEzEyC,EAAWhG,EACXmF,EAAY4qB,EAAc5qB,UAE1BA,IAAcnF,IACbmF,EAAUnF,OAAOkB,iBACpBlB,EAASmF,EAAUnF,OACnBgG,EAAWb,EAAUa,UAGtB,MAAA8pB,IAAAA,EAAgB3qB,EAAU3E,OAC1B,MAAA+kB,IAAAA,EAAgBpgB,EAAUgB,WAC1B,MAAArB,IAAAA,EAAWK,EAAUL,SAGlBkB,IAEHhG,EAAS,OAAA/B,EAAA8xB,EAAc9vB,MAAMwG,UAAUzG,IAA9B/B,EAAyCuH,GAAWC,WAAWO,IAGpEhG,IAEJA,EAAS,OAAAgD,EAAA+sB,EAAc9vB,MAAMwG,UAAU,YAA9BzD,EAA4CwC,GAAWwqB,eAChEhqB,EAAWhG,EAAOlG,MAGfkG,GAAUA,EAAOC,OAASD,EAAOC,QAAU8vB,EAAc9vB,QAG5D8vB,EAAgBlzB,GAAGkzB,EAAe/vB,EAAOC,QAO1C,IAAII,EAAS0vB,EAAc1vB,OAAOkE,QASlC,GAPAsD,IAAAA,EAAY7H,EAAOmZ,SAEftR,IAAYooB,GAAaF,KAE5B1vB,EAAS8Y,GAAQhK,GAAM4gB,IAA4B,IAAZloB,OAAmB,EAAYA,GAASxH,QAG5D,WAAhBL,EAAO3E,KAAmB,CAC7B,IAAI2E,EAAOL,UAIV,MAAM,IAAIR,UACT,UAAU6G,6DAJXpG,EAAMI,EAAOL,UAAUU,EAAQ0vB,EAAc9pB,MAAOzD,EAOtD,KACK,CAEJ,IAAI1I,EAAOkG,EAAOlG,MAAQ,QAEtBsH,EAAOpB,EAAOU,gBAAgBL,EAAQzE,EAAWk0B,GAErD,GAAa,UAATh2B,EAAkB,CAErB,IAAI+L,EACH7F,EAAOa,KAAM,OAAAiC,EAAA9C,EAAOuF,UAAP,EAAAzC,EAAa,KAAMitB,EAAc9vB,MAAM4F,OAASkqB,EAAc9vB,MAAMY,GAClFO,EAAK8uB,QAAQrqB,EACd,CAIA,IAAII,EAAQ8pB,EAAc9pB,WAEN,IAAhBsf,GAAsD,iBAAhBA,IACzCA,EACwB,iBAAhBA,EAA2B,CAAElqB,KAAMkqB,GAAgB,CAAE4K,QAAS5K,IAGvE,IAAIpf,EAAY,OAAAL,EAAA,MAAAyf,OAAA,EAAAA,EAAalqB,MAAbyK,EAAqB,WACjCsqB,GACsB,KAAzB,MAAA7K,OAAA,EAAAA,EAAa4K,WACI,IAAjBnwB,EAAOiG,QACmB,KAAzB,MAAAsf,OAAA,EAAAA,EAAa4K,WAAsC,IAAjBnwB,EAAOiG,OAAmBA,EAAQ,EAClEoqB,EAAW,GAIf,GAFA,MAAAvrB,IAAAA,EAAW9E,EAAO8E,QAEdsrB,EAAgB,CACnB,GAAkB,OAAdx0B,EAAoB,CACvB,IAAIC,EAEc,iBAAdsK,IACHtK,EAAO,IACPoK,GAAS,KAGVA,EAAQqqB,GAAqBrqB,EAAO,CAAErK,YAAWC,QAClD,CAEAw0B,EAAW,GAAGvrB,EAAS,IAAM,QAAQmB,GACtC,CAEArG,EAAM,GAAG9F,KAAQsH,EAAK6F,KAAKnC,EAAS,KAAO,OAAOurB,IACnD,CAEA,OAAOzwB,CACR,CFjDsBD,CADEwZ,GAAQtc,GAAGsd,EAASmO,GADT,QAATsH,EAAiB,OAASA,KAET,CAAEh0B,UAAW,MAEXgtB,IACvCgE,EAAAnzB,KAAKsyB,GAAOjvB,MAAQ+yB,EACpBp2B,KAAK+1B,aAAa,QAASK,GAC3BJ,EAAAh2B,KAAKqyB,EAAA4D,GAALt1B,KAAAX,KACF,CAAA,MAAU,CACV60B,EAAA70B,KAAK8zB,GAAsB,GAEvBX,EAAAnzB,KAAKi0B,IAAW+B,EAAAh2B,KAAKqyB,EAAAyE,GAALn2B,KAAAX,KACtB,CAEA,SAAI+2B,GAAU,OAAO5D,OAAKV,GAAOpvB,KAAM,CACvC,SAAI0zB,CAAM73B,GACR,MAAMi3B,EAAqB,UAANj3B,GAAuB,SAANA,EAAgBA,EAAI,OAC1Di0B,EAAAnzB,KAAKyyB,GAAOpvB,MAAQ8yB,EACP,SAATA,EAAiBn2B,KAAKg3B,gBAAgB,SACrCh3B,KAAK+1B,aAAa,QAASI,EAClC,CAEA,WAAIc,GAAY,OAAO9D,OAAKN,GAASxvB,KAAM,CAC3C,WAAI4zB,CAAQv3B,GACVyzB,EAAAnzB,KAAK6yB,GAASxvB,QAAU3D,EACpBA,EAAGM,KAAK+1B,aAAa,WAAY,IAChC/1B,KAAKg3B,gBAAgB,WAC5B,CAEA,SAAI3D,GAAU,OAAOF,OAAKC,GAAO/vB,KAAM,CACvC,iBAAI6vB,GAAkB,OAAOC,OAAKL,GAAUzvB,KAAM,CAElD,IAAA6zB,CAAKC,WACCA,IAAQhE,EAAAnzB,KAAK2yB,GAAQtvB,MAAQ8zB,GACjC,OAAA5tB,EAAA,OAAA/E,EAAA2uB,EAAAnzB,KAAKg0B,WAALxvB,EAAa4yB,cAAb7tB,EAAA5I,KAAA6D,GACAwxB,EAAAh2B,KAAKqyB,EAAAgF,GAAL12B,KAAAX,KACF,CACA,KAAAs3B,WAAU,OAAA/tB,EAAA,OAAA/E,EAAA2uB,EAAAnzB,KAAKg0B,WAALxvB,EAAa+yB,cAAbhuB,EAAA5I,KAAA6D,GAA8BwxB,EAAAh2B,KAAKqyB,EAAAmF,GAAL72B,KAAAX,KAAuB,CAC/D,UAAAy3B,GAAez3B,KAAKk3B,MAAO,CAE3B,SAAAQ,CAAUC,GAA0BxE,EAAAnzB,KAAK2yB,GAAQtvB,MAAQs0B,CAAG,CAC5D,YAAIC,CAASl4B,GAAaM,KAAKqD,MAAQ3D,CAAE,CACzC,oBAAIm4B,CAAiBF,GAA0B33B,KAAK03B,UAAUC,EAAI,CAmClE,iBAAAG,SACE,MAAMC,EAAM5E,EAAAnzB,KAAK+zB,GAAMiE,cAAiC,kBACxDnD,EAAA70B,KAAKq0B,EAAmB,MAAA0D,EAAAA,OAAO,GAC/BlD,EAAA70B,KAAKg0B,EAASb,EAAAnzB,KAAK+zB,GAAMiE,cAAc,WACvCnD,EAAA70B,KAAKi0B,EAAYd,EAAAnzB,KAAK+zB,GAAMiE,cAAc,cAC1CnD,EAAA70B,KAAKk0B,EAAef,EAAAnzB,KAAK+zB,GAAMiE,cAAc,WAC7CnD,EAAA70B,KAAKm0B,EAAUhB,EAAAnzB,KAAK+zB,GAAMiE,cAAc,gBACxCnD,EAAA70B,KAAKo0B,EAAQjB,EAAAnzB,KAAK+zB,GAAMiE,cAAc,UACtCnD,EAAA70B,KAAKs0B,EAAanB,EAAAnzB,KAAK+zB,GAAMiE,cAAc,gBAC3CnD,EAAA70B,KAAKu0B,EAAgBpB,EAAAnzB,KAAK+zB,GAAMiE,cAAc,mBAG9C,MAAMC,EAAU9E,EAAAnzB,KAAK+zB,GAAMiE,cAAiC,mBACtDE,EAAc/E,EAAAnzB,KAAK+zB,GAAMiE,cAA2B,iBACpDG,EAAwBhF,EAAAnzB,KAAK+zB,GAAMiE,cAA2B,6BACpE,GAAIC,GAAWC,GAAeC,EAAuB,CACnD,IAAIC,EAA6B,KACjCH,EAAQI,iBAAiB,QAASC,UAChC,UACQC,UAAUC,UAAUC,UAAUtF,EAAAnzB,KAAKsyB,GAAOjvB,OAChD60B,EAAYQ,UAAU7wB,IAAI,QAC1BswB,EAAsBQ,UAAYT,EAAYS,UAC1B,OAAhBP,GAAsBQ,aAAaR,GACvCA,EAAcS,OAAOC,WAAW,KAC9BZ,EAAYQ,UAAUK,OAAO,QAC7BZ,EAAsBQ,UAAY,GAClCP,EAAc,MACb,IACL,CAAA,MAAU,GAEd,CAGAjF,EAAAnzB,KAAKk0B,GAAasB,UAAY,w5BAyB1BuC,KAASM,iBAAiB,QAAS,IAAMr4B,KAAKk3B,KAAKa,IAGnD5E,OAAKmB,KACPnB,EAAAnzB,KAAKs0B,GAAWjxB,MAAQ8vB,EAAAnzB,KAAKsyB,GAAOjvB,MAEpC8vB,EAAAnzB,KAAKs0B,GAAW+D,iBAAiB,QAAU14B,IACzC,MAAMq5B,EAAcr5B,EAAEs5B,OAA4B51B,MAClD2yB,EAAAh2B,KAAKqyB,KAAL1xB,KAAAX,KAA0Bg5B,KAG5B7F,EAAAnzB,KAAKs0B,GAAW+D,iBAAiB,QAAU14B,QAM7CK,KAAKq4B,iBAAiB,UAAYa,IAChC,MAAMC,EAAWD,EAAWC,QAC5B,IAAKA,EAAS,OACd,MAAMC,EAAmBF,EAAWG,QAAWH,EAAWI,UAAYnE,SAASoE,yBAAyBpH,YAAcgD,SAASoE,cAAgB,MAC3IH,IAAmBvE,EAAA70B,KAAKw0B,EAAe4E,GAAiBp5B,KAAK03B,UAAU0B,IAC3D,iBAAZD,GAA0C,SAAZA,EAAoBn5B,KAAKk3B,KAAK/D,OAAKqB,IAChD,iBAAZ2E,GAA0C,UAAZA,OAA0B7B,QAC5C,mBAAZ6B,GAA4C,WAAZA,IACnChG,EAAAnzB,KAAK0yB,GAAMrvB,MAAOrD,KAAKs3B,QAAct3B,KAAKk3B,KAAK/D,EAAAnzB,KAAKw0B,OAI5D,OAAAhwB,EAAA2uB,EAAAnzB,KAAKg0B,KAALxvB,EAAa6zB,iBAAiB,SAAU,WACtC,MAAMV,EAAKxE,EAAAnzB,KAAKg0B,GAChB,IAAIwF,GAAU7B,EAAG8B,aAAa,UAC9B,IACED,EAAS,OAAAh1B,EAAAmzB,EAAGhoB,QAAQ,mBAAXnL,CACX,CAAA,MAAU,CACV2uB,EAAAnzB,KAAK0yB,GAAMrvB,MAAQm2B,EACfA,EACFxD,EAAAh2B,KAAKqyB,EAAAgF,GAAL12B,KAAAX,MAEAg2B,EAAAh2B,KAAKqyB,EAAAmF,GAAL72B,KAAAX,MAEFA,KAAK05B,cAAc,IAAIC,YAAYH,EAAS,OAAS,QAAS,CAAEI,SAAS,OAG3EzG,EAAAnzB,KAAKk0B,GAAamE,iBAAiB,SAAU,KAC3Cr4B,KAAKk2B,WAAa/C,OAAKe,GAAc7wB,MACrC2yB,EAAAh2B,KAAKqyB,EAAAyE,GAALn2B,KAAAX,QAIF60B,EAAA70B,KAAK0zB,EAAwBmG,GAAO,KAClC,MAAMn6B,EAAIyzB,OAAKb,GAAOjvB,MAChBgwB,EAAQF,OAAKC,GAAO/vB,MACpBmqB,EAAW2F,OAAKL,GAAUzvB,MAC5B8vB,EAAAnzB,KAAKm0B,KAAShB,EAAAnzB,KAAKm0B,GAAQ9wB,MAAQ3D,GACnCyzB,OAAKiB,IAAOjB,EAAAnzB,KAAKo0B,GAAM0F,MAAMC,YAAY,UAAWr6B,GACpDyzB,EAAAnzB,KAAKs0B,IAAcnB,EAAAnzB,KAAKs0B,GAAWjxB,QAAU3D,IAC/CyzB,EAAAnzB,KAAKs0B,GAAWjxB,MAAQ3D,GAE1BM,KAAK85B,MAAMC,YAAY,aAAcvM,GACrCxtB,KAAK85B,MAAMC,YAAY,YAA0B,UAAbvM,EAAuB,QAAU,SACrE,MAAMwM,EAAU7G,EAAAnzB,KAAK+zB,GAAMiE,cAAc,UACrCgC,MAAiB3E,YAAchC,GACnC,MAAM4G,EAAU9G,EAAAnzB,KAAK+zB,GAAMiE,cAAc,YACrCiC,GAASA,EAAQH,MAAMC,YAAY,UAAWr6B,MAGpDm1B,EAAA70B,KAAK4zB,EAAsBiG,GAAO,KAChC,MAAMK,EAAQ/G,OAAKP,GAAOvvB,MACtB62B,GACFl6B,KAAK+1B,aAAa,aAAc,IAC5B5C,EAAAnzB,KAAKu0B,KAAepB,EAAAnzB,KAAKu0B,GAAcc,YAAc6E,GACrD/G,OAAKmB,IAAYnB,EAAAnzB,KAAKs0B,GAAWyB,aAAa,eAAgB,UAElE/1B,KAAKg3B,gBAAgB,cACjB7D,EAAAnzB,KAAKu0B,KAAepB,EAAAnzB,KAAKu0B,GAAcc,YAAc,IACrDlC,OAAKmB,IAAYnB,EAAAnzB,KAAKs0B,GAAWyB,aAAa,eAAgB,aAItElB,EAAA70B,KAAK2zB,EAA4BkG,GAAO,KACtC,MAAM9C,EAAQ5D,OAAKV,GAAOpvB,MACpB82B,EAAwB,SAAVpD,EAAmB,aAAeA,EACtD/2B,KAAK85B,MAAMC,YAAY,eAAgBI,MAIpCn6B,KAAKy5B,aAAa,UAAUz5B,KAAK+1B,aAAa,QAASnE,IACvD5xB,KAAKy5B,aAAa,eAGrBz5B,KAAK+1B,aAAa,aAAc5C,EAAAnzB,KAAKwyB,GAAOnvB,OAG9C8vB,EAAAnzB,KAAKk0B,GAAa7wB,MAAQ8vB,EAAAnzB,KAAKwyB,GAAOnvB,MACtC2yB,EAAAh2B,KAAKqyB,EAAAyE,GAALn2B,KAAAX,KACF,CAEA,oBAAAo6B,GACMjH,EAAAnzB,KAAK2zB,IAA2BR,EAAAnzB,KAAK2zB,GAALhzB,KAAAX,MAChCmzB,EAAAnzB,KAAK0zB,IAAuBP,EAAAnzB,KAAK0zB,GAAL/yB,KAAAX,MAC5BmzB,EAAAnzB,KAAK4zB,IAAqBT,EAAAnzB,KAAK4zB,GAALjzB,KAAAX,KAChC,CAEA,wBAAAq6B,CAAyBh6B,EAAci6B,EAAqBj3B,GAC1D,GAAIA,IAAUi3B,IAEVnH,OAAKW,GAAT,CAEA,GAAa,UAATzzB,GAAqC,iBAAVgD,EAC7B,IACE,MACMwyB,EAAM/G,GADGpnB,GAAMrE,GACoBuJ,SACnCkpB,EAAyB,iBAAVzyB,GAAsBA,EAAMoC,OAAO2F,WAAW,KACnE+nB,EAAAnzB,KAAKsyB,GAAOjvB,MAAQA,EACpB8vB,EAAAnzB,KAAKwyB,GAAOnvB,MAAQyyB,EAAQ,MAAiB,QAARD,EAAgB,OAAUA,EAC3D1C,OAAKe,KAAcf,EAAAnzB,KAAKk0B,GAAa7wB,MAAQ8vB,OAAKX,GAAOnvB,MAC/D,CAAA,MAAU,CAEC,eAAThD,GAAyBgD,IAC3B8vB,EAAAnzB,KAAKwyB,GAAOnvB,MAAQA,EAChB8vB,EAAAnzB,KAAKk0B,KAAcf,EAAAnzB,KAAKk0B,GAAa7wB,MAAQA,IAEtC,UAAThD,IACF8yB,EAAAnzB,KAAKyyB,GAAOpvB,MAASA,GAAmB,QAE7B,aAAThD,IACF8yB,EAAAnzB,KAAK6yB,GAASxvB,MAAkB,OAAVA,EAClB8vB,EAAAnzB,KAAKi0B,IAAW+B,EAAAh2B,KAAKqyB,EAAAyE,GAALn2B,KAAAX,MArBQ,CAuBhC,SAnTAsyB,EAAA,IAAAiI,QACA/H,EAAA,IAAA+H,QACA9H,EAAA,IAAA8H,QACA7H,EAAA,IAAA6H,QACA5H,EAAA,IAAA4H,QACA3H,EAAA,IAAA2H,QACA1H,EAAA,IAAA0H,QAEAzH,EAAA,IAAAyH,QACAnH,EAAA,IAAAmH,QAEA7G,EAAA,IAAA6G,QACA5G,EAAA,IAAA4G,QACA3G,EAAA,IAAA2G,QACA1G,EAAA,IAAA0G,QACAzG,EAAA,IAAAyG,QA0EAxG,EAAA,IAAAwG,QACAvG,EAAA,IAAAuG,QACAtG,EAAA,IAAAsG,QACArG,EAAA,IAAAqG,QACApG,EAAA,IAAAoG,QACAnG,EAAA,IAAAmG,QACAlG,EAAA,IAAAkG,QACAjG,EAAA,IAAAiG,QACAhG,EAAA,IAAAgG,QACA/F,EAAA,IAAA+F,QAxGKlI,EAAA,IAAAmI,QA2TLvE,EAAA,WACE,MAAMwE,EAAuB,CAAEp3B,MAAO8vB,EAAAnzB,KAAKsyB,GAAOjvB,MAAO6yB,WAAY/C,EAAAnzB,KAAKwyB,GAAOnvB,MAAOgwB,MAAOF,EAAAnzB,KAAKozB,GAAO/vB,OAC3GrD,KAAK05B,cAAc,IAAIC,YAA0B,SAAU,CAAEc,SAAQb,SAAS,IAChF,EAEAc,WAAqB1B,GACnB,GAAKA,GAAeA,EAAWvzB,OAK/B,IACE,MACMowB,EAAM/G,GADGpnB,GAAMsxB,GACoBpsB,SACnCkpB,EAA8B,iBAAfkD,GAA2BA,EAAWvzB,OAAO2F,WAAW,KAG7E+nB,EAAAnzB,KAAK4yB,GAAOvvB,MAAQ,KAGpB8vB,EAAAnzB,KAAKwyB,GAAOnvB,MAAQyyB,EAAQ,MAAiB,QAARD,EAAgB,OAAUA,EAC/D1C,EAAAnzB,KAAKsyB,GAAOjvB,MAAQ21B,EACpBh5B,KAAK+1B,aAAa,QAASiD,GAC3Bh5B,KAAK+1B,aAAa,aAAc5C,EAAAnzB,KAAKwyB,GAAOnvB,OACxC8vB,OAAKe,KAAcf,EAAAnzB,KAAKk0B,GAAa7wB,MAAQ8vB,OAAKX,GAAOnvB,OAC7D2yB,EAAAh2B,KAAKqyB,EAAA4D,GAALt1B,KAAAX,KACF,OAASk6B,GACP/G,EAAAnzB,KAAK4yB,GAAOvvB,MAAQ,sBACtB,MArBE8vB,EAAAnzB,KAAK4yB,GAAOvvB,MAAQ,sBAsBxB,EAKAoxB,EAAA,IAAA8F,QACA7F,EAAA,IAAA6F,QACA5F,EAAA,IAAA4F,QACA3F,EAAA,IAAA2F,QAEAlD,EAAA,mBACE,GAAIlE,EAAAnzB,KAAK20B,GAAS5pB,OAAQ,OAC1BirB,EAAAh2B,KAAKqyB,EAAAsI,GAALh6B,KAAAX,MAEA,MAAMm3B,EAAS,OAAA5tB,EAAA,OAAA/E,EAAA2uB,EAAAnzB,KAAK2yB,GAAQtvB,OAAbmB,EAAsB2uB,EAAAnzB,KAAKw0B,IAA3BjrB,EAA2C4pB,EAAAnzB,KAAKq0B,GAC/D,GAAK8C,GAAWhE,EAAAnzB,KAAKg0B,GAArB,CAEA,GAA8B,oBAAnB4G,eAAgC,CACzC,MAAMC,EAAK,IAAID,eAAe,IAAM5E,EAAAh2B,KAAKqyB,KAAL1xB,KAAAX,OACpC66B,EAAGC,QAAQ3D,GACX0D,EAAGC,QAAQ3H,OAAKa,IAChB6G,EAAGC,QAAQ3F,SAAS4F,iBACpB5H,EAAAnzB,KAAK20B,GAAS7tB,KAAK,IAAM+zB,EAAGG,aAC9B,KAAO,CACL,MAAMC,EAAW,IAAMjF,EAAAh2B,KAAKqyB,EAAAsI,GAALh6B,KAAAX,MACvB64B,OAAOR,iBAAiB,SAAU4C,GAClC9H,EAAAnzB,KAAK20B,GAAS7tB,KAAK,IAAM+xB,OAAOqC,oBAAoB,SAAUD,GAChE,CAEA,GAAIpC,OAAOsC,eAAgB,CACzB,MAAMC,EAAO,IAAMpF,EAAAh2B,KAAKqyB,EAAAsI,GAALh6B,KAAAX,MACnB64B,OAAOsC,eAAe9C,iBAAiB,SAAU+C,GACjDvC,OAAOsC,eAAe9C,iBAAiB,SAAU+C,GACjDjI,EAAAnzB,KAAK20B,GAAS7tB,KAAK,aACjB,OAAAtC,EAAAq0B,OAAOsC,iBAAP32B,EAAuB02B,oBAAoB,SAAUE,GACrD,OAAA7xB,EAAAsvB,OAAOsC,iBAAP5xB,EAAuB2xB,oBAAoB,SAAUE,IAEzD,CASA,GD7MG,SAA0BzD,GAC/B,MAAM0D,EAAqB,GAC3B,IAAI3a,EAA0BiX,EAAG2D,cAEjC,KAAO5a,GAAWA,IAAYyU,SAAS4F,iBAAiB,CACtD,MAAMjB,EAAQyB,iBAAiB7a,GACzB8a,EAAY1B,EAAM0B,UAClBC,EAAY3B,EAAM2B,UAGP,SAAdD,GAAsC,WAAdA,GAAwC,SAAdC,GAAsC,WAAdA,KAC1E/a,EAAQgb,aAAehb,EAAQib,cAAgBjb,EAAQkb,YAAclb,EAAQmb,cAE9ER,EAAQv0B,KAAK4Z,GAGfA,EAAUA,EAAQ4a,aACpB,CAOA,OAJInG,SAAS2G,kBACXT,EAAQv0B,KAAKquB,SAAS2G,kBAGjBT,CACT,CC6K0BU,CAAiB5E,GACzBhvB,QAAS6zB,IACrB,MAAMC,EAAW,IAAMjG,EAAAh2B,KAAKqyB,EAAAsI,GAALh6B,KAAAX,MACvBg8B,EAAG3D,iBAAiB,SAAU4D,EAAU,CAAEC,SAAS,IACnD/I,EAAAnzB,KAAK20B,GAAS7tB,KAAK,IAAMk1B,EAAGd,oBAAoB,SAAUe,MAGxB,oBAAzBE,qBAAsC,CAC/C,MAAMC,EAAK,IAAID,qBAAqB,IAAMnG,EAAAh2B,KAAKqyB,KAAL1xB,KAAAX,MAA4B,CAAEq8B,UAAW,IACnFD,EAAGtB,QAAQ3D,GACXhE,EAAAnzB,KAAK20B,GAAS7tB,KAAK,IAAMs1B,EAAGpB,aAC9B,CAnC6B,CAoC/B,EAEAxD,EAAA,WACErE,EAAAnzB,KAAK20B,GAASxsB,QAASm0B,GAAOA,KAC9BzH,EAAA70B,KAAK20B,EAAW,IACI,OAAhBxB,EAAAnzB,KAAK40B,KACP2H,qBAAqBpJ,OAAKyB,IAC1BC,EAAA70B,KAAK40B,EAAS,MAElB,EAEA+F,EAAA,WACsB,OAAhBxH,EAAAnzB,KAAK40B,IACTC,EAAA70B,KAAK40B,EAAS4H,sBAAsB,KAClC3H,EAAA70B,KAAK40B,EAAS,MACdoB,EAAAh2B,KAAKqyB,EAAAoK,GAAL97B,KAAAX,QAEJ,EAEAy8B,EAAA,WACE,IAAKtJ,OAAKa,GAAQ,OAClB,MAAM0I,EAAQvJ,EAAAnzB,KAAKg0B,GAEb2I,EAAa3G,OAAK3D,EAAAuK,GAALj8B,KAAAX,MACb68B,ED9ZH,WACL,GAAI1L,GAAc,OAAOA,GAEzB,MAAM2L,EAAQ3H,SAASC,cAAc,OACrC0H,EAAMhD,MAAMiD,SAAW,QACvBD,EAAMhD,MAAMvI,KAAO,UACnBuL,EAAMhD,MAAMtI,IAAM,IAClBsL,EAAMhD,MAAMkD,WAAa,2BACzBF,EAAMhD,MAAMmD,aAAe,6BAC3BH,EAAMhD,MAAMoD,cAAgB,8BAC5BJ,EAAMhD,MAAMqD,YAAc,4BAC1BhI,SAAS4F,gBAAgBzF,YAAYwH,GAErC,MAAM/J,EAAWwI,iBAAiBuB,GAC5BtL,EAAMnQ,WAAW0R,EAASiK,aAAe,EACzCvL,EAAQpQ,WAAW0R,EAASkK,eAAiB,EAC7CvL,EAASrQ,WAAW0R,EAASmK,gBAAkB,EAC/C3L,EAAOlQ,WAAW0R,EAASoK,cAAgB,EAIjD,OAFAhI,SAAS4F,gBAAgBqC,YAAYN,GACrC3L,GAAe,CAAEK,MAAKC,QAAOC,SAAQH,QAC9BJ,EACT,CCwYmBkM,GACT/L,EDpYH,SAA8BuL,eACnC,MAAMS,EAAK,OAAA/zB,EAAA,OAAA/E,EAAAq0B,OAAOsC,uBAAP32B,EAAuB+4B,OAAvBh0B,EAAgCsvB,OAAO2E,WAC5CC,EAAK,OAAApxB,EAAA,OAAAhD,EAAAwvB,OAAOsC,qBAAP,EAAA9xB,EAAuBq0B,QAAvBrxB,EAAiCwsB,OAAO8E,YAC7CC,EAAU/E,OAAOgF,aAAe1I,SAAS4F,gBAAgB+C,WACzDC,EAAUlF,OAAOmF,aAAe7I,SAAS4F,gBAAgBkD,UAEzD1M,EAAOsL,EAAOtL,KAtES,EAsEgBqM,EACvCpM,EAAMqL,EAAOrL,IAvEU,EAuEcuM,EACrCtM,EAAQ6L,EAAKT,EAAOpL,MAxEG,EAwEuBmM,EAC9ClM,EAAS+L,EAAKZ,EAAOnL,OAzEE,EAyEyBqM,EAEtD,MAAO,CACLxM,OACAC,MACAC,QACAC,SACA6L,MAAO9L,EAAQF,EACfmM,OAAQhM,EAASF,EAErB,CCiXqB0M,CAAqBrB,GAChCsB,EAAOnI,EAAAh2B,KAAKqyB,EAAA+L,GAALz9B,KAAAX,KAAmB08B,GAE1B2B,ED/WH,SAA2BlH,EAAcgH,GAC9C,MAAQZ,MAAO18B,EAAG68B,OAAQt+B,GAAM++B,EAC1BG,EAA0B,CAC9B,CACEC,UAAW,gBACXhN,KAAM4F,EAAO5F,KAAO4F,EAAOoG,MAAQ,EAAI18B,EAAI,EAC3C2wB,IAAK2F,EAAOzF,OA7FI,EA8FhBD,MAAO,EAAGC,OAAQ,GAEpB,CACE6M,UAAW,aACXhN,KAAM4F,EAAO5F,KAAO4F,EAAOoG,MAAQ,EAAI18B,EAAI,EAC3C2wB,IAAK2F,EAAO3F,IAnGI,EAmGWpyB,EAC3BqyB,MAAO,EAAGC,OAAQ,GAEpB,CACE6M,UAAW,cACXhN,KAAM4F,EAAO1F,MAxGG,EAyGhBD,IAAK2F,EAAO3F,IACZC,MAAO,EAAGC,OAAQ,GAEpB,CACE6M,UAAW,aACXhN,KAAM4F,EAAO5F,KA9GG,EA8Ga1wB,EAC7B2wB,IAAK2F,EAAO3F,IACZC,MAAO,EAAGC,OAAQ,GAEpB,CACE6M,UAAW,cACXhN,KAAM4F,EAAO5F,KACbC,IAAK2F,EAAOzF,OArHI,EAsHhBD,MAAO,EAAGC,OAAQ,GAEpB,CACE6M,UAAW,eACXhN,KAAM4F,EAAO1F,MAAQ5wB,EACrB2wB,IAAK2F,EAAOzF,OA3HI,EA4HhBD,MAAO,EAAGC,OAAQ,GAEpB,CACE6M,UAAW,WACXhN,KAAM4F,EAAO5F,KACbC,IAAK2F,EAAO3F,IAjII,EAiIWpyB,EAC3BqyB,MAAO,EAAGC,OAAQ,GAEpB,CACE6M,UAAW,YACXhN,KAAM4F,EAAO1F,MAAQ5wB,EACrB2wB,IAAK2F,EAAO3F,IAvII,EAuIWpyB,EAC3BqyB,MAAO,EAAGC,OAAQ,IAUtB,OALA4M,EAAWn2B,QAAStI,IAClBA,EAAE4xB,MAAQ5xB,EAAE0xB,KAAO1wB,EACnBhB,EAAE6xB,OAAS7xB,EAAE2xB,IAAMpyB,IAGdk/B,CACT,CCmTuBE,CAAkB7B,EAAYwB,GAC3CM,ED9SH,SACLJ,EACA/M,EACAoN,GAGA,GAAIA,EAAe,CACjB,MAAM9hB,EAAOyhB,EAAW/2B,KAAM9H,GAAMA,EAAE++B,YAAcG,GACpD,GAAI9hB,GAAQwU,GAAWxU,EAAM0U,GAC3B,OAAO1U,CAEX,CAGA,IAAA,MAAWpd,KAAK6+B,EACd,GAAIjN,GAAW5xB,EAAG8xB,GAChB,OAAO9xB,EAKX,IAAIm/B,EAAON,EAAW,GAClBO,EAAUjN,GAAYgN,EAAMrN,GAEhC,IAAA,IAASvyB,EAAI,EAAGA,EAAIs/B,EAAWtzB,OAAQhM,IAAK,CAC1C,MAAM8/B,EAAOlN,GAAY0M,EAAWt/B,GAAIuyB,GACpCuN,EAAOD,IACTA,EAAUC,EACVF,EAAON,EAAWt/B,GAEtB,CAEA,OAAO4/B,CACT,CC6QiBG,CAAsBT,EAAY/M,EAAU6B,OAAKsB,IAC9DI,EAAA70B,KAAKy0B,EAAiBgK,EAAKF,WAE3B,MAAMhN,EAAO9uB,KAAKspB,MAAMtpB,KAAKe,IAAIf,KAAKiB,IAAI+6B,EAAKlN,KAAMD,EAASC,MAAOD,EAASG,MAAQ0M,EAAKZ,QACrF/L,EAAM/uB,KAAKspB,MAAMtpB,KAAKe,IAAIf,KAAKiB,IAAI+6B,EAAKjN,IAAKF,EAASE,KAAMF,EAASI,OAASyM,EAAKT,SAEnFqB,EAAiBzN,EAASI,OAASJ,EAASE,IAC9C2M,EAAKT,OAASqB,GAChBrC,EAAM5C,MAAMkF,UAAY,GAAGD,MAC3BrC,EAAM5C,MAAMmF,SAAW,QACdvC,EAAM5C,MAAMkF,YACrBtC,EAAM5C,MAAMkF,UAAY,GACxBtC,EAAM5C,MAAMmF,SAAW,IAGzBvC,EAAM5C,MAAMiD,SAAW,WACvBL,EAAM5C,MAAMvI,KAAO,GAAGA,MACtBmL,EAAM5C,MAAMtI,IAAM,GAAGA,MACrBkL,EAAM5C,MAAMC,YAAY,uBAAwB0E,EAAKF,WACrD7B,EAAMwC,QAAQX,UAAYE,EAAKF,SACjC,EAEA3B,EAAA,6BACE,MAAMzF,EAAS,OAAA9tB,EAAA,OAAAE,EAAA,OAAA/E,EAAA2uB,EAAAnzB,KAAK2yB,GAAQtvB,OAAbmB,EAAsB2uB,EAAAnzB,KAAKw0B,IAA3BjrB,EAA2C4pB,EAAAnzB,KAAKq0B,IAAhDhrB,EAAoErJ,KAC7E49B,EAAU/E,OAAOgF,aAAe1I,SAAS4F,gBAAgB+C,WACzDC,EAAUlF,OAAOmF,aAAe7I,SAAS4F,gBAAgBkD,UAE/D,IAAK9G,EAAOgI,YAAa,CACvB,MAEMC,GAFK,OAAArxB,EAAA,OAAA1B,EAAAwsB,OAAOsC,qBAAP,EAAA9uB,EAAuBkxB,SAAS1E,OAAO2E,YAElC,EAAII,EACdyB,GAFK,OAAAjQ,EAAA,OAAAphB,EAAA6qB,OAAOsC,qBAAP,EAAAntB,EAAuB0vB,UAAU7E,OAAO8E,aAEnC,EAAII,EACpB,MAAO,CAAExM,KAAM6N,EAAI5N,IAAK6N,EAAI5N,MAAO2N,EAAI1N,OAAQ2N,EAAI9B,MAAO,EAAGG,OAAQ,EACvE,CACA,MAAM4B,EAAOnI,EAAOoI,wBACpB,MAAO,CACLhO,KAAM+N,EAAK/N,KAAOqM,EAClBpM,IAAK8N,EAAK9N,IAAMuM,EAChBtM,MAAO6N,EAAK7N,MAAQmM,EACpBlM,OAAQ4N,EAAK5N,OAASqM,EACtBR,MAAO+B,EAAK/B,MACZG,OAAQ4B,EAAK5B,OAEjB,EAEAU,WAAc1B,SACZ,MAAM4C,EAAO5C,EAAM6C,wBACnB,GAAID,EAAK/B,MAAQ,GAAK+B,EAAK5B,OAAS,EAElC,OADA7I,EAAA70B,KAAK00B,EAAiB,CAAE6I,MAAO+B,EAAK/B,MAAOG,OAAQ4B,EAAK5B,SACjDvK,EAAAnzB,KAAK00B,GAGd,MAAM8K,EAAQ,CACZC,QAAS/C,EAAM5C,MAAM2F,QACrB1C,SAAUL,EAAM5C,MAAMiD,SACtBxL,KAAMmL,EAAM5C,MAAMvI,KAClBC,IAAKkL,EAAM5C,MAAMtI,IACjBkO,WAAYhD,EAAM5C,MAAM4F,WACxBV,UAAWtC,EAAM5C,MAAMkF,WAEzBtC,EAAM5C,MAAM2F,QAAU,QACtB/C,EAAM5C,MAAMiD,SAAW,WACvBL,EAAM5C,MAAMvI,KAAO,WACnBmL,EAAM5C,MAAMtI,IAAM,IAClBkL,EAAM5C,MAAM4F,WAAa,SACzBhD,EAAM5C,MAAMkF,UAAY,OAExB,MAAMW,EAAQjD,EAAM6C,wBAQpB,OAPA7C,EAAM5C,MAAM2F,QAAUD,EAAMC,QAC5B/C,EAAM5C,MAAMiD,SAAWyC,EAAMzC,SAC7BL,EAAM5C,MAAMvI,KAAOiO,EAAMjO,KACzBmL,EAAM5C,MAAMtI,IAAMgO,EAAMhO,IACxBkL,EAAM5C,MAAM4F,WAAaF,EAAME,WAC/BhD,EAAM5C,MAAMkF,UAAYQ,EAAMR,UAE1BW,EAAMpC,MAAQ,GAAKoC,EAAMjC,OAAS,GACpC7I,EAAA70B,KAAK00B,EAAiB,CAAE6I,MAAOoC,EAAMpC,MAAOG,OAAQiC,EAAMjC,SACnDvK,EAAAnzB,KAAK00B,IAGP,OAAAlwB,EAAA2uB,OAAKuB,IAALlwB,EAAuB,CAAE+4B,MAAO,IAAKG,OAAQ,IACtD,EAKA5G,EAAA,+CACM3D,EAAAnzB,KAAK6zB,IAAwBV,EAAAnzB,KAAK6zB,GAALlzB,KAAAX,MACjC,MAAMwG,EAAQ2sB,OAAKX,GAAOnvB,MAC1B,IAAK8vB,OAAKc,GAAW,OACrB,MACM9E,EADUY,GAAkBvpB,EAAO2sB,EAAAnzB,KAAKsyB,GAAOjvB,OAClC8rB,GAEbyQ,EAAoE,CAAA,EAC1E/9B,OAAO0L,KAAK4hB,GAAIhnB,QAAQ03B,IACtBD,EAAeC,GAAOtN,GAAO1oB,OAAOslB,EAAG0Q,OAGzC,MAAMC,EAAO,CAACC,EAAeF,EAAar8B,EAAaE,EAAas8B,EAAO,EAAGC,EAAaC,aACzF,MAAMC,EAAkB,MAARN,EACVO,EAAe,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,OAAO90B,SAASu0B,GACnEQ,EAAkB,MAARR,EAEVS,EAAQnL,SAASC,cAAc,OACrCkL,EAAMC,UAAY,UAClB,MAAMjvB,EAAM6jB,SAASC,cAAc,SACnC9jB,EAAI+jB,YAAc0K,EAClB,MAAMS,EAAmC,CACvC9uB,EAAK,YACLU,EAAK,SACLwG,EAAK,MACLhZ,EAAK,aACLwb,EAAK,qBACLnb,EAAK,YACL6sB,EAAK,MACLnZ,EAAK,QACL4b,IAAO,SAEG,MAARsQ,EAEAvuB,EAAImvB,MADQ,UAAVj6B,GAA+B,QAAVA,EACX,uBACO,QAAVA,EACG,YAEA,OAELg6B,EAASX,KAClBvuB,EAAImvB,MAAQD,EAASX,IAEvB,MAAMv6B,EAAQ6vB,SAASC,cAAc,SASrC,GARA9vB,EAAM1D,KAAO,QACb0D,EAAM9B,IAAMqG,OAAOrG,GACnB8B,EAAM5B,IAAMmG,OAAOnG,GACnB4B,EAAM06B,KAAOn2B,OAAOm2B,GACpB16B,EAAMozB,UAAU7wB,IAAI,MAAMg4B,EAAI59B,iBAC1Bg+B,IAAI36B,EAAMw0B,MAAM4G,gBAAkBT,GAClCC,IAAS56B,EAAMw0B,MAAM6G,gBAAkBT,GAC3C56B,EAAMjC,MAAQwG,OAAO,OAAArF,EAAA2qB,EAAG0Q,IAAHr7B,EAAW,GACpB,QAARq7B,EAAe,CACjBv6B,EAAMozB,UAAU7wB,IAAI,SACpB,IACE,MAAM+4B,EAAK1R,GAAS1oB,EAAO,IAAK2oB,EAAII,IAAK,MACnCzZ,EAAKoZ,GAAS1oB,EAAO,IAAK2oB,EAAII,IAAK,QACnCsR,EAAwB,QAAVr6B,EAAkB,MAAmB,QAAVA,EAAkB,MAAmB,UAAVA,EAAoB,QAAU,QACxGlB,EAAMw0B,MAAMnN,WAAa,+BAA+BkU,MAAgBD,MAAO9qB,oBACjF,CAAA,MAAU,CACZ,CACA,MAAMiB,EAAMoe,SAASC,cAAc,SACnCre,EAAInV,KAAO,SACXmV,EAAIvT,IAAMqG,OAAOrG,GACjBuT,EAAIrT,IAAMmG,OAAOnG,GACjBqT,EAAIipB,KAAOn2B,OAAOm2B,GAClBjpB,EAAI2hB,UAAU7wB,IAAI,MAAMg4B,EAAI59B,iBAC5B8U,EAAI1T,MAAQwG,OAAO,OAAAN,EAAA4lB,EAAG0Q,IAAHt2B,EAAW,GAE9B,MAAMu3B,EAAa3L,SAASC,cAAc,OAG1C,GAFA0L,EAAWP,UAAY,cACvBO,EAAWxL,YAAYve,GACnBqpB,GAAgBC,EAAS,CAC3B,MAAMj+B,EAAO+yB,SAASC,cAAc,OACpChzB,EAAKizB,YAAcgL,EAAU,IAAM,IACnCS,EAAWxL,YAAYlzB,EACzB,CAEA,MAAM2+B,EAAQ,KACZ,MAAM5K,EAAOjH,GAAS1oB,EAAO2oB,GAC7BgE,EAAAnzB,KAAKsyB,GAAOjvB,MAAQ8yB,EACpBn2B,KAAK+1B,aAAa,QAASI,GAC3BH,EAAAh2B,KAAKqyB,EAAA4D,GAALt1B,KAAAX,OAGIghC,EAAW9H,IACf,MAAMD,EAASC,EAAGD,OAClB,IAAIx1B,EAAMoH,OAAOouB,EAAO51B,OACxB,IAAKwH,OAAOo2B,SAASx9B,GAAM,OAEzBA,EADE08B,GACM18B,EAAM,IAAO,KAAO,IAEtBhB,KAAKiB,IAAIF,EAAKf,KAAKe,IAAIE,EAAKD,IAEpC,MAAMy9B,EHjmBP,SAAuB16B,EAAmBq5B,EAAap8B,GAC5D,MAAMsoB,EAAQ,CAACtsB,EAAWa,EAAI,IAAMuK,OAAOpL,EAAEwvB,QAAQ3uB,IAErD,GAAc,UAAVkG,EAAmB,CACrB,GAAY,MAARq5B,EAAa,OAAOh2B,OAAOkiB,EAAMtoB,EAAK,IAC1C,GAAY,MAARo8B,GAAuB,MAARA,SAAoBh2B,OAAOkiB,EAAMtoB,EAAK,GAC3D,MAAA,GAAqB,UAAV+C,EAAmB,CAC5B,GAAY,MAARq5B,EAAa,OAAOh2B,OAAOkiB,EAAMtoB,EAAK,IAC1C,GAAY,MAARo8B,EAAa,OAAOh2B,OAAOkiB,EAAMtoB,EAAK,IAC1C,GAAY,MAARo8B,EAAa,OAAOh2B,OAAOkiB,EAAMtoB,EAAK,GAC5C,MAAA,GAAqB,QAAV+C,EAAiB,CAC1B,GAAY,MAARq5B,EAAa,OAAOh2B,OAAOkiB,EAAMtoB,EAAK,IAC1C,GAAY,MAARo8B,GAAuB,MAARA,SAAoBh2B,OAAOkiB,EAAMtoB,EAAK,GAC3D,MAAA,GAAqB,QAAV+C,GACT,GAAY,MAARq5B,GAAuB,MAARA,GAAuB,MAARA,EAAa,OAAOh2B,OAAOkiB,EAAMtoB,EAAK,SAC1E,GAAqB,QAAV+C,GAA6B,QAAVA,EAAiB,CAC7C,GAAY,MAARq5B,EAAa,OAAOh2B,OAAOkiB,EAAMtoB,EAAK,IAC1C,GAAY,MAARo8B,GAAuB,MAARA,GAAuB,MAARA,GAAuB,MAARA,EAAa,OAAOh2B,OAAOkiB,EAAMtoB,EAAK,GACzF,MAAA,GAAqB,SAAV+C,GAA8B,QAAVA,GAC7B,GAAY,MAARq5B,GAAuB,MAARA,GAAuB,MAARA,EAAa,OAAOh2B,OAAOkiB,EAAMtoB,EAAK,SAaxE,GAVgB,CACd,cACA,aACA,UACA,UACA,WACA,MACA,UACA,WAEU6H,SAAS9E,KAAmB,MAARq5B,GAAuB,MAARA,GAAuB,MAARA,GAC5D,OAAOh2B,OAAOkiB,EAAMtoB,EAAK,IAI7B,OAA0BoG,OAAOkiB,EAAMtoB,EAA3B,QAARo8B,EAAwC,EACnB,GAC3B,CG0jB0BsB,CAAc36B,EAAOq5B,EAAKp8B,GAC5C0rB,EAAG0Q,GAAOqB,EACVtB,EAAeC,GAAKx8B,MAAQ69B,EAE5B57B,EAAMjC,MAAQwG,OAAOslB,EAAG0Q,IACxB9oB,EAAI1T,MAAQwG,OAAOslB,EAAG0Q,IACtBkB,KAMF,OAHAz7B,EAAM+yB,iBAAiB,QAAS2I,GAChCjqB,EAAIshB,iBAAiB,QAAS2I,GAC9BV,EAAMc,OAAO9vB,EAAKhM,EAAOw7B,GAClBR,GAKT,GAFAnN,EAAAnzB,KAAKi0B,GAAUuB,UAAY,GAEb,UAAVhvB,EAAmB,CACrB,MAAM66B,EAAevB,EAAK,IAAK,MAAO,EAAG,IAAK,GAC1C3M,EAAAnzB,KAAK6yB,GAASxvB,QAAOg+B,EAAavH,MAAM2F,QAAU,QACtDtM,EAAAnzB,KAAKi0B,GAAUmN,OACbtB,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,oDAC1BA,EAAK,IAAK,KAAK,GAAM,GAAK,IAAM,2EAChCA,EAAK,IAAK,KAAK,GAAM,GAAK,IAAM,8EAChCuB,GAEF,MAAMC,EAAanO,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,8BAClEnD,EAAA70B,KAAK6zB,EAAyBgG,GAAO,KACnC,MAAMnoB,EAAIkuB,EAAeluB,EAAErO,OAAS,KAC9B+X,EAAIwkB,EAAexkB,EAAE/X,OAAS,IAC9B0pB,EAAI6S,EAAe7S,EAAE1pB,OAAS,IAChCi+B,IACFA,EAAWxH,MAAMnN,WAAa,4CAA4Cjb,MAAM0J,KAAK2R,kBAAkBrb,MAAM0J,KAAK2R,gCAGxH,MAAA,GAAqB,UAAVvmB,EAAmB,CAC5B,MAAM66B,EAAevB,EAAK,IAAK,MAAO,EAAG,IAAK,GAC1C3M,EAAAnzB,KAAK6yB,GAASxvB,QAAOg+B,EAAavH,MAAM2F,QAAU,QACtDtM,EAAAnzB,KAAKi0B,GAAUmN,OACbtB,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,oDAC1BA,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,4CAA4C,OAAAt7B,EAAA2qB,EAAGzd,GAAHlN,EAAQ,SAAS,OAAA+E,EAAA4lB,EAAGvW,GAAHrP,EAAQ,aAAa,OAAAF,EAAA8lB,EAAGzd,GAAHrI,EAAQ,WAAW,OAAAgD,EAAA8iB,EAAGvW,GAAHvM,EAAQ,OACvIyzB,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,qFAC1BuB,GAEF,MAAME,EAASpO,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,4BACxDsJ,EAAanO,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,8BAClEnD,EAAA70B,KAAK6zB,EAAyBgG,GAAO,KACnC,MAAMnoB,EAAIkuB,EAAeluB,EAAErO,OAAS,IAC9B+O,EAAIwtB,EAAextB,EAAE/O,OAAS,IAC9BuV,EAAIgnB,EAAehnB,EAAEvV,OAAS,IAChCk+B,IACFA,EAAOzH,MAAM4G,gBAAkB,4CAA4ChvB,SAASkH,gBAAgBlH,WAAWkH,UAE7G0oB,IACFA,EAAWxH,MAAMnN,WAAa,4CAA4Cjb,MAAMU,MAAMwG,kBAAkBlH,MAAMU,MAAMwG,gCAG1H,MAAA,GAAqB,QAAVpS,EAAiB,CAC1B,MAAM66B,EAAevB,EAAK,IAAK,MAAO,EAAG,IAAK,GAC1C3M,EAAAnzB,KAAK6yB,GAASxvB,QAAOg+B,EAAavH,MAAM2F,QAAU,QACtDtM,EAAAnzB,KAAKi0B,GAAUmN,OACbtB,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,kDAC1BA,EAAK,IAAK,KAAK,IAAM,IAAK,EAAG,2EAC7BA,EAAK,IAAK,KAAK,IAAM,IAAK,EAAG,wEAC7BuB,GAEF,MAAMC,EAAanO,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,8BAClEnD,EAAA70B,KAAK6zB,EAAyBgG,GAAO,KACnC,MAAMnoB,EAAIkuB,EAAeluB,EAAErO,OAAS,KAC9B+X,EAAIwkB,EAAexkB,EAAE/X,OAAS,IAC9B0pB,EAAI6S,EAAe7S,EAAE1pB,OAAS,IAChCi+B,IACFA,EAAWxH,MAAMnN,WAAa,wCAAwCjb,MAAM0J,KAAK2R,gBAAgBrb,MAAM0J,KAAK2R,gCAGlH,MAAA,GAAqB,QAAVvmB,EAAiB,CAC1B,MAAM66B,EAAevB,EAAK,IAAK,MAAO,EAAG,IAAK,GAC1C3M,EAAAnzB,KAAK6yB,GAASxvB,QAAOg+B,EAAavH,MAAM2F,QAAU,QACtDtM,EAAAnzB,KAAKi0B,GAAUmN,OACbtB,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,kDAC1BA,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,wCAAwC,OAAA/xB,EAAAohB,EAAGzd,GAAH3D,EAAQ,SAAS,OAAAC,EAAAmhB,EAAGvW,GAAH5K,EAAQ,WAAW,OAAAohB,EAAAD,EAAGzd,GAAH0d,EAAQ,WAAW,OAAAC,EAAAF,EAAGvW,GAAHyW,EAAQ,OACjIyQ,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,+EAC1BuB,GAEF,MAAME,EAASpO,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,4BACxDsJ,EAAanO,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,8BAClEnD,EAAA70B,KAAK6zB,EAAyBgG,GAAO,KACnC,MAAMnoB,EAAIkuB,EAAeluB,EAAErO,OAAS,KAC9B+O,EAAIwtB,EAAextB,EAAE/O,OAAS,IAC9BuV,EAAIgnB,EAAehnB,EAAEvV,OAAS,IAChCk+B,IACFA,EAAOzH,MAAM4G,gBAAkB,wCAAwChvB,SAASkH,WAAWlH,WAAWkH,OAEpG0oB,IACFA,EAAWxH,MAAMnN,WAAa,wCAAwCjb,MAAMU,MAAMwG,gBAAgBlH,MAAMU,MAAMwG,gCAGpH,MAAA,GAAqB,QAAVpS,EAAiB,CAC1B,MAAM66B,EAAevB,EAAK,IAAK,MAAO,EAAG,IAAK,GAC1C3M,EAAAnzB,KAAK6yB,GAASxvB,QAAOg+B,EAAavH,MAAM2F,QAAU,QACtDtM,EAAAnzB,KAAKi0B,GAAUmN,OACbtB,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,mFAC1BA,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,wCAAwC,OAAAxQ,EAAAH,EAAGvW,GAAH0W,EAAQ,QAAQ,OAAAE,EAAAL,EAAGzd,GAAH8d,EAAQ,oBAAoB,OAAAgS,EAAArS,EAAGvW,GAAH4oB,EAAQ,UAAU,OAAAC,EAAAtS,EAAGzd,GAAH+vB,EAAQ,gBACxI3B,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,0CAA0C,OAAA4B,EAAAvS,EAAGvW,GAAH8oB,EAAQ,KAAK,OAAAC,EAAAxS,EAAGvvB,GAAH+hC,EAAQ,iBAAiB,OAAAC,EAAAzS,EAAGvW,GAAHgpB,EAAQ,KAAK,OAAAC,EAAA1S,EAAGvvB,GAAHiiC,EAAQ,eAC/HR,GAEF,MAAMS,EAAS3O,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,4BACxD+J,EAAS5O,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,4BACxDsJ,EAAanO,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,8BAClEnD,EAAA70B,KAAK6zB,EAAyBgG,GAAO,KACnC,MAAMjhB,EAAIgnB,EAAehnB,EAAEvV,OAAS,IAC9BzD,EAAIggC,EAAehgC,EAAEyD,OAAS,MAC9BqO,EAAIkuB,EAAeluB,EAAErO,OAAS,KAChCy+B,IACFA,EAAOhI,MAAM4G,gBAAkB,wCAAwC9nB,QAAQlH,mBAAmBkH,UAAUlH,eAE1GqwB,IACFA,EAAOjI,MAAM4G,gBAAkB,0CAA0C9nB,KAAKhZ,eAAegZ,KAAKhZ,aAEhG0hC,IACFA,EAAWxH,MAAMnN,WAAa,wCAAwC/T,KAAKhZ,MAAM8R,iBAAiBkH,KAAKhZ,MAAM8R,iCAGnH,MAAA,GAAqB,QAAVlL,EAAiB,CAC1B,MAAM66B,EAAevB,EAAK,IAAK,MAAO,EAAG,IAAK,GAC1C3M,EAAAnzB,KAAK6yB,GAASxvB,QAAOg+B,EAAavH,MAAM2F,QAAU,QACtDtM,EAAAnzB,KAAKi0B,GAAUmN,OACbtB,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,mFAC1BA,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,kDAAmD,SAC7EA,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,kDAAmD,SAC7EuB,GAEF,MAAMC,EAAanO,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,8BAClEnD,EAAA70B,KAAK6zB,EAAyBgG,GAAO,KACnC,MAAMjhB,EAAIgnB,EAAehnB,EAAEvV,OAAS,IAC9BpD,EAAI2/B,EAAe3/B,EAAEoD,OAAS,IAC9B0pB,EAAI6S,EAAe7S,EAAE1pB,OAAS,IAChCi+B,IACFA,EAAWxH,MAAMnN,WAAa,wCAAwC/T,KAAK3Y,MAAM8sB,iBAAiBnU,KAAK3Y,MAAM8sB,iCAGnH,MAAA,GAAqB,SAAVvmB,GAA8B,QAAVA,EAAiB,CAC9C,MAAM66B,EAAevB,EAAK,IAAK,MAAO,EAAG,IAAK,GAC1C3M,EAAAnzB,KAAK6yB,GAASxvB,QAAOg+B,EAAavH,MAAM2F,QAAU,QACtDtM,EAAAnzB,KAAKi0B,GAAUmN,OACbtB,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,kDAAmD,SAC7EA,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,kDAAmD,SAC7EA,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,kDAAmD,SAC7EuB,GAEF,MAAMC,EAAanO,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,8BAClEnD,EAAA70B,KAAK6zB,EAAyBgG,GAAO,KACnC,MAAM/M,EAAI8S,EAAe9S,EAAEzpB,OAAS,IAC9BsQ,EAAIisB,EAAejsB,EAAEtQ,OAAS,IAC9B0pB,EAAI6S,EAAe7S,EAAE1pB,OAAS,IAChCi+B,IACFA,EAAWxH,MAAMnN,WAAa,yCAAyCG,MAAMnZ,MAAMoZ,iBAAiBD,MAAMnZ,MAAMoZ,iCAGtH,MAAA,GAAWiC,GAAUxoB,GAAQ,CAC3B,MAAM66B,EAAevB,EAAK,IAAK,MAAO,EAAG,IAAK,GAC1C3M,EAAAnzB,KAAK6yB,GAASxvB,QAAOg+B,EAAavH,MAAM2F,QAAU,QACtDtM,EAAAnzB,KAAKi0B,GAAUmN,OACbtB,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,kDAAmD,SAC7EA,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,kDAAmD,SAC7EA,EAAK,IAAK,IAAK,EAAG,IAAK,EAAG,kDAAmD,SAC7EuB,GAEF,MAAMC,EAAanO,EAAAnzB,KAAKi0B,GAAU+D,cAAgC,8BAClEnD,EAAA70B,KAAK6zB,EAAyBgG,GAAO,KACnC,MAAM/M,EAAI8S,EAAe9S,EAAEzpB,OAAS,IAC9BsQ,EAAIisB,EAAejsB,EAAEtQ,OAAS,IAC9B0pB,EAAI6S,EAAe7S,EAAE1pB,OAAS,IACpC,GAAIi+B,EAAY,CACd,MAAMV,EAAK1R,GAAS1oB,EAAO,IAAK2oB,EAAIrC,IAAGnZ,IAAGoZ,IAAGwC,IAAK,MAC5CzZ,EAAKoZ,GAAS1oB,EAAO,IAAK2oB,EAAIrC,IAAGnZ,IAAGoZ,IAAGwC,IAAK,QAClD+R,EAAWxH,MAAMnN,WAAa,6BAA6BiU,MAAO9qB,oBACpE,IAEJ,CACF,EAGFksB,eAAeC,OAAO,cAAe/P","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,72]}