{"version":3,"file":"index.js","sources":["../node_modules/@preact/signals-core/dist/signals-core.module.js","../node_modules/colorjs.io/src/multiply-matrices.js","../node_modules/colorjs.io/src/util.js","../node_modules/colorjs.io/src/Type.js","../node_modules/colorjs.io/src/Format.js","../node_modules/colorjs.io/src/hooks.js","../node_modules/colorjs.io/src/adapt.js","../node_modules/colorjs.io/src/defaults.js","../node_modules/colorjs.io/src/parse.js","../node_modules/colorjs.io/src/getColor.js","../node_modules/colorjs.io/src/ColorSpace.js","../node_modules/colorjs.io/src/spaces/xyz-d65.js","../node_modules/colorjs.io/src/RGBColorSpace.js","../node_modules/colorjs.io/src/getAll.js","../node_modules/colorjs.io/src/get.js","../node_modules/colorjs.io/src/setAll.js","../node_modules/colorjs.io/src/set.js","../node_modules/colorjs.io/src/spaces/xyz-d50.js","../node_modules/colorjs.io/src/spaces/lab.js","../node_modules/colorjs.io/src/angles.js","../node_modules/colorjs.io/src/spaces/lch.js","../node_modules/colorjs.io/src/deltaE/deltaE2000.js","../node_modules/colorjs.io/src/spaces/oklab.js","../node_modules/colorjs.io/src/deltaE/deltaEOK.js","../node_modules/colorjs.io/src/inGamut.js","../node_modules/colorjs.io/src/clone.js","../node_modules/colorjs.io/src/distance.js","../node_modules/colorjs.io/src/deltaE/deltaE76.js","../node_modules/colorjs.io/src/deltaE/deltaECMC.js","../node_modules/colorjs.io/src/spaces/xyz-abs-d65.js","../node_modules/colorjs.io/src/spaces/jzazbz.js","../node_modules/colorjs.io/src/spaces/jzczhz.js","../node_modules/colorjs.io/src/deltaE/deltaEJz.js","../node_modules/colorjs.io/src/spaces/ictcp.js","../node_modules/colorjs.io/src/deltaE/deltaEITP.js","../node_modules/colorjs.io/src/deltaE/deltaEOK2.js","../node_modules/colorjs.io/src/spaces/cam16.js","../node_modules/colorjs.io/src/spaces/hct.js","../node_modules/colorjs.io/src/deltaE/deltaEHCT.js","../node_modules/colorjs.io/src/deltaE/index.js","../node_modules/colorjs.io/src/toGamut.js","../node_modules/colorjs.io/src/to.js","../node_modules/colorjs.io/src/serialize.js","../node_modules/colorjs.io/src/spaces/rec2020-linear.js","../node_modules/colorjs.io/src/spaces/rec2020.js","../node_modules/colorjs.io/src/spaces/p3-linear.js","../node_modules/colorjs.io/src/spaces/srgb-linear.js","../node_modules/colorjs.io/src/keywords.js","../node_modules/colorjs.io/src/spaces/srgb.js","../node_modules/colorjs.io/src/spaces/p3.js","../node_modules/colorjs.io/src/luminance.js","../node_modules/colorjs.io/src/contrast/WCAG21.js","../node_modules/colorjs.io/src/contrast/APCA.js","../node_modules/colorjs.io/src/contrast/Michelson.js","../node_modules/colorjs.io/src/contrast/Weber.js","../node_modules/colorjs.io/src/contrast/Lstar.js","../node_modules/colorjs.io/src/spaces/lab-d65.js","../node_modules/colorjs.io/src/contrast/deltaPhi.js","../node_modules/colorjs.io/src/contrast.js","../node_modules/colorjs.io/src/spaces/hsl.js","../node_modules/colorjs.io/src/spaces/hsv.js","../node_modules/colorjs.io/src/spaces/hwb.js","../node_modules/colorjs.io/src/spaces/a98rgb-linear.js","../node_modules/colorjs.io/src/spaces/a98rgb.js","../node_modules/colorjs.io/src/spaces/prophoto-linear.js","../node_modules/colorjs.io/src/spaces/prophoto.js","../node_modules/colorjs.io/src/spaces/oklch.js","../node_modules/colorjs.io/src/spaces/okhsl.js","../node_modules/colorjs.io/src/spaces/okhsv.js","../src/color.ts","../src/utils/channel-formatting.ts","../src/utils/color-conversion.ts","../src/area-picker.ts","../src/utils/positioning.ts","../src/utils/template.ts","../src/color-input.ts"],"sourcesContent":["var i=Symbol.for(\"preact-signals\");function t(){if(!(s>1)){var i,t=!1;while(void 0!==h){var r=h;h=void 0;f++;while(void 0!==r){var o=r.o;r.o=void 0;r.f&=-3;if(!(8&r.f)&&c(r))try{r.c()}catch(r){if(!t){i=r;t=!0}}r=o}}f=0;s--;if(t)throw i}else s--}function r(i){if(s>0)return i();s++;try{return i()}finally{t()}}var o=void 0;function n(i){var t=o;o=void 0;try{return i()}finally{o=t}}var h=void 0,s=0,f=0,v=0;function e(i){if(void 0!==o){var t=i.n;if(void 0===t||t.t!==o){t={i:0,S:i,p:o.s,n:void 0,t:o,e:void 0,x:void 0,r:t};if(void 0!==o.s)o.s.n=t;o.s=t;i.n=t;if(32&o.f)i.S(t);return t}else if(-1===t.i){t.i=0;if(void 0!==t.n){t.n.p=t.p;if(void 0!==t.p)t.p.n=t.n;t.p=o.s;t.n=void 0;o.s.n=t;o.s=t}return t}}}function u(i,t){this.v=i;this.i=0;this.n=void 0;this.t=void 0;this.W=null==t?void 0:t.watched;this.Z=null==t?void 0:t.unwatched;this.name=null==t?void 0:t.name}u.prototype.brand=i;u.prototype.h=function(){return!0};u.prototype.S=function(i){var t=this,r=this.t;if(r!==i&&void 0===i.e){i.x=r;this.t=i;if(void 0!==r)r.e=i;else n(function(){var i;null==(i=t.W)||i.call(t)})}};u.prototype.U=function(i){var t=this;if(void 0!==this.t){var r=i.e,o=i.x;if(void 0!==r){r.x=o;i.e=void 0}if(void 0!==o){o.e=r;i.x=void 0}if(i===this.t){this.t=o;if(void 0===o)n(function(){var i;null==(i=t.Z)||i.call(t)})}}};u.prototype.subscribe=function(i){var t=this;return E(function(){var r=t.value,n=o;o=void 0;try{i(r)}finally{o=n}},{name:\"sub\"})};u.prototype.valueOf=function(){return this.value};u.prototype.toString=function(){return this.value+\"\"};u.prototype.toJSON=function(){return this.value};u.prototype.peek=function(){var i=o;o=void 0;try{return this.value}finally{o=i}};Object.defineProperty(u.prototype,\"value\",{get:function(){var i=e(this);if(void 0!==i)i.i=this.i;return this.v},set:function(i){if(i!==this.v){if(f>100)throw new Error(\"Cycle detected\");this.v=i;this.i++;v++;s++;try{for(var r=this.t;void 0!==r;r=r.x)r.t.N()}finally{t()}}}});function d(i,t){return new u(i,t)}function c(i){for(var t=i.s;void 0!==t;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function a(i){for(var t=i.s;void 0!==t;t=t.n){var r=t.S.n;if(void 0!==r)t.r=r;t.S.n=t;t.i=-1;if(void 0===t.n){i.s=t;break}}}function l(i){var t=i.s,r=void 0;while(void 0!==t){var o=t.p;if(-1===t.i){t.S.U(t);if(void 0!==o)o.n=t.n;if(void 0!==t.n)t.n.p=o}else r=t;t.S.n=t.r;if(void 0!==t.r)t.r=void 0;t=o}i.s=r}function y(i,t){u.call(this,void 0);this.x=i;this.s=void 0;this.g=v-1;this.f=4;this.W=null==t?void 0:t.watched;this.Z=null==t?void 0:t.unwatched;this.name=null==t?void 0:t.name}y.prototype=new u;y.prototype.h=function(){this.f&=-3;if(1&this.f)return!1;if(32==(36&this.f))return!0;this.f&=-5;if(this.g===v)return!0;this.g=v;this.f|=1;if(this.i>0&&!c(this)){this.f&=-2;return!0}var i=o;try{a(this);o=this;var t=this.x();if(16&this.f||this.v!==t||0===this.i){this.v=t;this.f&=-17;this.i++}}catch(i){this.v=i;this.f|=16;this.i++}o=i;l(this);this.f&=-2;return!0};y.prototype.S=function(i){if(void 0===this.t){this.f|=36;for(var t=this.s;void 0!==t;t=t.n)t.S.S(t)}u.prototype.S.call(this,i)};y.prototype.U=function(i){if(void 0!==this.t){u.prototype.U.call(this,i);if(void 0===this.t){this.f&=-33;for(var t=this.s;void 0!==t;t=t.n)t.S.U(t)}}};y.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var i=this.t;void 0!==i;i=i.x)i.t.N()}};Object.defineProperty(y.prototype,\"value\",{get:function(){if(1&this.f)throw new Error(\"Cycle detected\");var i=e(this);this.h();if(void 0!==i)i.i=this.i;if(16&this.f)throw this.v;return this.v}});function w(i,t){return new y(i,t)}function _(i){var r=i.u;i.u=void 0;if(\"function\"==typeof r){s++;var n=o;o=void 0;try{r()}catch(t){i.f&=-2;i.f|=8;b(i);throw t}finally{o=n;t()}}}function b(i){for(var t=i.s;void 0!==t;t=t.n)t.S.U(t);i.x=void 0;i.s=void 0;_(i)}function g(i){if(o!==this)throw new Error(\"Out-of-order effect\");l(this);o=i;this.f&=-2;if(8&this.f)b(this);t()}function p(i,t){this.x=i;this.u=void 0;this.s=void 0;this.o=void 0;this.f=32;this.name=null==t?void 0:t.name}p.prototype.c=function(){var i=this.S();try{if(8&this.f)return;if(void 0===this.x)return;var t=this.x();if(\"function\"==typeof t)this.u=t}finally{i()}};p.prototype.S=function(){if(1&this.f)throw new Error(\"Cycle detected\");this.f|=1;this.f&=-9;_(this);a(this);s++;var i=o;o=this;return g.bind(this,i)};p.prototype.N=function(){if(!(2&this.f)){this.f|=2;this.o=h;h=this}};p.prototype.d=function(){this.f|=8;if(!(1&this.f))b(this)};p.prototype.dispose=function(){this.d()};function E(i,t){var r=new p(i,t);try{r.c()}catch(i){r.d();throw i}var o=r.d.bind(r);o[Symbol.dispose]=o;return o}export{y as Computed,p as Effect,u as Signal,r as batch,w as computed,E as effect,d as signal,n as untracked};//# sourceMappingURL=signals-core.module.js.map\n","/** @import { Matrix3x3, Vector3 } from \"./types.js\" */\n\n/**\n * A is m x n. B is n x p. product is m x p.\n *\n * Array arguments are treated like vectors:\n * - A becomes 1 x n\n * - B becomes n x 1\n *\n * Returns Matrix m x p or equivalent array or number\n *\n * @overload\n * @param {number[]} A Vector 1 x n\n * @param {number[]} B Vector n x 1\n * @returns {number} Scalar number\n *\n * @overload\n * @param {number[][]} A Matrix m x n\n * @param {number[]} B Vector n x 1\n * @returns {number[]} Array with length m\n *\n * @overload\n * @param {number[]} A Vector 1 x n\n * @param {number[][]} B Matrix n x p\n * @returns {number[]} Array with length p\n *\n * @overload\n * @param {number[][]} A Matrix m x n\n * @param {number[][]} B Matrix n x p\n * @returns {number[][]} Matrix m x p\n *\n * @param {number[] | number[][]} A Matrix m x n or a vector\n * @param {number[] | number[][]} B Matrix n x p or a vector\n * @returns {number | number[] | number[][]} Matrix m x p or equivalent array or number\n */\nexport default function multiplyMatrices (A, B) {\n\tlet m = A.length;\n\t/** @type {number[][]} */\n\tlet AM;\n\t/** @type {number[][]} */\n\tlet BM;\n\tlet aVec = false;\n\tlet bVec = false;\n\n\tif (!Array.isArray(A[0])) {\n\t\t// A is vector, convert to [[a, b, c, ...]]\n\t\tAM = [/** @type {number[]} */ (A)];\n\t\tm = AM.length;\n\t\taVec = true;\n\t}\n\telse {\n\t\tAM = /** @type {number[][]} */ (A);\n\t}\n\n\tif (!Array.isArray(B[0])) {\n\t\t// B is vector, convert to [[a], [b], [c], ...]]\n\t\tBM = B.length > 0 ? B.map(x => [x]) : [[]]; // Avoid mapping empty array\n\t\tbVec = true;\n\t}\n\telse {\n\t\tBM = /** @type {number[][]} */ (B);\n\t}\n\n\tlet p = BM[0].length;\n\tlet BM_cols = BM[0].map((_, i) => BM.map(x => x[i])); // transpose B\n\t/** @type {number[] | number[][]} */\n\tlet product = AM.map(row =>\n\t\tBM_cols.map(col => {\n\t\t\tlet ret = 0;\n\n\t\t\tif (!Array.isArray(row)) {\n\t\t\t\tfor (let c of col) {\n\t\t\t\t\tret += row * c;\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < row.length; i++) {\n\t\t\t\tret += row[i] * (col[i] || 0);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}));\n\n\tif (m === 1 && aVec) {\n\t\tproduct = product[0]; // Avoid [[a, b, c, ...]]\n\t}\n\tif (p === 1 && bVec) {\n\t\tif (m === 1 && aVec) {\n\t\t\treturn product[0]; // Avoid [[a]], return a number\n\t\t}\n\t\telse {\n\t\t\treturn product.map(x => x[0]); // Avoid [[a], [b], [c], ...]]\n\t\t}\n\t}\n\n\treturn product;\n}\n\n// dot3 and transform functions adapted from https://github.com/texel-org/color/blob/9793c7d4d02b51f068e0f3fd37131129a4270396/src/core.js\n//\n// The MIT License (MIT)\n// Copyright (c) 2024 Matt DesLauriers\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n// IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE\n// OR OTHER DEALINGS IN THE SOFTWARE.\n\n/**\n * Returns the dot product of two vectors each with a length of 3.\n *\n * @param {Vector3} a\n * @param {Vector3} b\n * @returns {number}\n */\nfunction dot3 (a, b) {\n\treturn a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n\n/**\n * Transforms a vector of length 3 by a 3x3 matrix. Specify the same input and output\n * vector to transform in place.\n *\n * @param {Vector3} input\n * @param {Matrix3x3} matrix\n * @param {Vector3} [out]\n * @returns {Vector3}\n */\nexport function multiply_v3_m3x3 (input, matrix, out = [0, 0, 0]) {\n\tconst x = dot3(input, matrix[0]);\n\tconst y = dot3(input, matrix[1]);\n\tconst z = dot3(input, matrix[2]);\n\tout[0] = x;\n\tout[1] = y;\n\tout[2] = z;\n\treturn out;\n}\n","/**\n * Various utility functions\n */\n\nexport { default as multiplyMatrices, multiply_v3_m3x3 } from \"./multiply-matrices.js\";\n\n/**\n * Check if a value is a string (including a String object)\n * @param {any} str - Value to check\n * @returns {str is string}\n */\nexport function isString (str) {\n\treturn type(str) === \"string\";\n}\n\n/**\n * Determine the internal JavaScript [[Class]] of an object.\n * @param {any} o - Value to check\n * @returns {string}\n */\nexport function type (o) {\n\tlet str = Object.prototype.toString.call(o);\n\n\treturn (str.match(/^\\[object\\s+(.*?)\\]$/)[1] || \"\").toLowerCase();\n}\n\n/**\n * @param {number} n\n * @param {{ precision?: number | undefined, unit?: string | undefined }} options\n * @returns {string}\n */\nexport function serializeNumber (n, { precision = 16, unit }) {\n\tif (isNone(n)) {\n\t\treturn \"none\";\n\t}\n\n\tn = +toPrecision(n, precision);\n\n\treturn n + (unit ?? \"\");\n}\n\n/**\n * Check if a value corresponds to a none argument\n * @param {any} n - Value to check\n * @returns {n is null}\n */\nexport function isNone (n) {\n\treturn n === null;\n}\n\n/**\n * Replace none values with 0\n * @param {number | null} n\n * @returns {number}\n */\nexport function skipNone (n) {\n\treturn isNone(n) ? 0 : n;\n}\n\n/**\n * Round a number to a certain number of significant digits\n * @param {number} n - The number to round\n * @param {number} precision - Number of significant digits\n */\nexport function toPrecision (n, precision) {\n\tif (n === 0) {\n\t\treturn 0;\n\t}\n\tlet integer = ~~n;\n\tlet digits = 0;\n\tif (integer && precision) {\n\t\tdigits = ~~Math.log10(Math.abs(integer)) + 1;\n\t}\n\tconst multiplier = 10.0 ** (precision - digits);\n\treturn Math.floor(n * multiplier + 0.5) / multiplier;\n}\n\n/**\n * @param {number} start\n * @param {number} end\n * @param {number} p\n */\nexport function interpolate (start, end, p) {\n\tif (isNaN(start)) {\n\t\treturn end;\n\t}\n\n\tif (isNaN(end)) {\n\t\treturn start;\n\t}\n\n\treturn start + (end - start) * p;\n}\n\n/**\n * @param {number} start\n * @param {number} end\n * @param {number} value\n */\nexport function interpolateInv (start, end, value) {\n\treturn (value - start) / (end - start);\n}\n\n/**\n * @param {[number, number]} from\n * @param {[number, number]} to\n * @param {number} value\n */\nexport function mapRange (from, to, value) {\n\tif (\n\t\t!from ||\n\t\t!to ||\n\t\tfrom === to ||\n\t\t(from[0] === to[0] && from[1] === to[1]) ||\n\t\tisNaN(value) ||\n\t\tvalue === null\n\t) {\n\t\t// Ranges missing or the same\n\t\treturn value;\n\t}\n\n\treturn interpolate(to[0], to[1], interpolateInv(from[0], from[1], value));\n}\n\n/**\n * Clamp value between the minimum and maximum\n * @param {number} min minimum value to return\n * @param {number} val the value to return if it is between min and max\n * @param {number} max maximum value to return\n */\nexport function clamp (min, val, max) {\n\treturn Math.max(Math.min(max, val), min);\n}\n\n/**\n * Copy sign of one value to another.\n * @param {number} to - Number to copy sign to\n * @param {number} from - Number to copy sign from\n */\nexport function copySign (to, from) {\n\treturn Math.sign(to) === Math.sign(from) ? to : -to;\n}\n\n/**\n * Perform pow on a signed number and copy sign to result\n * @param {number} base The base number\n * @param {number} exp The exponent\n */\nexport function spow (base, exp) {\n\treturn copySign(Math.abs(base) ** exp, base);\n}\n\n/**\n * Perform a divide, but return zero if the denominator is zero\n * @param {number} n The numerator\n * @param {number} d The denominator\n */\nexport function zdiv (n, d) {\n\treturn d === 0 ? 0 : n / d;\n}\n\n/**\n * Perform a bisect on a sorted list and locate the insertion point for\n * a value in arr to maintain sorted order.\n * @param {number[]} arr - array of sorted numbers\n * @param {number} value - value to find insertion point for\n * @param {number} lo - used to specify a the low end of a subset of the list\n * @param {number} hi - used to specify a the high end of a subset of the list\n */\nexport function bisectLeft (arr, value, lo = 0, hi = arr.length) {\n\twhile (lo < hi) {\n\t\tconst mid = (lo + hi) >> 1;\n\t\tif (arr[mid] < value) {\n\t\t\tlo = mid + 1;\n\t\t}\n\t\telse {\n\t\t\thi = mid;\n\t\t}\n\t}\n\treturn lo;\n}\n\n/**\n * Determines whether an argument is an instance of a constructor, including subclasses.\n * This is done by first just checking `instanceof`,\n * and then comparing the string names of the constructors if that fails.\n * @param {any} arg\n * @param {C} constructor\n * @template {new (...args: any) => any} C\n * @returns {arg is InstanceType<C>}\n */\nexport function isInstance (arg, constructor) {\n\tif (arg instanceof constructor) {\n\t\treturn true;\n\t}\n\n\tconst targetName = constructor.name;\n\n\twhile (arg) {\n\t\tconst proto = Object.getPrototypeOf(arg);\n\t\tconst constructorName = proto?.constructor?.name;\n\t\tif (constructorName === targetName) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!constructorName || constructorName === \"Object\") {\n\t\t\treturn false;\n\t\t}\n\t\targ = proto;\n\t}\n\n\treturn false;\n}\n","import { serializeNumber, mapRange, isInstance } from \"./util.js\";\n\nexport default class Type {\n\t// Class properties - declared here so that type inference works\n\ttype;\n\tcoordMeta;\n\tcoordRange;\n\t/** @type {[number, number]} */\n\trange;\n\n\t/**\n\t * @param {any} type\n\t * @param {import(\"./types.js\").CoordMeta} coordMeta\n\t */\n\tconstructor (type, coordMeta) {\n\t\tif (typeof type === \"object\") {\n\t\t\tthis.coordMeta = type;\n\t\t}\n\n\t\tif (coordMeta) {\n\t\t\tthis.coordMeta = coordMeta;\n\t\t\tthis.coordRange = coordMeta.range ?? coordMeta.refRange;\n\t\t}\n\n\t\tif (typeof type === \"string\") {\n\t\t\tlet params = type\n\t\t\t\t.trim()\n\t\t\t\t.match(/^(?<type><[a-z]+>)(\\[(?<min>-?[.\\d]+),\\s*(?<max>-?[.\\d]+)\\])?$/);\n\n\t\t\tif (!params) {\n\t\t\t\tthrow new TypeError(`Cannot parse ${type} as a type definition.`);\n\t\t\t}\n\n\t\t\tthis.type = params.groups.type;\n\t\t\tlet { min, max } = params.groups;\n\n\t\t\tif (min || max) {\n\t\t\t\tthis.range = [+min, +max];\n\t\t\t}\n\t\t}\n\t}\n\n\t/** @returns {[number, number]} */\n\tget computedRange () {\n\t\tif (this.range) {\n\t\t\treturn this.range;\n\t\t}\n\t\tif (this.type === \"<percentage>\") {\n\t\t\treturn this.percentageRange();\n\t\t}\n\t\telse if (this.type === \"<angle>\") {\n\t\t\treturn [0, 360];\n\t\t}\n\t\treturn null;\n\t}\n\n\tget unit () {\n\t\tif (this.type === \"<percentage>\") {\n\t\t\treturn \"%\";\n\t\t}\n\t\telse if (this.type === \"<angle>\") {\n\t\t\treturn \"deg\";\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Map a number to the internal representation\n\t * @param {number} number\n\t */\n\tresolve (number) {\n\t\tif (this.type === \"<angle>\") {\n\t\t\treturn number;\n\t\t}\n\n\t\tlet fromRange = this.computedRange;\n\t\tlet toRange = this.coordRange;\n\n\t\tif (this.type === \"<percentage>\") {\n\t\t\ttoRange ??= this.percentageRange();\n\t\t}\n\n\t\treturn mapRange(fromRange, toRange, number);\n\t}\n\n\t/**\n\t * Serialize a number from the internal representation to a string\n\t * @param {number} number\n\t * @param {number} [precision]\n\t */\n\tserialize (number, precision) {\n\t\tlet toRange = this.type === \"<percentage>\" ? this.percentageRange(100) : this.computedRange;\n\n\t\tlet unit = this.unit;\n\n\t\tnumber = mapRange(this.coordRange, toRange, number);\n\t\treturn serializeNumber(number, { unit, precision });\n\t}\n\n\ttoString () {\n\t\tlet ret = this.type;\n\n\t\tif (this.range) {\n\t\t\tlet [min = \"\", max = \"\"] = this.range;\n\t\t\tret += `[${min},${max}]`;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Returns a percentage range for values of this type\n\t * @param {number} scale\n\t * @returns {[number, number]}\n\t */\n\tpercentageRange (scale = 1) {\n\t\tlet range;\n\t\tif (\n\t\t\t(this.coordMeta && this.coordMeta.range) ||\n\t\t\t(this.coordRange && this.coordRange[0] >= 0)\n\t\t) {\n\t\t\trange = [0, 1];\n\t\t}\n\t\telse {\n\t\t\trange = [-1, 1];\n\t\t}\n\t\treturn [range[0] * scale, range[1] * scale];\n\t}\n\n\tstatic get (type, coordMeta) {\n\t\tif (isInstance(type, this)) {\n\t\t\treturn type;\n\t\t}\n\n\t\treturn new this(type, coordMeta);\n\t}\n}\n","import { isInstance, isNone } from \"./util.js\";\nimport Type from \"./Type.js\";\n\n/** @import { ColorSpace, Coords } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").Format} FormatInterface */\n\n/**\n * @internal\n * Used to index {@link FormatInterface Format} objects and store an instance.\n * Not meant for external use\n */\nexport const instance = Symbol(\"instance\");\n\n/**\n * Remove the first element of an array type\n * @template {any[]} T\n * @typedef {T extends [any, ...infer R] ? R : T[number][]} RemoveFirstElement\n */\n\n/**\n * @class Format\n * @implements {Omit<FormatInterface, \"coords\" | \"serializeCoords\">}\n * Class to hold a color serialization format\n */\nexport default class Format {\n\t// Class properties - declared here so that type inference works\n\ttype;\n\tname;\n\tspaceCoords;\n\t/** @type {Type[][]} */\n\tcoords;\n\t/** @type {string | undefined} */\n\tid;\n\t/** @type {boolean | undefined} */\n\talpha;\n\n\t/**\n\t * @param {FormatInterface} format\n\t * @param {ColorSpace} space\n\t */\n\tconstructor (format, space = format.space) {\n\t\tformat[instance] = this;\n\t\tthis.type = \"function\";\n\t\tthis.name = \"color\";\n\n\t\tObject.assign(this, format);\n\n\t\tthis.space = space;\n\n\t\tif (this.type === \"custom\") {\n\t\t\t// Nothing else to do here\n\t\t\treturn;\n\t\t}\n\n\t\tthis.spaceCoords = Object.values(space.coords);\n\n\t\tif (!this.coords) {\n\t\t\t// @ts-expect-error Strings are converted to the correct type later\n\t\t\tthis.coords = this.spaceCoords.map(coordMeta => {\n\t\t\t\tlet ret = [\"<number>\", \"<percentage>\"];\n\n\t\t\t\tif (coordMeta.type === \"angle\") {\n\t\t\t\t\tret.push(\"<angle>\");\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t});\n\t\t}\n\n\t\tthis.coords = this.coords.map(\n\t\t\t/** @param {string | string[] | Type[]} types */ (types, i) => {\n\t\t\t\tlet coordMeta = this.spaceCoords[i];\n\n\t\t\t\tif (typeof types === \"string\") {\n\t\t\t\t\ttypes = types.trim().split(/\\s*\\|\\s*/);\n\t\t\t\t}\n\n\t\t\t\treturn types.map(type => Type.get(type, coordMeta));\n\t\t\t},\n\t\t);\n\t}\n\n\t/**\n\t * @param {Coords} coords\n\t * @param {number} precision\n\t * @param {Type[]} types\n\t */\n\tserializeCoords (coords, precision, types) {\n\t\ttypes = coords.map((_, i) =>\n\t\t\tType.get(types?.[i] ?? this.coords[i][0], this.spaceCoords[i]));\n\t\treturn coords.map((c, i) => types[i].serialize(c, precision));\n\t}\n\n\t/**\n\t * Validates the coordinates of a color against a format's coord grammar and\n\t * maps the coordinates to the range or refRange of the coordinates.\n\t * @param {Coords} coords\n\t * @param {[string, string, string]} types\n\t */\n\tcoerceCoords (coords, types) {\n\t\treturn Object.entries(this.space.coords).map(([id, coordMeta], i) => {\n\t\t\tlet arg = coords[i];\n\n\t\t\tif (isNone(arg) || isNaN(arg)) {\n\t\t\t\t// Nothing to do here\n\t\t\t\treturn arg;\n\t\t\t}\n\n\t\t\t// Find grammar alternative that matches the provided type\n\t\t\t// Non-strict equals is intentional because we are comparing w/ string objects\n\t\t\tlet providedType = types[i];\n\t\t\tlet type = this.coords[i].find(c => c.type == providedType);\n\n\t\t\t// Check that each coord conforms to its grammar\n\t\t\tif (!type) {\n\t\t\t\t// Type does not exist in the grammar, throw\n\t\t\t\tlet coordName = coordMeta.name || id;\n\t\t\t\tthrow new TypeError(\n\t\t\t\t\t`${providedType ?? /** @type {any} */ (arg)?.raw ?? arg} not allowed for ${coordName} in ${this.name}()`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\targ = type.resolve(arg);\n\n\t\t\tif (type.range) {\n\t\t\t\t// Adjust type to include range\n\t\t\t\ttypes[i] = type.toString();\n\t\t\t}\n\n\t\t\treturn arg;\n\t\t});\n\t}\n\n\t/**\n\t * @returns {boolean | Required<FormatInterface>[\"serialize\"]}\n\t */\n\tcanSerialize () {\n\t\treturn this.type === \"function\" || /** @type {any} */ (this).serialize;\n\t}\n\n\t/**\n\t * @param {string} str\n\t * @returns {(import(\"./types.js\").ColorConstructor) | undefined | null}\n\t */\n\tparse (str) {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @param {Format | FormatInterface} format\n\t * @param {RemoveFirstElement<ConstructorParameters<typeof Format>>} args\n\t * @returns {Format}\n\t */\n\tstatic get (format, ...args) {\n\t\tif (!format || isInstance(format, this)) {\n\t\t\treturn /** @type {Format} */ (format);\n\t\t}\n\n\t\tif (format[instance]) {\n\t\t\treturn format[instance];\n\t\t}\n\n\t\treturn new Format(format, ...args);\n\t}\n}\n","/**\n * A class for adding deep extensibility to any piece of JS code\n */\nexport class Hooks {\n\tadd (name, callback, first) {\n\t\tif (typeof arguments[0] != \"string\") {\n\t\t\t// Multiple hooks\n\t\t\tfor (var name in arguments[0]) {\n\t\t\t\tthis.add(name, arguments[0][name], arguments[1]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t(Array.isArray(name) ? name : [name]).forEach(function (name) {\n\t\t\tthis[name] = this[name] || [];\n\n\t\t\tif (callback) {\n\t\t\t\tthis[name][first ? \"unshift\" : \"push\"](callback);\n\t\t\t}\n\t\t}, this);\n\t}\n\n\trun (name, env) {\n\t\tthis[name] = this[name] || [];\n\t\tthis[name].forEach(function (callback) {\n\t\t\tcallback.call(env && env.context ? env.context : env, env);\n\t\t});\n\t}\n}\n\n/**\n * The instance of {@link Hooks} used throughout Color.js\n */\nconst hooks = new Hooks();\n\nexport default hooks;\n","import hooks from \"./hooks.js\";\nimport { multiply_v3_m3x3 } from \"./util.js\";\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").White} White */\n\n/** @type {Record<string, White>} */\n// prettier-ignore\nexport const WHITES = {\n\t// for compatibility, the four-digit chromaticity-derived ones everyone else uses\n\tD50: [0.3457 / 0.3585, 1.00000, (1.0 - 0.3457 - 0.3585) / 0.3585],\n\tD65: [0.3127 / 0.3290, 1.00000, (1.0 - 0.3127 - 0.3290) / 0.3290],\n};\n\n/**\n *\n * @param {string | White} name\n * @returns {White}\n */\nexport function getWhite (name) {\n\tif (Array.isArray(name)) {\n\t\treturn name;\n\t}\n\n\treturn WHITES[name];\n}\n\n/**\n * Adapt XYZ from white point W1 to W2\n * @param {White | string} W1\n * @param {White | string} W2\n * @param {[number, number, number]} XYZ\n * @param {{ method?: string | undefined }} options\n * @returns {[number, number, number]}\n */\nexport default function adapt (W1, W2, XYZ, options = {}) {\n\tW1 = getWhite(W1);\n\tW2 = getWhite(W2);\n\n\tif (!W1 || !W2) {\n\t\tthrow new TypeError(\n\t\t\t`Missing white point to convert ${!W1 ? \"from\" : \"\"}${!W1 && !W2 ? \"/\" : \"\"}${!W2 ? \"to\" : \"\"}`,\n\t\t);\n\t}\n\n\tif (W1 === W2) {\n\t\t// Same whitepoints, no conversion needed\n\t\treturn XYZ;\n\t}\n\n\tlet env = { W1, W2, XYZ, options };\n\n\thooks.run(\"chromatic-adaptation-start\", env);\n\n\tif (!env.M) {\n\t\tif (env.W1 === WHITES.D65 && env.W2 === WHITES.D50) {\n\t\t\t// prettier-ignore\n\t\t\tenv.M = [\n\t\t\t\t[  1.0479297925449969,   0.022946870601609652, -0.05019226628920524  ],\n\t\t\t\t[  0.02962780877005599,  0.9904344267538799,   -0.017073799063418826 ],\n\t\t\t\t[ -0.009243040646204504, 0.015055191490298152,  0.7518742814281371   ],\n\t\t\t];\n\t\t}\n\t\telse if (env.W1 === WHITES.D50 && env.W2 === WHITES.D65) {\n\t\t\t// prettier-ignore\n\t\t\tenv.M = [\n\t\t\t\t[  0.955473421488075,    -0.02309845494876471,  0.06325924320057072  ],\n\t\t\t\t[ -0.0283697093338637,    1.0099953980813041,   0.021041441191917323 ],\n\t\t\t\t[  0.012314014864481998, -0.020507649298898964, 1.330365926242124    ],\n\t\t\t];\n\t\t}\n\t}\n\n\thooks.run(\"chromatic-adaptation-end\", env);\n\n\tif (env.M) {\n\t\treturn multiply_v3_m3x3(env.XYZ, env.M);\n\t}\n\telse {\n\t\tthrow new TypeError(\"Only Bradford CAT with white points D50 and D65 supported for now.\");\n\t}\n}\n","// Global defaults one may want to configure\nexport default {\n\tgamut_mapping: \"css\",\n\tprecision: 5,\n\tdeltaE: \"76\", // Default deltaE method\n\tverbose: globalThis?.process?.env?.NODE_ENV?.toLowerCase() !== \"test\",\n\twarn: function warn (msg) {\n\t\tif (this.verbose) {\n\t\t\tglobalThis?.console?.warn?.(msg);\n\t\t}\n\t},\n};\n","import { isNone, clamp } from \"./util.js\";\nimport hooks from \"./hooks.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport defaults from \"./defaults.js\";\n\n/** @import { ColorConstructor } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").ArgumentMeta} ArgumentMeta */\n/** @typedef {import(\"./types.js\").ParseFunctionReturn} ParseFunctionReturn */\n/** @typedef {import(\"./types.js\").ParseOptions} ParseOptions */\n\n/**\n * Convert a CSS Color string to a color object\n * @param {string} str\n * @param {ParseOptions} [options]\n * @returns {ColorConstructor}\n */\nexport default function parse (str, options) {\n\tlet env = {\n\t\tstr: String(str)?.trim(),\n\t\toptions,\n\t};\n\n\thooks.run(\"parse-start\", env);\n\n\tif (env.color) {\n\t\treturn env.color;\n\t}\n\n\tenv.parsed = parseFunction(env.str);\n\tlet ret;\n\tlet meta = env.options ? (env.options.parseMeta ?? env.options.meta) : null;\n\n\tif (env.parsed) {\n\t\t// Is a functional syntax\n\t\tlet name = env.parsed.name;\n\t\tlet format;\n\t\tlet space;\n\t\tlet coords = env.parsed.args;\n\t\tlet types = coords.map((c, i) => env.parsed.argMeta[i]?.type);\n\n\t\tif (name === \"color\") {\n\t\t\t// color() function\n\t\t\tlet id = coords.shift();\n\t\t\ttypes.shift();\n\t\t\t// Check against both <dashed-ident> and <ident> versions\n\t\t\tlet alternateId = id.startsWith(\"--\") ? id.substring(2) : `--${id}`;\n\t\t\tlet ids = [id, alternateId];\n\t\t\tformat = ColorSpace.findFormat({ name, id: ids, type: \"function\" });\n\n\t\t\tif (!format) {\n\t\t\t\t// Not found\n\t\t\t\tlet didYouMean;\n\n\t\t\t\tlet registryId = id in ColorSpace.registry ? id : alternateId;\n\t\t\t\tif (registryId in ColorSpace.registry) {\n\t\t\t\t\t// Used color space id instead of color() id, these are often different\n\t\t\t\t\tlet cssId = ColorSpace.registry[registryId].formats?.color?.id;\n\n\t\t\t\t\tif (cssId) {\n\t\t\t\t\t\tlet altColor = str.replace(\"color(\" + id, \"color(\" + cssId);\n\t\t\t\t\t\tdidYouMean = `Did you mean ${altColor}?`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthrow new TypeError(\n\t\t\t\t\t`Cannot parse ${env.str}. ` + (didYouMean ?? \"Missing a plugin?\"),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tspace = format.space;\n\n\t\t\tif (format.id.startsWith(\"--\") && !id.startsWith(\"--\")) {\n\t\t\t\tdefaults.warn(\n\t\t\t\t\t`${space.name} is a non-standard space and not currently supported in the CSS spec. ` +\n\t\t\t\t\t\t`Use prefixed color(${format.id}) instead of color(${id}).`,\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (id.startsWith(\"--\") && !format.id.startsWith(\"--\")) {\n\t\t\t\tdefaults.warn(\n\t\t\t\t\t`${space.name} is a standard space and supported in the CSS spec. ` +\n\t\t\t\t\t\t`Use color(${format.id}) instead of prefixed color(${id}).`,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tformat = ColorSpace.findFormat({ name, type: \"function\" });\n\t\t\tspace = format.space;\n\t\t}\n\n\t\tif (meta) {\n\t\t\tObject.assign(meta, {\n\t\t\t\tformat,\n\t\t\t\tformatId: format.name,\n\t\t\t\ttypes,\n\t\t\t\tcommas: env.parsed.commas,\n\t\t\t});\n\t\t}\n\n\t\tlet alpha = 1;\n\n\t\tif (env.parsed.lastAlpha) {\n\t\t\talpha = env.parsed.args.pop();\n\n\t\t\tif (meta) {\n\t\t\t\tmeta.alphaType = types.pop();\n\t\t\t}\n\t\t}\n\n\t\tlet coordCount = format.coords.length;\n\n\t\tif (coords.length !== coordCount) {\n\t\t\tthrow new TypeError(\n\t\t\t\t`Expected ${coordCount} coordinates for ${space.id} in ${env.str}), got ${coords.length}`,\n\t\t\t);\n\t\t}\n\n\t\tcoords = format.coerceCoords(coords, types);\n\n\t\tret = { spaceId: space.id, coords, alpha };\n\t}\n\telse {\n\t\t// Custom, colorspace-specific format\n\t\tspaceloop: for (let space of ColorSpace.all) {\n\t\t\tfor (let formatId in space.formats) {\n\t\t\t\tlet format = space.formats[formatId];\n\n\t\t\t\tif (format.type !== \"custom\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (format.test && !format.test(env.str)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Convert to Format object\n\t\t\t\tlet formatObject = space.getFormat(format);\n\n\t\t\t\tlet color = formatObject.parse(env.str);\n\n\t\t\t\tif (color) {\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tObject.assign(meta, { format: formatObject, formatId });\n\t\t\t\t\t}\n\n\t\t\t\t\tret = color;\n\t\t\t\t\tbreak spaceloop;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!ret) {\n\t\t// If we're here, we couldn't parse\n\t\tthrow new TypeError(`Could not parse ${str} as a color. Missing a plugin?`);\n\t}\n\n\t// Clamp alpha to [0, 1]\n\tret.alpha = isNone(ret.alpha)\n\t\t? ret.alpha\n\t\t: ret.alpha === undefined\n\t\t\t? 1\n\t\t\t: clamp(0, ret.alpha, 1);\n\n\treturn ret;\n}\n\n/**\n * Units and multiplication factors for the internally stored numbers\n */\nexport const units = {\n\t\"%\": 0.01,\n\tdeg: 1,\n\tgrad: 0.9,\n\trad: 180 / Math.PI,\n\tturn: 360,\n};\n\nexport const regex = {\n\t// Need to list calc(NaN) explicitly as otherwise its ending paren would terminate the function call\n\tfunction: /^([a-z]+)\\(((?:calc\\(NaN\\)|.)+?)\\)$/i,\n\tnumber: /^([-+]?(?:[0-9]*\\.)?[0-9]+(e[-+]?[0-9]+)?)$/i,\n\tunitValue: RegExp(`(${Object.keys(units).join(\"|\")})$`),\n\n\t// NOTE The -+ are not just for prefix, but also for idents, and e+N notation!\n\tsingleArgument: /\\/?\\s*(none|NaN|calc\\(NaN\\)|[-+\\w.]+(?:%|deg|g?rad|turn)?)/g,\n};\n\n/**\n * Parse a single function argument\n * @param {string} rawArg\n * @returns {{value: number, meta: ArgumentMeta}}\n */\nexport function parseArgument (rawArg) {\n\t/** @type {Partial<ArgumentMeta>} */\n\tlet meta = {};\n\tlet unit = rawArg.match(regex.unitValue)?.[0];\n\t/** @type {string | number} */\n\tlet value = (meta.raw = rawArg);\n\n\tif (unit) {\n\t\t// It’s a dimension token\n\t\tmeta.type = unit === \"%\" ? \"<percentage>\" : \"<angle>\";\n\t\tmeta.unit = unit;\n\t\tmeta.unitless = Number(value.slice(0, -unit.length)); // unitless number\n\n\t\tvalue = meta.unitless * units[unit];\n\t}\n\telse if (regex.number.test(value)) {\n\t\t// It's a number\n\t\t// Convert numerical args to numbers\n\t\tvalue = Number(value);\n\t\tmeta.type = \"<number>\";\n\t}\n\telse if (value === \"none\") {\n\t\tvalue = null;\n\t}\n\telse if (value === \"NaN\" || value === \"calc(NaN)\") {\n\t\tvalue = NaN;\n\t\tmeta.type = \"<number>\";\n\t}\n\telse {\n\t\tmeta.type = \"<ident>\";\n\t}\n\n\treturn { value: /** @type {number} */ (value), meta: /** @type {ArgumentMeta} */ (meta) };\n}\n\n/**\n * Parse a CSS function, regardless of its name and arguments\n * @param {string} str String to parse\n * @return {ParseFunctionReturn | void}\n */\nexport function parseFunction (str) {\n\tif (!str) {\n\t\treturn;\n\t}\n\n\tstr = str.trim();\n\n\tlet parts = str.match(regex.function);\n\n\tif (parts) {\n\t\t// It is a function, parse args\n\t\tlet args = [];\n\t\tlet argMeta = [];\n\t\tlet lastAlpha = false;\n\t\tlet name = parts[1].toLowerCase();\n\n\t\tlet separators = parts[2].replace(regex.singleArgument, ($0, rawArg) => {\n\t\t\tlet { value, meta } = parseArgument(rawArg);\n\n\t\t\tif (\n\t\t\t\t// If there's a slash here, it's modern syntax\n\t\t\t\t$0.startsWith(\"/\") ||\n\t\t\t\t// If there's still elements to process after there's already 3 in `args` (and the we're not dealing with \"color()\"), it's likely to be a legacy color like \"hsl(0, 0%, 0%, 0.5)\"\n\t\t\t\t(name !== \"color\" && args.length === 3)\n\t\t\t) {\n\t\t\t\t// It's alpha\n\t\t\t\tlastAlpha = true;\n\t\t\t}\n\n\t\t\targs.push(value);\n\t\t\targMeta.push(meta);\n\t\t\treturn \"\";\n\t\t});\n\n\t\treturn {\n\t\t\tname,\n\t\t\targs,\n\t\t\targMeta,\n\t\t\tlastAlpha,\n\t\t\tcommas: separators.includes(\",\"),\n\t\t\trawName: parts[1],\n\t\t\trawArgs: parts[2],\n\t\t};\n\t}\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport { isString, isInstance } from \"./util.js\";\nimport parse from \"./parse.js\";\n\n/** @import { ColorTypes, ParseOptions as GetColorOptions, PlainColorObject } from \"./types.js\" */\n\n/**\n * Resolves a color reference (object or string) to a plain color object\n * @overload\n * @param {ColorTypes} color\n * @param {GetColorOptions} [options]\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes[]} color\n * @param {GetColorOptions} [options]\n * @returns {PlainColorObject[]}\n */\nexport default function getColor (color, options) {\n\tif (Array.isArray(color)) {\n\t\treturn color.map(c => getColor(c, options));\n\t}\n\n\tif (!color) {\n\t\tthrow new TypeError(\"Empty color reference\");\n\t}\n\n\tif (isString(color)) {\n\t\tcolor = parse(color, options);\n\t}\n\n\t// Object fixup\n\tlet space = color.space || color.spaceId;\n\n\tif (typeof space === \"string\") {\n\t\t// Convert string id to color space object\n\t\tcolor.space = ColorSpace.get(space);\n\t}\n\n\tif (color.alpha === undefined) {\n\t\tcolor.alpha = 1;\n\t}\n\n\treturn color;\n}\n","/**\n * @packageDocumentation\n * Defines the class and other types related to creating color spaces.\n * For the builtin color spaces, see the `spaces` module.\n */\nimport { type, isNone, isInstance } from \"./util.js\";\nimport Format from \"./Format.js\";\nimport { getWhite } from \"./adapt.js\";\nimport hooks from \"./hooks.js\";\nimport getColor from \"./getColor.js\";\n\nconst ε = 0.000075;\n\n/**\n * Class to represent a color space\n */\nexport default class ColorSpace {\n\tconstructor (options) {\n\t\tthis.id = options.id;\n\t\tthis.name = options.name;\n\t\tthis.base = options.base ? ColorSpace.get(options.base) : null;\n\t\tthis.aliases = options.aliases;\n\n\t\tif (this.base) {\n\t\t\tthis.fromBase = options.fromBase;\n\t\t\tthis.toBase = options.toBase;\n\t\t}\n\n\t\t// Coordinate metadata\n\n\t\tlet coords = options.coords ?? this.base.coords;\n\n\t\tfor (let name in coords) {\n\t\t\tif (!(\"name\" in coords[name])) {\n\t\t\t\tcoords[name].name = name;\n\t\t\t}\n\t\t}\n\t\tthis.coords = coords;\n\n\t\t// White point\n\n\t\tlet white = options.white ?? this.base.white ?? \"D65\";\n\t\tthis.white = getWhite(white);\n\n\t\t// Sort out formats\n\n\t\tthis.formats = options.formats ?? {};\n\n\t\tfor (let name in this.formats) {\n\t\t\tlet format = this.formats[name];\n\t\t\tformat.type ||= \"function\";\n\t\t\tformat.name ||= name;\n\t\t}\n\n\t\tif (!this.formats.color?.id) {\n\t\t\tthis.formats.color = {\n\t\t\t\t...(this.formats.color ?? {}),\n\t\t\t\tid: options.cssId || this.id,\n\t\t\t};\n\t\t}\n\n\t\t// Gamut space\n\n\t\tif (options.gamutSpace) {\n\t\t\t// Gamut space explicitly specified\n\t\t\tthis.gamutSpace =\n\t\t\t\toptions.gamutSpace === \"self\" ? this : ColorSpace.get(options.gamutSpace);\n\t\t}\n\t\telse {\n\t\t\t// No gamut space specified, calculate a sensible default\n\t\t\tif (this.isPolar) {\n\t\t\t\t// Do not check gamut through polar coordinates\n\t\t\t\tthis.gamutSpace = this.base;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.gamutSpace = this;\n\t\t\t}\n\t\t}\n\n\t\t// Optimize inGamut for unbounded spaces\n\t\tif (this.gamutSpace.isUnbounded) {\n\t\t\tthis.inGamut = (coords, options) => {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\t// Other stuff\n\t\tthis.referred = options.referred;\n\n\t\t// Compute ancestors and store them, since they will never change\n\t\tObject.defineProperty(this, \"path\", {\n\t\t\tvalue: getPath(this).reverse(),\n\t\t\twritable: false,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t});\n\n\t\thooks.run(\"colorspace-init-end\", this);\n\t}\n\n\tinGamut (coords, { epsilon = ε } = {}) {\n\t\tif (!this.equals(this.gamutSpace)) {\n\t\t\tcoords = this.to(this.gamutSpace, coords);\n\t\t\treturn this.gamutSpace.inGamut(coords, { epsilon });\n\t\t}\n\n\t\tlet coordMeta = Object.values(this.coords);\n\n\t\treturn coords.every((c, i) => {\n\t\t\tlet meta = coordMeta[i];\n\n\t\t\tif (meta.type !== \"angle\" && meta.range) {\n\t\t\t\tif (isNone(c)) {\n\t\t\t\t\t// NaN is always in gamut\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tlet [min, max] = meta.range;\n\t\t\t\treturn (\n\t\t\t\t\t(min === undefined || c >= min - epsilon) &&\n\t\t\t\t\t(max === undefined || c <= max + epsilon)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tget isUnbounded () {\n\t\treturn Object.values(this.coords).every(coord => !(\"range\" in coord));\n\t}\n\n\tget cssId () {\n\t\treturn this.formats?.color?.id || this.id;\n\t}\n\n\tget isPolar () {\n\t\tfor (let id in this.coords) {\n\t\t\tif (this.coords[id].type === \"angle\") {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Lookup a format in this color space\n\t * @param {string | object | Format} format - Format id if string. If object, it's converted to a `Format` object and returned.\n\t * @returns {Format}\n\t */\n\tgetFormat (format) {\n\t\tif (!format) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (format === \"default\") {\n\t\t\tformat = Object.values(this.formats)[0];\n\t\t}\n\t\telse if (typeof format === \"string\") {\n\t\t\tformat = this.formats[format];\n\t\t}\n\n\t\tlet ret = Format.get(format, this);\n\n\t\tif (ret !== format && format.name in this.formats) {\n\t\t\t// Update the format we have on file so we can find it more quickly next time\n\t\t\tthis.formats[format.name] = ret;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Check if this color space is the same as another color space reference.\n\t * Allows proxying color space objects and comparing color spaces with ids.\n\t * @param {string | ColorSpace} space ColorSpace object or id to compare to\n\t * @returns {boolean}\n\t */\n\tequals (space) {\n\t\tif (!space) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this === space || this.id === space || this.id === space.id;\n\t}\n\n\tto (space, coords) {\n\t\tif (arguments.length === 1) {\n\t\t\tconst color = getColor(space);\n\t\t\t[space, coords] = [color.space, color.coords];\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tif (this.equals(space)) {\n\t\t\t// Same space, no change needed\n\t\t\treturn coords;\n\t\t}\n\n\t\t// Convert NaN to 0, which seems to be valid in every coordinate of every color space\n\t\tcoords = coords.map(c => (isNone(c) ? 0 : c));\n\n\t\t// Find connection space = lowest common ancestor in the base tree\n\t\tlet myPath = this.path;\n\t\tlet otherPath = space.path;\n\n\t\tlet connectionSpace, connectionSpaceIndex;\n\n\t\tfor (let i = 0; i < myPath.length; i++) {\n\t\t\tif (myPath[i].equals(otherPath[i])) {\n\t\t\t\tconnectionSpace = myPath[i];\n\t\t\t\tconnectionSpaceIndex = i;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!connectionSpace) {\n\t\t\t// This should never happen\n\t\t\tthrow new Error(\n\t\t\t\t`Cannot convert between color spaces ${this} and ${space}: no connection space was found`,\n\t\t\t);\n\t\t}\n\n\t\t// Go up from current space to connection space\n\t\tfor (let i = myPath.length - 1; i > connectionSpaceIndex; i--) {\n\t\t\tcoords = myPath[i].toBase(coords);\n\t\t}\n\n\t\t// Go down from connection space to target space\n\t\tfor (let i = connectionSpaceIndex + 1; i < otherPath.length; i++) {\n\t\t\tcoords = otherPath[i].fromBase(coords);\n\t\t}\n\n\t\treturn coords;\n\t}\n\n\tfrom (space, coords) {\n\t\tif (arguments.length === 1) {\n\t\t\tconst color = getColor(space);\n\t\t\t[space, coords] = [color.space, color.coords];\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\treturn space.to(this, coords);\n\t}\n\n\ttoString () {\n\t\treturn `${this.name} (${this.id})`;\n\t}\n\n\tgetMinCoords () {\n\t\tlet ret = [];\n\n\t\tfor (let id in this.coords) {\n\t\t\tlet meta = this.coords[id];\n\t\t\tlet range = meta.range || meta.refRange;\n\t\t\tret.push(range?.min ?? 0);\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tstatic registry = {};\n\n\t// Returns array of unique color spaces\n\tstatic get all () {\n\t\treturn [...new Set(Object.values(ColorSpace.registry))];\n\t}\n\n\tstatic register (id, space) {\n\t\tif (arguments.length === 1) {\n\t\t\tspace = arguments[0];\n\t\t\tid = space.id;\n\t\t}\n\n\t\tspace = this.get(space);\n\n\t\tif (this.registry[id] && this.registry[id] !== space) {\n\t\t\tthrow new Error(`Duplicate color space registration: '${id}'`);\n\t\t}\n\t\tthis.registry[id] = space;\n\n\t\t// Register aliases when called without an explicit ID.\n\t\tif (arguments.length === 1 && space.aliases) {\n\t\t\tfor (let alias of space.aliases) {\n\t\t\t\tthis.register(alias, space);\n\t\t\t}\n\t\t}\n\n\t\treturn space;\n\t}\n\n\t/**\n\t * Lookup ColorSpace object by name\n\t * @param {ColorSpace | string} name\n\t */\n\tstatic get (space, ...alternatives) {\n\t\tif (!space || isInstance(space, this)) {\n\t\t\treturn space;\n\t\t}\n\n\t\tlet argType = type(space);\n\n\t\tif (argType === \"string\") {\n\t\t\t// It's a color space id\n\t\t\tlet ret = ColorSpace.registry[space.toLowerCase()];\n\n\t\t\tif (!ret) {\n\t\t\t\tthrow new TypeError(`No color space found with id = \"${space}\"`);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (alternatives.length) {\n\t\t\treturn ColorSpace.get(...alternatives);\n\t\t}\n\n\t\tthrow new TypeError(`${space} is not a valid color space`);\n\t}\n\n\t/**\n\t * Look up all color spaces for a format that matches certain criteria\n\t * @param {object | string} filters\n\t * @param {Array<ColorSpace>} [spaces=ColorSpace.all]\n\t * @returns {Format | null}\n\t */\n\tstatic findFormat (filters, spaces = ColorSpace.all) {\n\t\tif (!filters) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (typeof filters === \"string\") {\n\t\t\tfilters = { name: filters };\n\t\t}\n\n\t\tfor (let space of spaces) {\n\t\t\tfor (let [name, format] of Object.entries(space.formats)) {\n\t\t\t\tformat.name ??= name;\n\t\t\t\tformat.type ??= \"function\";\n\n\t\t\t\tlet matches =\n\t\t\t\t\t(!filters.name || format.name === filters.name) &&\n\t\t\t\t\t(!filters.type || format.type === filters.type);\n\n\t\t\t\tif (filters.id) {\n\t\t\t\t\tlet ids = format.ids || [format.id];\n\t\t\t\t\tlet filterIds = Array.isArray(filters.id) ? filters.id : [filters.id];\n\t\t\t\t\tmatches &&= filterIds.some(id => ids.includes(id));\n\t\t\t\t}\n\n\t\t\t\tif (matches) {\n\t\t\t\t\tlet ret = Format.get(format, space);\n\n\t\t\t\t\tif (ret !== format) {\n\t\t\t\t\t\tspace.formats[format.name] = ret;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Get metadata about a coordinate of a color space\n\t *\n\t * @static\n\t * @param {Array | string} ref\n\t * @param {ColorSpace | string} [workingSpace]\n\t * @return {Object}\n\t */\n\tstatic resolveCoord (ref, workingSpace) {\n\t\tlet coordType = type(ref);\n\t\tlet space, coord;\n\n\t\tif (coordType === \"string\") {\n\t\t\tif (ref.includes(\".\")) {\n\t\t\t\t// Absolute coordinate\n\t\t\t\t[space, coord] = ref.split(\".\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Relative coordinate\n\t\t\t\t[space, coord] = [, ref];\n\t\t\t}\n\t\t}\n\t\telse if (Array.isArray(ref)) {\n\t\t\t[space, coord] = ref;\n\t\t}\n\t\telse {\n\t\t\t// Object\n\t\t\tspace = ref.space;\n\t\t\tcoord = ref.coordId;\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tif (!space) {\n\t\t\tspace = workingSpace;\n\t\t}\n\n\t\tif (!space) {\n\t\t\tthrow new TypeError(\n\t\t\t\t`Cannot resolve coordinate reference ${ref}: No color space specified and relative references are not allowed here`,\n\t\t\t);\n\t\t}\n\n\t\tcoordType = type(coord);\n\n\t\tif (coordType === \"number\" || (coordType === \"string\" && coord >= 0)) {\n\t\t\t// Resolve numerical coord\n\t\t\tlet meta = Object.entries(space.coords)[coord];\n\n\t\t\tif (meta) {\n\t\t\t\treturn { space, id: meta[0], index: coord, ...meta[1] };\n\t\t\t}\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tlet normalizedCoord = coord.toLowerCase();\n\n\t\tlet i = 0;\n\t\tfor (let id in space.coords) {\n\t\t\tlet meta = space.coords[id];\n\n\t\t\tif (\n\t\t\t\tid.toLowerCase() === normalizedCoord ||\n\t\t\t\tmeta.name?.toLowerCase() === normalizedCoord\n\t\t\t) {\n\t\t\t\treturn { space, id, index: i, ...meta };\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\tthrow new TypeError(\n\t\t\t`No \"${coord}\" coordinate found in ${space.name}. Its coordinates are: ${Object.keys(space.coords).join(\", \")}`,\n\t\t);\n\t}\n\n\tstatic DEFAULT_FORMAT = {\n\t\ttype: \"functions\",\n\t\tname: \"color\",\n\t};\n}\n\nfunction getPath (space) {\n\tlet ret = [space];\n\n\tfor (let s = space; (s = s.base); ) {\n\t\tret.push(s);\n\t}\n\n\treturn ret;\n}\n","import ColorSpace from \"../ColorSpace.js\";\n\nexport default new ColorSpace({\n\tid: \"xyz-d65\",\n\tname: \"XYZ D65\",\n\tcoords: {\n\t\tx: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"X\",\n\t\t},\n\t\ty: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Y\",\n\t\t},\n\t\tz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Z\",\n\t\t},\n\t},\n\twhite: \"D65\",\n\tformats: {\n\t\tcolor: {\n\t\t\tids: [\"xyz-d65\", \"xyz\"],\n\t\t},\n\t},\n\taliases: [\"xyz\"],\n});\n","import ColorSpace from \"./ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"./util.js\";\nimport adapt from \"./adapt.js\";\nimport XYZ_D65 from \"./spaces/xyz-d65.js\";\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").RGBOptions} RGBOptions */\n\n/** Convenience class for RGB color spaces */\nexport default class RGBColorSpace extends ColorSpace {\n\t/**\n\t * Creates a new RGB ColorSpace.\n\t * If coords are not specified, they will use the default RGB coords.\n\t * Instead of `fromBase()` and `toBase()` functions,\n\t * you can specify to/from XYZ matrices and have `toBase()` and `fromBase()` automatically generated.\n\t * @param {RGBOptions} options\n\t */\n\tconstructor (options) {\n\t\tif (!options.coords) {\n\t\t\toptions.coords = {\n\t\t\t\tr: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Red\",\n\t\t\t\t},\n\t\t\t\tg: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Green\",\n\t\t\t\t},\n\t\t\t\tb: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Blue\",\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tif (!options.base) {\n\t\t\toptions.base = XYZ_D65;\n\t\t}\n\n\t\tif (options.toXYZ_M && options.fromXYZ_M) {\n\t\t\toptions.toBase ??= rgb => {\n\t\t\t\tlet xyz = multiply_v3_m3x3(rgb, options.toXYZ_M);\n\n\t\t\t\tif (this.white !== this.base.white) {\n\t\t\t\t\t// Perform chromatic adaptation\n\t\t\t\t\txyz = adapt(this.white, this.base.white, xyz);\n\t\t\t\t}\n\n\t\t\t\treturn xyz;\n\t\t\t};\n\n\t\t\toptions.fromBase ??= xyz => {\n\t\t\t\txyz = adapt(this.base.white, this.white, xyz);\n\t\t\t\treturn multiply_v3_m3x3(xyz, options.fromXYZ_M);\n\t\t\t};\n\t\t}\n\n\t\toptions.referred ??= \"display\";\n\n\t\tsuper(options);\n\t}\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\nimport { toPrecision } from \"./util.js\";\n\n/** @import { ColorTypes, Coords } from \"./types.js\" */\n\n/**\n * Options for {@link getAll}\n * @typedef GetAllOptions\n * @property {string | ColorSpace | undefined} [space]\n * The color space to convert to. Defaults to the color's current space\n * @property {number | undefined} [precision]\n * The number of significant digits to round the coordinates to\n */\n\n/**\n * Get the coordinates of a color in any color space\n * @overload\n * @param {ColorTypes} color\n * @param {string | ColorSpace} [options=color.space] The color space to convert to. Defaults to the color's current space\n * @returns {Coords} The color coordinates in the given color space\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {GetAllOptions} [options]\n * @returns {Coords} The color coordinates in the given color space\n */\nexport default function getAll (color, options) {\n\tcolor = getColor(color);\n\n\tlet space = ColorSpace.get(options, options?.space);\n\tlet precision = options?.precision;\n\n\tlet coords;\n\tif (!space || color.space.equals(space)) {\n\t\t// No conversion needed\n\t\tcoords = color.coords.slice();\n\t}\n\telse {\n\t\tcoords = space.from(color);\n\t}\n\n\treturn precision === undefined ? coords : coords.map(coord => toPrecision(coord, precision));\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getAll from \"./getAll.js\";\nimport getColor from \"./getColor.js\";\n\n/** @import { ColorTypes, Ref } from \"./types.js\" */\n\n/**\n * @param {ColorTypes} color\n * @param {Ref} prop\n * @returns {number}\n */\nexport default function get (color, prop) {\n\tcolor = getColor(color);\n\n\tif (prop === \"alpha\") {\n\t\treturn color.alpha ?? 1;\n\t}\n\n\tlet { space, index } = ColorSpace.resolveCoord(prop, color.space);\n\tlet coords = getAll(color, space);\n\treturn coords[index];\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\n\n/** @import { ColorTypes, Coords, PlainColorObject } from \"./types.js\" */\n\n/**\n * Set all coordinates of a color at once, in its own color space or another.\n * Modifies the color in place.\n * @overload\n * @param {ColorTypes} color\n * @param {Coords} coords Array of coordinates\n * @param {number} [alpha]\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {string | ColorSpace} space The color space of the provided coordinates.\n * @param {Coords} coords Array of coordinates\n * @param {number} [alpha]\n * @returns {PlainColorObject}\n */\nexport default function setAll (color, space, coords, alpha) {\n\tcolor = getColor(color);\n\n\tif (Array.isArray(space)) {\n\t\t// Space is omitted\n\t\t[space, coords, alpha] = [color.space, space, coords];\n\t}\n\n\tspace = ColorSpace.get(space); // Make sure we have a ColorSpace object\n\tcolor.coords = space === color.space ? coords.slice() : space.to(color.space, coords);\n\n\tif (alpha !== undefined) {\n\t\tcolor.alpha = alpha;\n\t}\n\n\treturn color;\n}\n\n/** @type {\"color\"} */\nsetAll.returns = \"color\";\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\nimport get from \"./get.js\";\nimport getAll from \"./getAll.js\";\nimport setAll from \"./setAll.js\";\nimport { type } from \"./util.js\";\n\n/** @import { ColorTypes, PlainColorObject, Ref } from \"./types.js\" */\n\n/**\n * Set properties and return current instance\n * @overload\n * @param {ColorTypes} color\n * @param {Ref} prop\n * @param {number | ((coord: number) => number)} value\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {Record<string, number | ((coord: number) => number)>} props\n * @returns {PlainColorObject}\n */\nexport default function set (color, prop, value) {\n\tcolor = getColor(color);\n\n\tif (arguments.length === 2 && type(arguments[1]) === \"object\") {\n\t\t// Argument is an object literal\n\t\tlet object = arguments[1];\n\t\tfor (let p in object) {\n\t\t\tset(color, p, object[p]);\n\t\t}\n\t}\n\telse {\n\t\tif (typeof value === \"function\") {\n\t\t\tvalue = value(get(color, prop));\n\t\t}\n\n\t\tif (prop === \"alpha\") {\n\t\t\tcolor.alpha = value;\n\t\t}\n\t\telse {\n\t\t\tlet { space, index } = ColorSpace.resolveCoord(prop, color.space);\n\t\t\tlet coords = getAll(color, space);\n\t\t\tcoords[index] = value;\n\t\t\tsetAll(color, space, coords);\n\t\t}\n\t}\n\n\treturn color;\n}\n\n/** @type {\"color\"} */\nset.returns = \"color\";\n","import ColorSpace from \"../ColorSpace.js\";\nimport adapt from \"../adapt.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\nexport default new ColorSpace({\n\tid: \"xyz-d50\",\n\tname: \"XYZ D50\",\n\twhite: \"D50\",\n\tbase: XYZ_D65,\n\tfromBase: coords => adapt(XYZ_D65.white, \"D50\", coords),\n\ttoBase: coords => adapt(\"D50\", XYZ_D65.white, coords),\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { WHITES } from \"../adapt.js\";\nimport xyz_d50 from \"./xyz-d50.js\";\n\n// κ * ε  = 2^3 = 8\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst ε3 = 24 / 116;\nconst κ = 24389 / 27; // 29^3/3^3\n\nlet white = WHITES.D50;\n\nexport default new ColorSpace({\n\tid: \"lab\",\n\tname: \"Lab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t},\n\n\t// Assuming XYZ is relative to D50, convert to CIE Lab\n\t// from CIE standard, which now defines these as a rational fraction\n\twhite,\n\n\tbase: xyz_d50,\n\t// Convert D50-adapted XYX to Lab\n\t// CIE 15.3:2004 section 8.2.1.1\n\tfromBase (XYZ) {\n\t\t// XYZ scaled relative to reference white\n\t\tlet xyz = XYZ.map((value, i) => value / white[i]);\n\t\tlet f = xyz.map(value => (value > ε ? Math.cbrt(value) : (κ * value + 16) / 116));\n\n\t\tlet L = 116 * f[1] - 16;\n\t\tlet a = 500 * (f[0] - f[1]);\n\t\tlet b = 200 * (f[1] - f[2]);\n\n\t\treturn [L, a, b];\n\t},\n\t// Convert Lab to D50-adapted XYZ\n\t// Same result as CIE 15.3:2004 Appendix D although the derivation is different\n\t// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n\ttoBase (Lab) {\n\t\t// compute f, starting with the luminance-related term\n\t\tlet [L, a, b] = Lab;\n\t\tlet f = [];\n\t\tf[1] = (L + 16) / 116;\n\t\tf[0] = a / 500 + f[1];\n\t\tf[2] = f[1] - b / 200;\n\n\t\t// compute xyz\n\t\t// prettier-ignore\n\t\tlet xyz = [\n\t\t\tf[0]   > ε3 ? Math.pow(f[0], 3)                : (116 * f[0] - 16) / κ,\n\t\t\tLab[0] > 8  ? Math.pow((Lab[0] + 16) / 116, 3) : Lab[0] / κ,\n\t\t\tf[2]   > ε3 ? Math.pow(f[2], 3)                : (116 * f[2] - 16) / κ,\n\t\t];\n\n\t\t// Compute XYZ by scaling xyz by reference white\n\t\treturn xyz.map((value, i) => value * white[i]);\n\t},\n\n\tformats: {\n\t\tlab: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import * as util from \"./util.js\";\n\n/**\n * Constrain an angle to 360 degrees\n * @param {number} angle\n * @returns {number}\n */\nexport function constrain (angle) {\n\tif (typeof angle !== \"number\") {\n\t\treturn angle;\n\t}\n\n\treturn ((angle % 360) + 360) % 360;\n}\n\n/**\n * @param {\"raw\" | \"increasing\" | \"decreasing\" | \"longer\" | \"shorter\"} arc\n * @param {[number, number]} angles\n * @returns {[number, number]}\n */\nexport function adjust (arc, angles) {\n\tlet [a1, a2] = angles;\n\n\tlet none1 = util.isNone(a1);\n\tlet none2 = util.isNone(a2);\n\n\tif (none1 && none2) {\n\t\treturn [a1, a2];\n\t}\n\telse if (none1) {\n\t\ta1 = a2;\n\t}\n\telse if (none2) {\n\t\ta2 = a1;\n\t}\n\n\tif (arc === \"raw\") {\n\t\treturn angles;\n\t}\n\n\ta1 = constrain(a1);\n\ta2 = constrain(a2);\n\n\tlet angleDiff = a2 - a1;\n\n\tif (arc === \"increasing\") {\n\t\tif (angleDiff < 0) {\n\t\t\ta2 += 360;\n\t\t}\n\t}\n\telse if (arc === \"decreasing\") {\n\t\tif (angleDiff > 0) {\n\t\t\ta1 += 360;\n\t\t}\n\t}\n\telse if (arc === \"longer\") {\n\t\tif (-180 < angleDiff && angleDiff < 180) {\n\t\t\tif (angleDiff > 0) {\n\t\t\t\ta1 += 360;\n\t\t\t}\n\t\t\telse {\n\t\t\t\ta2 += 360;\n\t\t\t}\n\t\t}\n\t}\n\telse if (arc === \"shorter\") {\n\t\tif (angleDiff > 180) {\n\t\t\ta1 += 360;\n\t\t}\n\t\telse if (angleDiff < -180) {\n\t\t\ta2 += 360;\n\t\t}\n\t}\n\n\treturn [a1, a2];\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport Lab from \"./lab.js\";\nimport { constrain as constrainAngle } from \"../angles.js\";\nimport { isNone } from \"../util.js\";\n\nexport default new ColorSpace({\n\tid: \"lch\",\n\tname: \"LCH\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 150],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Lab,\n\tfromBase (Lab) {\n\t\t// These methods are used for other polar forms as well, so we can't hardcode the ε\n\t\tif (this.ε === undefined) {\n\t\t\t// @ts-expect-error Property 'coords' does not exist on type 'string | ColorSpace'\n\t\t\tlet range = Object.values(this.base.coords)[1].refRange;\n\t\t\tlet extent = range[1] - range[0];\n\t\t\tthis.ε = extent / 100000;\n\t\t}\n\n\t\t// Convert to polar form\n\t\tlet [L, a, b] = Lab;\n\t\tlet isAchromatic = Math.abs(a) < this.ε && Math.abs(b) < this.ε;\n\t\tlet h = isAchromatic ? null : constrainAngle((Math.atan2(b, a) * 180) / Math.PI);\n\t\tlet C = isAchromatic ? 0 : Math.sqrt(a ** 2 + b ** 2);\n\n\t\treturn [L, C, h];\n\t},\n\ttoBase (lch) {\n\t\t// Convert from polar form\n\t\tlet [L, C, h] = lch;\n\t\tlet a = null,\n\t\t\tb = null;\n\n\t\tif (!isNone(h)) {\n\t\t\tC = C < 0 ? 0 : C; // Clamp negative Chroma\n\t\t\ta = C * Math.cos((h * Math.PI) / 180);\n\t\t\tb = C * Math.sin((h * Math.PI) / 180);\n\t\t}\n\n\t\treturn [L, a, b];\n\t},\n\n\tformats: {\n\t\tlch: {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import defaults from \"../defaults.js\";\nimport lab from \"../spaces/lab.js\";\nimport lch from \"../spaces/lch.js\";\nimport getColor from \"../getColor.js\";\n\n// deltaE2000 is a statistically significant improvement\n// and is recommended by the CIE and Idealliance\n// especially for color differences less than 10 deltaE76\n// but is wicked complicated\n// and many implementations have small errors!\n// DeltaE2000 is also discontinuous; in case this\n// matters to you, use deltaECMC instead.\n\nconst Gfactor = 25 ** 7;\nconst π = Math.PI;\nconst r2d = 180 / π;\nconst d2r = π / 180;\n\nfunction pow7 (x) {\n\t// Faster than x ** 7 or Math.pow(x, 7)\n\n\tconst x2 = x * x;\n\tconst x7 = x2 * x2 * x2 * x;\n\n\treturn x7;\n}\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @param {{ kL?: number | undefined; kC?: number | undefined; kH?: number | undefined }} options\n * @returns {number}\n */\nexport default function (color, sample, { kL = 1, kC = 1, kH = 1 } = {}) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and the function parameter as the sample,\n\t// calculate deltaE 2000.\n\n\t// This implementation assumes the parametric\n\t// weighting factors kL, kC and kH\n\t// for the influence of viewing conditions\n\t// are all 1, as sadly seems typical.\n\t// kL should be increased for lightness texture or noise\n\t// and kC increased for chroma noise\n\n\tlet [L1, a1, b1] = lab.from(color);\n\tlet C1 = lch.from(lab, [L1, a1, b1])[1];\n\tlet [L2, a2, b2] = lab.from(sample);\n\tlet C2 = lch.from(lab, [L2, a2, b2])[1];\n\n\t// Check for negative Chroma,\n\t// which might happen through\n\t// direct user input of LCH values\n\n\tif (C1 < 0) {\n\t\tC1 = 0;\n\t}\n\tif (C2 < 0) {\n\t\tC2 = 0;\n\t}\n\n\tlet Cbar = (C1 + C2) / 2; // mean Chroma\n\n\t// calculate a-axis asymmetry factor from mean Chroma\n\t// this turns JND ellipses for near-neutral colors back into circles\n\tlet C7 = pow7(Cbar);\n\n\tlet G = 0.5 * (1 - Math.sqrt(C7 / (C7 + Gfactor)));\n\n\t// scale a axes by asymmetry factor\n\t// this by the way is why there is no Lab2000 colorspace\n\tlet adash1 = (1 + G) * a1;\n\tlet adash2 = (1 + G) * a2;\n\n\t// calculate new Chroma from scaled a and original b axes\n\tlet Cdash1 = Math.sqrt(adash1 ** 2 + b1 ** 2);\n\tlet Cdash2 = Math.sqrt(adash2 ** 2 + b2 ** 2);\n\n\t// calculate new hues, with zero hue for true neutrals\n\t// and in degrees, not radians\n\n\tlet h1 = adash1 === 0 && b1 === 0 ? 0 : Math.atan2(b1, adash1);\n\tlet h2 = adash2 === 0 && b2 === 0 ? 0 : Math.atan2(b2, adash2);\n\n\tif (h1 < 0) {\n\t\th1 += 2 * π;\n\t}\n\tif (h2 < 0) {\n\t\th2 += 2 * π;\n\t}\n\n\th1 *= r2d;\n\th2 *= r2d;\n\n\t// Lightness and Chroma differences; sign matters\n\tlet ΔL = L2 - L1;\n\tlet ΔC = Cdash2 - Cdash1;\n\n\t// Hue difference, getting the sign correct\n\tlet hdiff = h2 - h1;\n\tlet hsum = h1 + h2;\n\tlet habs = Math.abs(hdiff);\n\tlet Δh;\n\n\tif (Cdash1 * Cdash2 === 0) {\n\t\tΔh = 0;\n\t}\n\telse if (habs <= 180) {\n\t\tΔh = hdiff;\n\t}\n\telse if (hdiff > 180) {\n\t\tΔh = hdiff - 360;\n\t}\n\telse if (hdiff < -180) {\n\t\tΔh = hdiff + 360;\n\t}\n\telse {\n\t\tdefaults.warn(\"the unthinkable has happened\");\n\t}\n\n\t// weighted Hue difference, more for larger Chroma\n\tlet ΔH = 2 * Math.sqrt(Cdash2 * Cdash1) * Math.sin((Δh * d2r) / 2);\n\n\t// calculate mean Lightness and Chroma\n\tlet Ldash = (L1 + L2) / 2;\n\tlet Cdash = (Cdash1 + Cdash2) / 2;\n\tlet Cdash7 = pow7(Cdash);\n\n\t// Compensate for non-linearity in the blue region of Lab.\n\t// Four possibilities for hue weighting factor,\n\t// depending on the angles, to get the correct sign\n\tlet hdash;\n\tif (Cdash1 * Cdash2 === 0) {\n\t\thdash = hsum; // which should be zero\n\t}\n\telse if (habs <= 180) {\n\t\thdash = hsum / 2;\n\t}\n\telse if (hsum < 360) {\n\t\thdash = (hsum + 360) / 2;\n\t}\n\telse {\n\t\thdash = (hsum - 360) / 2;\n\t}\n\n\t// positional corrections to the lack of uniformity of CIELAB\n\t// These are all trying to make JND ellipsoids more like spheres\n\n\t// SL Lightness crispening factor\n\t// a background with L=50 is assumed\n\tlet lsq = (Ldash - 50) ** 2;\n\tlet SL = 1 + (0.015 * lsq) / Math.sqrt(20 + lsq);\n\n\t// SC Chroma factor, similar to those in CMC and deltaE 94 formulae\n\tlet SC = 1 + 0.045 * Cdash;\n\n\t// Cross term T for blue non-linearity\n\tlet T = 1;\n\tT -= 0.17 * Math.cos((hdash - 30) * d2r);\n\tT += 0.24 * Math.cos(2 * hdash * d2r);\n\tT += 0.32 * Math.cos((3 * hdash + 6) * d2r);\n\tT -= 0.2 * Math.cos((4 * hdash - 63) * d2r);\n\n\t// SH Hue factor depends on Chroma,\n\t// as well as adjusted hue angle like deltaE94.\n\tlet SH = 1 + 0.015 * Cdash * T;\n\n\t// RT Hue rotation term compensates for rotation of JND ellipses\n\t// and Munsell constant hue lines\n\t// in the medium-high Chroma blue region\n\t// (Hue 225 to 315)\n\tlet Δθ = 30 * Math.exp(-1 * ((hdash - 275) / 25) ** 2);\n\tlet RC = 2 * Math.sqrt(Cdash7 / (Cdash7 + Gfactor));\n\tlet RT = -1 * Math.sin(2 * Δθ * d2r) * RC;\n\n\t// Finally calculate the deltaE, term by term as root sume of squares\n\tlet dE = (ΔL / (kL * SL)) ** 2;\n\tdE += (ΔC / (kC * SC)) ** 2;\n\tdE += (ΔH / (kH * SH)) ** 2;\n\tdE += RT * (ΔC / (kC * SC)) * (ΔH / (kH * SH));\n\treturn Math.sqrt(dE);\n\t// Yay!!!\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"../util.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// Recalculated for consistent reference white\n// see https://github.com/w3c/csswg-drafts/issues/6642#issuecomment-943521484\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst XYZtoLMS_M = [\n\t[ 0.8190224379967030, 0.3619062600528904, -0.1288737815209879 ],\n\t[ 0.0329836539323885, 0.9292868615863434,  0.0361446663506424 ],\n\t[ 0.0481771893596242, 0.2642395317527308,  0.6335478284694309 ],\n];\n// inverse of XYZtoLMS_M\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst LMStoXYZ_M = [\n\t[  1.2268798758459243, -0.5578149944602171,  0.2813910456659647 ],\n\t[ -0.0405757452148008,  1.1122868032803170, -0.0717110580655164 ],\n\t[ -0.0763729366746601, -0.4214933324022432,  1.5869240198367816 ],\n];\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const LMStoLab_M = [\n\t[ 0.2104542683093140,  0.7936177747023054, -0.0040720430116193 ],\n\t[ 1.9779985324311684, -2.4285922420485799,  0.4505937096174110 ],\n\t[ 0.0259040424655478,  0.7827717124575296, -0.8086757549230774 ],\n];\n// LMStoIab_M inverted\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const LabtoLMS_M = [\n\t[ 1.0000000000000000,  0.3963377773761749,  0.2158037573099136 ],\n\t[ 1.0000000000000000, -0.1055613458156586, -0.0638541728258133 ],\n\t[ 1.0000000000000000, -0.0894841775298119, -1.2914855480194092 ],\n];\n\nexport default new ColorSpace({\n\tid: \"oklab\",\n\tname: \"Oklab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t},\n\n\t// Note that XYZ is relative to D65\n\twhite: \"D65\",\n\tbase: XYZ_D65,\n\tfromBase (XYZ) {\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiply_v3_m3x3(XYZ, XYZtoLMS_M);\n\n\t\t// non-linearity\n\t\tLMS[0] = Math.cbrt(LMS[0]);\n\t\tLMS[1] = Math.cbrt(LMS[1]);\n\t\tLMS[2] = Math.cbrt(LMS[2]);\n\n\t\treturn multiply_v3_m3x3(LMS, LMStoLab_M, LMS);\n\t},\n\ttoBase (OKLab) {\n\t\t// move to LMS cone domain\n\t\tlet LMSg = multiply_v3_m3x3(OKLab, LabtoLMS_M);\n\n\t\t// restore linearity\n\t\tLMSg[0] = LMSg[0] ** 3;\n\t\tLMSg[1] = LMSg[1] ** 3;\n\t\tLMSg[2] = LMSg[2] ** 3;\n\n\t\treturn multiply_v3_m3x3(LMSg, LMStoXYZ_M, LMSg);\n\t},\n\n\tformats: {\n\t\toklab: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import oklab from \"../spaces/oklab.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * More accurate color-difference formulae\n * than the simple 1976 Euclidean distance in CIE Lab\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaEOK, term by term as root sum of squares\n\tlet [L1, a1, b1] = oklab.from(color);\n\tlet [L2, a2, b2] = oklab.from(sample);\n\tlet ΔL = L1 - L2;\n\tlet Δa = a1 - a2;\n\tlet Δb = b1 - b2;\n\treturn Math.sqrt(ΔL ** 2 + Δa ** 2 + Δb ** 2);\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport getColor from \"./getColor.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\nconst ε = 0.000075;\n\n/**\n * Check if a color is in gamut of either its own or another color space\n * @param {ColorTypes} color\n * @param {string | ColorSpace} [space]\n * @param {{ epsilon?: number | undefined }} [param2]\n * @returns {boolean}\n */\nexport default function inGamut (color, space, { epsilon = ε } = {}) {\n\tcolor = getColor(color);\n\n\tif (!space) {\n\t\tspace = color.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\tlet coords = color.coords;\n\n\tif (space !== color.space) {\n\t\tcoords = space.from(color);\n\t}\n\n\treturn space.inGamut(coords, { epsilon });\n}\n","/** @import { Coords, PlainColorObject } from \"./types.js\" */\n\n/**\n * @param {PlainColorObject} color\n * @returns {PlainColorObject}\n */\nexport default function clone (color) {\n\treturn {\n\t\tspace: color.space,\n\t\tcoords: /** @type {Coords} */ (color.coords.slice()),\n\t\talpha: color.alpha,\n\t};\n}\n","import ColorSpace from \"./ColorSpace.js\";\nimport { isNone } from \"./util.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n/**\n * Euclidean distance of colors in an arbitrary color space\n * @param {ColorTypes} color1\n * @param {ColorTypes} color2\n * @param {string | ColorSpace} space\n * @returns {number}\n */\nexport default function distance (color1, color2, space = \"lab\") {\n\tspace = ColorSpace.get(space);\n\n\t// Assume getColor() is called on color in space.from()\n\tlet coords1 = space.from(color1);\n\tlet coords2 = space.from(color2);\n\n\treturn Math.sqrt(\n\t\tcoords1.reduce((acc, c1, i) => {\n\t\t\tlet c2 = coords2[i];\n\t\t\tif (isNone(c1) || isNone(c2)) {\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\treturn acc + (c2 - c1) ** 2;\n\t\t}, 0),\n\t);\n}\n","import distance from \"../distance.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function deltaE76 (color, sample) {\n\t// Assume getColor() is called in the distance function\n\treturn distance(color, sample, \"lab\");\n}\n","import lab from \"../spaces/lab.js\";\nimport lch from \"../spaces/lch.js\";\nimport getColor from \"../getColor.js\";\nimport { isNone } from \"../util.js\";\n\n// More accurate color-difference formulae\n// than the simple 1976 Euclidean distance in Lab\n\n// CMC by the Color Measurement Committee of the\n// Bradford Society of Dyeists and Colorsts, 1994.\n// Uses LCH rather than Lab,\n// with different weights for L, C and H differences\n// A nice increase in accuracy for modest increase in complexity\nconst π = Math.PI;\nconst d2r = π / 180;\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @param {{ l?: number | undefined; c?: number | undefined }} options\n * @returns {number}\n */\nexport default function (color, sample, { l = 2, c = 1 } = {}) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE CMC.\n\n\t// This implementation assumes the parametric\n\t// weighting factors l:c are 2:1\n\t// which is typical for non-textile uses.\n\n\tlet [L1, a1, b1] = lab.from(color);\n\tlet [, C1, H1] = lch.from(lab, [L1, a1, b1]);\n\tlet [L2, a2, b2] = lab.from(sample);\n\tlet C2 = lch.from(lab, [L2, a2, b2])[1];\n\n\t// let [L1, a1, b1] = color.getAll(lab);\n\t// let C1 = color.get(\"lch.c\");\n\t// let H1 = color.get(\"lch.h\");\n\t// let [L2, a2, b2] = sample.getAll(lab);\n\t// let C2 = sample.get(\"lch.c\");\n\n\t// Check for negative Chroma,\n\t// which might happen through\n\t// direct user input of LCH values\n\n\tif (C1 < 0) {\n\t\tC1 = 0;\n\t}\n\tif (C2 < 0) {\n\t\tC2 = 0;\n\t}\n\n\t// we don't need H2 as ΔH is calculated from Δa, Δb and ΔC\n\n\t// Lightness and Chroma differences\n\t// These are (color - sample), unlike deltaE2000\n\tlet ΔL = L1 - L2;\n\tlet ΔC = C1 - C2;\n\n\tlet Δa = a1 - a2;\n\tlet Δb = b1 - b2;\n\n\t// weighted Hue difference, less for larger Chroma difference\n\n\tlet H2 = Δa ** 2 + Δb ** 2 - ΔC ** 2;\n\t// due to roundoff error it is possible that, for zero a and b,\n\t// ΔC > Δa + Δb is 0, resulting in attempting\n\t// to take the square root of a negative number\n\n\t// trying instead the equation from Industrial Color Physics\n\t// By Georg A. Klein\n\n\t// let ΔH = ((a1 * b2) - (a2 * b1)) / Math.sqrt(0.5 * ((C2 * C1) + (a2 * a1) + (b2 * b1)));\n\t// console.log({ΔH});\n\t// This gives the same result to 12 decimal places\n\t// except it sometimes NaNs when trying to root a negative number\n\n\t// let ΔH = Math.sqrt(H2); we never actually use the root, it gets squared again!!\n\n\t// positional corrections to the lack of uniformity of CIELAB\n\t// These are all trying to make JND ellipsoids more like spheres\n\n\t// SL Lightness crispening factor, depends entirely on L1 not L2\n\tlet SL = 0.511; // linear portion of the Y to L transfer function\n\tif (L1 >= 16) {\n\t\t// cubic portion\n\t\tSL = (0.040975 * L1) / (1 + 0.01765 * L1);\n\t}\n\n\t// SC Chroma factor\n\tlet SC = (0.0638 * C1) / (1 + 0.0131 * C1) + 0.638;\n\n\t// Cross term T for blue non-linearity\n\tlet T;\n\tif (isNone(H1)) {\n\t\tH1 = 0;\n\t}\n\n\tif (H1 >= 164 && H1 <= 345) {\n\t\tT = 0.56 + Math.abs(0.2 * Math.cos((H1 + 168) * d2r));\n\t}\n\telse {\n\t\tT = 0.36 + Math.abs(0.4 * Math.cos((H1 + 35) * d2r));\n\t}\n\t// console.log({T});\n\n\t// SH Hue factor also depends on C1,\n\tlet C4 = Math.pow(C1, 4);\n\tlet F = Math.sqrt(C4 / (C4 + 1900));\n\tlet SH = SC * (F * T + 1 - F);\n\n\t// Finally calculate the deltaE, term by term as root sume of squares\n\tlet dE = (ΔL / (l * SL)) ** 2;\n\tdE += (ΔC / (c * SC)) ** 2;\n\tdE += H2 / SH ** 2;\n\t// dE += (ΔH / SH)  ** 2;\n\treturn Math.sqrt(dE);\n\t// Yay!!!\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\nconst Yw = 203; // absolute luminance of media white\n\nexport default new ColorSpace({\n\t// Absolute CIE XYZ, with a D65 whitepoint,\n\t// as used in most HDR colorspaces as a starting point.\n\t// SDR spaces are converted per BT.2048\n\t// so that diffuse, media white is 203 cd/m²\n\tid: \"xyz-abs-d65\",\n\tcssId: \"--xyz-abs-d65\",\n\tname: \"Absolute XYZ D65\",\n\tcoords: {\n\t\tx: {\n\t\t\trefRange: [0, 9504.7],\n\t\t\tname: \"Xa\",\n\t\t},\n\t\ty: {\n\t\t\trefRange: [0, 10000],\n\t\t\tname: \"Ya\",\n\t\t},\n\t\tz: {\n\t\t\trefRange: [0, 10888.3],\n\t\t\tname: \"Za\",\n\t\t},\n\t},\n\n\tbase: XYZ_D65,\n\tfromBase (XYZ) {\n\t\t// Make XYZ absolute, not relative to media white\n\t\t// Maximum luminance in PQ is 10,000 cd/m²\n\t\t// Relative XYZ has Y=1 for media white\n\t\treturn XYZ.map(v => v * Yw);\n\t},\n\ttoBase (AbsXYZ) {\n\t\t// Convert to media-white relative XYZ\n\t\treturn AbsXYZ.map(v => v / Yw);\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"../util.js\";\nimport XYZ_Abs_D65 from \"./xyz-abs-d65.js\";\nimport { spow } from \"../util.js\";\n\n/** @import { Matrix3x3, Vector3 } from \"../types.js\" */\n\nconst b = 1.15;\nconst g = 0.66;\nconst n = 2610 / 2 ** 14;\nconst ninv = 2 ** 14 / 2610;\nconst c1 = 3424 / 2 ** 12;\nconst c2 = 2413 / 2 ** 7;\nconst c3 = 2392 / 2 ** 7;\nconst p = (1.7 * 2523) / 2 ** 5;\nconst pinv = 2 ** 5 / (1.7 * 2523);\nconst d = -0.56;\nconst d0 = 1.6295499532821566e-11;\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst XYZtoCone_M = [\n\t[  0.41478972, 0.579999,  0.0146480 ],\n\t[ -0.2015100,  1.120649,  0.0531008 ],\n\t[ -0.0166008,  0.264800,  0.6684799 ],\n];\n// XYZtoCone_M inverted\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst ConetoXYZ_M = [\n\t[  1.9242264357876067,  -1.0047923125953657,  0.037651404030618   ],\n\t[  0.35031676209499907,  0.7264811939316552, -0.06538442294808501 ],\n\t[ -0.09098281098284752, -0.3127282905230739,  1.5227665613052603  ],\n];\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst ConetoIab_M = [\n\t[  0.5,       0.5,       0        ],\n\t[  3.524000, -4.066708,  0.542708 ],\n\t[  0.199076,  1.096799, -1.295875 ],\n];\n// ConetoIab_M inverted\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst IabtoCone_M = [\n\t[ 1,                   0.13860504327153927,   0.05804731615611883 ],\n\t[ 1,                  -0.1386050432715393,   -0.058047316156118904 ],\n\t[ 1,                  -0.09601924202631895,  -0.81189189605603900  ],\n];\n\nexport default new ColorSpace({\n\tid: \"jzazbz\",\n\tname: \"Jzazbz\",\n\tcoords: {\n\t\tjz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Jz\",\n\t\t},\n\t\taz: {\n\t\t\trefRange: [-0.21, 0.21],\n\t\t},\n\t\tbz: {\n\t\t\trefRange: [-0.21, 0.21],\n\t\t},\n\t},\n\n\tbase: XYZ_Abs_D65,\n\tfromBase (XYZ) {\n\t\t// First make XYZ absolute, not relative to media white\n\t\t// Maximum luminance in PQ is 10,000 cd/m²\n\t\t// Relative XYZ has Y=1 for media white\n\t\t// BT.2048 says media white Y=203 at PQ 58\n\n\t\tlet [Xa, Ya, Za] = XYZ;\n\n\t\t// modify X and Y to minimize blue curvature\n\t\tlet Xm = b * Xa - (b - 1) * Za;\n\t\tlet Ym = g * Ya - (g - 1) * Xa;\n\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiply_v3_m3x3([Xm, Ym, Za], XYZtoCone_M);\n\n\t\t// PQ-encode LMS\n\t\tlet PQLMS = /** @type {Vector3} } */ (\n\t\t\tLMS.map(function (val) {\n\t\t\t\tlet num = c1 + c2 * spow(val / 10000, n);\n\t\t\t\tlet denom = 1 + c3 * spow(val / 10000, n);\n\n\t\t\t\treturn spow(num / denom, p);\n\t\t\t})\n\t\t);\n\n\t\t// almost there, calculate Iz az bz\n\t\tlet [Iz, az, bz] = multiply_v3_m3x3(PQLMS, ConetoIab_M);\n\t\t// console.log({Iz, az, bz});\n\n\t\tlet Jz = ((1 + d) * Iz) / (1 + d * Iz) - d0;\n\t\treturn [Jz, az, bz];\n\t},\n\ttoBase (Jzazbz) {\n\t\tlet [Jz, az, bz] = Jzazbz;\n\t\tlet Iz = (Jz + d0) / (1 + d - d * (Jz + d0));\n\n\t\t// bring into LMS cone domain\n\t\tlet PQLMS = multiply_v3_m3x3([Iz, az, bz], IabtoCone_M);\n\n\t\t// convert from PQ-coded to linear-light\n\t\tlet LMS = /** @type {Vector3} } */ (\n\t\t\tPQLMS.map(function (val) {\n\t\t\t\tlet num = c1 - spow(val, pinv);\n\t\t\t\tlet denom = c3 * spow(val, pinv) - c2;\n\t\t\t\tlet x = 10000 * spow(num / denom, ninv);\n\n\t\t\t\treturn x; // luminance relative to diffuse white, [0, 70 or so].\n\t\t\t})\n\t\t);\n\n\t\t// modified abs XYZ\n\t\tlet [Xm, Ym, Za] = multiply_v3_m3x3(LMS, ConetoXYZ_M);\n\n\t\t// un-modify X and Y to get D65 XYZ, relative to media white\n\t\tlet Xa = (Xm + (b - 1) * Za) / b;\n\t\tlet Ya = (Ym + (g - 1) * Xa) / g;\n\t\treturn [Xa, Ya, Za];\n\t},\n\n\tformats: {\n\t\t// https://drafts.csswg.org/css-color-hdr/#Jzazbz\n\t\tjzazbz: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport Jzazbz from \"./jzazbz.js\";\nimport lch from \"./lch.js\";\n\nexport default new ColorSpace({\n\tid: \"jzczhz\",\n\tname: \"JzCzHz\",\n\tcoords: {\n\t\tjz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Jz\",\n\t\t},\n\t\tcz: {\n\t\t\trefRange: [0, 0.26],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\thz: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Jzazbz,\n\tfromBase: lch.fromBase,\n\ttoBase: lch.toBase,\n\n\tformats: {\n\t\t// https://drafts.csswg.org/css-color-hdr/#JzCzhz\n\t\tjzczhz: {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import jzczhz from \"../spaces/jzczhz.js\";\nimport getColor from \"../getColor.js\";\nimport { isNone } from \"../util.js\";\n\n/**\n * More accurate color-difference formulae\n * than the simple 1976 Euclidean distance in Lab\n *\n * Uses JzCzHz, which has improved perceptual uniformity\n * and thus a simple Euclidean root-sum of ΔL² ΔC² ΔH²\n * gives good results.\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE in JzCzHz.\n\tlet [Jz1, Cz1, Hz1] = jzczhz.from(color);\n\tlet [Jz2, Cz2, Hz2] = jzczhz.from(sample);\n\n\t// Lightness and Chroma differences\n\t// sign does not matter as they are squared.\n\tlet ΔJ = Jz1 - Jz2;\n\tlet ΔC = Cz1 - Cz2;\n\n\t// length of chord for ΔH\n\tif (isNone(Hz1) && isNone(Hz2)) {\n\t\t// both undefined hues\n\t\tHz1 = 0;\n\t\tHz2 = 0;\n\t}\n\telse if (isNone(Hz1)) {\n\t\t// one undefined, set to the defined hue\n\t\tHz1 = Hz2;\n\t}\n\telse if (isNone(Hz2)) {\n\t\tHz2 = Hz1;\n\t}\n\n\tlet Δh = Hz1 - Hz2;\n\tlet ΔH = 2 * Math.sqrt(Cz1 * Cz2) * Math.sin((Δh / 2) * (Math.PI / 180));\n\n\treturn Math.sqrt(ΔJ ** 2 + ΔC ** 2 + ΔH ** 2);\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3 } from \"../util.js\";\nimport XYZ_Abs_D65 from \"./xyz-abs-d65.js\";\n\n/** @import { Matrix3x3, Vector3 } from \"../types.js\" */\n\nconst c1 = 3424 / 4096;\nconst c2 = 2413 / 128;\nconst c3 = 2392 / 128;\nconst m1 = 2610 / 16384;\nconst m2 = 2523 / 32;\nconst im1 = 16384 / 2610;\nconst im2 = 32 / 2523;\n\n// The matrix below includes the 4% crosstalk components\n// and is from the Dolby \"What is ICtCp\" paper\"\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst XYZtoLMS_M = [\n\t[  0.3592832590121217,  0.6976051147779502, -0.0358915932320290 ],\n\t[ -0.1920808463704993,  1.1004767970374321,  0.0753748658519118 ],\n\t[  0.0070797844607479,  0.0748396662186362,  0.8433265453898765 ],\n];\n// linear-light Rec.2020 to LMS, again with crosstalk\n// rational terms from Jan Fröhlich,\n// Encoding High Dynamic Range andWide Color Gamut Imagery, p.97\n// and ITU-R BT.2124-0 p.2\n/*\nconst Rec2020toLMS_M = [\n\t[ 1688 / 4096,  2146 / 4096,   262 / 4096 ],\n\t[  683 / 4096,  2951 / 4096,   462 / 4096 ],\n\t[   99 / 4096,   309 / 4096,  3688 / 4096 ]\n];\n*/\n// this includes the Ebner LMS coefficients,\n// the rotation, and the scaling to [-0.5,0.5] range\n// rational terms from Fröhlich p.97\n// and ITU-R BT.2124-0 pp.2-3\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst LMStoIPT_M = [\n\t[  2048 / 4096,   2048 / 4096,       0      ],\n\t[  6610 / 4096, -13613 / 4096,  7003 / 4096 ],\n\t[ 17933 / 4096, -17390 / 4096,  -543 / 4096 ],\n];\n\n// inverted matrices, calculated from the above\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst IPTtoLMS_M = [\n\t[ 0.9999999999999998,  0.0086090370379328,  0.1110296250030260 ],\n\t[ 0.9999999999999998, -0.0086090370379328, -0.1110296250030259 ],\n\t[ 0.9999999999999998,  0.5600313357106791, -0.3206271749873188 ],\n];\n/*\n// prettier-ignore\nconst LMStoRec2020_M = [\n\t[ 3.4375568932814012112,   -2.5072112125095058195,   0.069654319228104608382],\n\t[-0.79142868665644156125,   1.9838372198740089874,  -0.19240853321756742626 ],\n\t[-0.025646662911506476363, -0.099240248643945566751, 1.1248869115554520431  ]\n];\n*/\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst LMStoXYZ_M = [\n\t[  2.0701522183894223, -1.3263473389671563,  0.2066510476294053 ],\n\t[  0.3647385209748072,  0.6805660249472273, -0.0453045459220347 ],\n\t[ -0.0497472075358123, -0.0492609666966131,  1.1880659249923042 ],\n];\n\n// Only the PQ form of ICtCp is implemented here. There is also an HLG form.\n// from Dolby, \"WHAT IS ICTCP?\"\n// https://professional.dolby.com/siteassets/pdfs/ictcp_dolbywhitepaper_v071.pdf\n// and\n// Dolby, \"Perceptual Color Volume\n// Measuring the Distinguishable Colors of HDR and WCG Displays\"\n// https://professional.dolby.com/siteassets/pdfs/dolby-vision-measuring-perceptual-color-volume-v7.1.pdf\nexport default new ColorSpace({\n\tid: \"ictcp\",\n\tname: \"ICTCP\",\n\t// From BT.2100-2 page 7:\n\t// During production, signal values are expected to exceed the\n\t// range E′ = [0.0 : 1.0]. This provides processing headroom and avoids\n\t// signal degradation during cascaded processing. Such values of E′,\n\t// below 0.0 or exceeding 1.0, should not be clipped during production\n\t// and exchange.\n\t// Values below 0.0 should not be clipped in reference displays (even\n\t// though they represent “negative” light) to allow the black level of\n\t// the signal (LB) to be properly set using test signals known as “PLUGE”\n\tcoords: {\n\t\ti: {\n\t\t\trefRange: [0, 1], // Constant luminance,\n\t\t\tname: \"I\",\n\t\t},\n\t\tct: {\n\t\t\trefRange: [-0.5, 0.5], // Full BT.2020 gamut in range [-0.5, 0.5]\n\t\t\tname: \"CT\",\n\t\t},\n\t\tcp: {\n\t\t\trefRange: [-0.5, 0.5],\n\t\t\tname: \"CP\",\n\t\t},\n\t},\n\n\tbase: XYZ_Abs_D65,\n\tfromBase (XYZ) {\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiply_v3_m3x3(XYZ, XYZtoLMS_M);\n\n\t\treturn LMStoICtCp(LMS);\n\t},\n\ttoBase (ICtCp) {\n\t\tlet LMS = ICtCptoLMS(ICtCp);\n\n\t\treturn multiply_v3_m3x3(LMS, LMStoXYZ_M);\n\t},\n\n\tformats: {\n\t\tictcp: {\n\t\t\tcoords: [\n\t\t\t\t\"<percentage> | <number>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n\n/**\n *\n * @param {Vector3} LMS\n * @returns {Vector3}\n */\nfunction LMStoICtCp (LMS) {\n\t// apply the PQ EOTF\n\t// we can't ever be dividing by zero because of the \"1 +\" in the denominator\n\tlet PQLMS = /** @type {Vector3} */ (\n\t\tLMS.map(function (val) {\n\t\t\tlet num = c1 + c2 * (val / 10000) ** m1;\n\t\t\tlet denom = 1 + c3 * (val / 10000) ** m1;\n\n\t\t\treturn (num / denom) ** m2;\n\t\t})\n\t);\n\n\t// LMS to IPT, with rotation for Y'C'bC'r compatibility\n\treturn multiply_v3_m3x3(PQLMS, LMStoIPT_M);\n}\n\n/**\n *\n * @param {Vector3} ICtCp\n * @returns {Vector3}\n */\nfunction ICtCptoLMS (ICtCp) {\n\tlet PQLMS = multiply_v3_m3x3(ICtCp, IPTtoLMS_M);\n\n\t// From BT.2124-0 Annex 2 Conversion 3\n\tlet LMS = /** @type {Vector3} */ (\n\t\tPQLMS.map(function (val) {\n\t\t\tlet num = Math.max(val ** im2 - c1, 0);\n\t\t\tlet denom = c2 - c3 * val ** im2;\n\t\t\treturn 10000 * (num / denom) ** im1;\n\t\t})\n\t);\n\n\treturn LMS;\n}\n","import ictcp from \"../spaces/ictcp.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * Delta E in ICtCp space,\n * which the ITU calls Delta E ITP, which is shorter.\n * Formulae from ITU Rec. ITU-R BT.2124-0\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE in ICtCp\n\t// which is simply the Euclidean distance\n\n\tlet [I1, T1, P1] = ictcp.from(color);\n\tlet [I2, T2, P2] = ictcp.from(sample);\n\n\t// the 0.25 factor is to undo the encoding scaling in Ct\n\t// the 720 is so that 1 deltaE = 1 JND\n\t// per  ITU-R BT.2124-0 p.3\n\n\treturn 720 * Math.sqrt((I1 - I2) ** 2 + 0.25 * (T1 - T2) ** 2 + (P1 - P2) ** 2);\n}\n","import oklab from \"../spaces/oklab.js\";\nimport getColor from \"../getColor.js\";\n\n/**\n * More accurate color-difference formulae\n * than the simple 1976 Euclidean distance in CIE Lab\n * The Oklab a and b axes are scaled relative to the L axis, for better uniformity\n * Björn Ottosson said:\n * \"I've recently done some tests with color distance datasets as implemented\n * in Colorio and on both the Combvd dataset and the OSA-UCS dataset a\n * scale factor of slightly more than 2 for a and b would give the best results\n * (2.016 works best for Combvd and 2.045 for the OSA-UCS dataset).\"\n * @see {@link <https://github.com/w3c/csswg-drafts/issues/6642#issuecomment-945714988>}\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaEOK2, term by term as root sum of squares\n\tlet abscale = 2;\n\tlet [L1, a1, b1] = oklab.from(color);\n\tlet [L2, a2, b2] = oklab.from(sample);\n\tlet ΔL = L1 - L2;\n\tlet Δa = abscale * (a1 - a2);\n\tlet Δb = abscale * (b1 - b2);\n\treturn Math.sqrt(ΔL ** 2 + Δa ** 2 + Δb ** 2);\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { multiply_v3_m3x3, interpolate, copySign, spow, zdiv, bisectLeft } from \"../util.js\";\nimport { constrain } from \"../angles.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport { WHITES } from \"../adapt.js\";\n\n/** @import { Coords, Matrix3x3, Vector3 } from \"../types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"../types.js\").Cam16Object} Cam16Object */\n/** @typedef {import(\"../types.js\").Cam16Input} Cam16Input */\n/** @typedef {import(\"../types.js\").Cam16Environment} Cam16Environment */\n\nconst white = WHITES.D65;\nconst adaptedCoef = 0.42;\nconst adaptedCoefInv = 1 / adaptedCoef;\nconst tau = 2 * Math.PI;\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst cat16 = [\n\t[  0.401288,  0.650173, -0.051461 ],\n\t[ -0.250268,  1.204414,  0.045854 ],\n\t[ -0.002079,  0.048952,  0.953127 ],\n];\n\n/** @type {Matrix3x3} */\nconst cat16Inv = [\n\t[1.8620678550872327, -1.0112546305316843, 0.14918677544445175],\n\t[0.38752654323613717, 0.6214474419314753, -0.008973985167612518],\n\t[-0.015841498849333856, -0.03412293802851557, 1.0499644368778496],\n];\n\n/** @type {Matrix3x3} */\nconst m1 = [\n\t[460.0, 451.0, 288.0],\n\t[460.0, -891.0, -261.0],\n\t[460.0, -220.0, -6300.0],\n];\n\nconst surroundMap = {\n\tdark: [0.8, 0.525, 0.8],\n\tdim: [0.9, 0.59, 0.9],\n\taverage: [1, 0.69, 1],\n};\n\nconst hueQuadMap = {\n\t// Red, Yellow, Green, Blue, Red\n\th: [20.14, 90.0, 164.25, 237.53, 380.14],\n\te: [0.8, 0.7, 1.0, 1.2, 0.8],\n\tH: [0.0, 100.0, 200.0, 300.0, 400.0],\n};\n\nconst rad2deg = 180 / Math.PI;\nconst deg2rad = Math.PI / 180;\n\n/**\n * @param {Coords} coords\n * @param {number} fl\n * @returns {[number, number, number]}\n */\nexport function adapt (coords, fl) {\n\tconst temp = /** @type {[number, number, number]} */ (\n\t\tcoords.map(c => {\n\t\t\tconst x = spow(fl * Math.abs(c) * 0.01, adaptedCoef);\n\t\t\treturn (400 * copySign(x, c)) / (x + 27.13);\n\t\t})\n\t);\n\treturn temp;\n}\n\n/**\n * @param {Coords} adapted\n * @param {number} fl\n * @returns {[number, number, number]}\n */\nexport function unadapt (adapted, fl) {\n\tconst constant = (100 / fl) * 27.13 ** adaptedCoefInv;\n\treturn /** @type {[number, number, number]} */ (\n\t\tadapted.map(c => {\n\t\t\tconst cabs = Math.abs(c);\n\t\t\treturn copySign(constant * spow(cabs / (400 - cabs), adaptedCoefInv), c);\n\t\t})\n\t);\n}\n\n/**\n * @param {number} h\n */\nexport function hueQuadrature (h) {\n\tlet hp = constrain(h);\n\tif (hp <= hueQuadMap.h[0]) {\n\t\thp += 360;\n\t}\n\n\tconst i = bisectLeft(hueQuadMap.h, hp) - 1;\n\tconst [hi, hii] = hueQuadMap.h.slice(i, i + 2);\n\tconst [ei, eii] = hueQuadMap.e.slice(i, i + 2);\n\tconst Hi = hueQuadMap.H[i];\n\n\tconst t = (hp - hi) / ei;\n\treturn Hi + (100 * t) / (t + (hii - hp) / eii);\n}\n\n/**\n * @param {number} H\n */\nexport function invHueQuadrature (H) {\n\tlet Hp = ((H % 400) + 400) % 400;\n\tconst i = Math.floor(0.01 * Hp);\n\tHp = Hp % 100;\n\tconst [hi, hii] = hueQuadMap.h.slice(i, i + 2);\n\tconst [ei, eii] = hueQuadMap.e.slice(i, i + 2);\n\n\treturn constrain((Hp * (eii * hi - ei * hii) - 100 * hi * eii) / (Hp * (eii - ei) - 100 * eii));\n}\n\n/**\n * @param {[number, number, number]} refWhite\n * @param {number} adaptingLuminance\n * @param {number} backgroundLuminance\n * @param {keyof typeof surroundMap} surround\n * @param {boolean} discounting\n * @returns {Cam16Environment}\n */\nexport function environment (\n\trefWhite,\n\tadaptingLuminance,\n\tbackgroundLuminance,\n\tsurround,\n\tdiscounting,\n) {\n\tconst env = {};\n\n\tenv.discounting = discounting;\n\tenv.refWhite = refWhite;\n\tenv.surround = surround;\n\tconst xyzW = /** @type {Vector3} */ (\n\t\trefWhite.map(c => {\n\t\t\treturn c * 100;\n\t\t})\n\t);\n\n\t// The average luminance of the environment in `cd/m^2cd/m` (a.k.a. nits)\n\tenv.la = adaptingLuminance;\n\t// The relative luminance of the nearby background\n\tenv.yb = backgroundLuminance;\n\t// Absolute luminance of the reference white.\n\tconst yw = xyzW[1];\n\n\t// Cone response for reference white\n\tconst rgbW = multiply_v3_m3x3(xyzW, cat16);\n\n\t// Surround: dark, dim, and average\n\tlet values = surroundMap[env.surround];\n\tconst f = values[0];\n\tenv.c = values[1];\n\tenv.nc = values[2];\n\n\tconst k = 1 / (5 * env.la + 1);\n\tconst k4 = k ** 4;\n\n\t// Factor of luminance level adaptation\n\tenv.fl = k4 * env.la + 0.1 * (1 - k4) * (1 - k4) * Math.cbrt(5 * env.la);\n\tenv.flRoot = env.fl ** 0.25;\n\n\tenv.n = env.yb / yw;\n\tenv.z = 1.48 + Math.sqrt(env.n);\n\tenv.nbb = 0.725 * env.n ** -0.2;\n\tenv.ncb = env.nbb;\n\n\t// Degree of adaptation calculating if not discounting\n\t// illuminant (assumed eye is fully adapted)\n\tconst d = discounting\n\t\t? 1\n\t\t: Math.max(Math.min(f * (1 - (1 / 3.6) * Math.exp((-env.la - 42) / 92)), 1), 0);\n\tenv.dRgb = /** @type {[number, number, number]} */ (\n\t\trgbW.map(c => {\n\t\t\treturn interpolate(1, yw / c, d);\n\t\t})\n\t);\n\tenv.dRgbInv = /** @type {[number, number, number]} */ (\n\t\tenv.dRgb.map(c => {\n\t\t\treturn 1 / c;\n\t\t})\n\t);\n\n\t// Achromatic response\n\tconst rgbCW = /** @type {[number, number, number]} */ (\n\t\trgbW.map((c, i) => {\n\t\t\treturn c * env.dRgb[i];\n\t\t})\n\t);\n\tconst rgbAW = adapt(rgbCW, env.fl);\n\tenv.aW = env.nbb * (2 * rgbAW[0] + rgbAW[1] + 0.05 * rgbAW[2]);\n\n\t// console.log(env);\n\n\treturn env;\n}\n\n// Pre-calculate everything we can with the viewing conditions\nconst viewingConditions = environment(white, (64 / Math.PI) * 0.2, 20, \"average\", false);\n\n/**\n * @param {Cam16Input} cam16\n * @param {Cam16Environment} env\n * @returns {[number, number, number]}\n */\nexport function fromCam16 (cam16, env) {\n\t// These check ensure one, and only one attribute for a\n\t// given category is provided.\n\t// @ts-expect-error The '^` operator is not allowed for boolean types\n\tif (!((cam16.J !== undefined) ^ (cam16.Q !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'J' or 'Q'\");\n\t}\n\n\t// @ts-expect-error - The '^` operator is not allowed for boolean types\n\tif (!((cam16.C !== undefined) ^ (cam16.M !== undefined) ^ (cam16.s !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'C', 'M' or 's'\");\n\t}\n\n\t// Hue is absolutely required\n\t// @ts-expect-error - The '^` operator is not allowed for boolean types\n\tif (!((cam16.h !== undefined) ^ (cam16.H !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'h' or 'H'\");\n\t}\n\n\t// Black\n\tif (cam16.J === 0.0 || cam16.Q === 0.0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\n\t// Break hue into Cartesian components\n\tlet hRad = 0.0;\n\tif (cam16.h !== undefined) {\n\t\thRad = constrain(cam16.h) * deg2rad;\n\t}\n\telse {\n\t\thRad = invHueQuadrature(cam16.H) * deg2rad;\n\t}\n\n\tconst cosh = Math.cos(hRad);\n\tconst sinh = Math.sin(hRad);\n\n\t// Calculate `Jroot` from one of the lightness derived coordinates.\n\tlet Jroot = 0.0;\n\tif (cam16.J !== undefined) {\n\t\tJroot = spow(cam16.J, 1 / 2) * 0.1;\n\t}\n\telse if (cam16.Q !== undefined) {\n\t\tJroot = (0.25 * env.c * cam16.Q) / ((env.aW + 4) * env.flRoot);\n\t}\n\n\t// Calculate the `t` value from one of the chroma derived coordinates\n\tlet alpha = 0.0;\n\tif (cam16.C !== undefined) {\n\t\talpha = cam16.C / Jroot;\n\t}\n\telse if (cam16.M !== undefined) {\n\t\talpha = cam16.M / env.flRoot / Jroot;\n\t}\n\telse if (cam16.s !== undefined) {\n\t\talpha = (0.0004 * cam16.s ** 2 * (env.aW + 4)) / env.c;\n\t}\n\tconst t = spow(alpha * Math.pow(1.64 - Math.pow(0.29, env.n), -0.73), 10 / 9);\n\n\t// Eccentricity\n\tconst et = 0.25 * (Math.cos(hRad + 2) + 3.8);\n\n\t// Achromatic response\n\tconst A = env.aW * spow(Jroot, 2 / env.c / env.z);\n\n\t// Calculate red-green and yellow-blue components\n\tconst p1 = (5e4 / 13) * env.nc * env.ncb * et;\n\tconst p2 = A / env.nbb;\n\tconst r = 23 * (p2 + 0.305) * zdiv(t, 23 * p1 + t * (11 * cosh + 108 * sinh));\n\tconst a = r * cosh;\n\tconst b = r * sinh;\n\n\t// Calculate back from cone response to XYZ\n\tconst rgb_c = unadapt(\n\t\t/** @type {Vector3} */\n\t\t(\n\t\t\tmultiply_v3_m3x3([p2, a, b], m1).map(c => {\n\t\t\t\treturn (c * 1) / 1403;\n\t\t\t})\n\t\t),\n\t\tenv.fl,\n\t);\n\treturn /** @type {Vector3} */ (\n\t\tmultiply_v3_m3x3(\n\t\t\t/** @type {Vector3} */ (\n\t\t\t\trgb_c.map((c, i) => {\n\t\t\t\t\treturn c * env.dRgbInv[i];\n\t\t\t\t})\n\t\t\t),\n\t\t\tcat16Inv,\n\t\t).map(c => {\n\t\t\treturn c / 100;\n\t\t})\n\t);\n}\n\n/**\n * @param {[number, number, number]} xyzd65\n * @param {Cam16Environment} env\n * @returns {Cam16Object}\n */\nexport function toCam16 (xyzd65, env) {\n\t// Cone response\n\tconst xyz100 = /** @type {Vector3} */ (\n\t\txyzd65.map(c => {\n\t\t\treturn c * 100;\n\t\t})\n\t);\n\tconst rgbA = adapt(\n\t\t/** @type {[number, number, number]} */\n\t\t(\n\t\t\tmultiply_v3_m3x3(xyz100, cat16).map((c, i) => {\n\t\t\t\treturn c * env.dRgb[i];\n\t\t\t})\n\t\t),\n\t\tenv.fl,\n\t);\n\n\t// Calculate hue from red-green and yellow-blue components\n\tconst a = rgbA[0] + (-12 * rgbA[1] + rgbA[2]) / 11;\n\tconst b = (rgbA[0] + rgbA[1] - 2 * rgbA[2]) / 9;\n\tconst hRad = ((Math.atan2(b, a) % tau) + tau) % tau;\n\n\t// Eccentricity\n\tconst et = 0.25 * (Math.cos(hRad + 2) + 3.8);\n\n\tconst t =\n\t\t(5e4 / 13) *\n\t\tenv.nc *\n\t\tenv.ncb *\n\t\tzdiv(et * Math.sqrt(a ** 2 + b ** 2), rgbA[0] + rgbA[1] + 1.05 * rgbA[2] + 0.305);\n\tconst alpha = spow(t, 0.9) * Math.pow(1.64 - Math.pow(0.29, env.n), 0.73);\n\n\t// Achromatic response\n\tconst A = env.nbb * (2 * rgbA[0] + rgbA[1] + 0.05 * rgbA[2]);\n\n\tconst Jroot = spow(A / env.aW, 0.5 * env.c * env.z);\n\n\t// Lightness\n\tconst J = 100 * spow(Jroot, 2);\n\n\t// Brightness\n\tconst Q = (4 / env.c) * Jroot * (env.aW + 4) * env.flRoot;\n\n\t// Chroma\n\tconst C = alpha * Jroot;\n\n\t// Colorfulness\n\tconst M = C * env.flRoot;\n\n\t// Hue\n\tconst h = constrain(hRad * rad2deg);\n\n\t// Hue quadrature\n\tconst H = hueQuadrature(h);\n\n\t// Saturation\n\tconst s = 50 * spow((env.c * alpha) / (env.aW + 4), 1 / 2);\n\n\t// console.log({J: J, C: C, h: h, s: s, Q: Q, M: M, H: H});\n\n\treturn { J: J, C: C, h: h, s: s, Q: Q, M: M, H: H };\n}\n\n// Provided as a way to directly evaluate the CAM16 model\n// https://observablehq.com/@jrus/cam16: reference implementation\n// https://arxiv.org/pdf/1802.06067.pdf: Nico Schlömer\n// https://onlinelibrary.wiley.com/doi/pdf/10.1002/col.22324: hue quadrature\n// https://www.researchgate.net/publication/318152296_Comprehensive_color_solutions_CAM16_CAT16_and_CAM16-UCS\n// Results compared against: https://github.com/colour-science/colour\nexport default new ColorSpace({\n\tid: \"cam16-jmh\",\n\tcssId: \"--cam16-jmh\",\n\tname: \"CAM16-JMh\",\n\tcoords: {\n\t\tj: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"J\",\n\t\t},\n\t\tm: {\n\t\t\trefRange: [0, 105.0],\n\t\t\tname: \"Colorfulness\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: xyz_d65,\n\n\tfromBase (xyz) {\n\t\t// If another derivation is created, ε could vary, so we can't hardcode\n\t\tif (this.ε === undefined) {\n\t\t\tthis.ε = Object.values(this.coords)[1].refRange[1] / 100000;\n\t\t}\n\t\tconst cam16 = toCam16(xyz, viewingConditions);\n\t\tconst isAchromatic = Math.abs(cam16.M) < this.ε;\n\t\treturn [cam16.J, isAchromatic ? 0 : cam16.M, isAchromatic ? null : cam16.h];\n\t},\n\ttoBase (cam16) {\n\t\treturn fromCam16({ J: cam16[0], M: cam16[1], h: cam16[2] }, viewingConditions);\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport { constrain } from \"../angles.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport { fromCam16, toCam16, environment } from \"./cam16.js\";\nimport { WHITES } from \"../adapt.js\";\n\nconst white = WHITES.D65;\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27; // 29^3/3^3\n\nfunction toLstar (y) {\n\t// Convert XYZ Y to L*\n\n\tconst fy = y > ε ? Math.cbrt(y) : (κ * y + 16) / 116;\n\treturn 116.0 * fy - 16.0;\n}\n\nfunction fromLstar (lstar) {\n\t// Convert L* back to XYZ Y\n\n\treturn lstar > 8 ? Math.pow((lstar + 16) / 116, 3) : lstar / κ;\n}\n\nfunction fromHct (coords, env) {\n\t// Use Newton's method to try and converge as quick as possible or\n\t// converge as close as we can. While the requested precision is achieved\n\t// most of the time, it may not always be achievable. Especially past the\n\t// visible spectrum, the algorithm will likely struggle to get the same\n\t// precision. If, for whatever reason, we cannot achieve the accuracy we\n\t// seek in the allotted iterations, just return the closest we were able to\n\t// get.\n\n\tlet [h, c, t] = coords;\n\tlet xyz = [];\n\tlet j = 0;\n\n\t// Shortcut out for black\n\tif (t === 0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\n\t// Calculate the Y we need to target\n\tlet y = fromLstar(t);\n\n\t// A better initial guess yields better results. Polynomials come from\n\t// curve fitting the T vs J response.\n\tif (t > 0) {\n\t\tj = 0.00379058511492914 * t ** 2 + 0.608983189401032 * t + 0.9155088574762233;\n\t}\n\telse {\n\t\tj = 9.514440756550361e-6 * t ** 2 + 0.08693057439788597 * t - 21.928975842194614;\n\t}\n\n\t// Threshold of how close is close enough, and max number of attempts.\n\t// More precision and more attempts means more time spent iterating. Higher\n\t// required precision gives more accuracy but also increases the chance of\n\t// not hitting the goal. 2e-12 allows us to convert round trip with\n\t// reasonable accuracy of six decimal places or more.\n\tconst threshold = 2e-12;\n\tconst max_attempts = 15;\n\n\tlet attempt = 0;\n\tlet last = Infinity;\n\tlet best = j;\n\n\t// Try to find a J such that the returned y matches the returned y of the L*\n\twhile (attempt <= max_attempts) {\n\t\txyz = fromCam16({ J: j, C: c, h: h }, env);\n\n\t\t// If we are within range, return XYZ\n\t\t// If we are closer than last time, save the values\n\t\tconst delta = Math.abs(xyz[1] - y);\n\t\tif (delta < last) {\n\t\t\tif (delta <= threshold) {\n\t\t\t\treturn xyz;\n\t\t\t}\n\t\t\tbest = j;\n\t\t\tlast = delta;\n\t\t}\n\n\t\t// f(j_root) = (j ** (1 / 2)) * 0.1\n\t\t// f(j) = ((f(j_root) * 100) ** 2) / j - 1 = 0\n\t\t// f(j_root) = Y = y / 100\n\t\t// f(j) = (y ** 2) / j - 1\n\t\t// f'(j) = (2 * y) / j\n\t\tj = j - ((xyz[1] - y) * j) / (2 * xyz[1]);\n\n\t\tattempt += 1;\n\t}\n\n\t// We could not acquire the precision we desired,\n\t// return our closest attempt.\n\treturn fromCam16({ J: j, C: c, h: h }, env);\n}\n\nfunction toHct (xyz, env) {\n\t// Calculate HCT by taking the L* of CIE LCh D65 and CAM16 chroma and hue.\n\n\tconst t = toLstar(xyz[1]);\n\tif (t === 0.0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\tconst cam16 = toCam16(xyz, viewingConditions);\n\treturn [constrain(cam16.h), cam16.C, t];\n}\n\n// Pre-calculate everything we can with the viewing conditions\nexport const viewingConditions = environment(\n\twhite,\n\t(200 / Math.PI) * fromLstar(50.0),\n\tfromLstar(50.0) * 100,\n\t\"average\",\n\tfalse,\n);\n\n// https://material.io/blog/science-of-color-design\n// This is not a port of the material-color-utilities,\n// but instead implements the full color space as described,\n// combining CAM16 JCh and Lab D65. This does not clamp conversion\n// to HCT to specific chroma bands and provides support for wider\n// gamuts than Google currently supports and does so at a greater\n// precision (> 8 bits back to sRGB).\n// This implementation comes from https://github.com/facelessuser/coloraide\n// which is licensed under MIT.\nexport default new ColorSpace({\n\tid: \"hct\",\n\tname: \"HCT\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 145],\n\t\t\tname: \"Colorfulness\",\n\t\t},\n\t\tt: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Tone\",\n\t\t},\n\t},\n\n\tbase: xyz_d65,\n\n\tfromBase (xyz) {\n\t\tif (this.ε === undefined) {\n\t\t\tthis.ε = Object.values(this.coords)[1].refRange[1] / 100000;\n\t\t}\n\t\tlet hct = toHct(xyz, viewingConditions);\n\t\tif (hct[1] < this.ε) {\n\t\t\thct[1] = 0.0;\n\t\t\thct[0] = null;\n\t\t}\n\t\treturn hct;\n\t},\n\ttoBase (hct) {\n\t\treturn fromHct(hct, viewingConditions);\n\t},\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hct\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import hct from \"../spaces/hct.js\";\nimport { viewingConditions } from \"../spaces/hct.js\";\nimport getColor from \"../getColor.js\";\n\n/** @import { Coords } from \"../types.js\" */\n\nconst rad2deg = 180 / Math.PI;\nconst deg2rad = Math.PI / 180;\nconst ucsCoeff = [1.0, 0.007, 0.0228];\n\n/**\n * Convert HCT chroma and hue (CAM16 JMh colorfulness and hue) using UCS logic for a and b.\n * @param {Coords} coords - HCT coordinates.\n * @return {number[]}\n */\nfunction convertUcsAb (coords) {\n\t// We want the distance between the actual color.\n\t// If chroma is negative, it will throw off our calculations.\n\t// Normally, converting back to the base and forward will correct it.\n\t// If we have a negative chroma after this, then we have a color that\n\t// cannot resolve to positive chroma.\n\tif (coords[1] < 0) {\n\t\tcoords = hct.fromBase(hct.toBase(coords));\n\t}\n\n\t// Only in extreme cases (usually outside the visible spectrum)\n\t// can the input value for log become negative.\n\t// Avoid domain error by forcing a zero result via \"max\" if necessary.\n\tconst M =\n\t\tMath.log(Math.max(1 + ucsCoeff[2] * coords[1] * viewingConditions.flRoot, 1.0)) /\n\t\tucsCoeff[2];\n\tconst hrad = coords[0] * deg2rad;\n\tconst a = M * Math.cos(hrad);\n\tconst b = M * Math.sin(hrad);\n\n\treturn [coords[2], a, b];\n}\n\n/**\n * Color distance using HCT.\n * @param {import(\"../types.js\").ColorTypes} color\n * @param {import(\"../types.js\").ColorTypes} sample\n * @returns {number}\n */\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\tlet [t1, a1, b1] = convertUcsAb(hct.from(color));\n\tlet [t2, a2, b2] = convertUcsAb(hct.from(sample));\n\n\t// Use simple euclidean distance with a and b using UCS conversion\n\t// and LCh lightness (HCT tone).\n\treturn Math.sqrt((t1 - t2) ** 2 + (a1 - a2) ** 2 + (b1 - b2) ** 2);\n}\n","/**\n * @packageDocumentation\n * This module defines all the builtin deltaE methods.\n */\nimport deltaE76 from \"./deltaE76.js\";\nimport deltaECMC from \"./deltaECMC.js\";\nimport deltaE2000 from \"./deltaE2000.js\";\nimport deltaEJz from \"./deltaEJz.js\";\nimport deltaEITP from \"./deltaEITP.js\";\nimport deltaEOK from \"./deltaEOK.js\";\nimport deltaEOK2 from \"./deltaEOK2.js\";\nimport deltaEHCT from \"./deltaEHCT.js\";\n\nexport { deltaE76, deltaECMC, deltaE2000, deltaEJz, deltaEITP, deltaEOK, deltaEOK2, deltaEHCT };\n\nexport default {\n\tdeltaE76,\n\tdeltaECMC,\n\tdeltaE2000,\n\tdeltaEJz,\n\tdeltaEITP,\n\tdeltaEOK,\n\tdeltaEOK2,\n\tdeltaEHCT,\n};\n\n/** @typedef {keyof typeof import(\"./index.js\").default extends `deltaE${infer Method}` ? Method : string} Methods */\n","import * as util from \"./util.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport defaults from \"./defaults.js\";\nimport deltaE2000 from \"./deltaE/deltaE2000.js\";\nimport deltaEOK from \"./deltaE/deltaEOK.js\";\nimport inGamut from \"./inGamut.js\";\nimport to from \"./to.js\";\nimport get from \"./get.js\";\nimport oklab from \"./spaces/oklab.js\";\nimport set from \"./set.js\";\nimport clone from \"./clone.js\";\nimport getColor from \"./getColor.js\";\nimport deltaEMethods from \"./deltaE/index.js\";\nimport { WHITES } from \"./adapt.js\";\n\n/** @import { ColorTypes, PlainColorObject } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").ToGamutOptions} ToGamutOptions */\n\n/**\n * Calculate the epsilon to 2 degrees smaller than the specified JND.\n * @param {number} jnd The target \"just noticeable difference\".\n * @returns {number}\n */\nfunction calcEpsilon (jnd) {\n\t// Calculate the epsilon to 2 degrees smaller than the specified JND.\n\n\tconst order = !jnd ? 0 : Math.floor(Math.log10(Math.abs(jnd)));\n\t// Limit to an arbitrary value to ensure value is never too small and causes infinite loops.\n\treturn Math.max(parseFloat(`1e${order - 2}`), 1e-6);\n}\n\nconst GMAPPRESET = {\n\thct: {\n\t\tmethod: \"hct.c\",\n\t\tjnd: 2,\n\t\tdeltaEMethod: \"hct\",\n\t\tblackWhiteClamp: {},\n\t},\n\t\"hct-tonal\": {\n\t\tmethod: \"hct.c\",\n\t\tjnd: 0,\n\t\tdeltaEMethod: \"hct\",\n\t\tblackWhiteClamp: { channel: \"hct.t\", min: 0, max: 100 },\n\t},\n};\n\n/**\n * Force coordinates to be in gamut of a certain color space.\n * Mutates the color it is passed.\n * @overload\n * @param {ColorTypes} color\n * @param {ToGamutOptions} [options]\n * @returns {PlainColorObject}\n */\n/**\n * @overload\n * @param {ColorTypes} color\n * @param {string} [space]\n * @returns {PlainColorObject}\n */\n/**\n * @param {ColorTypes} color\n * @param {string & Partial<ToGamutOptions> | ToGamutOptions} [space]\n * @returns {PlainColorObject}\n */\nexport default function toGamut (\n\tcolor,\n\t{\n\t\tmethod = defaults.gamut_mapping,\n\t\tspace = undefined,\n\t\tdeltaEMethod = \"\",\n\t\tjnd = 2,\n\t\tblackWhiteClamp = undefined,\n\t} = {},\n) {\n\tcolor = getColor(color);\n\n\tif (util.isString(arguments[1])) {\n\t\tspace = arguments[1];\n\t}\n\telse if (!space) {\n\t\tspace = color.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\n\t// 3 spaces:\n\t// color.space: current color space\n\t// space: space whose gamut we are mapping to\n\t// mapSpace: space with the coord we're reducing\n\n\tif (inGamut(color, space, { epsilon: 0 })) {\n\t\treturn /** @type {PlainColorObject} */ (color);\n\t}\n\n\tlet spaceColor;\n\tif (method === \"css\") {\n\t\tspaceColor = toGamutCSS(color, { space });\n\t}\n\telse {\n\t\tif (method !== \"clip\" && !inGamut(color, space)) {\n\t\t\tif (Object.prototype.hasOwnProperty.call(GMAPPRESET, method)) {\n\t\t\t\t({ method, jnd, deltaEMethod, blackWhiteClamp } = GMAPPRESET[method]);\n\t\t\t}\n\n\t\t\t// Get the correct delta E method\n\t\t\tlet de = deltaE2000;\n\t\t\tif (deltaEMethod !== \"\") {\n\t\t\t\tfor (let m in deltaEMethods) {\n\t\t\t\t\tif (\"deltae\" + deltaEMethod.toLowerCase() === m.toLowerCase()) {\n\t\t\t\t\t\tde = deltaEMethods[m];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (jnd === 0) {\n\t\t\t\tjnd = 1e-16;\n\t\t\t}\n\n\t\t\tlet clipped = toGamut(to(color, space), { method: \"clip\", space });\n\t\t\tif (de(color, clipped) > jnd) {\n\t\t\t\t// Clamp to SDR white and black if required\n\t\t\t\tif (blackWhiteClamp && Object.keys(blackWhiteClamp).length === 3) {\n\t\t\t\t\tlet channelMeta = ColorSpace.resolveCoord(blackWhiteClamp.channel);\n\t\t\t\t\tlet channel = get(to(color, channelMeta.space), channelMeta.id);\n\t\t\t\t\tif (util.isNone(channel)) {\n\t\t\t\t\t\tchannel = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (channel >= blackWhiteClamp.max) {\n\t\t\t\t\t\treturn to({ space: \"xyz-d65\", coords: WHITES[\"D65\"] }, color.space);\n\t\t\t\t\t}\n\t\t\t\t\telse if (channel <= blackWhiteClamp.min) {\n\t\t\t\t\t\treturn to({ space: \"xyz-d65\", coords: [0, 0, 0] }, color.space);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Reduce a coordinate of a certain color space until the color is in gamut\n\t\t\t\tlet coordMeta = ColorSpace.resolveCoord(method);\n\t\t\t\tlet mapSpace = coordMeta.space;\n\t\t\t\tlet coordId = coordMeta.id;\n\n\t\t\t\tlet mappedColor = to(color, mapSpace);\n\t\t\t\t// If we were already in the mapped color space, we need to resolve undefined channels\n\t\t\t\tmappedColor.coords.forEach((c, i) => {\n\t\t\t\t\tif (util.isNone(c)) {\n\t\t\t\t\t\tmappedColor.coords[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet bounds = coordMeta.range || coordMeta.refRange;\n\t\t\t\tlet min = bounds[0];\n\t\t\t\tlet ε = calcEpsilon(jnd);\n\t\t\t\tlet low = min;\n\t\t\t\tlet high = get(mappedColor, coordId);\n\n\t\t\t\twhile (high - low > ε) {\n\t\t\t\t\tlet clipped = clone(mappedColor);\n\t\t\t\t\tclipped = toGamut(clipped, { space, method: \"clip\" });\n\t\t\t\t\tlet deltaE = de(mappedColor, clipped);\n\n\t\t\t\t\tif (deltaE - jnd < ε) {\n\t\t\t\t\t\tlow = get(mappedColor, coordId);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\thigh = get(mappedColor, coordId);\n\t\t\t\t\t}\n\n\t\t\t\t\tset(mappedColor, coordId, (low + high) / 2);\n\t\t\t\t}\n\n\t\t\t\tspaceColor = to(mappedColor, space);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tspaceColor = clipped;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tspaceColor = to(color, space);\n\t\t}\n\n\t\tif (\n\t\t\tmethod === \"clip\" || // Dumb coord clipping\n\t\t\t// finish off smarter gamut mapping with clip to get rid of ε, see #17\n\t\t\t!inGamut(spaceColor, space, { epsilon: 0 })\n\t\t) {\n\t\t\tlet bounds = Object.values(space.coords).map(c => c.range || []);\n\n\t\t\tspaceColor.coords = /** @type {[number, number, number]} */ (\n\t\t\t\tspaceColor.coords.map((c, i) => {\n\t\t\t\t\tlet [min, max] = bounds[i];\n\n\t\t\t\t\tif (min !== undefined) {\n\t\t\t\t\t\tc = Math.max(min, c);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (max !== undefined) {\n\t\t\t\t\t\tc = Math.min(c, max);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn c;\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t}\n\n\tif (space !== color.space) {\n\t\tspaceColor = to(spaceColor, color.space);\n\t}\n\n\tcolor.coords = spaceColor.coords;\n\treturn /** @type {PlainColorObject} */ (color);\n}\n\n/** @type {\"color\"} */\ntoGamut.returns = \"color\";\n\n/**\n * The reference colors to be used if lightness is out of the range 0-1 in the\n * `Oklch` space. These are created in the `Oklab` space, as it is used by the\n * DeltaEOK calculation, so it is guaranteed to be imported.\n * @satisfies {Record<string, ColorTypes>}\n */\nconst COLORS = {\n\tWHITE: { space: oklab, coords: [1, 0, 0], alpha: 1 },\n\tBLACK: { space: oklab, coords: [0, 0, 0], alpha: 1 },\n};\n\n/**\n * Given a color `origin`, returns a new color that is in gamut using\n * the CSS Gamut Mapping Algorithm. If `space` is specified, it will be in gamut\n * in `space`, and returned in `space`. Otherwise, it will be in gamut and\n * returned in the color space of `origin`.\n * @param {ColorTypes} origin\n * @param {{ space?: string | ColorSpace | undefined }} param1\n * @returns {PlainColorObject}\n */\nexport function toGamutCSS (origin, { space } = {}) {\n\tconst JND = 0.02;\n\tconst ε = 0.0001;\n\n\torigin = getColor(origin);\n\n\tif (!space) {\n\t\tspace = origin.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\tconst oklchSpace = ColorSpace.get(\"oklch\");\n\n\tif (space.isUnbounded) {\n\t\treturn to(origin, space);\n\t}\n\n\tconst origin_OKLCH = to(origin, oklchSpace);\n\tlet L = origin_OKLCH.coords[0];\n\n\t// return media white or black, if lightness is out of range\n\tif (L >= 1) {\n\t\tconst white = to(COLORS.WHITE, space);\n\t\twhite.alpha = origin.alpha;\n\t\treturn to(white, space);\n\t}\n\tif (L <= 0) {\n\t\tconst black = to(COLORS.BLACK, space);\n\t\tblack.alpha = origin.alpha;\n\t\treturn to(black, space);\n\t}\n\n\tif (inGamut(origin_OKLCH, space, { epsilon: 0 })) {\n\t\treturn to(origin_OKLCH, space);\n\t}\n\n\tfunction clip (_color) {\n\t\tconst destColor = to(_color, space);\n\t\tconst spaceCoords = Object.values(/** @type {ColorSpace} */ (space).coords);\n\t\tdestColor.coords = /** @type {[number, number, number]} */ (\n\t\t\tdestColor.coords.map((coord, index) => {\n\t\t\t\tif (\"range\" in spaceCoords[index]) {\n\t\t\t\t\tconst [min, max] = spaceCoords[index].range;\n\t\t\t\t\treturn util.clamp(min, coord, max);\n\t\t\t\t}\n\t\t\t\treturn coord;\n\t\t\t})\n\t\t);\n\t\treturn destColor;\n\t}\n\tlet min = 0;\n\tlet max = origin_OKLCH.coords[1];\n\tlet min_inGamut = true;\n\tlet current = clone(origin_OKLCH);\n\tlet clipped = clip(current);\n\n\tlet E = deltaEOK(clipped, current);\n\tif (E < JND) {\n\t\treturn clipped;\n\t}\n\n\twhile (max - min > ε) {\n\t\tconst chroma = (min + max) / 2;\n\t\tcurrent.coords[1] = chroma;\n\t\tif (min_inGamut && inGamut(current, space, { epsilon: 0 })) {\n\t\t\tmin = chroma;\n\t\t}\n\t\telse {\n\t\t\tclipped = clip(current);\n\t\t\tE = deltaEOK(clipped, current);\n\t\t\tif (E < JND) {\n\t\t\t\tif (JND - E < ε) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmin_inGamut = false;\n\t\t\t\t\tmin = chroma;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmax = chroma;\n\t\t\t}\n\t\t}\n\t}\n\treturn clipped;\n}\n","import getColor from \"./getColor.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport toGamut from \"./toGamut.js\";\n\n/** @import { ColorTypes, PlainColorObject, ToGamutOptions } from \"./types.js\" */\n\n/**\n * Convert to color space and return a new color\n * @param {ColorTypes} color\n * @param {string | ColorSpace} space\n * @param {{ inGamut?: boolean | ToGamutOptions | undefined }} options\n * @returns {PlainColorObject}\n */\nexport default function to (color, space, { inGamut } = {}) {\n\tcolor = getColor(color);\n\tspace = ColorSpace.get(space);\n\n\tlet coords = space.from(color);\n\tlet ret = { space, coords, alpha: color.alpha };\n\n\tif (inGamut) {\n\t\tret = toGamut(ret, inGamut === true ? undefined : inGamut);\n\t}\n\n\treturn ret;\n}\n\n/** @type {\"color\"} */\nto.returns = \"color\";\n","// @ts-nocheck\n\nimport * as util from \"./util.js\";\nimport ColorSpace from \"./ColorSpace.js\";\nimport defaults from \"./defaults.js\";\nimport getColor from \"./getColor.js\";\nimport to from \"./to.js\";\nimport checkInGamut from \"./inGamut.js\";\nimport toGamut from \"./toGamut.js\";\nimport clone from \"./clone.js\";\n\n/** @import { ColorTypes, ParseOptions, PlainColorObject } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").SerializeOptions} SerializeOptions */\n\n/**\n * Generic toString() method, outputs a color(spaceId ...coords) function, a functional syntax, or custom formats defined by the color space\n * @param {ColorTypes} color\n * @param {SerializeOptions & Record<string, any>} options\n * @returns {string}\n */\nexport default function serialize (color, options = {}) {\n\tlet {\n\t\tprecision = defaults.precision,\n\t\tformat,\n\t\tinGamut = true,\n\t\tcoords: coordFormat,\n\t\talpha: alphaFormat,\n\t\tcommas,\n\t} = options;\n\tlet ret;\n\n\tlet colorWithMeta = /** @type {PlainColorObject & ParseOptions} */ (getColor(color));\n\n\tlet formatId = format;\n\tlet parseMeta = colorWithMeta.parseMeta;\n\n\tif (parseMeta && !format) {\n\t\tif (parseMeta.format.canSerialize()) {\n\t\t\tformat = parseMeta.format;\n\t\t\tformatId = parseMeta.formatId;\n\t\t}\n\n\t\tcoordFormat ??= parseMeta.types;\n\t\talphaFormat ??= parseMeta.alphaType;\n\t\tcommas ??= parseMeta.commas;\n\t}\n\n\tif (formatId) {\n\t\t// A format is explicitly specified\n\t\tformat = colorWithMeta.space.getFormat(format) ?? ColorSpace.findFormat(formatId);\n\t}\n\n\tif (!format) {\n\t\t// No format specified, or format not found\n\t\tformat = colorWithMeta.space.getFormat(\"default\") ?? ColorSpace.DEFAULT_FORMAT;\n\t\tformatId = format.name;\n\t}\n\n\tif (format && format.space && format.space !== colorWithMeta.space) {\n\t\t// Format specified belongs to a different color space,\n\t\t// need to convert to it first\n\t\tcolorWithMeta = to(colorWithMeta, format.space);\n\t}\n\n\t// The assignment to coords and inGamut needs to stay in the order they are now\n\t// The order of the assignment was changed as a workaround for a bug in Next.js\n\t// See this issue for details: https://github.com/color-js/color.js/issues/260\n\n\tlet coords = colorWithMeta.coords.slice(); // clone so we can manipulate it\n\n\tinGamut ||= format.toGamut;\n\n\tif (inGamut && !checkInGamut(colorWithMeta)) {\n\t\t// FIXME what happens if the color contains none values?\n\t\tcoords = toGamut(clone(colorWithMeta), inGamut === true ? undefined : inGamut).coords;\n\t}\n\n\tif (format.type === \"custom\") {\n\t\tif (format.serialize) {\n\t\t\tret = format.serialize(coords, colorWithMeta.alpha, options);\n\t\t}\n\t\telse {\n\t\t\tthrow new TypeError(\n\t\t\t\t`format ${formatId} can only be used to parse colors, not for serialization`,\n\t\t\t);\n\t\t}\n\t}\n\telse {\n\t\t// Functional syntax\n\t\tlet name = format.name || \"color\";\n\n\t\tlet args = format.serializeCoords(coords, precision, coordFormat);\n\n\t\tif (name === \"color\") {\n\t\t\t// If output is a color() function, add colorspace id as first argument\n\t\t\tlet cssId =\n\t\t\t\tformat.id || format.ids?.[0] || colorWithMeta.space.cssId || colorWithMeta.space.id;\n\t\t\targs.unshift(cssId);\n\t\t}\n\n\t\t// Serialize alpha?\n\t\t/** @type {string | number} */\n\t\tlet alpha = colorWithMeta.alpha;\n\n\t\tif (alphaFormat !== undefined && !(typeof alphaFormat === \"object\")) {\n\t\t\talphaFormat =\n\t\t\t\ttypeof alphaFormat === \"string\" ? { type: alphaFormat } : { include: alphaFormat };\n\t\t}\n\n\t\tlet alphaType = alphaFormat?.type ?? \"<number>\";\n\t\tlet serializeAlpha =\n\t\t\talphaFormat?.include === true ||\n\t\t\tformat.alpha === true ||\n\t\t\t(alphaFormat?.include !== false && format.alpha !== false && alpha < 1);\n\t\tlet strAlpha = \"\";\n\n\t\tcommas ??= format.commas;\n\n\t\tif (serializeAlpha) {\n\t\t\tif (precision !== null) {\n\t\t\t\tlet unit;\n\n\t\t\t\tif (alphaType === \"<percentage>\") {\n\t\t\t\t\tunit = \"%\";\n\t\t\t\t\talpha *= 100;\n\t\t\t\t}\n\n\t\t\t\talpha = util.serializeNumber(alpha, { precision, unit });\n\t\t\t}\n\n\t\t\tstrAlpha = `${commas ? \",\" : \" /\"} ${alpha}`;\n\t\t}\n\n\t\tret = `${name}(${args.join(commas ? \", \" : \" \")}${strAlpha})`;\n\t}\n\n\treturn ret;\n}\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// convert an array of linear-light rec2020 values to CIE XYZ\n// using  D65 (no chromatic adaptation)\n// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n// 0 is actually calculated as  4.994106574466076e-17\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.6369580483012914, 0.14461690358620832,  0.1688809751641721  ],\n\t[ 0.2627002120112671, 0.6779980715188708,   0.05930171646986196 ],\n\t[ 0.000000000000000,  0.028072693049087428, 1.060985057710791   ],\n];\n\n// from ITU-R BT.2124-0 Annex 2 p.3\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[  1.716651187971268,  -0.355670783776392, -0.253366281373660  ],\n\t[ -0.666684351832489,   1.616481236634939,  0.0157685458139111 ],\n\t[  0.017639857445311,  -0.042770613257809,  0.942103121235474  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"rec2020-linear\",\n\tcssId: \"--rec2020-linear\",\n\tname: \"Linear REC.2020\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport REC2020Linear from \"./rec2020-linear.js\";\n// import sRGB from \"./srgb.js\";\n\nexport default new RGBColorSpace({\n\tid: \"rec2020\",\n\tname: \"REC.2020\",\n\tbase: REC2020Linear,\n\t//  Reference electro-optical transfer function from Rec. ITU-R BT.1886 Annex 1\n\t//  with b (black lift) = 0 and a (user gain) = 1\n\t//  defined over the extended range, not clamped\n\ttoBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\t\t\treturn sign * Math.pow(abs, 2.4);\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\t\t\treturn sign * Math.pow(abs, 1 / 2.4);\n\t\t});\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[0.4865709486482162, 0.26566769316909306, 0.1982172852343625],\n\t[0.2289745640697488, 0.6917385218365064,  0.079286914093745],\n\t[0.0000000000000000, 0.04511338185890264, 1.043944368900976],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[ 2.493496911941425,   -0.9313836179191239, -0.40271078445071684],\n\t[-0.8294889695615747,   1.7626640603183463,  0.023624685841943577],\n\t[ 0.03584583024378447, -0.07617238926804182, 0.9568845240076872],\n];\n\nexport default new RGBColorSpace({\n\tid: \"p3-linear\",\n\tcssId: \"display-p3-linear\",\n\tname: \"Linear P3\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// This is the linear-light version of sRGB\n// as used for example in SVG filters\n// or in Canvas\n\n// This matrix was calculated directly from the RGB and white chromaticities\n// when rounded to 8 decimal places, it agrees completely with the official matrix\n// see https://github.com/w3c/csswg-drafts/issues/5922\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.41239079926595934, 0.357584339383878,   0.1804807884018343  ],\n\t[ 0.21263900587151027, 0.715168678767756,   0.07219231536073371 ],\n\t[ 0.01933081871559182, 0.11919477979462598, 0.9505321522496607  ],\n];\n\n// This matrix is the inverse of the above;\n// again it agrees with the official definition when rounded to 8 decimal places\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const fromXYZ_M = [\n\t[  3.2409699419045226,  -1.537383177570094,   -0.4986107602930034  ],\n\t[ -0.9692436362808796,   1.8759675015077202,   0.04155505740717559 ],\n\t[  0.05563007969699366, -0.20397695888897652,  1.0569715142428786  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"srgb-linear\",\n\tname: \"Linear sRGB\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","// To produce: Visit https://www.w3.org/TR/css-color-4/#named-colors\n// and run in the console:\n// copy($$(\"tr\", $(\".named-color-table tbody\")).map(tr => `\"${tr.cells[2].textContent.trim()}\": [${tr.cells[4].textContent.trim().split(/\\s+/).map(c => c === \"0\"? \"0\" : c === \"255\"? \"1\" : c + \" / 255\").join(\", \")}]`).join(\",\\n\"))\n\n/** List of CSS color keywords\n *  Note that this does not include currentColor, transparent,\n *  or system colors\n *\n *  @type {Record<string, [number, number, number]>}\n */\nexport default {\n\taliceblue: [240 / 255, 248 / 255, 1],\n\tantiquewhite: [250 / 255, 235 / 255, 215 / 255],\n\taqua: [0, 1, 1],\n\taquamarine: [127 / 255, 1, 212 / 255],\n\tazure: [240 / 255, 1, 1],\n\tbeige: [245 / 255, 245 / 255, 220 / 255],\n\tbisque: [1, 228 / 255, 196 / 255],\n\tblack: [0, 0, 0],\n\tblanchedalmond: [1, 235 / 255, 205 / 255],\n\tblue: [0, 0, 1],\n\tblueviolet: [138 / 255, 43 / 255, 226 / 255],\n\tbrown: [165 / 255, 42 / 255, 42 / 255],\n\tburlywood: [222 / 255, 184 / 255, 135 / 255],\n\tcadetblue: [95 / 255, 158 / 255, 160 / 255],\n\tchartreuse: [127 / 255, 1, 0],\n\tchocolate: [210 / 255, 105 / 255, 30 / 255],\n\tcoral: [1, 127 / 255, 80 / 255],\n\tcornflowerblue: [100 / 255, 149 / 255, 237 / 255],\n\tcornsilk: [1, 248 / 255, 220 / 255],\n\tcrimson: [220 / 255, 20 / 255, 60 / 255],\n\tcyan: [0, 1, 1],\n\tdarkblue: [0, 0, 139 / 255],\n\tdarkcyan: [0, 139 / 255, 139 / 255],\n\tdarkgoldenrod: [184 / 255, 134 / 255, 11 / 255],\n\tdarkgray: [169 / 255, 169 / 255, 169 / 255],\n\tdarkgreen: [0, 100 / 255, 0],\n\tdarkgrey: [169 / 255, 169 / 255, 169 / 255],\n\tdarkkhaki: [189 / 255, 183 / 255, 107 / 255],\n\tdarkmagenta: [139 / 255, 0, 139 / 255],\n\tdarkolivegreen: [85 / 255, 107 / 255, 47 / 255],\n\tdarkorange: [1, 140 / 255, 0],\n\tdarkorchid: [153 / 255, 50 / 255, 204 / 255],\n\tdarkred: [139 / 255, 0, 0],\n\tdarksalmon: [233 / 255, 150 / 255, 122 / 255],\n\tdarkseagreen: [143 / 255, 188 / 255, 143 / 255],\n\tdarkslateblue: [72 / 255, 61 / 255, 139 / 255],\n\tdarkslategray: [47 / 255, 79 / 255, 79 / 255],\n\tdarkslategrey: [47 / 255, 79 / 255, 79 / 255],\n\tdarkturquoise: [0, 206 / 255, 209 / 255],\n\tdarkviolet: [148 / 255, 0, 211 / 255],\n\tdeeppink: [1, 20 / 255, 147 / 255],\n\tdeepskyblue: [0, 191 / 255, 1],\n\tdimgray: [105 / 255, 105 / 255, 105 / 255],\n\tdimgrey: [105 / 255, 105 / 255, 105 / 255],\n\tdodgerblue: [30 / 255, 144 / 255, 1],\n\tfirebrick: [178 / 255, 34 / 255, 34 / 255],\n\tfloralwhite: [1, 250 / 255, 240 / 255],\n\tforestgreen: [34 / 255, 139 / 255, 34 / 255],\n\tfuchsia: [1, 0, 1],\n\tgainsboro: [220 / 255, 220 / 255, 220 / 255],\n\tghostwhite: [248 / 255, 248 / 255, 1],\n\tgold: [1, 215 / 255, 0],\n\tgoldenrod: [218 / 255, 165 / 255, 32 / 255],\n\tgray: [128 / 255, 128 / 255, 128 / 255],\n\tgreen: [0, 128 / 255, 0],\n\tgreenyellow: [173 / 255, 1, 47 / 255],\n\tgrey: [128 / 255, 128 / 255, 128 / 255],\n\thoneydew: [240 / 255, 1, 240 / 255],\n\thotpink: [1, 105 / 255, 180 / 255],\n\tindianred: [205 / 255, 92 / 255, 92 / 255],\n\tindigo: [75 / 255, 0, 130 / 255],\n\tivory: [1, 1, 240 / 255],\n\tkhaki: [240 / 255, 230 / 255, 140 / 255],\n\tlavender: [230 / 255, 230 / 255, 250 / 255],\n\tlavenderblush: [1, 240 / 255, 245 / 255],\n\tlawngreen: [124 / 255, 252 / 255, 0],\n\tlemonchiffon: [1, 250 / 255, 205 / 255],\n\tlightblue: [173 / 255, 216 / 255, 230 / 255],\n\tlightcoral: [240 / 255, 128 / 255, 128 / 255],\n\tlightcyan: [224 / 255, 1, 1],\n\tlightgoldenrodyellow: [250 / 255, 250 / 255, 210 / 255],\n\tlightgray: [211 / 255, 211 / 255, 211 / 255],\n\tlightgreen: [144 / 255, 238 / 255, 144 / 255],\n\tlightgrey: [211 / 255, 211 / 255, 211 / 255],\n\tlightpink: [1, 182 / 255, 193 / 255],\n\tlightsalmon: [1, 160 / 255, 122 / 255],\n\tlightseagreen: [32 / 255, 178 / 255, 170 / 255],\n\tlightskyblue: [135 / 255, 206 / 255, 250 / 255],\n\tlightslategray: [119 / 255, 136 / 255, 153 / 255],\n\tlightslategrey: [119 / 255, 136 / 255, 153 / 255],\n\tlightsteelblue: [176 / 255, 196 / 255, 222 / 255],\n\tlightyellow: [1, 1, 224 / 255],\n\tlime: [0, 1, 0],\n\tlimegreen: [50 / 255, 205 / 255, 50 / 255],\n\tlinen: [250 / 255, 240 / 255, 230 / 255],\n\tmagenta: [1, 0, 1],\n\tmaroon: [128 / 255, 0, 0],\n\tmediumaquamarine: [102 / 255, 205 / 255, 170 / 255],\n\tmediumblue: [0, 0, 205 / 255],\n\tmediumorchid: [186 / 255, 85 / 255, 211 / 255],\n\tmediumpurple: [147 / 255, 112 / 255, 219 / 255],\n\tmediumseagreen: [60 / 255, 179 / 255, 113 / 255],\n\tmediumslateblue: [123 / 255, 104 / 255, 238 / 255],\n\tmediumspringgreen: [0, 250 / 255, 154 / 255],\n\tmediumturquoise: [72 / 255, 209 / 255, 204 / 255],\n\tmediumvioletred: [199 / 255, 21 / 255, 133 / 255],\n\tmidnightblue: [25 / 255, 25 / 255, 112 / 255],\n\tmintcream: [245 / 255, 1, 250 / 255],\n\tmistyrose: [1, 228 / 255, 225 / 255],\n\tmoccasin: [1, 228 / 255, 181 / 255],\n\tnavajowhite: [1, 222 / 255, 173 / 255],\n\tnavy: [0, 0, 128 / 255],\n\toldlace: [253 / 255, 245 / 255, 230 / 255],\n\tolive: [128 / 255, 128 / 255, 0],\n\tolivedrab: [107 / 255, 142 / 255, 35 / 255],\n\torange: [1, 165 / 255, 0],\n\torangered: [1, 69 / 255, 0],\n\torchid: [218 / 255, 112 / 255, 214 / 255],\n\tpalegoldenrod: [238 / 255, 232 / 255, 170 / 255],\n\tpalegreen: [152 / 255, 251 / 255, 152 / 255],\n\tpaleturquoise: [175 / 255, 238 / 255, 238 / 255],\n\tpalevioletred: [219 / 255, 112 / 255, 147 / 255],\n\tpapayawhip: [1, 239 / 255, 213 / 255],\n\tpeachpuff: [1, 218 / 255, 185 / 255],\n\tperu: [205 / 255, 133 / 255, 63 / 255],\n\tpink: [1, 192 / 255, 203 / 255],\n\tplum: [221 / 255, 160 / 255, 221 / 255],\n\tpowderblue: [176 / 255, 224 / 255, 230 / 255],\n\tpurple: [128 / 255, 0, 128 / 255],\n\trebeccapurple: [102 / 255, 51 / 255, 153 / 255],\n\tred: [1, 0, 0],\n\trosybrown: [188 / 255, 143 / 255, 143 / 255],\n\troyalblue: [65 / 255, 105 / 255, 225 / 255],\n\tsaddlebrown: [139 / 255, 69 / 255, 19 / 255],\n\tsalmon: [250 / 255, 128 / 255, 114 / 255],\n\tsandybrown: [244 / 255, 164 / 255, 96 / 255],\n\tseagreen: [46 / 255, 139 / 255, 87 / 255],\n\tseashell: [1, 245 / 255, 238 / 255],\n\tsienna: [160 / 255, 82 / 255, 45 / 255],\n\tsilver: [192 / 255, 192 / 255, 192 / 255],\n\tskyblue: [135 / 255, 206 / 255, 235 / 255],\n\tslateblue: [106 / 255, 90 / 255, 205 / 255],\n\tslategray: [112 / 255, 128 / 255, 144 / 255],\n\tslategrey: [112 / 255, 128 / 255, 144 / 255],\n\tsnow: [1, 250 / 255, 250 / 255],\n\tspringgreen: [0, 1, 127 / 255],\n\tsteelblue: [70 / 255, 130 / 255, 180 / 255],\n\ttan: [210 / 255, 180 / 255, 140 / 255],\n\tteal: [0, 128 / 255, 128 / 255],\n\tthistle: [216 / 255, 191 / 255, 216 / 255],\n\ttomato: [1, 99 / 255, 71 / 255],\n\tturquoise: [64 / 255, 224 / 255, 208 / 255],\n\tviolet: [238 / 255, 130 / 255, 238 / 255],\n\twheat: [245 / 255, 222 / 255, 179 / 255],\n\twhite: [1, 1, 1],\n\twhitesmoke: [245 / 255, 245 / 255, 245 / 255],\n\tyellow: [1, 1, 0],\n\tyellowgreen: [154 / 255, 205 / 255, 50 / 255],\n};\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport sRGBLinear from \"./srgb-linear.js\";\nimport KEYWORDS from \"../keywords.js\";\n\n/** @import { Coords } from \"../types.js\" */\n\nlet coordGrammar = Array(3).fill(\"<percentage> | <number>[0, 255]\");\nlet coordGrammarNumber = Array(3).fill(\"<number>[0, 255]\");\n\nexport default new RGBColorSpace({\n\tid: \"srgb\",\n\tname: \"sRGB\",\n\tbase: sRGBLinear,\n\tfromBase: rgb => {\n\t\t// convert an array of linear-light sRGB values in the range 0.0-1.0\n\t\t// to gamma corrected form\n\t\t// https://en.wikipedia.org/wiki/SRGB\n\t\treturn rgb.map(val => {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs > 0.0031308) {\n\t\t\t\treturn sign * (1.055 * abs ** (1 / 2.4) - 0.055);\n\t\t\t}\n\n\t\t\treturn 12.92 * val;\n\t\t});\n\t},\n\ttoBase: rgb => {\n\t\t// convert an array of sRGB values in the range 0.0 - 1.0\n\t\t// to linear light (un-companded) form.\n\t\t// https://en.wikipedia.org/wiki/SRGB\n\t\treturn rgb.map(val => {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs <= 0.04045) {\n\t\t\t\treturn val / 12.92;\n\t\t\t}\n\n\t\t\treturn sign * ((abs + 0.055) / 1.055) ** 2.4;\n\t\t});\n\t},\n\tformats: {\n\t\trgb: {\n\t\t\tcoords: coordGrammar,\n\t\t},\n\t\trgb_number: {\n\t\t\tname: \"rgb\",\n\t\t\tcommas: true,\n\t\t\tcoords: coordGrammarNumber,\n\t\t\talpha: false,\n\t\t},\n\t\tcolor: {\n\t\t\t/* use defaults */\n\t\t},\n\t\trgba: {\n\t\t\tcoords: coordGrammar,\n\t\t\tcommas: true,\n\t\t\talpha: true,\n\t\t},\n\t\trgba_number: {\n\t\t\tname: \"rgba\",\n\t\t\tcommas: true,\n\t\t\tcoords: coordGrammarNumber,\n\t\t},\n\t\thex: {\n\t\t\ttype: \"custom\",\n\t\t\ttoGamut: true,\n\t\t\ttest: str => /^#(([a-f0-9]{2}){3,4}|[a-f0-9]{3,4})$/i.test(str),\n\t\t\tparse (str) {\n\t\t\t\tif (str.length <= 5) {\n\t\t\t\t\t// #rgb or #rgba, duplicate digits\n\t\t\t\t\tstr = str.replace(/[a-f0-9]/gi, \"$&$&\");\n\t\t\t\t}\n\n\t\t\t\t/** @type {number[]} */\n\t\t\t\tlet rgba = [];\n\t\t\t\t// @ts-expect-error Type 'void' is not assignable to type 'string'\n\t\t\t\tstr.replace(/[a-f0-9]{2}/gi, component => {\n\t\t\t\t\trgba.push(parseInt(component, 16) / 255);\n\t\t\t\t});\n\n\t\t\t\treturn {\n\t\t\t\t\tspaceId: \"srgb\",\n\t\t\t\t\tcoords: /** @type {Coords} */ (rgba.slice(0, 3)),\n\t\t\t\t\talpha: /** @type {number} */ (rgba.slice(3)[0]),\n\t\t\t\t};\n\t\t\t},\n\t\t\tserialize: (\n\t\t\t\tcoords,\n\t\t\t\talpha,\n\t\t\t\t{\n\t\t\t\t\tcollapse = true, // collapse to 3-4 digit hex when possible?\n\t\t\t\t\talpha: alphaFormat,\n\t\t\t\t} = {},\n\t\t\t) => {\n\t\t\t\tif ((alphaFormat !== false && alpha < 1) || alphaFormat === true) {\n\t\t\t\t\tcoords.push(alpha);\n\t\t\t\t}\n\n\t\t\t\tcoords = /** @type {[number, number, number]} */ (\n\t\t\t\t\tcoords.map(c => Math.round(c * 255))\n\t\t\t\t);\n\n\t\t\t\tlet collapsible = collapse && coords.every(c => c % 17 === 0);\n\n\t\t\t\tlet hex = coords\n\t\t\t\t\t.map(c => {\n\t\t\t\t\t\tif (collapsible) {\n\t\t\t\t\t\t\treturn (c / 17).toString(16);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn c.toString(16).padStart(2, \"0\");\n\t\t\t\t\t})\n\t\t\t\t\t.join(\"\");\n\n\t\t\t\treturn \"#\" + hex;\n\t\t\t},\n\t\t},\n\t\tkeyword: {\n\t\t\ttype: \"custom\",\n\t\t\ttest: str => /^[a-z]+$/i.test(str),\n\t\t\tparse (str) {\n\t\t\t\tstr = str.toLowerCase();\n\t\t\t\tlet ret = { spaceId: \"srgb\", coords: null, alpha: 1 };\n\n\t\t\t\tif (str === \"transparent\") {\n\t\t\t\t\tret.coords = KEYWORDS.black;\n\t\t\t\t\tret.alpha = 0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tret.coords = KEYWORDS[str];\n\t\t\t\t}\n\n\t\t\t\tif (ret.coords) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport P3Linear from \"./p3-linear.js\";\nimport sRGB from \"./srgb.js\";\n\nexport default new RGBColorSpace({\n\tid: \"p3\",\n\tcssId: \"display-p3\",\n\tname: \"P3\",\n\tbase: P3Linear,\n\t// Gamma encoding/decoding is the same as sRGB\n\tfromBase: sRGB.fromBase,\n\ttoBase: sRGB.toBase,\n});\n","/**\n * Relative luminance\n */\nimport get from \"./get.js\";\nimport set from \"./set.js\";\nimport xyz_d65 from \"./spaces/xyz-d65.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n/**\n *\n * @param {ColorTypes} color\n * @returns {number}\n */\nexport function getLuminance (color) {\n\t// Assume getColor() is called on color in get()\n\treturn get(color, [xyz_d65, \"y\"]);\n}\n\n/**\n * @param {ColorTypes} color\n * @param {number | ((coord: number) => number)} value\n */\nexport function setLuminance (color, value) {\n\t// Assume getColor() is called on color in set()\n\tset(color, [xyz_d65, \"y\"], value);\n}\n\n/**\n * @param {typeof import(\"./color.js\").default} Color\n */\nexport function register (Color) {\n\tObject.defineProperty(Color.prototype, \"luminance\", {\n\t\tget () {\n\t\t\treturn getLuminance(this);\n\t\t},\n\t\tset (value) {\n\t\t\tsetLuminance(this, value);\n\t\t},\n\t});\n}\n","// WCAG 2.0 contrast https://www.w3.org/TR/WCAG20-TECHS/G18.html\n// Simple contrast, with fixed 5% viewing flare contribution\n// Symmetric, does not matter which is foreground and which is background\n\nimport getColor from \"../getColor.js\";\nimport { getLuminance } from \"../luminance.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastWCAG21 (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\treturn (Y1 + 0.05) / (Y2 + 0.05);\n}\n","// APCA 0.0.98G\n// https://github.com/Myndex/apca-w3\n// see also https://github.com/w3c/silver/issues/643\n\nimport getColor from \"../getColor.js\";\nimport to from \"../to.js\";\nimport { isNone } from \"../util.js\";\n\n// exponents\nconst normBG = 0.56;\nconst normTXT = 0.57;\nconst revTXT = 0.62;\nconst revBG = 0.65;\n\n// clamps\nconst blkThrs = 0.022;\nconst blkClmp = 1.414;\nconst loClip = 0.1;\nconst deltaYmin = 0.0005;\n\n// scalers\n// see https://github.com/w3c/silver/issues/645\nconst scaleBoW = 1.14;\nconst loBoWoffset = 0.027;\nconst scaleWoB = 1.14;\nconst loWoBoffset = 0.027;\n\nfunction fclamp (Y) {\n\tif (Y >= blkThrs) {\n\t\treturn Y;\n\t}\n\treturn Y + (blkThrs - Y) ** blkClmp;\n}\n\nfunction linearize (val) {\n\tlet sign = val < 0 ? -1 : 1;\n\tlet abs = Math.abs(val);\n\treturn sign * Math.pow(abs, 2.4);\n}\n\n/**\n * Not symmetric, requires a foreground (text) color, and a background color\n * @param {import(\"../types.js\").ColorTypes} background\n * @param {import(\"../types.js\").ColorTypes} foreground\n * @returns {number}\n */\nexport default function contrastAPCA (background, foreground) {\n\tforeground = getColor(foreground);\n\tbackground = getColor(background);\n\n\tlet S;\n\tlet C;\n\tlet Sapc;\n\n\t// Myndex as-published, assumes sRGB inputs\n\tlet R, G, B;\n\n\tforeground = to(foreground, \"srgb\");\n\t// Should these be clamped to in-gamut values?\n\n\t// Calculates \"screen luminance\" with non-standard simple gamma EOTF\n\t// weights should be from CSS Color 4, not the ones here which are via Myndex and copied from Lindbloom\n\t[R, G, B] = foreground.coords.map(c => {\n\t\treturn isNone(c) ? 0 : c;\n\t});\n\tlet lumTxt = linearize(R) * 0.2126729 + linearize(G) * 0.7151522 + linearize(B) * 0.072175;\n\n\tbackground = to(background, \"srgb\");\n\t[R, G, B] = background.coords.map(c => {\n\t\treturn isNone(c) ? 0 : c;\n\t});\n\tlet lumBg = linearize(R) * 0.2126729 + linearize(G) * 0.7151522 + linearize(B) * 0.072175;\n\n\t// toe clamping of very dark values to account for flare\n\tlet Ytxt = fclamp(lumTxt);\n\tlet Ybg = fclamp(lumBg);\n\n\t// are we \"Black on White\" (dark on light), or light on dark?\n\tlet BoW = Ybg > Ytxt;\n\n\t// why is this a delta, when Y is not perceptually uniform?\n\t// Answer: it is a noise gate, see\n\t// https://github.com/LeaVerou/color.js/issues/208\n\tif (Math.abs(Ybg - Ytxt) < deltaYmin) {\n\t\tC = 0;\n\t}\n\telse {\n\t\tif (BoW) {\n\t\t\t// dark text on light background\n\t\t\tS = Ybg ** normBG - Ytxt ** normTXT;\n\t\t\tC = S * scaleBoW;\n\t\t}\n\t\telse {\n\t\t\t// light text on dark background\n\t\t\tS = Ybg ** revBG - Ytxt ** revTXT;\n\t\t\tC = S * scaleWoB;\n\t\t}\n\t}\n\tif (Math.abs(C) < loClip) {\n\t\tSapc = 0;\n\t}\n\telse if (C > 0) {\n\t\t// not clear whether Woffset is loBoWoffset or loWoBoffset\n\t\t// but they have the same value\n\t\tSapc = C - loBoWoffset;\n\t}\n\telse {\n\t\tSapc = C + loBoWoffset;\n\t}\n\n\treturn Sapc * 100;\n}\n","// Michelson  luminance contrast\n// the relation between the spread and the sum of the two luminances\n// Symmetric, does not matter which is foreground and which is background\n// No black level compensation for flare.\n\nimport getColor from \"../getColor.js\";\nimport { getLuminance } from \"../luminance.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastMichelson (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\tlet denom = Y1 + Y2;\n\treturn denom === 0 ? 0 : (Y1 - Y2) / denom;\n}\n","// Weber luminance contrast\n// The difference between the two luminances divided by the lower luminance\n// Symmetric, does not matter which is foreground and which is background\n// No black level compensation for flare.\n\nimport getColor from \"../getColor.js\";\nimport { getLuminance } from \"../luminance.js\";\n\n// the darkest sRGB color above black is #000001 and this produces\n// a plain Weber contrast of ~45647.\n// So, setting the divide-by-zero result at 50000 is a reasonable\n// max clamp for the plain Weber\nconst max = 50000;\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastWeber (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\treturn Y2 === 0 ? max : (Y1 - Y2) / Y2;\n}\n","// CIE Lightness difference, as used by Google Material Design\n// Google HCT Tone is the same as CIE Lightness\n// https://material.io/blog/science-of-color-design\n\nimport getColor from \"../getColor.js\";\nimport get from \"../get.js\";\nimport lab from \"../spaces/lab.js\";\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastLstar (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet L1 = get(color1, [lab, \"l\"]);\n\tlet L2 = get(color2, [lab, \"l\"]);\n\n\treturn Math.abs(L1 - L2);\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport { WHITES } from \"../adapt.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\n\n// κ * ε  = 2^3 = 8\nconst ε = 216 / 24389; // 6^3/29^3 == (24/116)^3\nconst ε3 = 24 / 116;\nconst κ = 24389 / 27; // 29^3/3^3\n\nlet white = WHITES.D65;\n\nexport default new ColorSpace({\n\tid: \"lab-d65\",\n\tname: \"Lab D65\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t},\n\n\t// Assuming XYZ is relative to D65, convert to CIE Lab\n\t// from CIE standard, which now defines these as a rational fraction\n\twhite,\n\n\tbase: xyz_d65,\n\t// Convert D65-adapted XYZ to Lab\n\t//  CIE 15.3:2004 section 8.2.1.1\n\tfromBase (XYZ) {\n\t\t// compute xyz, which is XYZ scaled relative to reference white\n\t\tlet xyz = XYZ.map((value, i) => value / white[i]);\n\n\t\t// now compute f\n\t\tlet f = xyz.map(value => (value > ε ? Math.cbrt(value) : (κ * value + 16) / 116));\n\n\t\treturn [\n\t\t\t116 * f[1] - 16, // L\n\t\t\t500 * (f[0] - f[1]), // a\n\t\t\t200 * (f[1] - f[2]), // b\n\t\t];\n\t},\n\t// Convert Lab to D65-adapted XYZ\n\t// Same result as CIE 15.3:2004 Appendix D although the derivation is different\n\t// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n\ttoBase (Lab) {\n\t\t// compute f, starting with the luminance-related term\n\t\tlet f = [];\n\t\tf[1] = (Lab[0] + 16) / 116;\n\t\tf[0] = Lab[1] / 500 + f[1];\n\t\tf[2] = f[1] - Lab[2] / 200;\n\n\t\t// compute xyz\n\t\tlet xyz = [\n\t\t\tf[0] > ε3 ? Math.pow(f[0], 3) : (116 * f[0] - 16) / κ,\n\t\t\tLab[0] > 8 ? Math.pow((Lab[0] + 16) / 116, 3) : Lab[0] / κ,\n\t\t\tf[2] > ε3 ? Math.pow(f[2], 3) : (116 * f[2] - 16) / κ,\n\t\t];\n\n\t\t// Compute XYZ by scaling xyz by reference white\n\t\treturn xyz.map((value, i) => value * white[i]);\n\t},\n\n\tformats: {\n\t\t\"lab-d65\": {\n\t\t\tcoords: [\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t\t\"<number> | <percentage>\",\n\t\t\t],\n\t\t},\n\t},\n});\n","// Delta Phi Star perceptual lightness contrast\n// See https://github.com/Myndex/deltaphistar\n// The (difference between two Lstars each raised to phi) raised to (1/phi)\n// Symmetric, does not matter which is foreground and which is background\n\nimport getColor from \"../getColor.js\";\nimport get from \"../get.js\";\nimport lab_d65 from \"../spaces/lab-d65.js\";\n\nconst phi = Math.pow(5, 0.5) * 0.5 + 0.5; // Math.phi can be used if Math.js\n\n/**\n * @param {import(\"../types.js\").ColorTypes} color1\n * @param {import(\"../types.js\").ColorTypes} color2\n * @returns {number}\n */\nexport default function contrastDeltaPhi (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Lstr1 = get(color1, [lab_d65, \"l\"]);\n\tlet Lstr2 = get(color2, [lab_d65, \"l\"]);\n\n\tlet deltaPhiStar = Math.abs(Math.pow(Lstr1, phi) - Math.pow(Lstr2, phi));\n\n\tlet contrast = Math.pow(deltaPhiStar, 1 / phi) * Math.SQRT2 - 40;\n\n\treturn contrast < 7.5 ? 0.0 : contrast;\n}\n","import getColor from \"./getColor.js\";\n// import defaults from \"./defaults.js\";\nimport { isString } from \"./util.js\";\nimport * as contrastAlgorithms from \"./contrast/index.js\";\n\n/** @import { ColorTypes } from \"./types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"./types.js\").Algorithms} Algorithms */\n\n/**\n *\n * @param {ColorTypes} background\n * @param {ColorTypes} foreground\n * @param {Algorithms | ({ algorithm: Algorithms } & Record<string, any>)} o\n * Algorithm to use as well as any other options to pass to the contrast function\n * @returns {number}\n * @throws {TypeError} Unknown or unspecified algorithm\n */\nexport default function contrast (background, foreground, o) {\n\tif (isString(o)) {\n\t\to = { algorithm: o };\n\t}\n\n\tlet { algorithm, ...rest } = o || {};\n\n\tif (!algorithm) {\n\t\tlet algorithms = Object.keys(contrastAlgorithms)\n\t\t\t.map(a => a.replace(/^contrast/, \"\"))\n\t\t\t.join(\", \");\n\t\tthrow new TypeError(\n\t\t\t`contrast() function needs a contrast algorithm. Please specify one of: ${algorithms}`,\n\t\t);\n\t}\n\n\tbackground = getColor(background);\n\tforeground = getColor(foreground);\n\n\tfor (let a in contrastAlgorithms) {\n\t\tif (\"contrast\" + algorithm.toLowerCase() === a.toLowerCase()) {\n\t\t\treturn contrastAlgorithms[a](background, foreground, rest);\n\t\t}\n\t}\n\n\tthrow new TypeError(`Unknown contrast algorithm: ${algorithm}`);\n}\n","import ColorSpace from \"../ColorSpace.js\";\nimport sRGB from \"./srgb.js\";\n\nexport default new ColorSpace({\n\tid: \"hsl\",\n\tname: \"HSL\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: sRGB,\n\n\t// Adapted from https://drafts.csswg.org/css-color-4/better-rgbToHsl.js\n\tfromBase: rgb => {\n\t\tlet max = Math.max(...rgb);\n\t\tlet min = Math.min(...rgb);\n\t\tlet [r, g, b] = rgb;\n\t\tlet [h, s, l] = [null, 0, (min + max) / 2];\n\t\tlet d = max - min;\n\n\t\tif (d !== 0) {\n\t\t\ts = l === 0 || l === 1 ? 0 : (max - l) / Math.min(l, 1 - l);\n\n\t\t\tswitch (max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t}\n\n\t\t\th = h * 60;\n\t\t}\n\n\t\t// Very out of gamut colors can produce negative saturation\n\t\t// If so, just rotate the hue by 180 and use a positive saturation\n\t\t// see https://github.com/w3c/csswg-drafts/issues/9222\n\t\tif (s < 0) {\n\t\t\th += 180;\n\t\t\ts = Math.abs(s);\n\t\t}\n\n\t\tif (h >= 360) {\n\t\t\th -= 360;\n\t\t}\n\n\t\treturn [h, s * 100, l * 100];\n\t},\n\n\t// Adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSL_to_RGB_alternative\n\ttoBase: hsl => {\n\t\tlet [h, s, l] = hsl;\n\t\th = h % 360;\n\n\t\tif (h < 0) {\n\t\t\th += 360;\n\t\t}\n\n\t\ts /= 100;\n\t\tl /= 100;\n\n\t\tfunction f (n) {\n\t\t\tlet k = (n + h / 30) % 12;\n\t\t\tlet a = s * Math.min(l, 1 - l);\n\t\t\treturn l - a * Math.max(-1, Math.min(k - 3, 9 - k, 1));\n\t\t}\n\n\t\treturn [f(0), f(8), f(4)];\n\t},\n\n\tformats: {\n\t\thsl: {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t\thsla: {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t\tcommas: true,\n\t\t\talpha: true,\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport sRGB from \"./srgb.js\";\n\n// Note that, like HSL, calculations are done directly on\n// gamma-corrected sRGB values rather than linearising them first.\n\nexport default new ColorSpace({\n\tid: \"hsv\",\n\tname: \"HSV\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tv: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Value\",\n\t\t},\n\t},\n\n\tbase: sRGB,\n\t// https://en.wikipedia.org/wiki/HSL_and_HSV#Formal_derivation\n\tfromBase (rgb) {\n\t\tlet max = Math.max(...rgb);\n\t\tlet min = Math.min(...rgb);\n\t\tlet [r, g, b] = rgb;\n\t\tlet [h, s, v] = [null, 0, max];\n\t\tlet d = max - min;\n\n\t\tif (d !== 0) {\n\t\t\tswitch (max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t}\n\n\t\t\th = h * 60;\n\t\t}\n\n\t\tif (v) {\n\t\t\ts = d / v;\n\t\t}\n\n\t\tif (h >= 360) {\n\t\t\th -= 360;\n\t\t}\n\n\t\treturn [h, s * 100, v * 100];\n\t},\n\t// Adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSV_to_RGB_alternative\n\ttoBase (hsv) {\n\t\tlet [h, s, v] = hsv;\n\t\th = h % 360;\n\n\t\tif (h < 0) {\n\t\t\th += 360;\n\t\t}\n\n\t\ts /= 100;\n\t\tv /= 100;\n\n\t\tfunction f (n) {\n\t\t\tlet k = (n + h / 60) % 6;\n\t\t\treturn v - v * s * Math.max(0, Math.min(k, 4 - k, 1));\n\t\t}\n\n\t\treturn [f(5), f(3), f(1)];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hsv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport HSV from \"./hsv.js\";\n\n// The Hue, Whiteness Blackness (HWB) colorspace\n// See https://drafts.csswg.org/css-color-4/#the-hwb-notation\n// Note that, like HSL, calculations are done directly on\n// gamma-corrected sRGB values rather than linearising them first.\n\nexport default new ColorSpace({\n\tid: \"hwb\",\n\tname: \"HWB\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\tw: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Whiteness\",\n\t\t},\n\t\tb: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Blackness\",\n\t\t},\n\t},\n\n\tbase: HSV,\n\tfromBase (hsv) {\n\t\tlet [h, s, v] = hsv;\n\n\t\treturn [h, (v * (100 - s)) / 100, 100 - v];\n\t},\n\ttoBase (hwb) {\n\t\tlet [h, w, b] = hwb;\n\n\t\t// Now convert percentages to [0..1]\n\t\tw /= 100;\n\t\tb /= 100;\n\n\t\t// Achromatic check (white plus black >= 1)\n\t\tlet sum = w + b;\n\t\tif (sum >= 1) {\n\t\t\tlet gray = w / sum;\n\t\t\treturn [h, 0, gray * 100];\n\t\t}\n\n\t\tlet v = 1 - b;\n\t\tlet s = v === 0 ? 0 : 1 - w / v;\n\t\treturn [h, s * 100, v * 100];\n\t},\n\n\tformats: {\n\t\thwb: {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// convert an array of linear-light a98-rgb values to CIE XYZ\n// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n// has greater numerical precision than section 4.3.5.3 of\n// https://www.adobe.com/digitalimag/pdfs/AdobeRGB1998.pdf\n// but the values below were calculated from first principles\n// from the chromaticity coordinates of R G B W\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.5766690429101305,   0.1855582379065463,   0.1882286462349947  ],\n\t[ 0.29734497525053605,  0.6273635662554661,   0.07529145849399788 ],\n\t[ 0.02703136138641234,  0.07068885253582723,  0.9913375368376388  ],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[  2.0415879038107465,    -0.5650069742788596,   -0.34473135077832956 ],\n\t[ -0.9692436362808795,     1.8759675015077202,    0.04155505740717557 ],\n\t[  0.013444280632031142,  -0.11836239223101838,   1.0151749943912054  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"a98rgb-linear\",\n\tcssId: \"--a98-rgb-linear\",\n\tname: \"Linear Adobe® 98 RGB compatible\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport A98Linear from \"./a98rgb-linear.js\";\n\nexport default new RGBColorSpace({\n\tid: \"a98rgb\",\n\tcssId: \"a98-rgb\",\n\tname: \"Adobe® 98 RGB compatible\",\n\tbase: A98Linear,\n\ttoBase: RGB => RGB.map(val => Math.pow(Math.abs(val), 563 / 256) * Math.sign(val)),\n\tfromBase: RGB => RGB.map(val => Math.pow(Math.abs(val), 256 / 563) * Math.sign(val)),\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport XYZ_D50 from \"./xyz-d50.js\";\n\n/** @import { Matrix3x3 } from \"../types.js\" */\n\n// convert an array of  prophoto-rgb values to CIE XYZ\n// using  D50 (so no chromatic adaptation needed afterwards)\n// matrix cannot be expressed in rational form, but is calculated to 64 bit accuracy\n// see https://github.com/w3c/csswg-drafts/issues/7675\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst toXYZ_M = [\n\t[ 0.79776664490064230,  0.13518129740053308,  0.03134773412839220 ],\n\t[ 0.28807482881940130,  0.71183523424187300,  0.00008993693872564 ],\n\t[ 0.00000000000000000,  0.00000000000000000,  0.82510460251046020 ],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nconst fromXYZ_M = [\n\t[  1.34578688164715830, -0.25557208737979464, -0.05110186497554526 ],\n\t[ -0.54463070512490190,  1.50824774284514680,  0.02052744743642139 ],\n\t[  0.00000000000000000,  0.00000000000000000,  1.21196754563894520 ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"prophoto-linear\",\n\tcssId: \"--prophoto-rgb-linear\",\n\tname: \"Linear ProPhoto\",\n\twhite: \"D50\",\n\tbase: XYZ_D50,\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../RGBColorSpace.js\";\nimport ProPhotoLinear from \"./prophoto-linear.js\";\n\nconst Et = 1 / 512;\nconst Et2 = 16 / 512;\n\nexport default new RGBColorSpace({\n\tid: \"prophoto\",\n\tcssId: \"prophoto-rgb\",\n\tname: \"ProPhoto\",\n\tbase: ProPhotoLinear,\n\ttoBase (RGB) {\n\t\t// Transfer curve is gamma 1.8 with a small linear portion\n\t\treturn RGB.map(v => {\n\t\t\tlet sign = v < 0 ? -1 : 1;\n\t\t\tlet abs = v * sign;\n\n\t\t\tif (abs < Et2) {\n\t\t\t\treturn v / 16;\n\t\t\t}\n\n\t\t\treturn sign * abs ** 1.8;\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(v => {\n\t\t\tlet sign = v < 0 ? -1 : 1;\n\t\t\tlet abs = v * sign;\n\n\t\t\tif (abs >= Et) {\n\t\t\t\treturn sign * abs ** (1 / 1.8);\n\t\t\t}\n\n\t\t\treturn 16 * v;\n\t\t});\n\t},\n});\n","import ColorSpace from \"../ColorSpace.js\";\nimport OKLab from \"./oklab.js\";\nimport lch from \"./lch.js\";\n\nexport default new ColorSpace({\n\tid: \"oklch\",\n\tname: \"OkLCh\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 0.4],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\twhite: \"D65\",\n\n\tbase: OKLab,\n\tfromBase: lch.fromBase,\n\ttoBase: lch.toBase,\n\n\tformats: {\n\t\toklch: {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","// Okhsl class.\n//\n// ---- License ----\n//\n// Copyright (c) 2021 Björn Ottosson\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy of\n// this software and associated documentation files (the \"Software\"), to deal in\n// the Software without restriction, including without limitation the rights to\n// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n// of the Software, and to permit persons to whom the Software is furnished to do\n// so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\nimport ColorSpace from \"../ColorSpace.js\";\nimport Oklab from \"./oklab.js\";\nimport { LabtoLMS_M } from \"./oklab.js\";\nimport { spow, multiply_v3_m3x3 } from \"../util.js\";\nimport { constrain } from \"../angles.js\";\n\n/** @import { Matrix3x3, Vector3 } from \"../types.js\" */\n\n// Type re-exports\n/** @typedef {import(\"../types.js\").OKCoeff} OKCoeff */\n\nexport const tau = 2 * Math.PI;\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const toLMS = [\n\t[0.4122214694707629, 0.5363325372617349, 0.0514459932675022],\n\t[0.2119034958178251, 0.6806995506452344, 0.1073969535369405],\n\t[0.0883024591900564, 0.2817188391361215, 0.6299787016738222],\n];\n\n/** @type {Matrix3x3} */\n// prettier-ignore\nexport const toSRGBLinear = [\n\t[ 4.0767416360759583, -3.3077115392580629,  0.2309699031821043],\n\t[-1.2684379732850315,  2.6097573492876882, -0.3413193760026570],\n\t[-0.0041960761386756, -0.7034186179359362,  1.7076146940746117],\n];\n\n/** @type {OKCoeff} */\nexport const RGBCoeff = [\n\t// Red\n\t[\n\t\t// Limit\n\t\t[-1.8817031, -0.80936501],\n\t\t// `Kn` coefficients\n\t\t[1.19086277, 1.76576728, 0.59662641, 0.75515197, 0.56771245],\n\t],\n\t// Green\n\t[\n\t\t// Limit\n\t\t[1.8144408, -1.19445267],\n\t\t// `Kn` coefficients\n\t\t[0.73956515, -0.45954404, 0.08285427, 0.12541073, -0.14503204],\n\t],\n\t// Blue\n\t[\n\t\t// Limit\n\t\t[0.13110758, 1.81333971],\n\t\t// `Kn` coefficients\n\t\t[1.35733652, -0.00915799, -1.1513021, -0.50559606, 0.00692167],\n\t],\n];\n\nconst floatMax = Number.MAX_VALUE;\nconst K1 = 0.206;\nconst K2 = 0.03;\nconst K3 = (1.0 + K1) / (1.0 + K2);\n\nfunction vdot (a, b) {\n\t// Dot two vectors\n\n\tlet l = a.length;\n\tif (l !== b.length) {\n\t\tthrow new Error(`Vectors of size ${l} and ${b.length} are not aligned`);\n\t}\n\n\tlet s = 0.0;\n\ta.forEach((c, i) => {\n\t\ts += c * b[i];\n\t});\n\n\treturn s;\n}\n\n/**\n * Toe function for L_r\n * @param {number} x\n */\nexport function toe (x) {\n\treturn 0.5 * (K3 * x - K1 + Math.sqrt((K3 * x - K1) * (K3 * x - K1) + 4 * K2 * K3 * x));\n}\n\n/**\n * Inverse toe function for L_r\n * @param {number} x\n */\nexport function toeInv (x) {\n\treturn (x ** 2 + K1 * x) / (K3 * (x + K2));\n}\n\n/**\n * @param {readonly [number, number]} cusp\n * @returns {[number, number]}\n */\nexport function toSt (cusp) {\n\t// To ST.\n\n\tlet [l, c] = cusp;\n\treturn [c / l, c / (1 - l)];\n}\n\nfunction getStMid (a, b) {\n\t// Returns a smooth approximation of the location of the cusp.\n\t//\n\t// This polynomial was created by an optimization process.\n\t// It has been designed so that S_mid < S_max and T_mid < T_max.\n\n\t// prettier-ignore\n\tlet s = 0.11516993 + 1.0 / (\n\t\t7.44778970 + 4.15901240 * b +\n\t\ta * (\n\t\t\t-2.19557347 + 1.75198401 * b +\n\t\t\ta * (\n\t\t\t\t-2.13704948 - 10.02301043 * b +\n\t\t\t\ta * (\n\t\t\t\t\t-4.24894561 + 5.38770819 * b + 4.69891013 * a\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t);\n\n\t// prettier-ignore\n\tlet t = 0.11239642 + 1.0 / (\n\t\t1.61320320 - 0.68124379 * b +\n\t\ta * (\n\t\t\t0.40370612 + 0.90148123 * b +\n\t\t\ta * (\n\t\t\t\t-0.27087943 + 0.61223990 * b +\n\t\t\t\ta * (\n\t\t\t\t\t0.00299215 - 0.45399568 * b - 0.14661872 * a\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t);\n\n\treturn [s, t];\n}\n\n/**\n * @param {Vector3} lab\n * @param {Matrix3x3} lmsToRgb\n */\nexport function oklabToLinearRGB (lab, lmsToRgb) {\n\t// Convert from Oklab to linear RGB.\n\t//\n\t// Can be any gamut as long as `lmsToRgb` is a matrix\n\t// that transform the LMS values to the linear RGB space.\n\n\tlet lms = multiply_v3_m3x3(lab, LabtoLMS_M);\n\n\tlms[0] = lms[0] ** 3;\n\tlms[1] = lms[1] ** 3;\n\tlms[2] = lms[2] ** 3;\n\n\treturn multiply_v3_m3x3(lms, lmsToRgb, lms);\n}\n\n/**\n * @param {number} a\n * @param {number} b\n * @param {Matrix3x3} lmsToRgb\n * @param {OKCoeff} okCoeff\n * @returns {[number, number]}\n * @todo Could probably make these types more specific/better-documented if desired\n */\nexport function findCusp (a, b, lmsToRgb, okCoeff) {\n\t// Finds L_cusp and C_cusp for a given hue.\n\t//\n\t// `a` and `b` must be normalized so `a^2 + b^2 == 1`.\n\n\t// First, find the maximum saturation (saturation `S = C/L`)\n\tlet sCusp = computeMaxSaturation(a, b, lmsToRgb, okCoeff);\n\n\t// Convert to linear RGB to find the first point where at least one of r, g or b >= 1:\n\tlet rgb = oklabToLinearRGB([1, sCusp * a, sCusp * b], lmsToRgb);\n\tlet lCusp = spow(1.0 / Math.max(...rgb), 1 / 3);\n\tlet cCusp = lCusp * sCusp;\n\n\treturn [lCusp, cCusp];\n}\n\n/**\n * @param {number} a\n * @param {number} b\n * @param {number} l1\n * @param {number} c1\n * @param {number} l0\n * @param {Matrix3x3} lmsToRgb\n * @param {OKCoeff} okCoeff\n * @param {[number, number]} cusp\n * @returns {Number}\n * @todo Could probably make these types more specific/better-documented if desired\n */\nexport function findGamutIntersection (a, b, l1, c1, l0, lmsToRgb, okCoeff, cusp) {\n\t// Finds intersection of the line.\n\t//\n\t// Defined by the following:\n\t//\n\t// ```\n\t// L = L0 * (1 - t) + t * L1\n\t// C = t * C1\n\t// ```\n\t//\n\t// `a` and `b` must be normalized so `a^2 + b^2 == 1`.\n\n\tlet t;\n\n\tif (cusp === undefined) {\n\t\tcusp = findCusp(a, b, lmsToRgb, okCoeff);\n\t}\n\n\t// Find the intersection for upper and lower half separately\n\tif ((l1 - l0) * cusp[1] - (cusp[0] - l0) * c1 <= 0.0) {\n\t\t// Lower half\n\t\tt = (cusp[1] * l0) / (c1 * cusp[0] + cusp[1] * (l0 - l1));\n\t}\n\telse {\n\t\t// Upper half\n\n\t\t// First intersect with triangle\n\t\tt = (cusp[1] * (l0 - 1.0)) / (c1 * (cusp[0] - 1.0) + cusp[1] * (l0 - l1));\n\n\t\t// Then one step Halley's method\n\t\tlet dl = l1 - l0;\n\t\tlet dc = c1;\n\n\t\tlet kl = vdot(LabtoLMS_M[0].slice(1), [a, b]);\n\t\tlet km = vdot(LabtoLMS_M[1].slice(1), [a, b]);\n\t\tlet ks = vdot(LabtoLMS_M[2].slice(1), [a, b]);\n\n\t\tlet ldt_ = dl + dc * kl;\n\t\tlet mdt_ = dl + dc * km;\n\t\tlet sdt_ = dl + dc * ks;\n\n\t\t// If higher accuracy is required, 2 or 3 iterations of the following block can be used:\n\t\tlet L = l0 * (1.0 - t) + t * l1;\n\t\tlet C = t * c1;\n\n\t\tlet l_ = L + C * kl;\n\t\tlet m_ = L + C * km;\n\t\tlet s_ = L + C * ks;\n\n\t\tlet l = l_ ** 3;\n\t\tlet m = m_ ** 3;\n\t\tlet s = s_ ** 3;\n\n\t\tlet ldt = 3 * ldt_ * l_ ** 2;\n\t\tlet mdt = 3 * mdt_ * m_ ** 2;\n\t\tlet sdt = 3 * sdt_ * s_ ** 2;\n\n\t\tlet ldt2 = 6 * ldt_ ** 2 * l_;\n\t\tlet mdt2 = 6 * mdt_ ** 2 * m_;\n\t\tlet sdt2 = 6 * sdt_ ** 2 * s_;\n\n\t\tlet r_ = vdot(lmsToRgb[0], [l, m, s]) - 1;\n\t\tlet r1 = vdot(lmsToRgb[0], [ldt, mdt, sdt]);\n\t\tlet r2 = vdot(lmsToRgb[0], [ldt2, mdt2, sdt2]);\n\n\t\tlet ur = r1 / (r1 * r1 - 0.5 * r_ * r2);\n\t\tlet tr = -r_ * ur;\n\n\t\tlet g_ = vdot(lmsToRgb[1], [l, m, s]) - 1;\n\t\tlet g1 = vdot(lmsToRgb[1], [ldt, mdt, sdt]);\n\t\tlet g2 = vdot(lmsToRgb[1], [ldt2, mdt2, sdt2]);\n\n\t\tlet ug = g1 / (g1 * g1 - 0.5 * g_ * g2);\n\t\tlet tg = -g_ * ug;\n\n\t\tlet b_ = vdot(lmsToRgb[2], [l, m, s]) - 1;\n\t\tlet b1 = vdot(lmsToRgb[2], [ldt, mdt, sdt]);\n\t\tlet b2 = vdot(lmsToRgb[2], [ldt2, mdt2, sdt2]);\n\n\t\tlet ub = b1 / (b1 * b1 - 0.5 * b_ * b2);\n\t\tlet tb = -b_ * ub;\n\n\t\ttr = ur >= 0.0 ? tr : floatMax;\n\t\ttg = ug >= 0.0 ? tg : floatMax;\n\t\ttb = ub >= 0.0 ? tb : floatMax;\n\n\t\tt += Math.min(tr, Math.min(tg, tb));\n\t}\n\n\treturn t;\n}\n\nfunction getCs (lab, lmsToRgb, okCoeff) {\n\t// Get Cs\n\n\tlet [l, a, b] = lab;\n\n\tlet cusp = findCusp(a, b, lmsToRgb, okCoeff);\n\n\tlet cMax = findGamutIntersection(a, b, l, 1, l, lmsToRgb, okCoeff, cusp);\n\tlet stMax = toSt(cusp);\n\n\t// Scale factor to compensate for the curved part of gamut shape:\n\tlet k = cMax / Math.min(l * stMax[0], (1 - l) * stMax[1]);\n\n\tlet stMid = getStMid(a, b);\n\n\t// Use a soft minimum function, instead of a sharp triangle shape to get a smooth value for chroma.\n\tlet ca = l * stMid[0];\n\tlet cb = (1.0 - l) * stMid[1];\n\tlet cMid = 0.9 * k * Math.sqrt(Math.sqrt(1.0 / (1.0 / ca ** 4 + 1.0 / cb ** 4)));\n\n\t// For `C_0`, the shape is independent of hue, so `ST` are constant.\n\t// Values picked to roughly be the average values of `ST`.\n\tca = l * 0.4;\n\tcb = (1.0 - l) * 0.8;\n\n\t// Use a soft minimum function, instead of a sharp triangle shape to get a smooth value for chroma.\n\tlet c0 = Math.sqrt(1.0 / (1.0 / ca ** 2 + 1.0 / cb ** 2));\n\n\treturn [c0, cMid, cMax];\n}\n\nfunction computeMaxSaturation (a, b, lmsToRgb, okCoeff) {\n\t// Finds the maximum saturation possible for a given hue that fits in RGB.\n\t//\n\t// Saturation here is defined as `S = C/L`.\n\t// `a` and `b` must be normalized so `a^2 + b^2 == 1`.\n\n\t// Max saturation will be when one of r, g or b goes below zero.\n\n\t// Select different coefficients depending on which component goes below zero first.\n\n\tlet k0, k1, k2, k3, k4, wl, wm, ws;\n\n\tif (vdot(okCoeff[0][0], [a, b]) > 1) {\n\t\t// Red component\n\t\t[k0, k1, k2, k3, k4] = okCoeff[0][1];\n\t\t[wl, wm, ws] = lmsToRgb[0];\n\t}\n\telse if (vdot(okCoeff[1][0], [a, b]) > 1) {\n\t\t// Green component\n\t\t[k0, k1, k2, k3, k4] = okCoeff[1][1];\n\t\t[wl, wm, ws] = lmsToRgb[1];\n\t}\n\telse {\n\t\t// Blue component\n\t\t[k0, k1, k2, k3, k4] = okCoeff[2][1];\n\t\t[wl, wm, ws] = lmsToRgb[2];\n\t}\n\n\t// Approximate max saturation using a polynomial:\n\tlet sat = k0 + k1 * a + k2 * b + k3 * a ** 2 + k4 * a * b;\n\n\t// Do one step Halley's method to get closer.\n\t// This gives an error less than 10e6, except for some blue hues where the `dS/dh` is close to infinite.\n\t// This should be sufficient for most applications, otherwise do two/three steps.\n\n\tlet kl = vdot(LabtoLMS_M[0].slice(1), [a, b]);\n\tlet km = vdot(LabtoLMS_M[1].slice(1), [a, b]);\n\tlet ks = vdot(LabtoLMS_M[2].slice(1), [a, b]);\n\n\tlet l_ = 1.0 + sat * kl;\n\tlet m_ = 1.0 + sat * km;\n\tlet s_ = 1.0 + sat * ks;\n\n\tlet l = l_ ** 3;\n\tlet m = m_ ** 3;\n\tlet s = s_ ** 3;\n\n\tlet lds = 3.0 * kl * l_ ** 2;\n\tlet mds = 3.0 * km * m_ ** 2;\n\tlet sds = 3.0 * ks * s_ ** 2;\n\n\tlet lds2 = 6.0 * kl ** 2 * l_;\n\tlet mds2 = 6.0 * km ** 2 * m_;\n\tlet sds2 = 6.0 * ks ** 2 * s_;\n\n\tlet f = wl * l + wm * m + ws * s;\n\tlet f1 = wl * lds + wm * mds + ws * sds;\n\tlet f2 = wl * lds2 + wm * mds2 + ws * sds2;\n\n\tsat = sat - (f * f1) / (f1 ** 2 - 0.5 * f * f2);\n\n\treturn sat;\n}\n\nfunction okhslToOklab (hsl, lmsToRgb, okCoeff) {\n\t// Convert Okhsl to Oklab.\n\n\tlet [h, s, l] = hsl;\n\tlet L = toeInv(l);\n\tlet a = null;\n\tlet b = null;\n\th = constrain(h) / 360.0;\n\n\tif (L !== 0.0 && L !== 1.0 && s !== 0) {\n\t\tlet a_ = Math.cos(tau * h);\n\t\tlet b_ = Math.sin(tau * h);\n\n\t\tlet [c0, cMid, cMax] = getCs([L, a_, b_], lmsToRgb, okCoeff);\n\n\t\t// Interpolate the three values for C so that:\n\t\t// ```\n\t\t// At s=0: dC/ds = C_0, C=0\n\t\t// At s=0.8: C=C_mid\n\t\t// At s=1.0: C=C_max\n\t\t// ```\n\n\t\tlet mid = 0.8;\n\t\tlet midInv = 1.25;\n\t\tlet t, k0, k1, k2;\n\n\t\tif (s < mid) {\n\t\t\tt = midInv * s;\n\t\t\tk0 = 0.0;\n\t\t\tk1 = mid * c0;\n\t\t\tk2 = 1.0 - k1 / cMid;\n\t\t}\n\t\telse {\n\t\t\tt = 5 * (s - 0.8);\n\t\t\tk0 = cMid;\n\t\t\tk1 = (0.2 * cMid ** 2 * 1.25 ** 2) / c0;\n\t\t\tk2 = 1.0 - k1 / (cMax - cMid);\n\t\t}\n\n\t\tlet c = k0 + (t * k1) / (1.0 - k2 * t);\n\n\t\ta = c * a_;\n\t\tb = c * b_;\n\t}\n\n\treturn [L, a, b];\n}\n\nfunction oklabToOkhsl (lab, lmsToRgb, okCoeff) {\n\t// Oklab to Okhsl.\n\n\t// Epsilon for lightness should approach close to 32 bit lightness\n\t// Epsilon for saturation just needs to be sufficiently close when denoting achromatic\n\tlet εL = 1e-7;\n\tlet εS = 1e-4;\n\tlet L = lab[0];\n\tlet s = 0.0;\n\tlet l = toe(L);\n\n\tlet c = Math.sqrt(lab[1] ** 2 + lab[2] ** 2);\n\tlet h = 0.5 + Math.atan2(-lab[2], -lab[1]) / tau;\n\n\tif (l !== 0.0 && l !== 1.0 && c !== 0) {\n\t\tlet a_ = lab[1] / c;\n\t\tlet b_ = lab[2] / c;\n\n\t\tlet [c0, cMid, cMax] = getCs([L, a_, b_], lmsToRgb, okCoeff);\n\n\t\tlet mid = 0.8;\n\t\tlet midInv = 1.25;\n\t\tlet k0, k1, k2, t;\n\n\t\tif (c < cMid) {\n\t\t\tk1 = mid * c0;\n\t\t\tk2 = 1.0 - k1 / cMid;\n\n\t\t\tt = c / (k1 + k2 * c);\n\t\t\ts = t * mid;\n\t\t}\n\t\telse {\n\t\t\tk0 = cMid;\n\t\t\tk1 = (0.2 * cMid ** 2 * midInv ** 2) / c0;\n\t\t\tk2 = 1.0 - k1 / (cMax - cMid);\n\n\t\t\tt = (c - k0) / (k1 + k2 * (c - k0));\n\t\t\ts = mid + 0.2 * t;\n\t\t}\n\t}\n\n\tconst achromatic = Math.abs(s) < εS;\n\tif (achromatic || l === 0.0 || Math.abs(1 - l) < εL) {\n\t\th = null;\n\t\t// Due to floating point imprecision near lightness of 1, we can end up\n\t\t// with really high around white, this is to provide consistency as\n\t\t// saturation can be really high for white due this imprecision.\n\t\tif (!achromatic) {\n\t\t\ts = 0.0;\n\t\t}\n\t}\n\telse {\n\t\th = constrain(h * 360);\n\t}\n\n\treturn [h, s, l];\n}\n\nexport default new ColorSpace({\n\tid: \"okhsl\",\n\tname: \"Okhsl\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 1],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: Oklab,\n\tgamutSpace: \"self\",\n\n\t// Convert Oklab to Okhsl\n\tfromBase (lab) {\n\t\treturn oklabToOkhsl(lab, toSRGBLinear, RGBCoeff);\n\t},\n\n\t// Convert Okhsl to Oklab\n\ttoBase (hsl) {\n\t\treturn okhslToOklab(hsl, toSRGBLinear, RGBCoeff);\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--okhsl\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","// Okhsv class.\n//\n// ---- License ----\n//\n// Copyright (c) 2021 Björn Ottosson\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy of\n// this software and associated documentation files (the \"Software\"), to deal in\n// the Software without restriction, including without limitation the rights to\n// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n// of the Software, and to permit persons to whom the Software is furnished to do\n// so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\nimport ColorSpace from \"../ColorSpace.js\";\nimport Oklab from \"./oklab.js\";\nimport { spow, multiply_v3_m3x3 } from \"../util.js\";\nimport { constrain } from \"../angles.js\";\nimport {\n\ttau,\n\ttoe,\n\ttoeInv,\n\tfindCusp,\n\ttoSt,\n\toklabToLinearRGB,\n\ttoSRGBLinear,\n\tRGBCoeff,\n} from \"./okhsl.js\";\n\n/** @import { Coords, Matrix3x3, OKCoeff, Vector3 } from \"../types.js\" */\n\n/**\n *\n * @param {Vector3} hsv\n * @param {Matrix3x3} lmsToRgb\n * @param {OKCoeff} okCoeff\n * @returns {Coords}\n */\nfunction okhsvToOklab (hsv, lmsToRgb, okCoeff) {\n\t// Convert from Okhsv to Oklab.\"\"\"\n\n\tlet [h, s, v] = hsv;\n\th = constrain(h) / 360.0;\n\n\tlet l = toeInv(v);\n\tlet a = null;\n\tlet b = null;\n\n\t// Avoid processing gray or colors with undefined hues\n\tif (l !== 0.0 && s !== 0.0) {\n\t\tlet a_ = Math.cos(tau * h);\n\t\tlet b_ = Math.sin(tau * h);\n\n\t\tlet cusp = findCusp(a_, b_, lmsToRgb, okCoeff);\n\t\tlet [sMax, tMax] = toSt(cusp);\n\t\tlet s0 = 0.5;\n\t\tlet k = 1 - s0 / sMax;\n\n\t\t// first we compute L and V as if the gamut is a perfect triangle:\n\n\t\t// L, C when v==1:\n\t\tlet lv = 1 - (s * s0) / (s0 + tMax - tMax * k * s);\n\t\tlet cv = (s * tMax * s0) / (s0 + tMax - tMax * k * s);\n\n\t\tl = v * lv;\n\t\tlet c = v * cv;\n\n\t\t// then we compensate for both toe and the curved top part of the triangle:\n\t\tlet lvt = toeInv(lv);\n\t\tlet cvt = (cv * lvt) / lv;\n\n\t\tlet lNew = toeInv(l);\n\t\tc = (c * lNew) / l;\n\t\tl = lNew;\n\n\t\t// RGB scale\n\t\tlet [rs, gs, bs] = oklabToLinearRGB([lvt, a_ * cvt, b_ * cvt], lmsToRgb);\n\t\tlet scaleL = spow(1.0 / Math.max(Math.max(rs, gs), Math.max(bs, 0.0)), 1 / 3);\n\n\t\tl = l * scaleL;\n\t\tc = c * scaleL;\n\n\t\ta = c * a_;\n\t\tb = c * b_;\n\t}\n\n\treturn [l, a, b];\n}\n\n/**\n *\n * @param {Vector3} lab\n * @param {Matrix3x3} lmsToRgb\n * @param {OKCoeff} okCoeff\n * @returns {Coords}\n */\nfunction oklabToOkhsv (lab, lmsToRgb, okCoeff) {\n\t// Oklab to Okhsv.\n\n\t// Epsilon for saturation just needs to be sufficiently close when denoting achromatic\n\tlet ε = 1e-4;\n\tlet l = lab[0];\n\tlet s = 0.0;\n\tlet v = toe(l);\n\tlet c = Math.sqrt(lab[1] ** 2 + lab[2] ** 2);\n\tlet h = 0.5 + Math.atan2(-lab[2], -lab[1]) / tau;\n\n\tif (l !== 0.0 && l !== 1 && c !== 0.0) {\n\t\tlet a_ = lab[1] / c;\n\t\tlet b_ = lab[2] / c;\n\n\t\tlet cusp = findCusp(a_, b_, lmsToRgb, okCoeff);\n\t\tlet [sMax, tMax] = toSt(cusp);\n\t\tlet s0 = 0.5;\n\t\tlet k = 1 - s0 / sMax;\n\n\t\t// first we find `L_v`, `C_v`, `L_vt` and `C_vt`\n\t\tlet t = tMax / (c + l * tMax);\n\t\tlet lv = t * l;\n\t\tlet cv = t * c;\n\n\t\tlet lvt = toeInv(lv);\n\t\tlet cvt = (cv * lvt) / lv;\n\n\t\t// we can then use these to invert the step that compensates\n\t\t// for the toe and the curved top part of the triangle:\n\t\tlet [rs, gs, bs] = oklabToLinearRGB([lvt, a_ * cvt, b_ * cvt], lmsToRgb);\n\t\tlet scaleL = spow(1.0 / Math.max(Math.max(rs, gs), Math.max(bs, 0.0)), 1 / 3);\n\n\t\tl = l / scaleL;\n\t\tc = c / scaleL;\n\n\t\tc = (c * toe(l)) / l;\n\t\tl = toe(l);\n\n\t\t// we can now compute v and s:\n\t\tv = l / lv;\n\t\ts = ((s0 + tMax) * cv) / (tMax * s0 + tMax * k * cv);\n\t}\n\n\tif (Math.abs(s) < ε || v === 0.0) {\n\t\th = null;\n\t}\n\telse {\n\t\th = constrain(h * 360);\n\t}\n\n\treturn [h, s, v];\n}\n\nexport default new ColorSpace({\n\tid: \"okhsv\",\n\tname: \"Okhsv\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 1],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tv: {\n\t\t\trange: [0, 1],\n\t\t\tname: \"Value\",\n\t\t},\n\t},\n\n\tbase: Oklab,\n\tgamutSpace: \"self\",\n\n\t// Convert Oklab to Okhsl\n\tfromBase (lab) {\n\t\treturn oklabToOkhsv(lab, toSRGBLinear, RGBCoeff);\n\t},\n\n\t// Convert Okhsl to Oklab\n\ttoBase (hsl) {\n\t\treturn okhsvToOklab(hsl, toSRGBLinear, RGBCoeff);\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--okhsv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import * as colorjs from \"colorjs.io/fn\";\nimport { type ColorConstructor, parse, contrast, contrastLstar, to, inGamut } from 'colorjs.io/fn'\n\nexport type Theme = 'auto' | 'light' | 'dark'\nexport type StandardSpace = 'srgb' | 'hex' | 'hsl' | 'hwb' | 'lab' | 'lch' | 'oklab' | 'oklch'\nexport type WideRGB = 'srgb-linear' | 'display-p3' | 'rec2020' | 'a98-rgb' | 'prophoto' | 'xyz' | 'xyz-d50' | 'xyz-d65'\nexport type ColorSpace = StandardSpace | WideRGB\n\ncolorjs.ColorSpace.register(colorjs.sRGB);\ncolorjs.ColorSpace.register(colorjs.sRGB_Linear);\ncolorjs.ColorSpace.register(colorjs.HSL);\ncolorjs.ColorSpace.register(colorjs.HWB);\ncolorjs.ColorSpace.register(colorjs.Lab);\ncolorjs.ColorSpace.register(colorjs.LCH);\ncolorjs.ColorSpace.register(colorjs.OKLab);\ncolorjs.ColorSpace.register(colorjs.OKLCH);\ncolorjs.ColorSpace.register(colorjs.P3);\ncolorjs.ColorSpace.register(colorjs.A98RGB);\ncolorjs.ColorSpace.register(colorjs.ProPhoto);\ncolorjs.ColorSpace.register(colorjs.REC_2020);\ncolorjs.ColorSpace.register(colorjs.XYZ_D65);\ncolorjs.ColorSpace.register(colorjs.XYZ_D50);\ncolorjs.ColorSpace.register(colorjs.Okhsv);\n\nexport function parseCoords(x: number, min = 0, max = 100) {\n  return Math.max(min, Math.min(max, x))\n}\n\nexport function contrastColor(c: string): 'white' | 'black' {\n  try {\n    const color = parse(c)\n    let wh: number\n    let bl: number\n    try {\n      wh = contrast(color, 'white', 'WCAG21') ?? contrastLstar(color, 'white')\n      bl = contrast(color, 'black', 'WCAG21') ?? contrastLstar(color, 'black')\n    } catch {\n      wh = contrastLstar(color, 'white')\n      bl = contrastLstar(color, 'black')\n    }\n    return wh > bl ? 'white' : 'black'\n  } catch {\n    return 'black'\n  }\n}\n\nexport type Gamut = 'srgb' | 'p3' | 'rec2020' | 'xyz'\nexport function detectGamut(colorStr: string): Gamut {\n  let gamut: Gamut = 'srgb'\n  if (!colorStr || colorStr.startsWith('#')) return gamut\n  try {\n    const c = parse(colorStr)\n    const srgb: ColorConstructor = { spaceId: 'srgb', coords: to(c, 'srgb').coords, alpha: null }\n    const p3: ColorConstructor = { spaceId: 'p3', coords: to(c, 'p3').coords, alpha: null }\n    const rec2020: ColorConstructor = { spaceId: 'rec2020', coords: to(c, 'rec2020').coords, alpha: null }\n    const xyz: ColorConstructor = { spaceId: 'xyz', coords: to(c, 'xyz').coords, alpha: null }\n    if (inGamut(xyz)) gamut = 'xyz'\n    if (inGamut(rec2020)) gamut = 'rec2020'\n    if (inGamut(p3)) gamut = 'p3'\n    if (inGamut(srgb)) gamut = 'srgb'\n  } catch { }\n  return gamut\n}\n\nexport function getColorJSSpaceID(space: ColorSpace | string) {\n  if (space === 'display-p3') return 'p3'\n  if (space === 'a98-rgb') return 'a98rgb'\n  return space\n}\n\nexport function reverseColorJSSpaceID(space: string): ColorSpace | string {\n  if (space === 'p3') return 'display-p3'\n  if (space === 'a98rgb') return 'a98-rgb'\n  return space\n}\n\nexport function alphaToString(alpha: string | number) {\n  return alpha === '100' || alpha === 100 ? '' : ` / ${alpha}%`\n}\n\nexport function isRGBLike(space: string) {\n  return [\n    'srgb-linear',\n    'display-p3',\n    'rec2020',\n    'a98-rgb',\n    'prophoto',\n    'xyz',\n    'xyz-d50',\n    'xyz-d65'\n  ].includes(space)\n}\n\nexport function rgbColor(space: string, r: string | number, g: string | number, b: string | number, a: string | number) {\n  const s = space === 'prophoto' ? 'prophoto-rgb' : space\n  return `color(${s} ${r}% ${g}% ${b}%${alphaToString(a)})`\n}\n","import type { ColorSpace } from '../color'\n\n/**\n * Round number to fixed decimals and remove trailing zeros from the string representation.\n * @example toFixed(1.5, 2) → \"1.5\"\n * @example toFixed(2.00, 2) → \"2\"\n */\nexport function toFixed(n: null | number, digits = 0): string {\n  if (n == null) {\n    return '0'\n  }\n  return Number(n.toFixed(digits)).toString()\n}\n\n/**\n * Strip trailing zeros from decimal strings.\n * @example trimZeros(\"1.500\") → \"1.5\"\n * @example trimZeros(\"2.00\") → \"2\"\n */\nexport function trimZeros(s: string): string {\n  return s.replace(/\\.0+($|\\D)/, '$1').replace(/(\\.\\d*?)0+($|\\D)/, '$1$2')\n}\n\n/**\n * Format a channel value to appropriate precision for the given color space and channel name.\n * Handles different precision requirements across color spaces:\n * - OKLab: L (0 decimals), A/B (2 decimals)\n * - OKLCH: L/C/H (0 decimals)\n * - Lab: L/A/B (0 decimals)\n * - LCH: L/C/H (0 decimals)\n * - HSL/HWB: All channels (0 decimals)\n * - RGB-like: R/G/B (0 decimals)\n * - Alpha: (0 decimals)\n * - Default: 2 decimals\n */\nexport function formatChannel(space: ColorSpace, key: string, val: number): string {\n  const round = (n: number, d = 0) => Number(n.toFixed(d))\n\n  if (space === 'oklab') {\n    if (key === 'L') return String(round(val, 0))\n    if (key === 'A' || key === 'B') return String(round(val, 2))\n  } else if (space === 'oklch') {\n    if (key === 'L') return String(round(val, 0))\n    if (key === 'C') return String(round(val, 0)) // 0-100 percentage\n    if (key === 'H') return String(round(val, 0))\n  } else if (space === 'lab') {\n    if (key === 'L') return String(round(val, 0))\n    if (key === 'A' || key === 'B') return String(round(val, 0))\n  } else if (space === 'lch') {\n    if (key === 'L' || key === 'C' || key === 'H') return String(round(val, 0)) // C is 0-100 scale\n  } else if (space === 'hsl' || space === 'hwb') {\n    if (key === 'H') return String(round(val, 0))\n    if (key === 'S' || key === 'L' || key === 'W' || key === 'B') return String(round(val, 0))\n  } else if (space === 'srgb' || space === 'hex') {\n    if (key === 'R' || key === 'G' || key === 'B') return String(round(val, 0))\n  } else {\n    // Handle RGB-like spaces (display-p3, rec2020, etc.)\n    const rgbLike = [\n      'srgb-linear',\n      'display-p3',\n      'rec2020',\n      'a98-rgb',\n      'prophoto',\n      'xyz',\n      'xyz-d50',\n      'xyz-d65'\n    ]\n    if (rgbLike.includes(space) && (key === 'R' || key === 'G' || key === 'B')) {\n      return String(round(val, 0))\n    }\n  }\n\n  if (key === 'ALP') return String(round(val, 0))\n  return String(round(val, 2))\n}\n","import { getColor, OKLCH, parse, to, toGamut } from 'colorjs.io/fn'\nimport type { ColorSpace } from '../color'\nimport {\n  alphaToString,\n  getColorJSSpaceID,\n  isRGBLike,\n  rgbColor,\n  reverseColorJSSpaceID\n} from '../color'\nimport { toFixed } from './channel-formatting'\n\nexport type ChannelRecord = Record<string, string | number>\n\n/**\n * Generate a CSS color string from channel values and color space identifier.\n * Handles percentage/angle notation and alpha transparency per CSS Color spec.\n *\n * @param space - The color space (e.g., 'oklch', 'hsl', 'srgb')\n * @param ch - Channel values as a record (e.g., { L: '50', C: '75', H: '180', ALP: '100' })\n * @returns CSS color string (e.g., 'oklch(50% 75% 180)')\n *\n * @example\n * gencolor('oklch', { L: '50', C: '75', H: '180', ALP: '100' })\n * // → 'oklch(50% 75% 180)'\n *\n * @example\n * gencolor('hsl', { H: '120', S: '100', L: '50', ALP: '50' })\n * // → 'hsl(120 100% 50% / 50%)'\n */\nexport function gencolor(space: ColorSpace, ch: ChannelRecord): string {\n  const L = (ch.L ?? 50) as any\n  const A = (ch.A ?? 0) as any\n  const B = (ch.B ?? 0) as any\n  const C = (ch.C ?? 0) as any\n  const H = (ch.H ?? 0) as any\n  const S = (ch.S ?? 0) as any\n  const W = (ch.W ?? 0) as any\n  const R = (ch.R ?? 0) as any\n  const G = (ch.G ?? 0) as any\n  const ALP = (ch.ALP ?? 100) as any\n\n  switch (space) {\n    case 'oklab': return `oklab(${L}% ${A} ${B}${alphaToString(ALP)})`\n    case 'oklch': return `oklch(${L}% ${C}% ${H}${alphaToString(ALP)})` // Chroma as percentage\n    case 'lab': return `lab(${L}% ${A} ${B}${alphaToString(ALP)})`\n    case 'lch': return `lch(${L}% ${C}% ${H}${alphaToString(ALP)})` // Chroma as percentage\n    case 'hsl': return `hsl(${H} ${S}% ${L}%${alphaToString(ALP)})`\n    case 'hwb': return `hwb(${H} ${W}% ${B}%${alphaToString(ALP)})`\n    case 'srgb': return `rgb(${R}% ${G}% ${B}%${alphaToString(ALP)})`\n    case 'hex': {\n      // Convert percentage to 0-255 range\n      const r = Math.round(Number(R) * 2.55)\n      const g = Math.round(Number(G) * 2.55)\n      const b = Math.round(Number(B) * 2.55)\n      const a = Number(ALP)\n      // Format as hex\n      const rh = r.toString(16).padStart(2, '0')\n      const gh = g.toString(16).padStart(2, '0')\n      const bh = b.toString(16).padStart(2, '0')\n\n      // Check if we can use shortened hex format (3 or 4 digits)\n      const canShorten = rh[0] === rh[1] && gh[0] === gh[1] && bh[0] === bh[1]\n\n      if (a < 100) {\n        const alpha = Math.round((a / 100) * 255)\n        const ah = alpha.toString(16).padStart(2, '0')\n\n        if (canShorten && ah[0] === ah[1]) {\n          // Use 4-digit hex format (#rgba)\n          return `#${rh[0]}${gh[0]}${bh[0]}${ah[0]}`\n        }\n        return `#${rh}${gh}${bh}${ah}`\n      }\n\n      if (canShorten) {\n        // Use 3-digit hex format (#rgb)\n        return `#${rh[0]}${gh[0]}${bh[0]}`\n      }\n      return `#${rh}${gh}${bh}`\n    }\n    default:\n      if (isRGBLike(space)) return rgbColor(space, R, G, B, ALP)\n      return 'oklch(75% 75% 180)' // fallback\n  }\n}\n\n/**\n * Parse a CSS color string into its component channels for a target color space.\n * Converts between spaces if necessary, normalizes channel ranges, and handles missing hue.\n *\n * @param space - Target color space to parse into\n * @param colorStr - CSS color string to parse\n * @returns Object containing the parsed space and channel values\n *\n * @example\n * parseIntoChannels('oklch', 'red')\n * // → { space: 'oklch', ch: { L: '62', C: '57', H: '29', ALP: '100' } }\n *\n * @example\n * parseIntoChannels('hsl', '#ff0000')\n * // → { space: 'hsl', ch: { H: '0', S: '100', L: '50', ALP: '100' } }\n */\nexport function parseIntoChannels(space: ColorSpace, colorStr: string): { space: ColorSpace; ch: ChannelRecord } {\n  // getColor() converts input to compatible type with to() result\n  let c = getColor(parse(colorStr))\n  // Hex is internally sRGB\n  const actualSpace = space === 'hex' ? 'srgb' : space\n  // Convert to target space if different\n  const targetId = getColorJSSpaceID(actualSpace)\n  if (c.space.id !== targetId) {\n    c = to(c, targetId)\n  }\n  const id = reverseColorJSSpaceID(c.space.id)\n  const s = (id === 'rgb' ? 'srgb' : id) as ColorSpace\n\n  const ch: ChannelRecord = {}\n\n  // fallback to non-transparent\n  const alpha = c.alpha ?? 1\n  if (s === 'oklab') {\n    const [l, a, b] = c.coords\n    ch.L = toFixed((l ?? 0) * 100)\n    ch.A = toFixed(a, 2)\n    ch.B = toFixed(b, 2)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'oklch') {\n    const [minChroma, maxChroma] = OKLCH.coords.c.refRange ?? [0, 1]\n    const [l, cc, h] = c.coords\n    const chromaPercentage = ((cc ?? 0 - minChroma) / (maxChroma - minChroma)) * 100\n    ch.L = toFixed((l ?? 0) * 100)\n    ch.C = toFixed(Math.min(100, chromaPercentage), 0) // Convert to 0-100%, clamp at 100%\n    ch.H = toFixed(h)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'lab') {\n    const [l, a, b] = c.coords\n    ch.L = toFixed(l)\n    ch.A = toFixed(a)\n    ch.B = toFixed(b)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'lch') {\n    const [l, cc, h] = c.coords\n    ch.L = toFixed(l)\n    ch.C = toFixed(Math.min(100, (cc ?? 0) / 1.5), 0) // Normalize 0-150 to 0-100%, clamp at 100%\n    ch.H = toFixed(h)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'hsl') {\n    const h = c.coords[0]\n    const s2 = c.coords[1] ?? 0\n    const l = c.coords[2] ?? 0\n    ch.H = toFixed(h)\n    // colorjs.io returns 0-1 when parsing HSL strings, but 0-100 when converting from other spaces\n    ch.S = toFixed(s2 > 1 ? s2 : s2 * 100)\n    ch.L = toFixed(l > 1 ? l : l * 100)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'hwb') {\n    const h = c.coords[0]\n    const w = c.coords[1] ?? 0\n    const b = c.coords[2] ?? 0\n    ch.H = toFixed(h)\n    // colorjs.io returns 0-1 when parsing HWB strings, but 0-100 when converting from other spaces\n    ch.W = toFixed(w > 1 ? w : w * 100)\n    ch.B = toFixed(b > 1 ? b : b * 100)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (s === 'srgb' || s === 'hex') {\n    const [r, g, b] = toGamut(c, { space: 'srgb', method: 'clip' }).coords\n    ch.R = toFixed((r ?? 0) * 100)\n    ch.G = toFixed((g ?? 0) * 100)\n    ch.B = toFixed((b ?? 0) * 100)\n    ch.ALP = toFixed(alpha * 100)\n  } else if (isRGBLike(s)) {\n    const [r, g, b] = c.coords\n    ch.R = toFixed((r ?? 0) * 100)\n    ch.G = toFixed((g ?? 0) * 100)\n    ch.B = toFixed((b ?? 0) * 100)\n    ch.ALP = toFixed(alpha * 100)\n  }\n\n  return { space: s, ch }\n}\n","import { computed, effect, signal } from \"@preact/signals-core\";\nimport { ColorConstructor, serialize, to } from \"colorjs.io/fn\";\nimport { getColorJSSpaceID, type ColorSpace } from \"./color\";\nimport { gencolor, parseIntoChannels } from \"./utils/color-conversion\";\n\ntype AreaConfig = {\n  fixedIndex: number;\n  xIndex: number;\n  xMax: number;\n  xStep: number;\n  yIndex: number;\n  yMax: number;\n  yStep: number;\n};\n\nconst AREA_CONFIGS: Record<string, undefined | AreaConfig> = {\n  okhsv: {\n    fixedIndex: 0,\n    xIndex: 1,\n    xMax: 1,\n    xStep: 1 / 100,\n    yIndex: 2,\n    yMax: 1,\n    yStep: 1 / 100,\n  },\n  oklch: {\n    fixedIndex: 2,\n    xIndex: 1,\n    // 0.4 is approximately supported gamut by displays\n    xMax: 0.4,\n    xStep: 0.4 / 100,\n    yIndex: 0,\n    yMax: 1,\n    yStep: 1 / 100,\n  },\n  hsl: {\n    fixedIndex: 0,\n    xIndex: 1,\n    xMax: 100,\n    xStep: 1,\n    yIndex: 2,\n    yMax: 100,\n    yStep: 1,\n  },\n};\n\nconst getAreaConfig = (color: null | ColorConstructor) => {\n  if (color) {\n    return AREA_CONFIGS[color.spaceId];\n  }\n};\n\nfunction renderAreaGradient(\n  canvas: HTMLCanvasElement,\n  getColor: (x: number, y: number) => ColorConstructor\n) {\n  const W = 320 / 2; // render at half res for performance\n  const H = 200 / 2;\n  canvas.width = W;\n  canvas.height = H;\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) {\n    return;\n  }\n  const img = ctx.createImageData(W, H);\n  const d = img.data;\n  for (let y = 0; y < H; y++) {\n    const Y = 1 - y / (H - 1);\n    for (let x = 0; x < W; x++) {\n      const X = (x / (W - 1));\n      const [r, g, b] = to(getColor(X, Y), \"srgb\").coords;\n      const i = (y * W + x) * 4;\n      d[i] = Math.round((r ?? 0) * 255);\n      d[i + 1] = Math.round((g ?? 0) * 255);\n      d[i + 2] = Math.round((b ?? 0) * 255);\n      d[i + 3] = 255;\n    }\n  }\n  ctx.putImageData(img, 0, 0);\n}\n\nexport class AreaPicker {\n  #area: HTMLElement | null;\n  #isDragging = signal(false);\n  #controller = new AbortController();\n  #color = signal<null | ColorConstructor>(null);\n  #space = signal<null | ColorSpace>(null);\n\n  constructor(\n    element: null | HTMLElement,\n    onChange: (color: string) => void\n  ) {\n    this.#area = element;\n    const canvas = element?.querySelector<HTMLCanvasElement>(\".area-canvas\");\n    if (!element || !canvas) {\n      return;\n    }\n\n    const hue = computed(() => {\n      const color = this.#color.value;\n      const config = getAreaConfig(color);\n      if (!config) {\n        return 0;\n      }\n      return color?.coords[config.fixedIndex] ?? 0;\n    });\n    const draggingHue = signal<null | number>(null);\n\n    const handleChange = (newColor: ColorConstructor) => {\n      if (!this.#space.value) {\n        return;\n      }\n      // Serialize to target color space\n      const space = this.#space.value;\n      const targetSpace = getColorJSSpaceID(\n        space === \"hex\" ? \"srgb\" : space\n      );\n      const targetColor = to(newColor, targetSpace, { inGamut: true });\n      const serialized = serialize(targetColor, {\n        format: space === \"hex\" ? \"hex\" : undefined,\n      })\n      onChange(\n        // reformat color\n        gencolor(space, parseIntoChannels(space, serialized).ch)\n      );\n    };\n\n    const handleMove = (event: PointerEvent) => {\n      const color = this.#color.value;\n      const config = getAreaConfig(color);\n      if (!color || !config) {\n        return;\n      }\n\n      // extract 0..1 coords\n      const rect = element.getBoundingClientRect();\n      const x = Math.max(0, Math.min(1, (event.clientX - rect.left) / rect.width));\n      const y = Math.max(0, Math.min(1, 1 - (event.clientY - rect.top) / rect.height));\n\n      // Build new coords array, preserving the fixed coordinate (hue)\n      const newCoords = structuredClone(color.coords);\n      newCoords[config.xIndex] = x * config.xMax;\n      newCoords[config.yIndex] = y * config.yMax;\n      handleChange({ ...color, coords: newCoords });\n    };\n\n    element.addEventListener(\n      \"pointerdown\",\n      (event) => {\n        this.#isDragging.value = true;\n        element.setPointerCapture(event.pointerId);\n        handleMove(event);\n        draggingHue.value = hue.value;\n      },\n      { signal: this.#controller.signal }\n    );\n\n    element.addEventListener(\n      \"pointermove\",\n      (event) => {\n        if (this.#isDragging.value) {\n          event.preventDefault();\n          handleMove(event);\n        }\n      },\n      { signal: this.#controller.signal }\n    );\n\n    element.addEventListener(\n      \"pointerup\",\n      (event) => {\n        this.#isDragging.value = false;\n        element.releasePointerCapture(event.pointerId);\n        draggingHue.value = null;\n      },\n      { signal: this.#controller.signal }\n    );\n\n    element.addEventListener(\n      \"pointercancel\",\n      () => {\n        this.#isDragging.value = false;\n        draggingHue.value = null;\n      },\n      { signal: this.#controller.signal }\n    );\n\n    element.addEventListener(\n      \"keydown\",\n      (event) => {\n        const color = this.#color.value;\n        const config = getAreaConfig(color);\n        if (!color || !config) {\n          return;\n        }\n\n        let xDelta = 0;\n        let yDelta = 0;\n        switch (event.key) {\n          case \"ArrowRight\":\n            xDelta = 1;\n            break;\n          case \"ArrowLeft\":\n            xDelta = -1;\n            break;\n          case \"ArrowUp\":\n            yDelta = 1;\n            break;\n          case \"ArrowDown\":\n            yDelta = -1;\n            break;\n          default:\n            return;\n        }\n        event.preventDefault();\n\n        // Calculate new values with clamping\n        const prevX = color.coords[config.xIndex] ?? 0;\n        const prevY = color.coords[config.yIndex] ?? 0;\n        const newX = Math.max(0, Math.min(config.xMax, prevX + xDelta * config.xStep));\n        const newY = Math.max(0, Math.min(config.yMax, prevY + yDelta * config.yStep));\n\n        // Build new coords array\n        const newCoords = structuredClone(color.coords);\n        newCoords[config.xIndex] = newX;\n        newCoords[config.yIndex] = newY;\n        handleChange({ ...color, coords: newCoords });\n      },\n      { signal: this.#controller.signal }\n    );\n\n    // update dragging state\n    const cleanupDragging = effect(() => {\n      element.classList.toggle(\"dragging\", this.#isDragging.value);\n      document.body.inert = this.#isDragging.value;\n    });\n\n    // update thumb position whenever color changes\n    const cleanupColor = effect(() => {\n      const color = this.#color.value;\n      const config = getAreaConfig(color);\n      if (!color || !config) {\n        return;\n      }\n      // Calculate percentage positions from current coords\n      const x = ((color.coords[config.xIndex] ?? 0) / config.xMax) * 100;\n      const y = ((color.coords[config.yIndex] ?? 0) / config.yMax) * 100;\n      this.#area?.style.setProperty(\"--thumb-x\", `${x}%`);\n      this.#area?.style.setProperty(\"--thumb-y\", `${100 - y}%`);\n    });\n\n    let animationId: null | number = null;\n    let pendingHue: null | number = null;\n\n    // allow only one render per animation frame\n    const cleanupHue = effect(() => {\n      // avoid frequent updates when hue is slightly changing due to conversion errors\n      // solve this by relying on hue when dragging is started\n      pendingHue = draggingHue.value ?? hue.value;\n\n      if (animationId === null) {\n        animationId = requestAnimationFrame(() => {\n          if (canvas && pendingHue !== null && this.#space.value) {\n            const color = this.#color.value\n            const config = getAreaConfig(color);\n            if (!color || !config) {\n              return;\n            }\n            renderAreaGradient(canvas, (x, y) => {\n              // Build coords array with fixedIndex getting pendingHue\n              const coords: [number, number, number] = [0, 0, 0];\n              coords[config.fixedIndex] = pendingHue ?? 0;\n              // x and y are 0-1 from the canvas loop\n              // Scale them according to config max values\n              coords[config.xIndex] = x * config.xMax;\n              coords[config.yIndex] = y * config.yMax;\n              return { spaceId: color.spaceId, coords, alpha: null };\n            });\n          }\n          animationId = null;\n          pendingHue = null;\n        });\n      }\n    });\n\n    this.#controller.signal.addEventListener(\"abort\", () => {\n      cleanupDragging();\n      cleanupColor();\n      cleanupHue();\n      if (animationId) {\n        cancelAnimationFrame(animationId);\n        animationId = null;\n      }\n    });\n  }\n\n  setValue(color: string, space: ColorSpace) {\n    this.#space.value = space;\n    try {\n      let colorObject\n      if (space === 'oklch' || space === 'lch') {\n        // For OKLCH/LCH spaces, convert to OKLCH\n        colorObject = to(color, \"oklch\");\n      } else if (space === 'hsl') {\n        // For HSL space, convert to HSL\n        colorObject = to(color, \"hsl\");\n      } else {\n        // For srgb/hex/hwb/lab/oklab, convert to OKHSV\n        colorObject = to(color, \"okhsv\");\n      }\n      this.#color.value = {\n        spaceId: colorObject.space.id,\n        coords: colorObject.coords,\n        alpha: colorObject.alpha,\n      };\n    } catch {\n      // If parsing fails, keep the current value or set to null\n      this.#color.value = null;\n    }\n  }\n\n  unmount() {\n    this.#controller.abort();\n  }\n}\n","/**\n * Positioning system: Intelligent popover placement\n *\n * Computes optimal popover position relative to an anchor, respecting viewport\n * bounds, safe areas, and scroll containers. Tries multiple placements and picks\n * the one that maximizes visible area while maintaining placement stability.\n */\n\nexport const VIEWPORT_MARGIN = 8\nexport const GUTTER = 8\n\nexport type Placement =\n  | 'bottom-center' | 'top-center'\n  | 'right-start' | 'left-start'\n  | 'bottom-left' | 'bottom-right'\n  | 'top-left' | 'top-right'\n\nexport interface Rect {\n  left: number\n  top: number\n  right: number\n  bottom: number\n  width: number\n  height: number\n}\n\nexport interface Size {\n  width: number\n  height: number\n}\n\nexport interface Candidate {\n  placement: Placement\n  left: number\n  top: number\n  right: number\n  bottom: number\n}\n\nlet cachedInsets: { top: number; right: number; bottom: number; left: number } | null = null\n\n/**\n * Detect CSS safe area insets (for notched/rounded displays) via a probe element.\n * Caches result after first call.\n */\nexport function getSafeAreaInsets(): { top: number; right: number; bottom: number; left: number } {\n  if (cachedInsets) return cachedInsets\n\n  const probe = document.createElement('div')\n  probe.style.position = 'fixed'\n  probe.style.left = '-9999px'\n  probe.style.top = '0'\n  probe.style.paddingTop = 'env(safe-area-inset-top)'\n  probe.style.paddingRight = 'env(safe-area-inset-right)'\n  probe.style.paddingBottom = 'env(safe-area-inset-bottom)'\n  probe.style.paddingLeft = 'env(safe-area-inset-left)'\n  document.documentElement.appendChild(probe)\n\n  const computed = getComputedStyle(probe)\n  const top = parseFloat(computed.paddingTop) || 0\n  const right = parseFloat(computed.paddingRight) || 0\n  const bottom = parseFloat(computed.paddingBottom) || 0\n  const left = parseFloat(computed.paddingLeft) || 0\n\n  document.documentElement.removeChild(probe)\n  cachedInsets = { top, right, bottom, left }\n  return cachedInsets\n}\n\n/**\n * Calculate the usable viewport rectangle after accounting for safe areas and margin.\n */\nexport function getViewportClampRect(insets: { top: number; right: number; bottom: number; left: number }): Rect {\n  const vw = window.visualViewport?.width ?? window.innerWidth\n  const vh = window.visualViewport?.height ?? window.innerHeight\n  const scrollX = window.pageXOffset || document.documentElement.scrollLeft\n  const scrollY = window.pageYOffset || document.documentElement.scrollTop\n\n  const left = insets.left + VIEWPORT_MARGIN + scrollX\n  const top = insets.top + VIEWPORT_MARGIN + scrollY\n  const right = vw - insets.right - VIEWPORT_MARGIN + scrollX\n  const bottom = vh - insets.bottom - VIEWPORT_MARGIN + scrollY\n\n  return {\n    left,\n    top,\n    right,\n    bottom,\n    width: right - left,\n    height: bottom - top,\n  }\n}\n\n/**\n * Generate all possible placement candidates (bottom-center, top-center, etc.) for a popover of given size.\n */\nexport function computeCandidates(anchor: Rect, size: Size): Candidate[] {\n  const { width: w, height: h } = size\n  const placements: Candidate[] = [\n    {\n      placement: 'bottom-center',\n      left: anchor.left + anchor.width / 2 - w / 2,\n      top: anchor.bottom + GUTTER,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'top-center',\n      left: anchor.left + anchor.width / 2 - w / 2,\n      top: anchor.top - GUTTER - h,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'right-start',\n      left: anchor.right + GUTTER,\n      top: anchor.top,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'left-start',\n      left: anchor.left - GUTTER - w,\n      top: anchor.top,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'bottom-left',\n      left: anchor.left,\n      top: anchor.bottom + GUTTER,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'bottom-right',\n      left: anchor.right - w,\n      top: anchor.bottom + GUTTER,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'top-left',\n      left: anchor.left,\n      top: anchor.top - GUTTER - h,\n      right: 0, bottom: 0\n    },\n    {\n      placement: 'top-right',\n      left: anchor.right - w,\n      top: anchor.top - GUTTER - h,\n      right: 0, bottom: 0\n    },\n  ]\n\n  // Compute right and bottom for each\n  placements.forEach((p) => {\n    p.right = p.left + w\n    p.bottom = p.top + h\n  })\n\n  return placements\n}\n\n/**\n * Select the best placement candidate: prefer the last placement if still valid (stability),\n * otherwise pick the first that fully fits, or the one with maximum visible area.\n */\nexport function findFirstFitOrMaxArea(\n  candidates: Candidate[],\n  viewport: Rect,\n  lastPlacement: Placement | null\n): Candidate {\n  // Check if last placement still fits (for stability)\n  if (lastPlacement) {\n    const last = candidates.find((c) => c.placement === lastPlacement)\n    if (last && fitsInside(last, viewport)) {\n      return last\n    }\n  }\n\n  // First pass: find first that fully fits\n  for (const c of candidates) {\n    if (fitsInside(c, viewport)) {\n      return c\n    }\n  }\n\n  // Second pass: choose candidate with maximum visible area\n  let best = candidates[0]\n  let maxArea = visibleArea(best, viewport)\n\n  for (let i = 1; i < candidates.length; i++) {\n    const area = visibleArea(candidates[i], viewport)\n    if (area > maxArea) {\n      maxArea = area\n      best = candidates[i]\n    }\n  }\n\n  return best\n}\n\n/**\n * Check if a candidate placement fully fits within the viewport bounds.\n */\nexport function fitsInside(candidate: Candidate, viewport: Rect): boolean {\n  return (\n    candidate.left >= viewport.left &&\n    candidate.top >= viewport.top &&\n    candidate.right <= viewport.right &&\n    candidate.bottom <= viewport.bottom\n  )\n}\n\n/**\n * Calculate the visible area (in px²) of a candidate that intersects with the viewport.\n */\nexport function visibleArea(candidate: Candidate, viewport: Rect): number {\n  const left = Math.max(candidate.left, viewport.left)\n  const top = Math.max(candidate.top, viewport.top)\n  const right = Math.min(candidate.right, viewport.right)\n  const bottom = Math.min(candidate.bottom, viewport.bottom)\n\n  if (right <= left || bottom <= top) return 0\n  return (right - left) * (bottom - top)\n}\n\n/**\n * Walk up the DOM tree to find all scrollable ancestor containers of an element.\n */\nexport function getScrollParents(el: HTMLElement): Element[] {\n  const parents: Element[] = []\n  let current: Element | null = el.parentElement\n\n  while (current && current !== document.documentElement) {\n    const style = getComputedStyle(current)\n    const overflowY = style.overflowY\n    const overflowX = style.overflowX\n\n    if (\n      (overflowY === 'auto' || overflowY === 'scroll' || overflowX === 'auto' || overflowX === 'scroll') &&\n      (current.scrollHeight > current.clientHeight || current.scrollWidth > current.clientWidth)\n    ) {\n      parents.push(current)\n    }\n\n    current = current.parentElement\n  }\n\n  // Always include document scrolling element\n  if (document.scrollingElement) {\n    parents.push(document.scrollingElement)\n  }\n\n  return parents\n}\n","/**\n * Shadow DOM Template\n *\n * Defines the component's internal structure.\n * Layout: trigger button + popover panel (preview area + controls).\n *\n * Note: Styles are applied via adoptedStyleSheets in the component.\n */\n\nexport function createTemplate(): HTMLTemplateElement {\n  const template = document.createElement('template')\n  template.innerHTML = `\n  <button class=\"trigger\" part=\"trigger\" aria-haspopup=\"dialog\" aria-label=\"Open color picker\" title=\"Open color picker\">\n    <span class=\"chip\" part=\"chip\"></span>\n  </button>\n  <div class=\"input-wrapper\">\n    <span class=\"error-message\" part=\"error\" role=\"alert\" aria-live=\"polite\"></span>\n    <input type=\"text\" class=\"text-input\" part=\"input\" aria-label=\"Color value\" title=\"Color value\" aria-invalid=\"false\" spellcheck=\"false\" />\n  </div>\n  <div class=\"panel\" popover=\"auto\" part=\"panel\">\n    <div class=\"area-picker\" part=\"area\" role=\"slider\" aria-label=\"Color area picker\" tabindex=\"0\">\n      <canvas class=\"area-canvas\"></canvas>\n      <div class=\"area-thumb\"></div>\n    </div>\n    <div class=\"controls\" part=\"controls\"></div>\n    <div class=\"preview\">\n      <div class=\"copy-wrap\">\n        <button class=\"copy-btn\">\n          <span class=\"visually-hidden\">Copy color</span>\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" aria-hidden=\"true\"><title>Copy color</title><path fill=\"currentColor\" d=\"M5 22q-.825 0-1.413-.588T3 20V6h2v14h11v2H5Zm4-4q-.825 0-1.413-.588T7 16V4q0-.825.588-1.413T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.588 1.413T18 18H9Z\"/></svg>\n        </button>\n        <span class=\"copy-message\" aria-hidden=\"true\">Copied!</span>\n        <span class=\"copy-message-live-region visually-hidden\" role=\"status\"></span>\n      </div>\n      <select class=\"space\" title=\"Colorspace\"></select>\n      <output class=\"info\" part=\"output\"></output>\n      <span class=\"gamut\" title=\"Color's gamut\" part=\"gamut\"></span>\n    </div>\n  </div>\n  `\n\n  return template\n}\n","import { signal, computed, effect, Signal } from '@preact/signals-core'\nimport { parse, serialize, to, toGamut } from 'colorjs.io/fn'\nimport {\n  contrastColor,\n  detectGamut,\n  getColorJSSpaceID,\n  isRGBLike,\n  reverseColorJSSpaceID,\n  type Theme,\n  type ColorSpace\n} from './color'\nimport { AreaPicker } from './area-picker'\nimport { formatChannel } from './utils/channel-formatting'\nimport { gencolor, parseIntoChannels } from './utils/color-conversion'\nimport {\n  computeCandidates,\n  findFirstFitOrMaxArea,\n  getSafeAreaInsets,\n  getScrollParents,\n  getViewportClampRect,\n  type Placement,\n  type Rect,\n  type Size\n} from './utils/positioning'\nimport { createTemplate } from './utils/template'\n// @ts-ignore\nimport styles from './styles/index.css?inline'\n\nexport type { Theme, ColorSpace }\nexport interface ChangeDetail { value: string; colorspace: ColorSpace; gamut: string }\n\nconst DEFAULT_VALUE = 'oklch(75% 75% 180)'\nconst DEFAULT_SPACE: ColorSpace = 'oklch'\n\n// Create shared stylesheet for all component instances\nconst sheet = new CSSStyleSheet()\n// Only call replaceSync if it exists (not available in jsdom)\nif (typeof sheet.replaceSync === 'function') {\n  sheet.replaceSync(styles)\n}\n\nexport class ColorInput extends HTMLElement {\n  static get observedAttributes() { return ['value', 'colorspace', 'theme', 'no-alpha'] }\n\n  // ──────────────────────────────────────────────────────────────────────────────\n  // State: Reactive signals (Preact Signals Core)\n  // ──────────────────────────────────────────────────────────────────────────────\n  #value = signal<string>(DEFAULT_VALUE)\n  #space = signal<ColorSpace>(DEFAULT_SPACE)\n  #theme = signal<Theme>('auto')\n  #open = signal(false)\n  #anchor: Signal<HTMLElement | null> = signal(null)\n  #error = signal<string | null>(null)\n  #noAlpha = signal(false)\n\n  #contrast = computed(() => contrastColor(this.#value.value))\n  #gamut = computed(() => detectGamut(this.#value.value))\n\n  #previewEffectCleanup: ReturnType<typeof effect> | null = null\n  #colorSchemeEffectCleanup: ReturnType<typeof effect> | null = null\n  #errorEffectCleanup: ReturnType<typeof effect> | null = null\n  #controlsEffectCleanup: ReturnType<typeof effect> | null = null\n  #areaPickerEffectCleanup: ReturnType<typeof effect> | null = null\n  #areaPicker?: AreaPicker\n  #programmaticUpdate = false\n\n  get value() { return this.#value.value }\n  set value(v: string) {\n    if (typeof v !== 'string' || !v) return\n    try {\n      const parsed = parse(v)\n      const sid = reverseColorJSSpaceID(parsed.spaceId)\n      const isHex = typeof v === 'string' && v.trim().startsWith('#')\n      this.#space.value = isHex ? 'hex' : (sid === 'rgb' ? 'srgb' : (sid as ColorSpace))\n      this.#value.value = v\n      this.#programmaticUpdate = true\n      this.setAttribute('value', v)\n      this.setAttribute('colorspace', this.#space.value)\n      this.#programmaticUpdate = false\n      this.#emitChange()\n    } catch { }\n  }\n\n  get colorspace() { return this.#space.value }\n  set colorspace(s: ColorSpace | string) {\n    const next = (s as ColorSpace) || DEFAULT_SPACE\n    this.#space.value = next\n    this.#programmaticUpdate = true\n    this.setAttribute('colorspace', next)\n    try {\n      const current = parse(this.#value.value)\n      const targetSpace = next === 'hex' ? 'srgb' : next\n      const converted = toGamut(to(current, getColorJSSpaceID(targetSpace)))\n      const tempStr = serialize(converted, { precision: 12 })\n      const parsed = parseIntoChannels(next, tempStr)\n      const newValue = gencolor(next, parsed.ch)\n      this.#value.value = newValue\n      this.setAttribute('value', newValue)\n      this.#emitChange()\n    } catch { }\n    this.#programmaticUpdate = false\n    // Re-render controls for new colorspace\n    if (this.#controls) this.#renderControls()\n  }\n\n  get theme() { return this.#theme.value }\n  set theme(t: Theme | string) {\n    const next: Theme = (t === 'light' || t === 'dark') ? t : 'auto'\n    this.#theme.value = next\n    if (next === 'auto') this.removeAttribute('theme')\n    else this.setAttribute('theme', next)\n  }\n\n  get noAlpha() { return this.#noAlpha.value }\n  set noAlpha(v: boolean) {\n    this.#noAlpha.value = !!v\n    if (v) this.setAttribute('no-alpha', '')\n    else this.removeAttribute('no-alpha')\n  }\n\n  get gamut() { return this.#gamut.value }\n  get contrastColor() { return this.#contrast.value }\n\n  show(anchor?: HTMLElement | null) {\n    if (anchor) this.#anchor.value = anchor\n    this.#panel?.showPopover?.();\n    this.#startReposition()\n  }\n  close() { this.#panel?.hidePopover?.(); this.#stopReposition() }\n  showPicker() { this.show() }\n\n  setAnchor(el: HTMLElement | null) { this.#anchor.value = el }\n  set setColor(v: string) { this.value = v }\n  set setAnchorElement(el: HTMLElement | null) { this.setAnchor(el) }\n\n  // ──────────────────────────────────────────────────────────────────────────────\n  // DOM references\n  // ──────────────────────────────────────────────────────────────────────────────\n  #root: ShadowRoot\n  #panel?: HTMLElement & { showPopover?: () => void; hidePopover?: () => void }\n  #controls?: HTMLElement\n  #spaceSelect?: HTMLSelectElement\n  #output?: HTMLOutputElement\n  #chip?: HTMLElement\n  #internalTrigger?: HTMLButtonElement\n  #textInput?: HTMLInputElement\n  #errorMessage?: HTMLElement\n  #lastInvoker: HTMLElement | null = null\n\n  constructor() {\n    super()\n    this.#root = this.attachShadow({ mode: 'open', delegatesFocus: true })\n\n    // Adopt shared stylesheet if supported, otherwise inject inline styles\n    if ('adoptedStyleSheets' in this.#root && typeof sheet.replaceSync === 'function') {\n      this.#root.adoptedStyleSheets = [sheet]\n    } else {\n      // Fallback for environments without adoptedStyleSheets support (e.g., jsdom)\n      const styleEl = document.createElement('style')\n      styleEl.textContent = styles\n      this.#root.appendChild(styleEl)\n    }\n\n    // Add template content\n    const template = createTemplate()\n    this.#root.appendChild(template.content.cloneNode(true))\n  }\n\n  connectedCallback() {\n    const btn = this.#root.querySelector<HTMLButtonElement>('button.trigger')\n    this.#internalTrigger = btn ?? undefined\n    this.#panel = this.#root.querySelector('.panel') as any\n    this.#controls = this.#root.querySelector('.controls') as HTMLElement\n    this.#spaceSelect = this.#root.querySelector('.space') as HTMLSelectElement\n    this.#output = this.#root.querySelector('output.info') as HTMLOutputElement\n    this.#chip = this.#root.querySelector('.chip') as HTMLElement\n    this.#textInput = this.#root.querySelector('.text-input') as HTMLInputElement\n    this.#errorMessage = this.#root.querySelector('.error-message') as HTMLElement\n\n    // Initialize AreaPicker only when visible\n    const areaPickerEl = this.#root.querySelector<HTMLElement>('.area-picker')\n    if (areaPickerEl && getComputedStyle(areaPickerEl).display !== 'none') {\n      this.#areaPicker = new AreaPicker(areaPickerEl, (color) => {\n        this.#value.value = color\n        this.setAttribute('value', color)\n        this.#emitChange()\n        this.#renderControls()\n      })\n\n      // Sync area picker when color changes\n      this.#areaPickerEffectCleanup = effect(() => {\n        const v = this.#value.value\n        const space = this.#space.value\n        this.#areaPicker?.setValue(v, space)\n      })\n    }\n\n    // Copy to clipboard\n    const copyBtn = this.#root.querySelector<HTMLButtonElement>('button.copy-btn')\n    const copyMessage = this.#root.querySelector<HTMLElement>('.copy-message')\n    const copyMessageLiveRegion = this.#root.querySelector<HTMLElement>('.copy-message-live-region')\n    if (copyBtn && copyMessage && copyMessageLiveRegion) {\n      let copyTimeout: number | null = null\n      copyBtn.addEventListener('click', async () => {\n        try {\n          await navigator.clipboard.writeText(this.#value.value)\n          copyMessage.classList.add('show')\n          copyMessageLiveRegion.innerText = copyMessage.innerText\n          if (copyTimeout !== null) clearTimeout(copyTimeout)\n          copyTimeout = window.setTimeout(() => {\n            copyMessage.classList.remove('show')\n            copyMessageLiveRegion.innerText = \"\"\n            copyTimeout = null\n          }, 3000)\n        } catch { }\n      })\n    }\n\n    // Init space options\n    this.#spaceSelect.innerHTML = `\n      <optgroup label=\"Standard\">\n        <option value=\"hex\">hex</option>\n        <option value=\"srgb\">rgb</option>\n        <option value=\"srgb-linear\">srgb-linear</option>\n        <option value=\"hsl\">hsl</option>\n        <option value=\"hwb\">hwb</option>\n      </optgroup>\n      <optgroup label=\"HDR\">\n        <option value=\"display-p3\">display-p3</option>\n        <option value=\"a98-rgb\">a98-rgb</option>\n      </optgroup>\n      <optgroup label=\"Ultra HDR\">\n        <option value=\"lab\">lab</option>\n        <option value=\"lch\">lch</option>\n        <option value=\"oklch\">oklch</option>\n        <option value=\"oklab\">oklab</option>\n        <option value=\"rec2020\">rec2020</option>\n        <option value=\"prophoto\">prophoto</option>\n        <option value=\"xyz\">xyz</option>\n        <option value=\"xyz-d50\">xyz-d50</option>\n        <option value=\"xyz-d65\">xyz-d65</option>\n      </optgroup>\n    `\n\n    if (btn) btn.addEventListener('click', () => this.show(btn))\n\n    // Text input validation\n    if (this.#textInput) {\n      this.#textInput.value = this.#value.value\n\n      this.#textInput.addEventListener('input', (e) => {\n        const inputValue = (e.target as HTMLInputElement).value\n        this.#validateAndSetColor(inputValue)\n      })\n\n      this.#textInput.addEventListener('paste', (e) => {\n        // Allow default paste, then validate via input event\n      })\n    }\n\n    // Command API handler\n    this.addEventListener('command', (ev: Event) => {\n      const command = (ev as any).command as string | undefined\n      if (!command) return\n      const possibleInvoker = (ev as any).source || (ev as any).invoker || (document.activeElement instanceof HTMLElement ? document.activeElement : null)\n      if (possibleInvoker) { this.#lastInvoker = possibleInvoker; this.setAnchor(possibleInvoker) }\n      if (command === 'show-popover' || command === 'show') this.show(this.#lastInvoker)\n      else if (command === 'hide-popover' || command === 'close') this.close()\n      else if (command === 'toggle-popover' || command === 'toggle') {\n        if (this.#open.value) this.close(); else this.show(this.#lastInvoker)\n      }\n    })\n\n    this.#panel?.addEventListener('toggle', () => {\n      const el = this.#panel as HTMLElement\n      let isOpen = !el.hasAttribute('hidden')\n      try {\n        isOpen = el.matches(':popover-open') ?? false\n      } catch { }\n      this.#open.value = isOpen\n      if (isOpen) {\n        this.#startReposition()\n      } else {\n        this.#stopReposition()\n      }\n      this.dispatchEvent(new CustomEvent(isOpen ? 'open' : 'close', { bubbles: true }))\n    })\n\n    this.#spaceSelect.addEventListener('change', () => {\n      this.colorspace = this.#spaceSelect!.value as ColorSpace\n      this.#renderControls()\n    })\n\n    // Reactive effects\n    this.#previewEffectCleanup = effect(() => {\n      const v = this.#value.value\n      const gamut = this.#gamut.value\n      const contrast = this.#contrast.value\n      if (this.#output) this.#output.value = v\n      if (this.#chip) this.#chip.style.setProperty('--value', v)\n      if (this.#textInput && this.#textInput.value !== v) {\n        this.#textInput.value = v\n      }\n      this.style.setProperty('--contrast', contrast)\n      this.style.setProperty('--counter', contrast === 'white' ? 'black' : 'white')\n      const gamutEl = this.#root.querySelector('.gamut') as HTMLElement\n      if (gamutEl) gamutEl.textContent = gamut\n      const preview = this.#root.querySelector('.preview') as HTMLElement\n      if (preview) preview.style.setProperty('--value', v)\n    })\n\n    this.#errorEffectCleanup = effect(() => {\n      const error = this.#error.value\n      if (error) {\n        this.setAttribute('data-error', '')\n        if (this.#errorMessage) this.#errorMessage.textContent = error\n        if (this.#textInput) this.#textInput.setAttribute('aria-invalid', 'true')\n      } else {\n        this.removeAttribute('data-error')\n        if (this.#errorMessage) this.#errorMessage.textContent = ''\n        if (this.#textInput) this.#textInput.setAttribute('aria-invalid', 'false')\n      }\n    })\n\n    this.#colorSchemeEffectCleanup = effect(() => {\n      const theme = this.#theme.value\n      const colorScheme = theme === 'auto' ? 'light dark' : theme\n      this.style.setProperty('color-scheme', colorScheme)\n    })\n\n    // Defaults\n    if (!this.hasAttribute('value')) this.setAttribute('value', DEFAULT_VALUE)\n    if (!this.hasAttribute('colorspace')) {\n      // If we have a value attribute, the colorspace was already detected in attributeChangedCallback\n      // So we should sync the attribute with the detected internal space value\n      this.setAttribute('colorspace', this.#space.value)\n    }\n\n    this.#spaceSelect.value = this.#space.value\n    this.#renderControls()\n  }\n\n  disconnectedCallback() {\n    this.#colorSchemeEffectCleanup?.()\n    this.#previewEffectCleanup?.()\n    this.#errorEffectCleanup?.()\n    this.#areaPickerEffectCleanup?.()\n    this.#areaPicker?.unmount()\n  }\n\n  attributeChangedCallback(name: string, _old: string | null, value: string | null) {\n    if (value === _old) return\n    // Skip processing if this is from a programmatic update (avoid circular event emissions)\n    if (this.#programmaticUpdate) return\n\n    if (name === 'value' && typeof value === 'string') {\n      try {\n        const parsed = parse(value)\n        const sid = reverseColorJSSpaceID(parsed.spaceId)\n        const isHex = typeof value === 'string' && value.trim().startsWith('#')\n        this.#value.value = value\n        this.#space.value = isHex ? 'hex' : (sid === 'rgb' ? 'srgb' : (sid as ColorSpace))\n        if (this.#spaceSelect) this.#spaceSelect.value = this.#space.value\n      } catch { }\n    }\n    if (name === 'colorspace' && value) {\n      this.#space.value = value as ColorSpace\n      if (this.#spaceSelect) this.#spaceSelect.value = value\n    }\n    if (name === 'theme') {\n      this.#theme.value = (value as Theme) || 'auto'\n    }\n    if (name === 'no-alpha') {\n      this.#noAlpha.value = value !== null\n      if (this.#controls) this.#renderControls()\n    }\n  }\n\n  #emitChange() {\n    const detail: ChangeDetail = { value: this.#value.value, colorspace: this.#space.value, gamut: this.#gamut.value }\n    this.dispatchEvent(new CustomEvent<ChangeDetail>('change', { detail, bubbles: true }))\n  }\n\n  #validateAndSetColor(inputValue: string) {\n    if (!inputValue || !inputValue.trim()) {\n      this.#error.value = 'Invalid color format'\n      return\n    }\n\n    try {\n      const parsed = parse(inputValue)\n      const sid = reverseColorJSSpaceID(parsed.spaceId)\n      const isHex = typeof inputValue === 'string' && inputValue.trim().startsWith('#')\n\n      // Clear error on success\n      this.#error.value = null\n\n      // Update value and colorspace\n      this.#space.value = isHex ? 'hex' : (sid === 'rgb' ? 'srgb' : (sid as ColorSpace))\n      this.#value.value = inputValue\n      this.setAttribute('value', inputValue)\n      this.setAttribute('colorspace', this.#space.value)\n      if (this.#spaceSelect) this.#spaceSelect.value = this.#space.value\n      this.#emitChange()\n    } catch (error) {\n      this.#error.value = 'Invalid color format'\n    }\n  }\n\n  // ──────────────────────────────────────────────────────────────────────────────\n  // Positioning system\n  // ──────────────────────────────────────────────────────────────────────────────\n  #lastPlacement: Placement | null = null\n  #lastPanelSize: Size | null = null\n  #cleanup: Array<() => void> = []\n  #rafId: number | null = null\n\n  #startReposition() {\n    if (this.#cleanup.length) return\n    this.#scheduleReposition()\n\n    const anchor = this.#anchor.value ?? this.#lastInvoker ?? this.#internalTrigger\n    if (!anchor || !this.#panel) return\n\n    if (typeof ResizeObserver !== 'undefined') {\n      const ro = new ResizeObserver(() => this.#scheduleReposition())\n      ro.observe(anchor)\n      ro.observe(this.#panel)\n      ro.observe(document.documentElement)\n      this.#cleanup.push(() => ro.disconnect())\n    } else {\n      const onResize = () => this.#scheduleReposition()\n      window.addEventListener('resize', onResize)\n      this.#cleanup.push(() => window.removeEventListener('resize', onResize))\n    }\n\n    if (window.visualViewport) {\n      const onVV = () => this.#scheduleReposition()\n      window.visualViewport.addEventListener('resize', onVV)\n      window.visualViewport.addEventListener('scroll', onVV)\n      this.#cleanup.push(() => {\n        window.visualViewport?.removeEventListener('resize', onVV)\n        window.visualViewport?.removeEventListener('scroll', onVV)\n      })\n    }\n\n    const scrollParents = getScrollParents(anchor)\n    scrollParents.forEach((sp) => {\n      const onScroll = () => this.#scheduleReposition()\n      sp.addEventListener('scroll', onScroll, { passive: true })\n      this.#cleanup.push(() => sp.removeEventListener('scroll', onScroll))\n    })\n\n    if (typeof IntersectionObserver !== 'undefined') {\n      const io = new IntersectionObserver(() => this.#scheduleReposition(), { threshold: 0 })\n      io.observe(anchor)\n      this.#cleanup.push(() => io.disconnect())\n    }\n  }\n\n  #stopReposition() {\n    this.#cleanup.forEach((fn) => fn())\n    this.#cleanup = []\n    if (this.#rafId !== null) {\n      cancelAnimationFrame(this.#rafId)\n      this.#rafId = null\n    }\n  }\n\n  #scheduleReposition() {\n    if (this.#rafId !== null) return\n    this.#rafId = requestAnimationFrame(() => {\n      this.#rafId = null\n      this.#positionNow()\n    })\n  }\n\n  #positionNow() {\n    if (!this.#panel) return\n    const panel = this.#panel as HTMLElement\n\n    const anchorRect = this.#getAnchorRect()\n    const insets = getSafeAreaInsets()\n    const viewport = getViewportClampRect(insets)\n    const size = this.#measurePanel(panel)\n\n    const candidates = computeCandidates(anchorRect, size)\n    const pick = findFirstFitOrMaxArea(candidates, viewport, this.#lastPlacement)\n    this.#lastPlacement = pick.placement\n\n    const left = Math.round(Math.min(Math.max(pick.left, viewport.left), viewport.right - size.width))\n    const top = Math.round(Math.min(Math.max(pick.top, viewport.top), viewport.bottom - size.height))\n\n    const maxPanelHeight = viewport.bottom - viewport.top\n    if (size.height > maxPanelHeight) {\n      panel.style.maxHeight = `${maxPanelHeight}px`\n      panel.style.overflow = 'auto'\n    } else if (panel.style.maxHeight) {\n      panel.style.maxHeight = ''\n      panel.style.overflow = ''\n    }\n\n    panel.style.position = 'absolute'\n    panel.style.left = `${left}px`\n    panel.style.top = `${top}px`\n    panel.style.setProperty('--ci-panel-placement', pick.placement)\n    panel.dataset.placement = pick.placement\n  }\n\n  #getAnchorRect(): Rect {\n    const anchor = this.#anchor.value ?? this.#lastInvoker ?? this.#internalTrigger ?? this\n    const scrollX = window.pageXOffset || document.documentElement.scrollLeft\n    const scrollY = window.pageYOffset || document.documentElement.scrollTop\n\n    if (!anchor.isConnected) {\n      const vw = window.visualViewport?.width ?? window.innerWidth\n      const vh = window.visualViewport?.height ?? window.innerHeight\n      const cx = vw / 2 + scrollX\n      const cy = vh / 2 + scrollY\n      return { left: cx, top: cy, right: cx, bottom: cy, width: 0, height: 0 }\n    }\n    const rect = anchor.getBoundingClientRect()\n    return {\n      left: rect.left + scrollX,\n      top: rect.top + scrollY,\n      right: rect.right + scrollX,\n      bottom: rect.bottom + scrollY,\n      width: rect.width,\n      height: rect.height,\n    }\n  }\n\n  #measurePanel(panel: HTMLElement): Size {\n    const rect = panel.getBoundingClientRect()\n    if (rect.width > 0 && rect.height > 0) {\n      this.#lastPanelSize = { width: rect.width, height: rect.height }\n      return this.#lastPanelSize\n    }\n\n    const saved = {\n      display: panel.style.display,\n      position: panel.style.position,\n      left: panel.style.left,\n      top: panel.style.top,\n      visibility: panel.style.visibility,\n      maxHeight: panel.style.maxHeight,\n    }\n    panel.style.display = 'block'\n    panel.style.position = 'absolute'\n    panel.style.left = '-99999px'\n    panel.style.top = '0'\n    panel.style.visibility = 'hidden'\n    panel.style.maxHeight = 'none'\n\n    const rect2 = panel.getBoundingClientRect()\n    panel.style.display = saved.display\n    panel.style.position = saved.position\n    panel.style.left = saved.left\n    panel.style.top = saved.top\n    panel.style.visibility = saved.visibility\n    panel.style.maxHeight = saved.maxHeight\n\n    if (rect2.width > 0 && rect2.height > 0) {\n      this.#lastPanelSize = { width: rect2.width, height: rect2.height }\n      return this.#lastPanelSize\n    }\n\n    return this.#lastPanelSize ?? { width: 560, height: 400 }\n  }\n\n  // ──────────────────────────────────────────────────────────────────────────────\n  // Control rendering\n  // ──────────────────────────────────────────────────────────────────────────────\n  #renderControls() {\n    if (this.#controlsEffectCleanup) this.#controlsEffectCleanup()\n    const space = this.#space.value\n    if (!this.#controls) return\n    const current = parseIntoChannels(space, this.#value.value)\n    const ch = current.ch\n\n    const channelSignals: Record<string, ReturnType<typeof signal<string>>> = {}\n    Object.keys(ch).forEach(key => {\n      channelSignals[key] = signal(String(ch[key]))\n    })\n\n    const make = (label: string, key: string, min: number, max: number, step = 1, bg?: string, bgColor?: string) => {\n      const wrapHue = key === 'H'\n      const isPercentage = ['L', 'S', 'C', 'W', 'B', 'R', 'G', 'ALP'].includes(key)\n      const isAngle = key === 'H'\n\n      const group = document.createElement('div')\n      group.className = 'control'\n      const lab = document.createElement('label')\n      lab.textContent = label\n      const titleMap: Record<string, string> = {\n        'L': 'Lightness',\n        'C': 'Chroma',\n        'H': 'Hue',\n        'S': 'Saturation',\n        'A': 'A (green-red axis)',\n        'W': 'Whiteness',\n        'R': 'Red',\n        'G': 'Green',\n        'ALP': 'Alpha'\n      }\n      if (key === 'B') {\n        if (space === 'oklab' || space === 'lab') {\n          lab.title = 'B (blue-yellow axis)'\n        } else if (space === 'hwb') {\n          lab.title = 'Blackness'\n        } else {\n          lab.title = 'Blue'\n        }\n      } else if (titleMap[key]) {\n        lab.title = titleMap[key]\n      }\n      const range = document.createElement('input')\n      range.type = 'range'\n      range.min = String(min)\n      range.max = String(max)\n      range.step = String(step)\n      range.classList.add(`ch-${key.toLowerCase()}`)\n      if (bg) range.style.backgroundImage = bg\n      if (bgColor) range.style.backgroundColor = bgColor\n      range.value = String(ch[key] ?? 0)\n      if (key === 'ALP') {\n        range.classList.add('alpha')\n        try {\n          const c0 = gencolor(space, { ...ch, ALP: '0' })\n          const c1 = gencolor(space, { ...ch, ALP: '100' })\n          const interpSpace = space === 'hsl' ? 'hsl' : (space === 'lch' ? 'lch' : (space === 'oklch' ? 'oklch' : 'oklab'))\n          range.style.background = `linear-gradient(to right in ${interpSpace}, ${c0}, ${c1}), var(--checker)`\n        } catch { }\n      }\n      const num = document.createElement('input')\n      num.type = 'number'\n      num.min = String(min)\n      num.max = String(max)\n      num.step = String(step)\n      num.classList.add(`ch-${key.toLowerCase()}`)\n      num.value = String(ch[key] ?? 0)\n\n      const numWrapper = document.createElement('div')\n      numWrapper.className = 'num-wrapper'\n      numWrapper.appendChild(num)\n      if (isPercentage || isAngle) {\n        const unit = document.createElement('sup')\n        unit.textContent = isAngle ? '°' : '%'\n        numWrapper.appendChild(unit)\n      }\n\n      const apply = () => {\n        const next = gencolor(space, ch)\n        this.#value.value = next\n        this.setAttribute('value', next)\n        this.#emitChange()\n      }\n\n      const onInput = (ev: Event) => {\n        const target = ev.target as HTMLInputElement\n        let val = Number(target.value)\n        if (!Number.isFinite(val)) return\n        if (wrapHue) {\n          val = ((val % 360) + 360) % 360\n        } else {\n          val = Math.max(min, Math.min(max, val))\n        }\n        const formatted = formatChannel(space, key, val)\n        ch[key] = formatted\n        channelSignals[key].value = formatted\n        // keep controls in sync\n        range.value = String(ch[key])\n        num.value = String(ch[key])\n        apply()\n      }\n\n      range.addEventListener('input', onInput)\n      num.addEventListener('input', onInput)\n      group.append(lab, range, numWrapper)\n      return group\n    }\n\n    this.#controls.innerHTML = ''\n\n    if (space === 'oklab') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('L', 'L', 0, 100, 1, 'linear-gradient(in oklab to right, black, white)'),\n        make('A', 'A', -0.5, 0.5, 0.01, 'linear-gradient(to right in oklab, oklab(65% -.5 .5), oklab(65% .5 .5))'),\n        make('B', 'B', -0.5, 0.5, 0.01, 'linear-gradient(to right in oklab, oklab(47% -.03 -.32), oklab(96% 0 .25))'),\n        alphaControl\n      )\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const L = channelSignals.L.value || '50'\n        const A = channelSignals.A.value || '0'\n        const B = channelSignals.B.value || '0'\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in oklab, oklab(${L}% ${A} ${B} / 0%), oklab(${L}% ${A} ${B} / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'oklch') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('L', 'L', 0, 100, 1, 'linear-gradient(in oklab to right, black, white)'),\n        make('C', 'C', 0, 100, 1, `linear-gradient(in oklch to right, oklch(${ch.L ?? 0}% 1% ${ch.H ?? 0}), oklch(${ch.L ?? 0}% 100% ${ch.H ?? 0}))`),\n        make('H', 'H', 0, 359, 1, 'linear-gradient(to right in oklch longer hue, oklch(90% 75% 0), oklch(90% 75% 0))'),\n        alphaControl\n      )\n      const cRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-c')\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const L = channelSignals.L.value || '0'\n        const C = channelSignals.C.value || '0'\n        const H = channelSignals.H.value || '0'\n        if (cRange) {\n          cRange.style.backgroundImage = `linear-gradient(in oklch to right, oklch(${L}% 1% ${H}deg), oklch(${L}% 100% ${H}deg))`\n        }\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in oklch, oklch(${L}% ${C}% ${H} / 0%), oklch(${L}% ${C}% ${H} / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'lab') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('L', 'L', 0, 100, 1, 'linear-gradient(in lab to right, black, white)'),\n        make('A', 'A', -160, 160, 1, 'linear-gradient(to right in oklab, lab(85% -100 100), lab(55% 100 100))'),\n        make('B', 'B', -160, 160, 1, 'linear-gradient(to right in oklab, lab(31% 70 -120), lab(96% 0 120))'),\n        alphaControl\n      )\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const L = channelSignals.L.value || '50'\n        const A = channelSignals.A.value || '0'\n        const B = channelSignals.B.value || '0'\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in lab, lab(${L}% ${A} ${B} / 0%), lab(${L}% ${A} ${B} / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'lch') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('L', 'L', 0, 100, 1, 'linear-gradient(in lab to right, black, white)'),\n        make('C', 'C', 0, 100, 1, `linear-gradient(in lch to right, lch(${ch.L ?? 0}% 1% ${ch.H ?? 0}), lch(${ch.L ?? 0}% 100% ${ch.H ?? 0}))`),\n        make('H', 'H', 0, 359, 1, 'linear-gradient(to right in lch longer hue, lch(90% 75% 0), lch(90% 75% 0))'),\n        alphaControl\n      )\n      const cRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-c')\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const L = channelSignals.L.value || '50'\n        const C = channelSignals.C.value || '0'\n        const H = channelSignals.H.value || '0'\n        if (cRange) {\n          cRange.style.backgroundImage = `linear-gradient(in lch to right, lch(${L}% 1% ${H}), lch(${L}% 100% ${H}))`\n        }\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in lch, lch(${L}% ${C}% ${H} / 0%), lch(${L}% ${C}% ${H} / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'hsl') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('H', 'H', 0, 359, 1, 'linear-gradient(to right in hsl longer hue, hsl(0 100% 50%), hsl(360 100% 50%))'),\n        make('S', 'S', 0, 100, 1, `linear-gradient(in hsl to right, hsl(${ch.H ?? 0} 0% ${ch.L ?? 50}% / 100%), hsl(${ch.H ?? 0} 100% ${ch.L ?? 50}% / 100%))`),\n        make('L', 'L', 0, 100, 1, `linear-gradient(in oklab to right, hsl(${ch.H ?? 0} ${ch.S ?? 100}% 0%), hsl(${ch.H ?? 0} ${ch.S ?? 100}% 100%))`),\n        alphaControl\n      )\n      const sRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-s')\n      const lRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-l')\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const H = channelSignals.H.value || '0'\n        const S = channelSignals.S.value || '100'\n        const L = channelSignals.L.value || '50'\n        if (sRange) {\n          sRange.style.backgroundImage = `linear-gradient(in hsl to right, hsl(${H} 0% ${L}% / 100%), hsl(${H} 100% ${L}% / 100%))`\n        }\n        if (lRange) {\n          lRange.style.backgroundImage = `linear-gradient(in oklab to right, hsl(${H} ${S}% 0%), hsl(${H} ${S}% 100%))`\n        }\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in hsl, hsl(${H} ${S}% ${L}% / 0%), hsl(${H} ${S}% ${L}% / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'hwb') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('H', 'H', 0, 359, 1, 'linear-gradient(to right in hsl longer hue, hsl(0 100% 50%), hsl(360 100% 50%))'),\n        make('W', 'W', 0, 100, 1, 'linear-gradient(to right in oklab, #fff0, #fff)', 'black'),\n        make('B', 'B', 0, 100, 1, 'linear-gradient(to right in oklab, #0000, #000)', 'white'),\n        alphaControl\n      )\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const H = channelSignals.H.value || '0'\n        const W = channelSignals.W.value || '0'\n        const B = channelSignals.B.value || '0'\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in hwb, hwb(${H} ${W}% ${B}% / 0%), hwb(${H} ${W}% ${B}% / 100%)), var(--checker)`\n        }\n      })\n    } else if (space === 'srgb' || space === 'hex') {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('R', 'R', 0, 100, 1, 'linear-gradient(to right in oklab, #f000, #f00)', 'black'),\n        make('G', 'G', 0, 100, 1, 'linear-gradient(to right in oklab, #0f00, #0f0)', 'black'),\n        make('B', 'B', 0, 100, 1, 'linear-gradient(to right in oklab, #00f0, #00f)', 'black'),\n        alphaControl\n      )\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const R = channelSignals.R.value || '0'\n        const G = channelSignals.G.value || '0'\n        const B = channelSignals.B.value || '0'\n        if (alphaRange) {\n          alphaRange.style.background = `linear-gradient(to right in srgb, rgb(${R}% ${G}% ${B}% / 0%), rgb(${R}% ${G}% ${B}% / 100%)), var(--checker)`\n        }\n      })\n    } else if (isRGBLike(space)) {\n      const alphaControl = make('A', 'ALP', 0, 100, 1)\n      if (this.#noAlpha.value) alphaControl.style.display = 'none'\n      this.#controls.append(\n        make('R', 'R', 0, 100, 1, 'linear-gradient(to right in oklab, #f000, #f00)', 'black'),\n        make('G', 'G', 0, 100, 1, 'linear-gradient(to right in oklab, #0f00, #0f0)', 'black'),\n        make('B', 'B', 0, 100, 1, 'linear-gradient(to right in oklab, #00f0, #00f)', 'black'),\n        alphaControl\n      )\n      const alphaRange = this.#controls.querySelector<HTMLInputElement>('input[type=\"range\"].ch-alp')\n      this.#controlsEffectCleanup = effect(() => {\n        const R = channelSignals.R.value || '0'\n        const G = channelSignals.G.value || '0'\n        const B = channelSignals.B.value || '0'\n        if (alphaRange) {\n          const c0 = gencolor(space, { ...ch, R, G, B, ALP: '0' })\n          const c1 = gencolor(space, { ...ch, R, G, B, ALP: '100' })\n          alphaRange.style.background = `linear-gradient(to right, ${c0}, ${c1}), var(--checker)`\n        }\n      })\n    }\n  }\n}\n\ncustomElements.define('color-input', ColorInput)\n\ndeclare global {\n  interface HTMLElementTagNameMap { 'color-input': ColorInput }\n}\n"],"names":["_space","i","t","o","r","n","d","b","g","p","a","y","to","max","_a","type","_","c","name","adapt","_b","_c","ε","white","coords","options","s","XYZ_D65","ε3","κ","xyz_d50","f","Lab","h","constrainAngle","lch","π","d2r","XYZtoLMS_M","LMStoXYZ_M","oklab","c1","c2","l","v","c3","Jzazbz","m1","tau","deg2rad","viewingConditions","hct","util.isString","util.isNone","clipped","_color","min","util.clamp","E","inGamut","checkInGamut","util.serializeNumber","toXYZ_M","fromXYZ_M","REC2020Linear","contrast","hsl","hwb","w","OKLab","lab","b2","f2","colorjs.ColorSpace","colorjs.sRGB","colorjs.sRGB_Linear","colorjs.HSL","colorjs.HWB","colorjs.Lab","colorjs.LCH","colorjs.OKLab","colorjs.OKLCH","colorjs.P3","colorjs.A98RGB","colorjs.ProPhoto","colorjs.REC_2020","colorjs.XYZ_D65","colorjs.XYZ_D50","colorjs.Okhsv","s2","getColor","signal","computed","effect","e"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68]}